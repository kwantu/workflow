(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.Workflow = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";function Workflow(e,s,r){var t=this;if(""===e||void 0===e)throw util.error("ParamRequired","A profile id is required.");if("string"!=typeof e)throw new Error("The profile id must be a javascript string.");if(t.profile=e||"",""===s||void 0===s)throw util.error("ParamRequired","An app id is required.");if("string"!=typeof s)throw new Error("The app id must be a javascript string.");if(t.app=s||"",""===r||void 0===r)throw util.error("ParamRequired","A workflow configuration is required.");"object"!=typeof r?t.config=JSON.parse(r):t.config=r,t.instance,t.subprocesses=[],t.indicators=[],t.history=[]}var Process=require("./lib/process"),util=require("utility"),userInterface=require("./lib/interface");Workflow.prototype.getProfile=function(){return this.profile},Workflow.prototype.getApp=function(){return this.app},Workflow.prototype.getConfig=function(){return this.config},Workflow.prototype.getInstance=function(){return this.instance},Workflow.prototype.setInstance=function(e){this.instance=e},Workflow.prototype.getSubProcesses=function(){return this.subprocesses},Workflow.prototype.setSubProcesses=function(e){this.subprocesses=e},Workflow.prototype.getIndicators=function(){return this.indicators},Workflow.prototype.setIndicators=function(e){this.indicators=e},Workflow.prototype.create=function(){var e=this;return new Promise(function(s,r){try{if(void 0!==e.instance){var t=util.warn("Instance already exists.",e);s(t)}else{var o={_id:"",version:"",type:"workflowInstance",processes:[]};o._id=e.profile+":processes",o.version=e.config.version,e.instance=o;var i=util.success("Workflow processes instance created successfully.",e);s(i)}}catch(e){r(e)}})},Workflow.prototype.initialise=function(e,s){var r=this;return new Promise(function(t,o){try{var i=[];if(""!==e&&void 0!==e){if(i=r.config.processes.filter(function(s){if(s._id===e)return s}),void 0===i[0]._id){var n=util.error("WFConfigError","No valid process definition found with process id: "+e);o(n)}}else i.push(r.config.processes[0]),e=r.config.processes[0]._id;var c=[];r.instance.processes.filter(function(s){s.id===e&&c.push(s)});var u=c.length+1,f={id:"",seq:"",subProcesses:[]};f.id=e,f.seq=u,r.instance.processes.push(f);var a=i[0].subProcesses[0]._id,p=1;r.instance.processes.filter(function(s){s.id===e&&s.seq===u&&(p=s.subProcesses.length+1)}),Process.subProcess(e,u,a,p,s,r).then(function(s){var i=r.profile+":"+r.app+":"+e+":"+u+":"+a+":"+p,n={id:a,seq:p,uuid:i};f.subProcesses.push(n),r.subprocesses.push(s.data);for(var c=0;c<r.instance.processes.length;c++){var l=r.instance.processes[c];l.id===e&&l.seq===u&&r.instance.processes.splice(c,1,f)}var d=s.data.indicators,h=s.data.step;Process.indicatorDocs(e,d,h,r).then(function(e){var s=util.success("Process: "+r.config.processes[0]._id+" initialized successfully.",r);t(s)},function(e){o(e)})},function(e){o(e)})}catch(e){o(e)}})},Workflow.prototype.transition=function(e,s,r,t,o,i,n){var c=this;return new Promise(function(u,f){try{Process.transition(e,s,r,t,o,i,n,c).then(function(o){var i=function(i){c.instance.processes.filter(function(n){n.id===e&&n.seq===s&&n.subProcesses.filter(function(e){e.id===r&&e.seq===t&&c.subprocesses.filter(function(s){if(s._id===e.uuid)if("step"===i){s.step=o.data;var r=util.success(o.message,s);u(r)}else if("stepComplete"===i){s.step=o.data.step,s.complete=!0;var r=util.success(o.message,s);u(r)}})})})};i(o.data.subProcessComplete?"stepComplete":"step")},function(e){f(e)})}catch(e){f(e)}})},Workflow.prototype.assignUser=function(e,s,r,t,o){return new Promise(function(e,s){try{e(o)}catch(e){s(e)}})},Workflow.prototype.ui=function(){var e=this;return{getProcess:function(s,r){return new Promise(function(t,o){try{userInterface.getProcess(s,r,e).then(function(e){t(e)},function(e){o(e)})}catch(e){o(e)}})}}},module.exports=Workflow;

},{"./lib/interface":3,"./lib/process":4,"utility":5}],2:[function(require,module,exports){
"use strict";function create(e){var s=e[0]||"",t=e[1]||{},i=t.indicators||[],c=e[3]||{},r=e[2]||{};return new Promise(function(e,u){util.syncLoop(i.length,function(e){var u=e.iteration(),n=i[u]._id,a=util.getName(i[u].name,"en"),o=c.profile+":"+c.app+":"+n+":0",l={_id:o,title:a,category:{term:n,label:a},workflows:[{id:c.config._id,instance:c.instance._id,processes:[{id:s,subProcessId:t._id,step:{id:r.id,seq:r.seq,startDate:"",status:r.status,message:r.message,assignedTo:{userId:r.assignedTo.userId,name:r.assignedTo.name},comment:r.comment,complete:!1,endDate:""}}]}]};c.indicators.push(l),e.next()},function(){var s=util.success("Form created successfully.",c.indicators);e(s)})})}function save(e){var s={complete:!0,data:[]};return new Promise(function(e,t){var i=util.success("Form indicator set saved successfully.",s);e(i)})}function submit(e){var s={complete:!0,data:[]};return new Promise(function(e,t){var i=util.success("Form submitted successfully.",s);e(i)})}function authorise(e){var s={complete:!0,data:[]};return new Promise(function(e,t){var i=util.success("Form authorised successfully.",s);e(i)})}function close(e){var s={complete:!0,data:[]};return new Promise(function(e,t){var i=util.success("Form closed successfully.",s);e(i)})}var util=require("utility");module.exports={create:create,save:save,submit:submit,authorise:authorise,close:close};

},{"utility":5}],3:[function(require,module,exports){
"use strict";function getProcess(e,s,t){return new Promise(function(n,i){try{var c=[],r=[];t.instance.processes.filter(function(s){s.id===e&&(r=s)}),util.syncLoop(r.subProcesses.length,function(n){var o=n.iteration(),u=r.seq,f=r.subProcesses[o].id,a=r.subProcesses[o].seq;getSubProcess(e,u,f,a,s,t).then(function(e){c.push(e),n.next()},function(e){n.break(),i(e)})},function(){n(c)})}catch(e){i(e)}})}function getSubProcess(e,s,t,n,i,c){return new Promise(function(r,o){try{var u={id:"",seq:"",name:"",help:"",dates:"",step:""},f=[],a=[];c.instance.processes.filter(function(i){if(i.id===e&&i.seq===s){i.subProcesses.length;i.subProcesses.filter(function(e){e.id===t&&e.seq===n&&e.complete===!1&&(f=e)})}}),c.config.processes.filter(function(s){s._id===e&&s.subProcesses.filter(function(e){e._id===t&&(a=e)})}),u.id=a._id,u.seq=f.seq,u.name=util.getName(a.name,i),u.help=util.getName(a.help,i),u.dates=f.dates,u.step=f.step,r(u)}catch(e){o(e)}})}var util=require("utility");module.exports={getProcess:getProcess};

},{"utility":5}],4:[function(require,module,exports){
"use strict";function preRequisites(e){return new Promise(function(e,t){var s=util.success("Pre-requisites completed successfully.",{});e(s)})}function preRequisite(e,t,s){return new Promise(function(t,s){switch(e._type){default:var i=util.error("WFPreRequisiteError","Pre-requisite type: "+e._type+" not defined.");s(i)}})}function preActions(e,t){return new Promise(function(e,t){var s=util.success("Pre-actions completed successfully.",{});e(s)})}function subProcess(e,t,s,i,n,r){var o=[],c=[];r.instance.processes.filter(function(n){if(n.id===e&&n.seq===t){n.subProcesses.length;n.subProcesses.filter(function(e){if(e.id===s&&e.seq===i){var t=e.uuid;r.subprocesses.filter(function(e){e._id===t&&(o=e)})}})}}),r.config.processes.filter(function(t){if(t._id===e){t.subProcesses.filter(function(e){e._id===s&&(c=e)})}});var a={_id:r.profile+":"+r.app+":"+e+":"+t+":"+s+":"+i,id:s,type:"workflowInstanceSubProcess",seq:i,initiated:!1,dates:{created:"",valid:"",due:"",closed:""},complete:!1,indicators:[],step:{}};return new Promise(function(u,d){try{var l=c.initiate;initiate(l,o,n).then(function(o){a.initiated=o.data.initiated,a.dates=o.data.dates;var l=c.steps[0]._id,f=c.steps[0].transitions[0]._id,p=1;step(e,t,s,i,l,p,n,r).then(function(o){a.step=o.data,indicators(c.indicators,r).then(function(o){a.indicators=o.data,transition(e,t,s,i,l,f,n,r).then(function(e){a.step=e.data;var t=util.success(e.message,a);u(t)},function(e){d(e)})},function(e){d(e)})},function(e){d(e)})},function(e){d(e)})}catch(e){d(e)}})}function initiate(e,t,s){var i={initiated:!1,dates:{created:"",valid:"",due:"",closed:""}};return new Promise(function(n,r){var o=function(){switch(e._type){case"user":if(i.dates.created=s.createdDate,"userSelected"===e.dates.valid._type)if(void 0!==s.validDate)i.dates.valid=s.validDate;else{var t=util.error("WFInitiateError","No valid date passed in - {inputData.validDate}");r(t)}if("userSelected"===e.dates.due._type)if(void 0!==s.dueDate)i.dates.due=s.dueDate;else{var t=util.error("WFInitiateError","No due date passed in - {inputData.dueDate}");r(t)}i.initiated=!0;var o=util.success("Sub-Process initiate completed successfully.",i);n(o);break;default:var t=util.error("WFInitiateError","Initiate type: "+e._type+" not defined.");r(t)}};if(void 0===t.complete)o();else if(!t.complete)if(e.parallelInstances)o();else{var c=util.error("WFInitiateError","Sub-process: "+t.id+" still active and parallel instances are not allowed.");r(c)}})}function step(e,t,s,i,n,r,o,c){var a,u={id:"",seq:"",status:"",message:"",assignedTo:{userId:"",name:""},comment:""},d={},l="",f={};return new Promise(function(p,v){try{c.instance.processes.filter(function(n){n.id===e&&n.seq===t&&n.subProcesses.filter(function(e){e.id===s&&e.seq===i&&(l=e.uuid)})}),c.subprocesses.filter(function(e){e._id===l&&(a=e)}),c.config.processes.filter(function(t){t._id===e&&t.subProcesses.filter(function(e){e._id===s&&(d=e,e.steps.filter(function(e){e._id===n&&(f=e)}))})}),u.id=n,u.seq=r,u.status=f._setInstanceStatusTo,u.message=f._setStatusMsgTo,u.assignedTo.userId=o.userId,u.assignedTo.name=o.name,u.comment=void 0!==o.comment?o.comment:"";var m=void 0!==a?a.indicators:[];indicatorDocs(e,m,u,c).then(function(n){if(void 0!==f.actions[0])actions(f.actions,e,t,s,i,d,u,c).then(function(e){var t=util.success("Actions completed successfully.",u);p(t)},function(e){v(e)});else if(void 0!==f.task){var r=util.success("Task awaiting user action.",u);p(r)}},function(e){v(e)})}catch(e){v(e)}})}function indicators(e,t){var s=[];return new Promise(function(i,n){try{for(var r=0;r<e.length;r++)for(var o=e[r]._id,c=0;c<t.indicators.length;c++){var a=t.indicators[c],u={id:"",instances:[]},d={uuid:"",title:"",key:"",seq:1};o===a.category.term&&(u.id=o,d.uuid=a._id,d.title=a.title,d.key="",d.seq=1,u.instances.push(d),s.push(u))}var l=util.success("Process indicator model updated.",s);i(l)}catch(e){n(e)}})}function indicatorDocs(e,t,s,i){return new Promise(function(n,r){try{if(void 0===t){util.error("WFIndicatorsUpdate","Indicators parameter is required. - Value: "+t);r(err)}else{for(var o=0;o<t.length;o++)for(var c=t[o],a=0;a<c.instances.length;a++)for(var u=c.instances[a],d=0;d<i.indicators.length;d++){var l=i.indicators[d];u.uuid===l._id&&l.workflows.filter(function(t){t.id===i.config._id&&t.processes.filter(function(t){t.id===e&&(t.step.id=s.id,t.step.seq=s.seq,t.step.status=s.status,t.step.message=s.message,t.step.assignedTo.userId=s.assignedTo.userId,t.step.assignedTo.name=s.assignedTo.name,t.step.comment=void 0!==s.comment?s.comment:"")})})}var f=util.success("Indicator documents workflow process model updated.",i);n(f)}}catch(e){r(e)}})}function actions(e,t,s,i,n,r,o,c){var a=[];return new Promise(function(u,d){util.syncLoop(e.length,function(u){var l=u.iteration();action(e[l],t,s,i,n,r,o,c).then(function(t){var s={id:e[l]._id,seq:l,data:t};a.push(s),u.next()},function(e){u.break(),d(e)})},function(){var e=util.success("Actions completed successfully.",a);u(e)})})}function action(e,t,s,i,n,r,o,c){return new Promise(function(a,u){var d=[],l="global",f="";void 0!==e._id&&(l=e._id.split(".")[0]),void 0!==e._id&&(f=e._id.split(".")[1]),d.length=0;for(var p=0;p<e._args.length;p++){var v=e._args[p];switch(v){case"processId":d.push(t);break;case"processSeq":d.push(s);break;case"subProcessId":d.push(i);break;case"subProcessSeq":d.push(n);break;case"subProcess":d.push(r);break;case"step":d.push(o);break;default:d=[]}}if(d.push(c),"form.create"===e._id)form.create(d).then(function(e){a(e.data)},function(e){u(e)});else if("form.authorise"===e._id)form.authorise(d).then(function(e){a(e.data)},function(e){u(e)});else if("form.close"===e._id)form.close(d).then(function(e){a(e.data)},function(e){u(e)});else{var m=util.error("WFActionError","Method: "+action_id+" not defined.");u(m)}})}function task(e){return"Implementation pending.."}function transition(e,t,s,i,n,r,o,c){return new Promise(function(a,u){try{for(var d=0,l="",f=0,p=[],v=c.config.processes.filter(function(t){if(t._id===e)return t}),m=v[0].subProcesses.filter(function(e){if(e._id===s)return e}),_=m[0].steps.filter(function(e){if(e._id===n)return e}),h=_[0].transitions.filter(function(e){if(e._id===r)return e}),g=0;g<m[0].steps.length;g++)m[0].steps[g]._id===n&&(d=parseInt(m[0].steps[g]._seq));m[0].steps.filter(function(e){f=d+1,parseInt(e._seq)===f&&(l=e._id)}),c.instance.processes.filter(function(n){n.id===e&&n.seq===t&&n.subProcesses.filter(function(e){if(e.id===s&&e.seq===i){var t=e.uuid;c.subprocesses.filter(function(e){e._id===t&&(p=e)})}})});var y=m[0].steps.length;switch(h[0]._type){case"auto":"nextStep"===h[0].goTo._type&&step(e,t,s,i,l,f,o,c).then(function(e){if(f===y){var t=util.success("All Step transitions have completed successfully.",{subProcessComplete:!0,step:e.data});a(t)}else{var t=util.success("Step transition completed successfully.",e.data);a(t)}var t=util.success("Step transition completed successfully.",e.data);a(t)},function(e){u(e)});break;case"user":if("nextStep"===h[0].goTo._type)step(e,t,s,i,l,f,o,c).then(function(e){if(f===y){var t=util.success("All Step transitions have completed successfully.",{subProcessComplete:!0,step:e.data});a(t)}else{var t=util.success("Step transition completed successfully.",e.data);a(t)}var t=util.success("Step transition completed successfully.",e.data);a(t)},function(e){u(e)});else if("stepId"===h[0].goTo._type){var P=h[0].goTo._stepId,b=1;m[0].steps.filter(function(e){e._id===P&&(b=parseInt(e._seq))}),step(e,t,s,i,P,b,o,c).then(function(e){if(b===y){var t=util.success("All Step transitions have completed successfully.",{subProcessComplete:!0,step:e.data});a(t)}else{var t=util.success("Step transition completed successfully.",e.data);a(t)}var t=util.success("Step transition completed successfully.",e.data);a(t)},function(e){u(e)})}break;default:var q=util.error("WFTransitionError","Transition type: "+h[0]._type+" not defined.");u(q)}}catch(e){u(e)}})}function postActions(e){return"Implementation pending.."}var util=require("utility"),form=require("./form");module.exports={preRequisites:preRequisites,preActions:preActions,subProcess:subProcess,indicatorDocs:indicatorDocs,task:task,transition:transition};

},{"./form":2,"utility":5}],5:[function(require,module,exports){
"use strict";function success(r,e){return{message:r,data:e}}function warn(r,e){return console.warn(e),{warning:r,data:e}}function error(r,e){var n=new Error("");return n.name=r,n.message=e,n}function syncLoop(r,e,n){var a=0,t=!1,o=!1,u={next:function(){return t&&o&&n?n():void(a<r?(a++,e(u)):(t=!0,n&&n()))},iteration:function(){return a-1},break:function(r){t=!0,o=r}};return u.next(),u}function compare(r,e,n){switch(e){case"greaterThan":return r>n;case"lessThan":return r<n;case"greaterThanEqual":return r>=n;case"lessThanEqual":return r<=n;case"equalTo":return r===n;case"notEqualTo":return r!==n}}function getName(r,e){if(void 0!==r)for(var n=0;n<r.length;n++)if(r[n].i18n._lang===e)return r[n].i18n.value}module.exports={success:success,warn:warn,error:error,syncLoop:syncLoop,compare:compare,getName:getName};

},{}]},{},[1])(1)
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Vzci9sb2NhbC9saWIvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsImluZGV4LmpzIiwibGliL2Zvcm0uanMiLCJsaWIvaW50ZXJmYWNlLmpzIiwibGliL3Byb2Nlc3MuanMiLCJub2RlX21vZHVsZXMvdXRpbGl0eS9pbmRleC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBLFlBMENBLFNBQVMsVUFBUyxFQUFTLEVBQUssR0FDL0IsR0FBSSxHQUFRLElBRVosSUFBZ0IsS0FBWixHQUE4QixTQUFaLEVBQ2YsS0FBTSxNQUFLLE1BQU0sZ0JBQWlCLDRCQUMvQixJQUF3QixnQkFBZCxHQUNoQixLQUFNLElBQUksT0FBTSw4Q0FLcEIsSUFISSxFQUFNLFFBQVUsR0FBVyxHQUduQixLQUFSLEdBQXNCLFNBQVIsRUFDWCxLQUFNLE1BQUssTUFBTSxnQkFBaUIseUJBQy9CLElBQW9CLGdCQUFWLEdBQ2hCLEtBQU0sSUFBSSxPQUFNLDBDQUtqQixJQUhDLEVBQU0sSUFBTSxHQUFPLEdBR0wsS0FBWCxHQUE0QixTQUFYLEVBQ3BCLEtBQU0sTUFBSyxNQUFNLGdCQUFpQix3Q0FDTCxpQkFBYixHQUNiLEVBQU0sT0FBUyxLQUFLLE1BQU0sR0FFN0IsRUFBTSxPQUFTLEVBR2hCLEVBQU0sU0FFUixFQUFNLGdCQUVOLEVBQU0sY0FFTixFQUFNLFdBekVSLEdBQUksU0FBVSxRQUFRLGlCQUNsQixLQUFPLFFBQVEsV0FDZixjQUFnQixRQUFRLGtCQW1GNUIsVUFBUyxVQUFVLFdBQWEsV0FDL0IsTUFBTyxNQUFLLFNBV2IsU0FBUyxVQUFVLE9BQVMsV0FDM0IsTUFBTyxNQUFLLEtBV2IsU0FBUyxVQUFVLFVBQVksV0FDOUIsTUFBTyxNQUFLLFFBV2IsU0FBUyxVQUFVLFlBQWMsV0FDaEMsTUFBTyxNQUFLLFVBYWIsU0FBUyxVQUFVLFlBQWMsU0FBUyxHQUN6QyxLQUFL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R0FBWSxTQUFSLEVBQ0gsSUFBSyxHQUFJLEdBQUksRUFBRyxFQUFJLEVBQUksT0FBUyxJQUNoQyxHQUFJLEVBQUksR0FBRyxLQUFLLFFBQVUsRUFDekIsTUFBTyxHQUFJLEdBQUcsS0FBSyxNQU12QixPQUFPLFNBRUwsUUFBUyxRQUNULEtBQU0sS0FDTixNQUFPLE1BQ1AsU0FBVSxTQUNWLFFBQVMsUUFDVixRQUFTIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIid1c2Ugc3RyaWN0JztcblxudmFyIFByb2Nlc3MgPSByZXF1aXJlKCcuL2xpYi9wcm9jZXNzJyk7XG52YXIgdXRpbCA9IHJlcXVpcmUoJ3V0aWxpdHknKTtcbnZhciB1c2VySW50ZXJmYWNlID0gcmVxdWlyZSgnLi9saWIvaW50ZXJmYWNlJyk7XG5cbi8qZ2xvYmFscyAqL1xuXG4vKipcbiAqIEEgbmV3IFdvcmtmbG93IGNvbnN0cnVjdG9yIGluc3RhbmNlIGNvbnRhaW5zIHRoZSByZWZlcmVuY2UgdG8gdGhlIGFwcGxpY2F0aW9uXG4gKiBhbmQgYXNzb2NpYXRlZCBwcm9maWxlIHdoaWNoIGl0IHJlcXVpcmVzIGFzIHRoZSBmaXJzdCB0d28gcGFyYW1ldGVycy4gSXQgYWxzb1xuICogcmVxdWlyZXMgYSB3b3JrZmxvdyBjb25maWd1cmF0aW9uLCBhcyB0aGUgdGhpcmQgcGFyYW1ldGVyLCB3aGljaCBpcyB1c2VkIHRvXG4gKiBkZXNjaWJlIHRoZSB3b3JrZmxvdyBwcm9jZXNzZXMuIElmIGEgd29ya2Zsb3cgaW5zdGFuY2UgZXhpc3RzIHlvdSBjYW4gcGFzcyBpdFxuICogaW4gYXMgdGhlIGZvdXJ0aCBwYXJhbWV0ZXIgd2hpY2ggaXQgd2lsbCB0aGVuIHVzZSwgZWxzZSBjcmVhdGUgYSBuZXcgb25lLlxuICpcbiAqIEBjb25zdHJ1Y3RvclxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBwcm9maWxlIC0gVGhlIGN1cnJlbnQgcHJvZmlsZSBpZFxuICogQHBhcmFtIHtzdHJpbmd9IGFwcCAtIFRoZSBhc3NvY2lhdGVkIGFwcGxpY2F0aW9uIGlkXG4gKiBAcGFyYW0ge09iamVjdH0gY29uZmlnIC0gVGhlIGFwcGxpY2F0aW9uIHdvcmtmbG93IGNvbmZpZ3VyYXRpb24gLyBkZWZpbml0aW9uXG4gKiBAcGFyYW0ge09iamVjdH0gW2luc3RhbmNlXSAtIEFuIGV4aXN0aW5nIGFwcGxpY2F0aW9uIHByb2ZpbGUgd29ya2Zsb3cgaW5zdGFuY2UgYmFzZWRcbiAqIG9uIHRoZSBkZWZpbml0aW9uXG4gKlxuICogQGF1dGhvciBCcmVudCBHb3Jkb25cbiAqIEB2ZXJzaW9uIDAuMS4wXG4gKlxuICogQGV4YW1wbGVcbiAqIHZhciBjb25maWcgPSB7ICdfaWQnOiAnYWJjMTIzJyB9O1xuICogdmFyIGluc3RhbmNlID0geyAnX2lkJzogJ2luc3RhbmNlX2FiYzEyMycgfTtcbiAqIC8vIElmIHRoZXJlIGlzbid0IGFuIGV4aXN0aW5nIGluc3RhbmNlXG4gKiB2YXIgd29ya2Zsb3cgPSBuZXcgV29ya2Zsb3coJzEyMzQnLCAnNTY3OCcsIGNvbmZpZyk7XG4gKiAvLyBJZiB0aGVyZSBpcyBhbiBleGlzdGluZyBpbnN0YW5jZVxuICogdmFyIHdvcmtmbG93ID0gbmV3IFdvcmtmbG93KCcxMjM0JywgJzU2NzgnLCBjb25maWcsIGluc3RhbmNlKTtcbiAqXG4gKiBAcmV0dXJuIHtPYmplY3R9IG5ldyBXb3JrZmxvdyBvYmplY3RcbiAqXG4gKiBAdGhyb3dzIEVycm9yOiBBIHByb2ZpbGUgaWQgaXMgcmVxdWlyZWRcbiAqIEB0aHJvd3MgRXJyb3I6IEFuIGFwcCBpZCBpcyByZXF1aXJlZFxuICogQHRocm93cyBFcnJvcjogQSB3b3JrZmxvdyBjb25maWd1cmF0aW9uIGlzIHJlcXVpcmVkXG4gKlxuICovXG5cbmZ1bmN0aW9uIFdvcmtmbG93KHByb2ZpbGUsIGFwcCwgY29uZmlnKXtcblx0dmFyIF90aGlzID0gdGhpcztcblx0Ly8gUHJvZmlsZSBJRCB2YWxpZGF0aW9uIGNoZWNrc1xuXHRpZiAocHJvZmlsZSA9PT0gJycgfHwgcHJvZmlsZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRocm93IHV0aWwuZXJyb3IoJ1BhcmFtUmVxdWlyZWQnLCAnQSBwcm9maWxlIGlkIGlzIHJlcXVpcmVkLicpO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mKHByb2ZpbGUpICE9PSAnc3RyaW5nJykge1xuICAgIFx0dGhyb3cgbmV3IEVycm9yKCdUaGUgcHJvZmlsZSBpZCBtdXN0IGJlIGEgamF2YXNjcmlwdCBzdHJpbmcuJyk7XG4gICAgfSBlbHNlIHtcbiAgICBcdF90aGlzLnByb2ZpbGUgPSBwcm9maWxlIHx8ICcnO1xuICAgIH1cbiAgICAvLyBBcHAgSUQgdmFsaWRhdGlvbiBjaGVja3Ncblx0aWYgKGFwcCA9PT0gJycgfHwgYXBwID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGhyb3cgdXRpbC5lcnJvcignUGFyYW1SZXF1aXJlZCcsICdBbiBhcHAgaWQgaXMgcmVxdWlyZWQuJyk7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YoYXBwKSAhPT0gJ3N0cmluZycpIHtcbiAgICBcdHRocm93IG5ldyBFcnJvcignVGhlIGFwcCBpZCBtdXN0IGJlIGEgamF2YXNjcmlwdCBzdHJpbmcuJyk7XG4gICAgfSBlbHNlIHtcbiAgICBcdF90aGlzLmFwcCA9IGFwcCB8fCAnJztcbiAgICB9XG4gICAgLy8gV29ya2Zsb3cgY29uZmlndXJhdGlvbiB2YWxpZGF0aW9uIGNoZWNrc1xuICAgIGlmIChjb25maWcgPT09ICcnIHx8IGNvbmZpZyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgXHR0aHJvdyB1dGlsLmVycm9yKCdQYXJhbVJlcXVpcmVkJywgJ0Egd29ya2Zsb3cgY29uZmlndXJhdGlvbiBpcyByZXF1aXJlZC4nKTtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZihjb25maWcpICE9PSAnb2JqZWN0Jykge1xuICAgICAgICBfdGhpcy5jb25maWcgPSBKU09OLnBhcnNlKGNvbmZpZyk7XG4gICAgfSBlbHNlIHtcbiAgICBcdF90aGlzLmNvbmZpZyA9IGNvbmZpZztcbiAgICB9XG4gICAgLy8gV29ya2Zsb3cgaW5zdGFuY2UgdmFsaWRhdGlvbiBjaGVja3NcbiAgICBfdGhpcy5pbnN0YW5jZTtcblx0XHQvLyBXb3JrZmxvdyBzdWItcHJvY2Vzc2VzIHZhbGlkYXRpb24gY2hlY2tzXG5cdFx0X3RoaXMuc3VicHJvY2Vzc2VzID0gW107XG5cdFx0Ly8gV29ya2Zsb3cgaW5kaWNhdG9ycyBwbGFjZSBob2xkZXJcblx0XHRfdGhpcy5pbmRpY2F0b3JzID0gW107XG5cdFx0Ly8gV29ya2Zsb3cgc3ViLXByb2Nlc3Mgc3RlcCBoaXN0b3J5IHBsYWNlIGhvbGRlclxuXHRcdF90aGlzLmhpc3RvcnkgPSBbXTtcblxufVxuXG4vKipcbiAqIFdvcmtmbG93IGdldCBwcm9maWxlIGlkLlxuICpcbiAqIEBleGFtcGxlIFwiXCJcbiAqXG4gKiBAcmV0dXJuIFwiXCJcbiAqXG4gKi9cbldvcmtmbG93LnByb3RvdHlwZS5nZXRQcm9maWxlID0gZnVuY3Rpb24oKXtcblx0cmV0dXJuIHRoaXMucHJvZmlsZTtcbn07XG5cbi8qKlxuICogV29ya2Zsb3cgZ2V0IGFwcCBpZC5cbiAqXG4gKiBAZXhhbXBsZSBcIlwiXG4gKlxuICogQHJldHVybiBcIlwiXG4gKlxuICovXG5Xb3JrZmxvdy5wcm90b3R5cGUuZ2V0QXBwID0gZnVuY3Rpb24oKXtcblx0cmV0dXJuIHRoaXMuYXBwO1xufTtcblxuLyoqXG4gKiBXb3JrZmxvdyBnZXQgY29uZmlnLlxuICpcbiAqIEBleGFtcGxlIFwiXCJcbiAqXG4gKiBAcmV0dXJuIFwiXCJcbiAqXG4gKi9cbldvcmtmbG93LnByb3RvdHlwZS5nZXRDb25maWcgPSBmdW5jdGlvbigpe1xuXHRyZXR1cm4gdGhpcy5jb25maWc7XG59O1xuXG4vKipcbiAqIFdvcmtmbG93IGdldCBpbnN0YW5jZS5cbiAqXG4gKiBAZXhhbXBsZSBcIlwiXG4gKlxuICogQHJldHVybiBcIlwiXG4gKlxuICovXG5Xb3JrZmxvdy5wcm90b3R5cGUuZ2V0SW5zdGFuY2UgPSBmdW5jdGlvbigpe1xuXHRyZXR1cm4gdGhpcy5pbnN0YW5jZTtcbn07XG5cbi8qKlxuICogV29ya2Zsb3cgc2V0IHRoZSBpbnN0YW5jZSBkYXRhLlxuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhIC0gdGhlIHdvcmtmbG93IHByb2Nlc3MgaW5zdGFuY2UgZGF0YVxuICpcbiAqIEBleGFtcGxlIFwiXCJcbiAqXG4gKiBAcmV0dXJuIFwiXCJcbiAqXG4gKi9cbldvcmtmbG93LnByb3RvdHlwZS5zZXRJbnN0YW5jZSA9IGZ1bmN0aW9uKGRhdGEpe1xuXHR0aGlzLmluc3RhbmNlID0gZGF0YTtcbn07XG5cbi8qKlxuICogV29ya2Zsb3cgZ2V0IHN1Yi1wcm9jZXNzZXMgZGF0YS5cbiAqXG4gKiBAZXhhbXBsZSBcIlwiXG4gKlxuICogQHJldHVybiBcIlwiXG4gKlxuICovXG5Xb3JrZmxvdy5wcm90b3R5cGUuZ2V0U3ViUHJvY2Vzc2VzID0gZnVuY3Rpb24oKXtcblx0cmV0dXJuIHRoaXMuc3VicHJvY2Vzc2VzO1xufTtcblxuLyoqXG4gKiBXb3JrZmxvdyBzZXQgdGhlIHN1Yi1wcm9jZXNzZXMgZGF0YS5cbiAqXG4gKiBAcGFyYW0ge09iamVjdH0gZGF0YSAtIHRoZSB3b3JrZmxvdyBwcm9jZXNzIGluc3RhbmNlIGRhdGFcbiAqXG4gKiBAZXhhbXBsZSBcIlwiXG4gKlxuICogQHJldHVybiBcIlwiXG4gKlxuICovXG5Xb3JrZmxvdy5wcm90b3R5cGUuc2V0U3ViUHJvY2Vzc2VzID0gZnVuY3Rpb24oZGF0YSl7XG5cdHRoaXMuc3VicHJvY2Vzc2VzID0gZGF0YTtcbn07XG5cbi8qKlxuICogV29ya2Zsb3cgZ2V0IGluZGljYXRvciBzZXQgZGF0YS5cbiAqXG4gKiBAZXhhbXBsZSBcIlwiXG4gKlxuICogQHJldHVybiBcIlwiXG4gKlxuICovXG5Xb3JrZmxvdy5wcm90b3R5cGUuZ2V0SW5kaWNhdG9ycyA9IGZ1bmN0aW9uKCl7XG5cdHJldHVybiB0aGlzLmluZGljYXRvcnM7XG59O1xuXG4vKipcbiAqIFdvcmtmbG93IHNldCB0aGUgaW5kaWNhdG9yIHNldCBkYXRhLlxuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhIC0gdGhlIHdvcmtmbG93IHByb2Nlc3MgaW5zdGFuY2UgZGF0YVxuICpcbiAqIEBleGFtcGxlIFwiXCJcbiAqXG4gKiBAcmV0dXJuIFwiXCJcbiAqXG4gKi9cbldvcmtmbG93LnByb3RvdHlwZS5zZXRJbmRpY2F0b3JzID0gZnVuY3Rpb24oZGF0YSl7XG5cdHRoaXMuaW5kaWNhdG9ycyA9IGRhdGE7XG59O1xuXG4vKipcbiAqIFRoaXMgbWV0aG9kIGNyZWF0ZXMgYSBuZXcgd29ya2Zsb3cgcHJvY2VzcyBpLmUuIGl0IGNyZWF0ZXMgYSB3b3JrZmxvdyBwcm9jZXNzZXMgaW5zdGFuY2VcbiAqIG9iamVjdCB3aXRoIHRoZSBtaW5pbXVtIHJlcXVpcmVkIGRhdGEuIFRoaXMgaW5zdGFuY2UgY2FuIGJlIHJlZmVyZW5jZWQgaW4gdGhlIGZvbGxvd2luZ1xuICogd2F5LCBzZWUgZXhhbXBsZSBiZWxvdy5cbiAqXG4gKiBAZXhhbXBsZVxuICogdmFyIGNvbmZpZyA9IHsgJ19pZCc6ICdhYmMxMjMnIH07XG4gKiB2YXIgd29ya2Zsb3cgPSBuZXcgV29ya2Zsb3coJzEyMzQnLCAnNTY3OCcsIGNvbmZpZyk7XG4gKiB3b3JrZmxvdy5jcmVhdGUoKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCl7XG4gKlx0Y29uc29sZS5sb2cocmVzdWx0Lm1lc3NhZ2UpO1xuICpcdC8vIFRoZSBmb2xsb3dpbmcgcHJvcGVydGllcyBjYW4gbm93IGJlIGFjY2Vzc2VkXG4gKiBcdHZhciBwcm9maWxlID0gd29ya2Zsb3cucHJvZmlsZTtcbiAqIFx0dmFyIGFwcCA9IHdvcmtmbG93LmFwcDtcbiAqIFx0dmFyIGNvbmZpZyA9IHdvcmtmbG93LmNvbmZpZztcbiAqXHQvLyBPbiBzdWNjZXNzIHlvdSBjYW4gYWNjZXNzIHRoZSBpbnN0YW5jZSB0aGUgZm9sbG93aW5nIHdheVxuICpcdHZhciBpbnN0YW5jZSA9IHdvcmtmbG93Lmluc3RhbmNlO1xuICogfSwgZnVuY3Rpb24oZXJyb3Ipe1xuICpcdGNvbnNvbGUubG9nKGVycm9yKTtcbiAqIH0pO1xuICpcbiAqIEByZXR1cm4ge09iamVjdH0gbmV3IFdvcmtmbG93IGluc3RhbmNlIHdpdGggdXBkYXRlZCBpbnN0YW5jZSBkYXRhLlxuICpcbiAqL1xuV29ya2Zsb3cucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uKCl7XG5cdHZhciBfdGhpcyA9IHRoaXM7XG5cdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcblx0XHR0cnkge1xuXHRcdFx0aWYgKF90aGlzLmluc3RhbmNlICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdFx0dmFyIHdhcm4gPSB1dGlsLndhcm4oJ0luc3RhbmNlIGFscmVhZHkgZXhpc3RzLicsIF90aGlzKVxuXHRcdFx0XHRyZXNvbHZlKHdhcm4pO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Ly8gQ3JlYXRlIHRoZSB3b3JrZmxvdyBwcm9jZXNzZXMgaW5zdGFuY2Ugb2JqZWN0XG5cdFx0XHRcdHZhciBtb2RlbCA9IHtcblx0XHRcdFx0ICAgIF9pZDogJycsXG5cdFx0XHRcdCAgICB2ZXJzaW9uOiAnJyxcblx0XHRcdFx0ICAgIHR5cGU6ICd3b3JrZmxvd0luc3RhbmNlJyxcblx0XHRcdFx0ICAgIHByb2Nlc3NlczogW11cblx0XHRcdFx0fTtcblx0XHRcdFx0bW9kZWwuX2lkID0gX3RoaXMucHJvZmlsZSArICc6cHJvY2Vzc2VzJztcblx0XHRcdFx0bW9kZWwudmVyc2lvbiA9IF90aGlzLmNvbmZpZy52ZXJzaW9uO1xuXHRcdFx0XHRfdGhpcy5pbnN0YW5jZSA9IG1vZGVsO1xuXHRcdFx0XHR2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnV29ya2Zsb3cgcHJvY2Vzc2VzIGluc3RhbmNlIGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5LicsIF90aGlzKTtcblx0XHRcdFx0cmVzb2x2ZShzdWNjZXNzKTtcblx0XHRcdH1cblx0XHR9IGNhdGNoIChlcnIpIHtcblx0XHRcdHJlamVjdChlcnIpO1xuXHRcdH1cblx0fSk7XG59O1xuXG4vKipcbiAqIFdvcmtmbG93IGluaXRpYWxpc2UsIHRoaXMgZnVuY3Rpb24gZXhlY3V0ZXMgYSBwcm9jZXNzIHdpdGhpbiBhIHdvcmtmbG93XG4gKiBjb25maWd1cmF0aW9uLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBwcm9jZXNzSWQgLSB0aGUgcHJvY2VzcyBpZCB0byBwcm9jZXNzXG4gKiBAcGFyYW0ge29iamVjdH0gW2RhdGFdIC0gdGhlIGlucHV0IGRhdGEgdG8gcHJvY2Vzc1xuICpcbiAqIEBleGFtcGxlXG4gKiBXb3JrZmxvdy5pbml0aWFsaXplKCdwcm9jZXNzSWQnLCB7IHZhbGlkRGF0ZTogJ2RhdGUnIH0pO1xuICpcbiAqIEByZXR1cm4gXCJcIlxuICpcbiAqL1xuV29ya2Zsb3cucHJvdG90eXBlLmluaXRpYWxpc2UgPSBmdW5jdGlvbihwcm9jZXNzSWQsIGRhdGEpe1xuXHR2YXIgX3RoaXMgPSB0aGlzO1xuXHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG5cdFx0dHJ5IHtcblx0XHRcdHZhciBjb25maWdQcm9jZXNzID0gW107XG5cdFx0XHQvLyBDaGVjayB0aGUgcGFzc2VkIGluIHBhcmFtZXRlcnNcblx0XHRcdGlmIChwcm9jZXNzSWQgIT09ICcnICYmIHByb2Nlc3NJZCAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRcdC8vIEdldCB0aGUgY3VycmVudCBwcm9jZXNzIGNvbmZpZ1xuXHRcdFx0XHRjb25maWdQcm9jZXNzID0gX3RoaXMuY29uZmlnLnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24ob2JqUHJvY2Vzcyl7XG5cdFx0XHRcdFx0aWYgKG9ialByb2Nlc3MuX2lkID09PSBwcm9jZXNzSWQpIHtcblx0XHRcdFx0XHRcdHJldHVybiBvYmpQcm9jZXNzO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHRcdGlmIChjb25maWdQcm9jZXNzWzBdLl9pZCA9PT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRcdFx0dmFyIGVycm9yID0gdXRpbC5lcnJvcignV0ZDb25maWdFcnJvcicsICdObyB2YWxpZCBwcm9jZXNzIGRlZmluaXRpb24gZm91bmQgd2l0aCBwcm9jZXNzIGlkOiAnICsgcHJvY2Vzc0lkKTtcblx0XHRcdFx0XHRyZWplY3QoZXJyb3IpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb25maWdQcm9jZXNzLnB1c2goX3RoaXMuY29uZmlnLnByb2Nlc3Nlc1swXSk7XG5cdFx0XHRcdHByb2Nlc3NJZCA9IF90aGlzLmNvbmZpZy5wcm9jZXNzZXNbMF0uX2lkO1xuXHRcdFx0fVxuXHRcdFx0Ly8gR2V0IHRoZSBjdXJyZW50IGxpc3Qgb2YgcHJvY2VzcyBpbnN0YW5jZXNcblx0XHRcdC8vIHZhciBwcm9jZXNzU2VxID0gMTtcblx0XHRcdHZhciBjdXJyZW50UHJvY2VzcyA9IFtdO1xuXHRcdFx0X3RoaXMuaW5zdGFuY2UucHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihwcm9jZXNzSXRlbSl7XG5cdFx0XHRcdGlmIChwcm9jZXNzSXRlbS5pZCA9PT0gcHJvY2Vzc0lkKSB7XG5cdFx0XHRcdFx0Y3VycmVudFByb2Nlc3MucHVzaChwcm9jZXNzSXRlbSk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdFx0dmFyIHByb2Nlc3NTZXEgPSBjdXJyZW50UHJvY2Vzcy5sZW5ndGggKyAxO1xuXHRcdFx0Ly8gdmFyIG5leHRTZXEgPSBwcm9jZXNzU2VxICsgMTtcblx0XHRcdC8vIFB1c2ggdGhlIHByb2Nlc3Mgb2JqZWN0IGludG8gdGhlIGFycmF5XG5cdFx0XHR2YXIgcHJvY2Vzc01vZGVsID0ge1xuXHRcdFx0XHRpZDogJycsXG5cdFx0XHRcdHNlcTogJycsXG5cdFx0XHRcdHN1YlByb2Nlc3NlczogW11cblx0XHRcdH1cblx0XHRcdC8vIDEuIFVwZGF0ZSB0aGUgcHJvY2VzcyBpZCBhbmQgc2VxXG5cdFx0XHRwcm9jZXNzTW9kZWwuaWQgPSBwcm9jZXNzSWQ7XG5cdFx0XHRwcm9jZXNzTW9kZWwuc2VxID0gcHJvY2Vzc1NlcTtcblx0XHRcdF90aGlzLmluc3RhbmNlLnByb2Nlc3Nlcy5wdXNoKHByb2Nlc3NNb2RlbCk7XG5cdFx0XHQvLyBQYXJhbWV0ZXJzXG5cdFx0XHR2YXIgc3ViUHJvY2Vzc0lkID0gY29uZmlnUHJvY2Vzc1swXS5zdWJQcm9jZXNzZXNbMF0uX2lkO1xuXHRcdFx0dmFyIHN1YlByb2Nlc3NTZXEgPSAxO1xuXHRcdFx0X3RoaXMuaW5zdGFuY2UucHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihwcm9jZXNzSXRlbSl7XG5cdFx0XHRcdGlmIChwcm9jZXNzSXRlbS5pZCA9PT0gcHJvY2Vzc0lkICYmIHByb2Nlc3NJdGVtLnNlcSA9PT0gcHJvY2Vzc1NlcSkge1xuXHRcdFx0XHRcdHN1YlByb2Nlc3NTZXEgPSBwcm9jZXNzSXRlbS5zdWJQcm9jZXNzZXMubGVuZ3RoICsgMVxuXHRcdFx0XHR9XG5cdFx0XHR9KVxuXHRcdFx0Ly8gQ2FsbCB0aGUgc3VicHJvY2VzcyBtZXRob2Rcblx0XHRcdFByb2Nlc3Muc3ViUHJvY2Vzcyhwcm9jZXNzSWQsIHByb2Nlc3NTZXEsIHN1YlByb2Nlc3NJZCwgc3ViUHJvY2Vzc1NlcSwgZGF0YSwgX3RoaXMpLnRoZW4oZnVuY3Rpb24oc3ViUHJvY2Vzcyl7XG5cdFx0XHRcdC8vIEdlbmVyYXRlIHRoZSB1dWlkXG5cdFx0XHRcdHZhciB1dWlkID0gX3RoaXMucHJvZmlsZSArICc6JyArIF90aGlzLmFwcCArICc6JyArIHByb2Nlc3NJZCArICc6JyArIHByb2Nlc3NTZXEgKyAnOicgKyBzdWJQcm9jZXNzSWQgKyAnOicgKyBzdWJQcm9jZXNzU2VxO1xuXHRcdFx0XHQvLyBCdWlsZCB0aGUgc3ViLXByb2Nlc3MgcmVmZXJlbmNlIG9iamVjdFxuXHRcdFx0XHR2YXIgc3ViUHJvY2Vzc1JlZiA9IHtcblx0XHRcdFx0XHRpZDogc3ViUHJvY2Vzc0lkLFxuXHRcdFx0XHRcdHNlcTogc3ViUHJvY2Vzc1NlcSxcblx0XHRcdFx0XHR1dWlkOiB1dWlkXG5cdFx0XHRcdH1cblx0XHRcdFx0Ly8gQWRkIHRoZSByZWZlcmVuY2UgdG8gdGhlIHByb2Nlc3MgbW9kZWxcblx0XHRcdFx0cHJvY2Vzc01vZGVsLnN1YlByb2Nlc3Nlcy5wdXNoKHN1YlByb2Nlc3NSZWYpO1xuXHRcdFx0XHQvLyBBZGQgdGhlIHN1YlByb2Nlc3MgbW9kZWwgdG8gdGhlIHN1YnByb2Nlc3NlcyBhcnJheVxuXHRcdFx0XHRfdGhpcy5zdWJwcm9jZXNzZXMucHVzaChzdWJQcm9jZXNzLmRhdGEpO1xuXHRcdFx0XHQvLyBfdGhpcy5pbnN0YW5jZS5wcm9jZXNzZXMucHVzaChwcm9jZXNzTW9kZWwpO1xuXHRcdFx0XHRmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgX3RoaXMuaW5zdGFuY2UucHJvY2Vzc2VzLmxlbmd0aDsgaW5kZXgrKyl7XG5cdFx0XHRcdFx0dmFyIHByb2Nlc3NJdGVtID0gX3RoaXMuaW5zdGFuY2UucHJvY2Vzc2VzW2luZGV4XTtcblx0XHRcdFx0XHRpZiAocHJvY2Vzc0l0ZW0uaWQgPT09IHByb2Nlc3NJZCAmJiBwcm9jZXNzSXRlbS5zZXEgPT09IHByb2Nlc3NTZXEpIHtcblx0XHRcdFx0XHRcdC8vIFJlbW92ZSB0aGUgY3VycmVudCBwcm9jZXNzIGZyb20gdGhlIGFycmF5IGFuZCBhZGQgdGhlIHVwZGF0ZWQgcHJvY2Vzc01vZGVsXG5cdFx0XHRcdFx0XHRfdGhpcy5pbnN0YW5jZS5wcm9jZXNzZXMuc3BsaWNlKGluZGV4LCAxLCBwcm9jZXNzTW9kZWwpXG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHRcdC8vIFByb2Nlc3MgdGhlIGluZGljYXRvciBkb2N1bWVudHMgd29ya2Zsb3cgcHJvY2Vzc2VzIHVwZGF0ZXNcblx0XHRcdFx0dmFyIGluZGljYXRvcnMgPSBzdWJQcm9jZXNzLmRhdGEuaW5kaWNhdG9ycztcblx0XHRcdFx0dmFyIHN0ZXAgPSBzdWJQcm9jZXNzLmRhdGEuc3RlcDtcblx0XHRcdFx0UHJvY2Vzcy5pbmRpY2F0b3JEb2NzKHByb2Nlc3NJZCwgaW5kaWNhdG9ycywgc3RlcCwgX3RoaXMpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KXtcblx0XHRcdFx0XHR2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnUHJvY2VzczogJyArIF90aGlzLmNvbmZpZy5wcm9jZXNzZXNbMF0uX2lkICsgJyBpbml0aWFsaXplZCBzdWNjZXNzZnVsbHkuJywgX3RoaXMpO1xuXHRcdFx0XHRcdHJlc29sdmUoc3VjY2Vzcyk7XG5cdFx0XHRcdH0sIGZ1bmN0aW9uKGVycil7XG5cdFx0XHRcdFx0cmVqZWN0KGVycik7XG5cdFx0XHRcdH0pXG5cdFx0XHR9LCBmdW5jdGlvbihlcnIpe1xuXHRcdFx0XHRyZWplY3QoZXJyKTtcblx0XHRcdH0pO1xuXHRcdH0gY2F0Y2goZXJyKSB7XG5cdFx0XHRyZWplY3QoZXJyKTtcblx0XHR9XG5cdH0pO1xufTtcblxuLyoqXG4gKiBXb3JrZmxvdyB0cmFuc2l0aW9uIHRvIHRoZSBuZXh0IHN0ZXAuIFRoaXMgbW92ZXMgdGhlIHdvcmtmbG93IGZyb20gdGhlIGN1cnJlbnQgcHJvY2VzcyxcbiAqIHN1Yi1wcm9jZXNzIHN0ZXAgdG8gdGhlIG5leHQgb25lIGFzIHNwZWNpZmllZC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gcHJvY2Vzc0lkIC0gdGhlIFdvcmtmbG93IGNvbmZpZyAvIGRlZmluaXRpb24gcHJvY2VzcyBpZFxuICogQHBhcmFtIHtudW1iZXJ9IHByb2Nlc3NTZXEgLSB0aGUgV29ya2Zsb3cgaW5zdGFuY2UgcHJvY2VzcyBzZXFcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdWJQcm9jZXNzSWQgLSB0aGUgV29ya2Zsb3cgY29uZmlnIC8gZGVmaW5pdGlvbiBzdWItcHJvY2VzcyBpZFxuICogQHBhcmFtIHtudW1iZXJ9IHN1YlByb2Nlc3NTZXEgLSB0aGUgV29ya2Zsb3cgaW5zdGFuY2Ugc3ViLXByb2Nlc3Mgc2VxXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RlcElkIC0gdGhlIFdvcmtmbG93IGNvbmZpZyAvIGRlZmluaXRpb24gc3RlcCBpZFxuICogQHBhcmFtIHtzdHJpbmd9IHRyYW5zaXRpb25JZCAtIHRoZSBXb3JrZmxvdyBjb25maWcgLyBkZWZpbml0aW9uIHRyYW5zaXRpb24gaWRcbiAqIEBwYXJhbSB7b2JqZWN0fSBkYXRhIC0gYW55IGFkZGl0aW9uYWwgZGF0YSBwYXNzZWQgaW4gYXMga2V5IHZhbHVlIHBhaXJzXG4gKlxuICogQGV4YW1wbGVcbiAqIFdvcmtmbG93LnRyYW5zaXRpb24oJ3Byb2Nlc3NJZCcsIDEsICdzdWJQcm9jZXNzSWQnLCAxLCAnc3RlcElkJywgJ3RyYW5zaXRpb25JZCcsIHsga2V5OiAnJywgdmFsdWU6ICcnIH0pO1xuICpcbiAqIEByZXR1cm4gXCJcIlxuICpcbiAqL1xuV29ya2Zsb3cucHJvdG90eXBlLnRyYW5zaXRpb24gPSBmdW5jdGlvbihwcm9jZXNzSWQsIHByb2Nlc3NTZXEsIHN1YlByb2Nlc3NJZCwgc3ViUHJvY2Vzc1NlcSwgc3RlcElkLCB0cmFuc2l0aW9uSWQsIGRhdGEpe1xuXHQvLyBSZS1hc3NpZ24gdGhpc1xuXHR2YXIgX3RoaXMgPSB0aGlzO1xuXHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG5cdFx0dHJ5IHtcblx0XHRcdFByb2Nlc3MudHJhbnNpdGlvbihwcm9jZXNzSWQsIHByb2Nlc3NTZXEsIHN1YlByb2Nlc3NJZCwgc3ViUHJvY2Vzc1NlcSwgc3RlcElkLCB0cmFuc2l0aW9uSWQsIGRhdGEsIF90aGlzKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCl7XG5cdFx0XHRcdC8vIFVwZGF0ZSB0aGUgY3VycmVudCBzdWItcHJvY2VzcyBzdGVwIGRhdGFcblx0XHRcdFx0dmFyIHVwZGF0ZSA9IGZ1bmN0aW9uKHR5cGUpe1xuXHRcdFx0XHRcdF90aGlzLmluc3RhbmNlLnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24ocHJvY2Vzc0l0ZW0pe1xuXHRcdFx0XHRcdFx0aWYgKHByb2Nlc3NJdGVtLmlkID09PSBwcm9jZXNzSWQgJiYgcHJvY2Vzc0l0ZW0uc2VxID09PSBwcm9jZXNzU2VxKSB7XG5cdFx0XHRcdFx0XHRcdHByb2Nlc3NJdGVtLnN1YlByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24oc3ViUHJvY2Vzc0l0ZW0pe1xuXHRcdFx0XHRcdFx0XHRcdGlmIChzdWJQcm9jZXNzSXRlbS5pZCA9PT0gc3ViUHJvY2Vzc0lkICYmIHN1YlByb2Nlc3NJdGVtLnNlcSA9PT0gc3ViUHJvY2Vzc1NlcSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0X3RoaXMuc3VicHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihzdWJQcm9jZXNzT2JqKXtcblx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKHN1YlByb2Nlc3NPYmouX2lkID09PSBzdWJQcm9jZXNzSXRlbS51dWlkKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGUgPT09ICdzdGVwJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0c3ViUHJvY2Vzc09iai5zdGVwID0gcmVzdWx0LmRhdGE7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHR2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcyhyZXN1bHQubWVzc2FnZSwgc3ViUHJvY2Vzc09iaik7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRyZXNvbHZlKHN1Y2Nlc3MpO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZSA9PT0gJ3N0ZXBDb21wbGV0ZScpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdHN1YlByb2Nlc3NPYmouc3RlcCA9IHJlc3VsdC5kYXRhLnN0ZXA7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRzdWJQcm9jZXNzT2JqLmNvbXBsZXRlID0gdHJ1ZVxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0dmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MocmVzdWx0Lm1lc3NhZ2UsIHN1YlByb2Nlc3NPYmopO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0cmVzb2x2ZShzdWNjZXNzKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0XHRcdH0pXG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR9KVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pXG5cdFx0XHRcdH1cblx0XHRcdFx0aWYgKHJlc3VsdC5kYXRhLnN1YlByb2Nlc3NDb21wbGV0ZSkge1xuXHRcdFx0XHRcdHVwZGF0ZSgnc3RlcENvbXBsZXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dXBkYXRlKCdzdGVwJyk7XG5cdFx0XHRcdH1cblx0XHRcdH0sIGZ1bmN0aW9uKGVycil7XG5cdFx0XHRcdHJlamVjdChlcnIpO1xuXHRcdFx0fSk7XG5cdFx0fSBjYXRjaChlcnIpIHtcblx0XHRcdHJlamVjdChlcnIpO1xuXHRcdH1cblx0fSk7XG59O1xuXG4vKipcbiAqIFdvcmtmbG93IGFzc2lnbiB1c2VyLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBwcm9jZXNzSWQgLSB0aGUgV29ya2Zsb3cgY29uZmlnIC8gZGVmaW5pdGlvbiBwcm9jZXNzIGlkXG4gKiBAcGFyYW0ge251bWJlcn0gcHJvY2Vzc1NlcSAtIHRoZSBXb3JrZmxvdyBpbnN0YW5jZSBwcm9jZXNzIHNlcVxuICogQHBhcmFtIHtzdHJpbmd9IHN1YlByb2Nlc3NJZCAtIHRoZSBXb3JrZmxvdyBjb25maWcgLyBkZWZpbml0aW9uIHN1Yi1wcm9jZXNzIGlkXG4gKiBAcGFyYW0ge251bWJlcn0gc3ViUHJvY2Vzc1NlcSAtIHRoZSBXb3JrZmxvdyBpbnN0YW5jZSBzdWItcHJvY2VzcyBzZXFcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdGVwSWQgLSB0aGUgV29ya2Zsb3cgY29uZmlnIC8gZGVmaW5pdGlvbiBzdGVwIGlkXG4gKiBAcGFyYW0ge29iamVjdH0gdXNlciAtIHRoZSB1c2VyIGlkIGFuZCB1c2VybmFtZSBkYXRhXG4gKlxuICogQGV4YW1wbGUgXCJcIlxuICpcbiAqIEByZXR1cm4gXCJcIlxuICpcbiAqL1xuV29ya2Zsb3cucHJvdG90eXBlLmFzc2lnblVzZXIgPSBmdW5jdGlvbihwcm9jZXNzSWQsIHByb2Nlc3NTZXEsIHN1YlByb2Nlc3NJZCwgc3ViUHJvY2Vzc1NlcSwgdXNlcil7XG5cdC8vIFJlLWFzc2lnbiB0aGUgV29ya2Zsb3cgY29uc3RydWN0b3IgaW5zdGFuY2UgYXMgX3RoaXNcblx0dmFyIF90aGlzID0gdGhpcztcblx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuXHRcdHRyeSB7XG5cdFx0XHRyZXNvbHZlKHVzZXIpXG5cdFx0fSBjYXRjaChlcnIpIHtcblx0XHRcdHJlamVjdChlcnIpO1xuXHRcdH1cblx0fSlcbn07XG5cbi8qKlxuICogV29ya2Zsb3cgdGFzaywgdGhpcyBtZXRob2QgZXhlY3V0ZXMgYSBzcGVjaWZpYyB0YXNrLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBwcm9jZXNzSWQgLSB0aGUgcHJvY2VzcyBpZCB0byBwcm9jZXNzXG4gKiBAcGFyYW0ge29iamVjdH0gaW5wdXREYXRhIC0gdGhlIGlucHV0IGRhdGEgdG8gcHJvY2Vzc1xuICpcbiAqIEBleGFtcGxlXG4gKiBXb3JrZmxvdy5pbml0aWFsaXplKCdwcm9jZXNzSWQnLCB7IHZhbGlkRGF0ZTogJ2RhdGUnIH0pO1xuICpcbiAqIEByZXR1cm4gXCJcIlxuICpcbiAqL1xuV29ya2Zsb3cucHJvdG90eXBlLnVpID0gZnVuY3Rpb24oKXtcblx0Ly8gUmUtYXNzaWduIHRoZSBXb3JrZmxvdyBjb25zdHJ1Y3RvciBpbnN0YW5jZSBhcyBfdGhpc1xuXHR2YXIgX3RoaXMgPSB0aGlzO1xuXHRyZXR1cm4ge1xuXHRcdGdldFByb2Nlc3M6IGZ1bmN0aW9uKHByb2Nlc3NJZCwgbGFuZyl7XG5cdFx0XHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG5cdFx0XHRcdHRyeSB7XG5cdFx0XHRcdFx0dXNlckludGVyZmFjZS5nZXRQcm9jZXNzKHByb2Nlc3NJZCwgbGFuZywgX3RoaXMpLnRoZW4oZnVuY3Rpb24obW9kZWwpe1xuXHRcdFx0XHRcdFx0cmVzb2x2ZShtb2RlbCk7XG5cdFx0XHRcdFx0fSwgZnVuY3Rpb24oZXJyKXtcblx0XHRcdFx0XHRcdHJlamVjdChlcnIpO1xuXHRcdFx0XHRcdH0pXG5cdFx0XHRcdH0gY2F0Y2goZXJyKSB7XG5cdFx0XHRcdFx0cmVqZWN0KGVycik7XG5cdFx0XHRcdH1cblx0XHRcdH0pXG5cdFx0fVxuXHR9XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFdvcmtmbG93O1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG4vLyB2YXIgR0sgPSByZXF1aXJlKCcuL2dhdGVrZWVwZXInKTtcbnZhciB1dGlsID0gcmVxdWlyZSgndXRpbGl0eScpO1xuLy8gdmFyIHV1aWQgPSByZXF1aXJlKCdub2RlLXV1aWQnKTtcblxuLy8gdmFyIGdhdGVrZWVwZXIgPSBuZXcgR0soKTtcblxuLyoqXG4gKiBGb3JtIE1vZHVsZVxuICpcbiAqIEBtb2R1bGUgbGliL2Zvcm1cbiAqIEBhdXRob3IgQnJlbnQgR29yZG9uXG4gKiBAdmVyc2lvbiAyLjAuMFxuICogQGRlc2NyaXB0aW9uIHRlc3QgZGVzY3JpcHRpb25cbiAqIEBjb3B5cmlnaHQgS3dhbnR1IEx0ZCBSU0EgMjAwOS0yMDE1LlxuICpcbiAqL1xuXG5mdW5jdGlvbiBjcmVhdGUoYXJncyl7XG5cdHZhciBwcm9jZXNzSWQgPSBhcmdzWzBdIHx8ICcnO1xuXHQvLyBjb25zb2xlLmxvZyhwcm9jZXNzSWQpO1xuXHR2YXIgc3ViUHJvY2VzcyA9IGFyZ3NbMV0gfHwge307XG5cdC8vIGNvbnNvbGUubG9nKHN1YlByb2Nlc3MpO1xuXHR2YXIgaW5kaWNhdG9ycyA9IHN1YlByb2Nlc3MuaW5kaWNhdG9ycyB8fCBbXTtcblx0Ly8gY29uc29sZS5sb2coaW5kaWNhdG9ycyk7XG5cdHZhciBfV0ZJbnN0YW5jZSA9IGFyZ3NbM10gfHwge307XG5cdC8vIGNvbnNvbGUubG9nKF9XRkluc3RhbmNlKTtcblx0dmFyIHN0ZXAgPSBhcmdzWzJdIHx8IHt9O1xuXHQvLyB2YXIgZGF0YSA9IGFyZ3NbM10gfHwge307XG5cdC8vIGNvbnNvbGUubG9nKHN0ZXApO1xuXHR2YXIgcmVzdWx0ID0gW107XG5cdC8vIGNvbnNvbGUubG9nKHN1YlByb2Nlc3MpO1xuXHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG5cdFx0dXRpbC5zeW5jTG9vcChpbmRpY2F0b3JzLmxlbmd0aCwgZnVuY3Rpb24obG9vcCl7XG5cdFx0XHR2YXIgY291bnRlciA9IGxvb3AuaXRlcmF0aW9uKCk7XG5cdFx0XHR2YXIgaW5kaWNhdG9ySWQgPSBpbmRpY2F0b3JzW2NvdW50ZXJdLl9pZDtcblx0XHRcdHZhciBpbmRpY2F0b3JOYW1lID0gdXRpbC5nZXROYW1lKGluZGljYXRvcnNbY291bnRlcl0ubmFtZSwgJ2VuJyk7XG5cdFx0XHR2YXIgaWQgPSBfV0ZJbnN0YW5jZS5wcm9maWxlICsgJzonICsgX1dGSW5zdGFuY2UuYXBwICsgJzonICsgaW5kaWNhdG9ySWQgKyAnOjAnO1xuXG5cdFx0XHQvLyBUT0RPOiBSZXBsYWNlIHdpdGggdGhlIGdhdGVrZWVwZXIgcHJvbWlzZSBjYWxsLCByZXR1cm4gdGhlIG9iamVjdCwgdXBkYXRlIHRoZSBpbmRpY2F0b3Jcblx0XHRcdC8vIGRvY3VtZW50IHdvcmtmbG93IHByb2Nlc3NlcyBkYXRhIGFuZCB1cGRhdGUgdGhlIHdvcmtmbG93IGNsYXNzIGluZGljYXRvcnMgYXJyYXkuXG5cblx0XHRcdC8vIGdhdGVrZWVwZXIuaW5zdGFudGlhdGUoaWQsICduZXdJbnN0YW5jZScsIGluZGljYXRvcklkLCBfV0ZJbnN0YW5jZS5wcm9maWxlLCBkYXRhLnZhbGlkRGF0ZSkudGhlbihmdW5jdGlvbihkb2Mpe1xuXHRcdFx0Ly9cdC8vIFVwZGF0ZSB0aGUgaW5kaWNhdG9yIHdvcmtmbG93IHByb2Nlc3NlcyBzZWN0aW9uXG5cdFx0XHQvL1x0dmFyIHdvcmtmbG93cyA9IGRvYy53b3JrZmxvd3M7XG5cdFx0XHQvL1x0d29ya2Zsb3dzLmlkID0gX1dGSW5zdGFuY2UuY29uZmlnLl9pZDtcblx0XHRcdC8vXHR3b3JrZmxvd3MuaW5zdGFuY2UgPSBfV0ZJbnN0YW5jZS5pbnN0YW5jZS5faWQ7XG5cdFx0XHQvL1x0X1dGSW5zdGFuY2UuaW5kaWNhdG9ycy5wdXNoKGRvYyk7XG5cdFx0XHQvL1x0bG9vcC5uZXh0KCk7XG5cdFx0XHQvLyB9LCBmdW5jdGlvbihlcnIpe1xuXHRcdFx0Ly9cdHJlamVjdChlcnIpO1xuXHRcdFx0Ly8gfSlcblxuXHRcdFx0Ly8gVGhpcyBzaG91bGQgYmUgdGhlIGRhdGEgcmV0dXJuZWQgZnJvbSB0aGUgZ2F0ZWtlZXBlciBjYWxsLlxuXHRcdFx0dmFyIGRvYyA9IHtcblx0XHRcdFx0XCJfaWRcIjogaWQsXG5cdFx0XHRcdFwidGl0bGVcIjogaW5kaWNhdG9yTmFtZSxcblx0XHRcdFx0XCJjYXRlZ29yeVwiOiB7XG5cdFx0XHRcdFx0XCJ0ZXJtXCI6IGluZGljYXRvcklkLFxuXHRcdFx0XHRcdFwibGFiZWxcIjogaW5kaWNhdG9yTmFtZVxuXHRcdFx0XHR9LFxuXHRcdFx0XHRcIndvcmtmbG93c1wiOiBbe1xuXHQgICAgICAgIFwiaWRcIjogX1dGSW5zdGFuY2UuY29uZmlnLl9pZCxcblx0ICAgICAgICBcImluc3RhbmNlXCI6IF9XRkluc3RhbmNlLmluc3RhbmNlLl9pZCxcblx0ICAgICAgICBcInByb2Nlc3Nlc1wiOiBbe1xuICAgICAgICAgICAgXCJpZFwiOiBwcm9jZXNzSWQsXG4gICAgICAgICAgICBcInN1YlByb2Nlc3NJZFwiOiBzdWJQcm9jZXNzLl9pZCxcbiAgICAgICAgICAgIFwic3RlcFwiOiB7XG4gICAgICAgICAgICAgIFwiaWRcIjogc3RlcC5pZCxcbiAgICAgICAgICAgICAgXCJzZXFcIjogc3RlcC5zZXEsXG4gICAgICAgICAgICAgIFwic3RhcnREYXRlXCI6IFwiXCIsXG4gICAgICAgICAgICAgIFwic3RhdHVzXCI6IHN0ZXAuc3RhdHVzLFxuICAgICAgICAgICAgICBcIm1lc3NhZ2VcIjogc3RlcC5tZXNzYWdlLFxuICAgICAgICAgICAgICBcImFzc2lnbmVkVG9cIjoge1xuICAgICAgICAgICAgICAgIFwidXNlcklkXCI6IHN0ZXAuYXNzaWduZWRUby51c2VySWQsXG4gICAgICAgICAgICAgICAgXCJuYW1lXCI6IHN0ZXAuYXNzaWduZWRUby5uYW1lXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIFwiY29tbWVudFwiOiBzdGVwLmNvbW1lbnQsXG4gICAgICAgICAgICAgIFwiY29tcGxldGVcIjogZmFsc2UsXG4gICAgICAgICAgICAgIFwiZW5kRGF0ZVwiOiBcIlwiXG4gICAgICAgICAgICB9XG5cdCAgICAgICAgfV1cblx0XHQgICAgfV1cblx0XHRcdH07XG5cblx0XHRcdC8vIFVwZGF0ZSB0aGUgaW5kaWNhdG9ycyBwcm9wZXJ0eSBhcnJheVxuXHRcdFx0X1dGSW5zdGFuY2UuaW5kaWNhdG9ycy5wdXNoKGRvYyk7XG5cdFx0XHQvLyBHb3QgdG8gdGhlIG5leHQgcHJvY2VzcyBpdGVtXG5cdFx0XHRsb29wLm5leHQoKTtcblx0XHR9LCBmdW5jdGlvbigpe1xuXHRcdFx0Ly8gT24gY29tcGxldGlvbiBvZiBhbGwgcHJvY2VzcyBsb29wIGl0ZW1zXG5cdCAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnRm9ybSBjcmVhdGVkIHN1Y2Nlc3NmdWxseS4nLCBfV0ZJbnN0YW5jZS5pbmRpY2F0b3JzKTtcblx0XHRcdHJlc29sdmUoc3VjY2Vzcyk7XG5cdFx0fSk7XG5cdFx0Ly8gdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ0Zvcm0gaW5kaWNhdG9yIHNldCBzYXZlZCBzdWNjZXNzZnVsbHkuJywgcmVzdWx0KTtcblx0XHQvLyByZXNvbHZlKHN1Y2Nlc3MpO1xuXHR9KTtcbn07XG5cbmZ1bmN0aW9uIHNhdmUoaW5kaWNhdG9yKXtcblx0dmFyIGNvbXBsZXRlZCA9IFtdO1xuXHR2YXIgcmVzdWx0ID0ge1xuXHRcdGNvbXBsZXRlOiB0cnVlLFxuXHRcdGRhdGE6IFtdXG5cdH07XG5cdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcblx0XHR2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnRm9ybSBpbmRpY2F0b3Igc2V0IHNhdmVkIHN1Y2Nlc3NmdWxseS4nLCByZXN1bHQpO1xuXHRcdHJlc29sdmUoc3VjY2Vzcyk7XG5cdH0pO1xufTtcblxuZnVuY3Rpb24gc3VibWl0KGZvcm0pe1xuXHR2YXIgY29tcGxldGVkID0gW107XG5cdHZhciByZXN1bHQgPSB7XG5cdFx0Y29tcGxldGU6IHRydWUsXG5cdFx0ZGF0YTogW11cblx0fTtcblx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuXHRcdHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdGb3JtIHN1Ym1pdHRlZCBzdWNjZXNzZnVsbHkuJywgcmVzdWx0KTtcblx0XHRyZXNvbHZlKHN1Y2Nlc3MpO1xuXHR9KTtcbn07XG5cbmZ1bmN0aW9uIGF1dGhvcmlzZShmb3JtKXtcblx0dmFyIGNvbXBsZXRlZCA9IFtdO1xuXHR2YXIgcmVzdWx0ID0ge1xuXHRcdGNvbXBsZXRlOiB0cnVlLFxuXHRcdGRhdGE6IFtdXG5cdH07XG5cdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcblxuXHRcdHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdGb3JtIGF1dGhvcmlzZWQgc3VjY2Vzc2Z1bGx5LicsIHJlc3VsdCk7XG5cdFx0cmVzb2x2ZShzdWNjZXNzKTtcblx0fSk7XG59O1xuXG5mdW5jdGlvbiBjbG9zZShmb3JtKXtcblx0dmFyIGNvbXBsZXRlZCA9IFtdO1xuXHR2YXIgcmVzdWx0ID0ge1xuXHRcdGNvbXBsZXRlOiB0cnVlLFxuXHRcdGRhdGE6IFtdXG5cdH07XG5cdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcblx0XHR2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnRm9ybSBjbG9zZWQgc3VjY2Vzc2Z1bGx5LicsIHJlc3VsdCk7XG5cdFx0cmVzb2x2ZShzdWNjZXNzKTtcblx0fSk7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IHtcblxuIFx0Y3JlYXRlOiBjcmVhdGUsXG4gXHRzYXZlOiBzYXZlLFxuIFx0c3VibWl0OiBzdWJtaXQsXG4gXHRhdXRob3Jpc2U6IGF1dGhvcmlzZSxcbiBcdGNsb3NlOiBjbG9zZVxuXG59XG4iLCIndXNlIHN0cmljdCc7XG5cbnZhciB1dGlsID0gcmVxdWlyZSgndXRpbGl0eScpO1xuXG4vKipcbiAqIFVzZXIgSW50ZXJmYWNlIE1vZHVsZVxuICpcbiAqIEBtb2R1bGUgbGliL3VpXG4gKiBAYXV0aG9yIEJyZW50IEdvcmRvblxuICogQHZlcnNpb24gMC4xLjBcbiAqIEBkZXNjcmlwdGlvbiB0ZXN0IGRlc2NyaXB0aW9uXG4gKlxuICovXG5cbiAvKipcbiAgKiBHZXQgYWxsIHByb2Nlc3Mgc3ViLXByb2Nlc3NlcyB1c2VyIGludGVyZmFjZSBkYXRhXG4gICpcbiAgKiBAcGFyYW0ge3N0cmluZ30gcHJvY2Vzc0lkIC0gdGhlIFdvcmtmbG93IGNvbmZpZyAvIGRlZmluaXRpb24gcHJvY2VzcyBpZFxuICAqIEBwYXJhbSB7c3RyaW5nfSBsYW5nIC0gdGhlIHVzZXIgcHJlZmZlcmVkIGxhbmdhdWdlXG4gICogQHBhcmFtIHtvYmplY3R9IF9XRkluc3RhbmNlIC0gdGhlIGN1cnJlbnQgd29ya2Zsb3cgY29uc3RydWN0b3IgaW5zdGFuY2VcbiAgKlxuICAqIEBleGFtcGxlICcnXG4gICpcbiAgKiBAcmV0dXJuICcnXG4gICpcbiAgKi9cbiBmdW5jdGlvbiBnZXRQcm9jZXNzKHByb2Nlc3NJZCwgbGFuZywgX1dGSW5zdGFuY2Upe1xuICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgdHJ5IHtcbiAgICAgIHZhciBwcm9jZXNzTW9kZWwgPSBbXTtcbiAgICAgIHZhciBwcm9jZXNzSW5zdGFuY2UgPSBbXTtcbiAgICBcdF9XRkluc3RhbmNlLmluc3RhbmNlLnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24ocHJvY2Vzc0l0ZW0pe1xuICAgIFx0XHRpZiAocHJvY2Vzc0l0ZW0uaWQgPT09IHByb2Nlc3NJZCkge1xuICAgIFx0XHRcdHByb2Nlc3NJbnN0YW5jZSA9IHByb2Nlc3NJdGVtO1xuICAgIFx0XHR9XG4gICAgXHR9KVxuICAgICAgLy8gY29uc29sZS5sb2cocHJvY2Vzc0luc3RhbmNlLnN1YlByb2Nlc3Nlcy5sZW5ndGgpO1xuICAgICAgdXRpbC5zeW5jTG9vcChwcm9jZXNzSW5zdGFuY2Uuc3ViUHJvY2Vzc2VzLmxlbmd0aCwgZnVuY3Rpb24obG9vcCl7XG4gIFx0XHRcdHZhciBjb3VudGVyID0gbG9vcC5pdGVyYXRpb24oKTtcbiAgICAgICAgdmFyIHByb2Nlc3NTZXEgPSBwcm9jZXNzSW5zdGFuY2Uuc2VxO1xuICAgICAgICB2YXIgc3ViUHJvY2Vzc0lkID0gcHJvY2Vzc0luc3RhbmNlLnN1YlByb2Nlc3Nlc1tjb3VudGVyXS5pZDtcbiAgICAgICAgdmFyIHN1YlByb2Nlc3NTZXEgPSBwcm9jZXNzSW5zdGFuY2Uuc3ViUHJvY2Vzc2VzW2NvdW50ZXJdLnNlcTtcbiAgICAgICAgZ2V0U3ViUHJvY2Vzcyhwcm9jZXNzSWQsIHByb2Nlc3NTZXEsIHN1YlByb2Nlc3NJZCwgc3ViUHJvY2Vzc1NlcSwgbGFuZywgX1dGSW5zdGFuY2UpLnRoZW4oZnVuY3Rpb24obW9kZWwpe1xuICAgICAgICAgIC8vIGNvbnNvbGUubG9nKG1vZGVsKTtcbiAgICAgICAgICBwcm9jZXNzTW9kZWwucHVzaChtb2RlbCk7XG4gICAgICAgICAgbG9vcC5uZXh0KCk7XG4gICAgICAgICAgLy8gY29uc29sZS5sb2cocHJvY2Vzc01vZGVsKTtcbiAgXHRcdFx0fSwgZnVuY3Rpb24oZXJyKXtcbiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhwcm9jZXNzTW9kZWwpO1xuICBcdFx0XHRcdGxvb3AuYnJlYWsoKTtcbiAgXHRcdFx0XHRyZWplY3QoZXJyKTtcbiAgXHRcdFx0fSk7XG4gIFx0XHR9LCBmdW5jdGlvbigpe1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhwcm9jZXNzTW9kZWwpO1xuICBcdFx0XHRyZXNvbHZlKHByb2Nlc3NNb2RlbCk7XG4gIFx0XHR9KTtcbiAgICB9IGNhdGNoKGVycil7XG4gICAgICByZWplY3QoZXJyKTtcbiAgICB9XG4gIH0pXG59O1xuXG4gLyoqXG4gICogR2V0IFN1YlByb2Nlc3MgdXNlciBpbnRlcmZhY2UgZGF0YVxuICAqXG4gICogQHBhcmFtIHtzdHJpbmd9IHByb2Nlc3NJZCAtIHRoZSBXb3JrZmxvdyBjb25maWcgLyBkZWZpbml0aW9uIHByb2Nlc3MgaWRcbiAgKiBAcGFyYW0ge251bWJlcn0gcHJvY2Vzc1NlcSAtIHRoZSBXb3JrZmxvdyBpbnN0YW5jZSBwcm9jZXNzIHNlcVxuICAqIEBwYXJhbSB7c3RyaW5nfSBzdWJQcm9jZXNzSWQgLSB0aGUgV29ya2Zsb3cgY29uZmlnIC8gZGVmaW5pdGlvbiBzdWItcHJvY2VzcyBpZFxuICAqIEBwYXJhbSB7bnVtYmVyfSBzdWJQcm9jZXNzU2VxIC0gdGhlIFdvcmtmbG93IGluc3RhbmNlIHN1Yi1wcm9jZXNzIHNlcVxuICAqIEBwYXJhbSB7b2JqZWN0fSBfV0ZJbnN0YW5jZSAtIHRoZSBjdXJyZW50IHdvcmtmbG93IGNvbnN0cnVjdG9yIGluc3RhbmNlXG4gICpcbiAgKiBAZXhhbXBsZSAnJ1xuICAqXG4gICogQHJldHVybiAnJ1xuICAqXG4gICovXG5mdW5jdGlvbiBnZXRTdWJQcm9jZXNzKHByb2Nlc3NJZCwgcHJvY2Vzc1NlcSwgc3ViUHJvY2Vzc0lkLCBzdWJQcm9jZXNzU2VxLCBsYW5nLCBfV0ZJbnN0YW5jZSl7XG4gIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICB0cnkge1xuICAgICAgdmFyIG1vZGVsID0ge1xuICAgICAgICBpZDogJycsXG4gICAgICAgIHNlcTogJycsXG4gICAgICAgIG5hbWU6ICcnLFxuICAgICAgICBoZWxwOiAnJyxcbiAgICAgICAgZGF0ZXM6ICcnLFxuICAgICAgICBzdGVwOiAnJ1xuICAgICAgfTtcbiAgICAgIHZhciBzdWJQcm9jZXNzID0gW107XG4gICAgXHR2YXIgc3ViUHJvY2Vzc0NvbmYgPSBbXTtcbiAgICBcdF9XRkluc3RhbmNlLmluc3RhbmNlLnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24ocHJvY2Vzc0l0ZW0pe1xuICAgIFx0XHRpZiAocHJvY2Vzc0l0ZW0uaWQgPT09IHByb2Nlc3NJZCAmJiBwcm9jZXNzSXRlbS5zZXEgPT09IHByb2Nlc3NTZXEpIHtcbiAgICBcdFx0XHR2YXIgc3BMZW5ndGggPSBwcm9jZXNzSXRlbS5zdWJQcm9jZXNzZXMubGVuZ3RoO1xuICAgIFx0XHRcdHByb2Nlc3NJdGVtLnN1YlByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24oc3ViUHJvY2Vzc0l0ZW0pe1xuICAgIFx0XHRcdFx0aWYgKHN1YlByb2Nlc3NJdGVtLmlkID09PSBzdWJQcm9jZXNzSWQgJiYgc3ViUHJvY2Vzc0l0ZW0uc2VxID09PSBzdWJQcm9jZXNzU2VxICYmIHN1YlByb2Nlc3NJdGVtLmNvbXBsZXRlID09PSBmYWxzZSkge1xuICAgIFx0XHRcdFx0XHRzdWJQcm9jZXNzID0gc3ViUHJvY2Vzc0l0ZW07XG4gICAgXHRcdFx0XHR9XG4gICAgXHRcdFx0fSlcbiAgICBcdFx0fVxuICAgIFx0fSlcbiAgICBcdC8vIEdldCB0aGUgY3VycmVudCBzdWJQcm9jZXNzIGNvbmZpZ3VyYXRpb25cbiAgICBcdF9XRkluc3RhbmNlLmNvbmZpZy5wcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKHByb2Nlc3NDb25maWcpe1xuICAgIFx0XHRpZiAocHJvY2Vzc0NvbmZpZy5faWQgPT09IHByb2Nlc3NJZCkge1xuICAgIFx0XHRcdHByb2Nlc3NDb25maWcuc3ViUHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihzdWJQcm9jZXNzQ29uZmlnKXtcbiAgICBcdFx0XHRcdGlmIChzdWJQcm9jZXNzQ29uZmlnLl9pZCA9PT0gc3ViUHJvY2Vzc0lkKSB7XG4gICAgXHRcdFx0XHRcdHN1YlByb2Nlc3NDb25mID0gc3ViUHJvY2Vzc0NvbmZpZztcbiAgICBcdFx0XHRcdH1cbiAgICBcdFx0XHR9KVxuICAgIFx0XHR9XG4gICAgXHR9KVxuICAgICAgLy8gVXBkYXRlIHRoZSBtb2RlbFxuICAgICAgbW9kZWwuaWQgPSBzdWJQcm9jZXNzQ29uZi5faWQ7XG4gICAgICBtb2RlbC5zZXEgPSBzdWJQcm9jZXNzLnNlcTtcbiAgICAgIG1vZGVsLm5hbWUgPSB1dGlsLmdldE5hbWUoc3ViUHJvY2Vzc0NvbmYubmFtZSwgbGFuZyk7XG4gICAgICBtb2RlbC5oZWxwID0gdXRpbC5nZXROYW1lKHN1YlByb2Nlc3NDb25mLmhlbHAsIGxhbmcpO1xuICAgICAgbW9kZWwuZGF0ZXMgPSBzdWJQcm9jZXNzLmRhdGVzO1xuICAgICAgbW9kZWwuc3RlcCA9IHN1YlByb2Nlc3Muc3RlcDtcbiAgICAgIHJlc29sdmUobW9kZWwpO1xuICAgIH0gY2F0Y2goZXJyKSB7XG4gICAgICByZWplY3QoZXJyKTtcbiAgICB9XG4gIH0pXG59O1xuXG4gbW9kdWxlLmV4cG9ydHMgPSB7XG5cbiAgZ2V0UHJvY2VzczogZ2V0UHJvY2Vzc1xuXG4gfVxuIiwiJ3VzZSBzdHJpY3QnO1xuXG52YXIgdXRpbCA9IHJlcXVpcmUoJ3V0aWxpdHknKTtcbnZhciBmb3JtID0gcmVxdWlyZSgnLi9mb3JtJyk7XG5cbi8qKlxuICogUHJvY2VzcyBNb2R1bGVcbiAqXG4gKiBAbW9kdWxlIGxpYi9wcm9jZXNzXG4gKiBAYXV0aG9yIEJyZW50IEdvcmRvblxuICogQHZlcnNpb24gMC4xLjBcbiAqIEBkZXNjcmlwdGlvbiB0ZXN0IGRlc2NyaXB0aW9uXG4gKlxuICovXG5cbi8qKlxuICogUHJvY2VzcyBwcmUtcmVxdWlzaXRlc1xuICpcbiAqIEBwYXJhbSB7b2JqZWN0fSBwcmVyZXF1aXNpdGVzIC0gdGhlIHByZS1yZXF1aXNpdGVzIGNvbmZpZyBkYXRhXG4gKlxuICogQGV4YW1wbGUgJydcbiAqXG4gKiBAcmV0dXJuICcnXG4gKlxuICovXG5mdW5jdGlvbiBwcmVSZXF1aXNpdGVzKHByZXJlcXVpc2l0ZXMpIHtcblx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuXHRcdC8vIFVuY29tbWVudCBiZWxvdyBzZWN0aW9uIHdoZW4gcmVhZHkgdG8gaW1wbGVtZW50XG5cdFx0Ly8gdXRpbC5zeW5jTG9vcChwcmVyZXF1aXNpdGVzLmxlbmd0aCwgZnVuY3Rpb24obG9vcCl7XG5cdFx0Ly8gXHR2YXIgY291bnRlciA9IGxvb3AuaXRlcmF0aW9uKCk7XG5cdFx0Ly8gXHRwcmVSZXF1aXNpdGUocHJlcmVxdWlzaXRlc1tjb3VudGVyXSwgY291bnRlcikudGhlbihmdW5jdGlvbihkYXRhKXtcblx0XHQvLyBcdFx0Ly8gQ2hlY2sgaWYgYWxsIHByZS1yZXF1aXNpdGVzIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkuXG5cdFx0Ly8gXHRcdGNvbXBsZXRlZC5wdXNoKGRhdGEuY29tcGxldGUpO1xuXHRcdC8vIFx0XHRyZXN1bHQuZGF0YS5wdXNoKGRhdGEpO1xuXHRcdC8vIFx0XHRpZiAoY29tcGxldGVkLmV2ZXJ5KEJvb2xlYW4pKSB7XG5cdFx0Ly8gXHRcdFx0cmVzdWx0LmNvbXBsZXRlZCA9IHRydWU7XG5cdFx0Ly8gXHRcdFx0bG9vcC5uZXh0KCk7XG5cdFx0Ly8gXHRcdFx0dmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ1ByZS1yZXF1aXNpdGVzIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkuJywgcmVzdWx0KTtcblx0XHQvLyBcdFx0XHRkZWZlcnJlZC5yZXNvbHZlKHN1Y2Nlc3MpO1xuXHRcdC8vIFx0XHR9IGVsc2Uge1xuXHRcdC8vIFx0XHRcdGxvb3AuYnJlYWsoKTtcblx0XHQvLyBcdFx0XHR2YXIgZXJyb3IgPSB1dGlsLmVycm9yKCdXRjAwNycpO1xuXHRcdC8vIFx0XHRcdGRlZmVycmVkLnJlamVjdChlcnJvcik7XG5cdFx0Ly8gXHRcdH1cblx0XHQvLyBcdH0sIGZ1bmN0aW9uKGVycil7XG5cdFx0Ly8gXHRcdGxvb3AuYnJlYWsoKTtcblx0XHQvLyBcdFx0ZGVmZXJyZWQucmVqZWN0KGVycik7XG5cdFx0Ly8gXHR9KTtcblx0XHQvLyB9KTtcblx0XHR2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnUHJlLXJlcXVpc2l0ZXMgY29tcGxldGVkIHN1Y2Nlc3NmdWxseS4nLCB7fSk7XG5cdFx0cmVzb2x2ZShzdWNjZXNzKTtcblx0fSk7XG59O1xuXG4vKipcbiAqIFByb2Nlc3MgcHJlLXJlcXVpc2l0ZSwgZXhlY3V0ZSB0aGUgcHJlLXJlcXVpc2l0ZSBjb25kaXRpb24uXG4gKlxuICogQHBhcmFtIHtvYmplY3R9IHByZXJlcXVpc2l0ZSAtIHRoZSBwcmUtcmVxdWlzaXRlIGNvbmZpZyBkYXRhXG4gKiBAcGFyYW0ge251bWJlcn0gY291bnRlciAtIHRoZSBwcmUtcmVxdWlzaXRlIGNvdW50IC8gbnVtYmVyXG4gKiBAcGFyYW0ge29iamVjdH0gX1dGSW5zdGFuY2UgLSB0aGUgd29ya2Zsb3cgY29uc3RydWN0b3IgaW5zdGFuY2VcbiAqXG4gKiBAZXhhbXBsZVxuICogdmFyIGNvbmZpZyA9IHtcbiAqXHQgICAgXCJfc2VxXCI6IFwiXCIsXG4gKlx0ICAgIFwiX3R5cGVcIjogXCJcIixcbiAqXHRcdFwiX3N1YmplY3RcIjogXCJcIixcbiAqXHQgICAgXCJfb3BlcmF0b3JcIjogXCJcIixcbiAqXHQgICAgXCJfdmFsdWVcIjogXCJcIixcbiAqXHQgICAgXCJfcmVmZXJlbmNlXCI6IFwiXCIsXG4gKlx0ICAgIFwibWVzc2FnZVwiOiB7XG4gKlx0ICAgIFx0XCJpMThuXCI6IHtcbiAqXHQgICAgXHRcdFwiX2xhbmdcIjogXCJlblwiLFxuICpcdCAgICBcdFx0XCJ2YWx1ZVwiOiBcIlwiXG4gKlx0ICAgIFx0fVxuICpcdCAgICB9XG4gKlx0fTtcbiAqIFByb2Nlc3MucHJlUmVxdWlzaXRlKGNvbmZpZywgY291bnRlciwgaW5zdGFuY2UsIGRvYyk7XG4gKlxuICogQHJldHVybiAnJ1xuICpcbiAqL1xuZnVuY3Rpb24gcHJlUmVxdWlzaXRlKHByZXJlcXVpc2l0ZSwgY291bnRlciwgX1dGSW5zdGFuY2Upe1xuXHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG5cdFx0c3dpdGNoKHByZXJlcXVpc2l0ZS5fdHlwZSkge1xuXHRcdFx0Ly8gVE9ETzogQWRkIHRoZSBjYWxsIHRvIHRoZSByZWxldmFudCBtZXRob2RzIGJhc2VkIG9uIHRoZSBfdHlwZSBhdHRyaWJ1dGUuIFNob3VsZCBjYWxsIHRoZSBnZW5lcmljIGFjdGlvbigpIG1ldGhvZC5cblx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdHZhciBlcnJvciA9IHV0aWwuZXJyb3IoJ1dGUHJlUmVxdWlzaXRlRXJyb3InLCdQcmUtcmVxdWlzaXRlIHR5cGU6ICcgKyBwcmVyZXF1aXNpdGUuX3R5cGUgKyAnIG5vdCBkZWZpbmVkLicpO1xuXHRcdFx0XHRyZWplY3QoZXJyb3IpO1xuXHRcdH1cblx0fSk7XG59O1xuXG4vKipcbiAqIFByb2Nlc3MgcHJlLWFjdGlvbnNzXG4gKlxuICogQHBhcmFtIHtvYmplY3R9IHByZUFjdGlvbnMgLSB0aGUgcHJlLWFjdGlvbnMgY29uZmlnIGRhdGFcbiAqIEBwYXJhbSB7b2JqZWN0fSBfV0ZJbnN0YW5jZSAtIHRoZSBjdXJyZW50IHdvcmtmbG93IGNvbnN0cnVjdG9yIGluc3RhbmNlXG4gKlxuICogQGV4YW1wbGUgJydcbiAqXG4gKiBAcmV0dXJuICcnXG4gKlxuICovXG5mdW5jdGlvbiBwcmVBY3Rpb25zKHByZUFjdGlvbnMsIF9XRkluc3RhbmNlKXtcblx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuXHRcdC8vIEFkZCBmdW5jdGlvbiBsb2dpYyBoZXJlLi4uXG5cblx0XHR2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnUHJlLWFjdGlvbnMgY29tcGxldGVkIHN1Y2Nlc3NmdWxseS4nLCB7fSk7XG5cdFx0cmVzb2x2ZShzdWNjZXNzKTtcblx0fSk7XG59O1xuXG4vKipcbiAqIFByb2Nlc3Mgc3ViLXByb2Nlc3NcbiAqXG4gKiBAcGFyYW0ge29iamVjdH0gcHJvY2VzcyAtIHRoZSBjdXJyZW50IHByb2Nlc3MgaWQgYW5kIHNlcVxuICogQHBhcmFtIHtvYmplY3R9IHN1YlByb2Nlc3MgLSB0aGUgc3ViLXByb2Nlc3MgaWQgYW5kIHNlcVxuICogQHBhcmFtIHtvYmplY3R9IGRhdGEgLSB0aGUgdXNlciBpbnB1dCBkYXRhXG4gKiBAcGFyYW0ge29iamVjdH0gX1dGSW5zdGFuY2UgLSB0aGUgY3VycmVudCB3b3JrZmxvdyBjb25zdHJ1Y3RvciBpbnN0YW5jZVxuICpcbiAqIEBleGFtcGxlICcnXG4gKlxuICogQHJldHVybiAnJ1xuICpcbiAqL1xuZnVuY3Rpb24gc3ViUHJvY2Vzcyhwcm9jZXNzSWQsIHByb2Nlc3NTZXEsIHN1YlByb2Nlc3NJZCwgc3ViUHJvY2Vzc1NlcSwgZGF0YSwgX1dGSW5zdGFuY2Upe1xuXHQvLyBHZXQgdGhlIGN1cnJlbnQgcHJvY2VzcyBzdWJQcm9jZXNzIGluc3RhbmNlXG5cdC8vIHZhciBzdWJQcm9jZXNzU2VxID0gMTtcblx0dmFyIHN1YlByb2Nlc3MgPSBbXTtcblx0dmFyIHN1YlByb2Nlc3NDb25mID0gW107XG5cdF9XRkluc3RhbmNlLmluc3RhbmNlLnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24ob2JqUHJvY2Vzcyl7XG5cdFx0aWYgKG9ialByb2Nlc3MuaWQgPT09IHByb2Nlc3NJZCAmJiBvYmpQcm9jZXNzLnNlcSA9PT0gcHJvY2Vzc1NlcSkge1xuXHRcdFx0dmFyIHNwTGVuZ3RoID0gb2JqUHJvY2Vzcy5zdWJQcm9jZXNzZXMubGVuZ3RoO1xuXHRcdFx0b2JqUHJvY2Vzcy5zdWJQcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKG9ialN1YlByb2Nlc3Mpe1xuXHRcdFx0XHRpZiAob2JqU3ViUHJvY2Vzcy5pZCA9PT0gc3ViUHJvY2Vzc0lkICYmIG9ialN1YlByb2Nlc3Muc2VxID09PSBzdWJQcm9jZXNzU2VxKSB7XG5cdFx0XHRcdFx0dmFyIHV1aWQgPSBvYmpTdWJQcm9jZXNzLnV1aWQ7XG5cdFx0XHRcdFx0Ly8gc3ViUHJvY2VzcyA9IG9ialN1YlByb2Nlc3M7XG5cdFx0XHRcdFx0Ly8gY29uc29sZS5sb2codXVpZCk7XG5cdFx0XHRcdFx0Ly8gY29uc29sZS5sb2coX1dGSW5zdGFuY2Uuc3VicHJvY2Vzc2VzLmxlbmd0aCk7XG5cdFx0XHRcdFx0X1dGSW5zdGFuY2Uuc3VicHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihzdWJQcm9jZXNzSXRlbSl7XG5cdFx0XHRcdFx0XHRpZiAoc3ViUHJvY2Vzc0l0ZW0uX2lkID09PSB1dWlkKSB7XG5cdFx0XHRcdFx0XHRcdHN1YlByb2Nlc3MgPSBzdWJQcm9jZXNzSXRlbTtcblx0XHRcdFx0XHRcdFx0Ly8gY29uc29sZS5sb2coc3ViUHJvY2Vzcyk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0fVxuXHRcdFx0fSlcblx0XHR9XG5cdH0pXG5cdC8vIEdldCB0aGUgY3VycmVudCBzdWJQcm9jZXNzIGNvbmZpZ3VyYXRpb25cblx0X1dGSW5zdGFuY2UuY29uZmlnLnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24ocHJvY2Vzc0NvbmZpZyl7XG5cdFx0aWYgKHByb2Nlc3NDb25maWcuX2lkID09PSBwcm9jZXNzSWQpIHtcblx0XHRcdHZhciByZXN1bHQgPSBbXTtcblx0XHRcdHByb2Nlc3NDb25maWcuc3ViUHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihzdWJQcm9jZXNzQ29uZmlnKXtcblx0XHRcdFx0aWYgKHN1YlByb2Nlc3NDb25maWcuX2lkID09PSBzdWJQcm9jZXNzSWQpIHtcblx0XHRcdFx0XHRzdWJQcm9jZXNzQ29uZiA9IHN1YlByb2Nlc3NDb25maWc7XG5cdFx0XHRcdH1cblx0XHRcdH0pXG5cdFx0fVxuXHR9KVxuXHQvLyBpZiAoc3ViUHJvY2Vzcy5sZW5ndGggIT09IDApIHtcblx0Ly8gXHRzdWJQcm9jZXNzU2VxID0gc3ViUHJvY2Vzcy5sZW5ndGggKyAxO1xuXHQvLyB9XG5cdC8vIFRoZSBkZWZhdWx0IHN1YlByb2Nlc3MgbW9kZWxcblx0dmFyIG1vZGVsID0ge1xuXHRcdF9pZDogX1dGSW5zdGFuY2UucHJvZmlsZSArICc6JyArIF9XRkluc3RhbmNlLmFwcCArICc6JyArIHByb2Nlc3NJZCArICc6JyArIHByb2Nlc3NTZXEgKyAnOicgKyBzdWJQcm9jZXNzSWQgKyAnOicgKyBzdWJQcm9jZXNzU2VxLFxuXHRcdGlkOiBzdWJQcm9jZXNzSWQsXG5cdFx0dHlwZTogJ3dvcmtmbG93SW5zdGFuY2VTdWJQcm9jZXNzJyxcblx0XHRzZXE6IHN1YlByb2Nlc3NTZXEsXG5cdFx0aW5pdGlhdGVkOiBmYWxzZSxcblx0XHRkYXRlczoge1xuXHRcdFx0Y3JlYXRlZDogJycsXG5cdFx0XHR2YWxpZDogJycsXG5cdFx0XHRkdWU6ICcnLFxuXHRcdFx0Y2xvc2VkOiAnJ1xuXHRcdH0sXG5cdFx0Y29tcGxldGU6IGZhbHNlLFxuXHRcdGluZGljYXRvcnM6IFtdLFxuXHRcdHN0ZXA6IHt9XG5cdH07XG5cdC8vIFJldHVybiBhIHByb21pc2Vcblx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuXHRcdC8vIENhdGNoIGFsbCB1bmNhdWdodCBlcnJvcnNcblx0XHR0cnkge1xuXHRcdFx0Ly8gMS4gSW5pdGlhdGUgdGhlIHN1YlByb2Nlc3Ncblx0XHRcdHZhciBpbml0aWF0ZUNvbmYgPSBzdWJQcm9jZXNzQ29uZi5pbml0aWF0ZTtcblx0XHRcdC8vIGNvbnNvbGUubG9nKHN1YlByb2Nlc3MpO1xuXHRcdFx0aW5pdGlhdGUoaW5pdGlhdGVDb25mLCBzdWJQcm9jZXNzLCBkYXRhKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCl7XG5cdFx0XHRcdC8vVXBkYXRlIHRoZSBzdWJQcm9jZXNzIG1vZGVsXG5cdFx0XHRcdG1vZGVsLmluaXRpYXRlZCA9IHJlc3VsdC5kYXRhLmluaXRpYXRlZDtcblx0XHRcdFx0bW9kZWwuZGF0ZXMgPSByZXN1bHQuZGF0YS5kYXRlcztcblx0XHRcdFx0Ly8gRXhlY3V0ZSB0aGUgZmlyc3Qgc3RlcFxuXHRcdFx0XHR2YXIgc3RlcElkID0gc3ViUHJvY2Vzc0NvbmYuc3RlcHNbMF0uX2lkO1xuXHRcdFx0XHR2YXIgdHJhbnNpdGlvbklkID0gc3ViUHJvY2Vzc0NvbmYuc3RlcHNbMF0udHJhbnNpdGlvbnNbMF0uX2lkO1xuXHRcdFx0XHR2YXIgc3RlcFNlcSA9IDE7XG5cdFx0XHRcdHN0ZXAocHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIHN0ZXBJZCwgc3RlcFNlcSwgZGF0YSwgX1dGSW5zdGFuY2UpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KXtcblx0XHRcdFx0XHRtb2RlbC5zdGVwID0gcmVzdWx0LmRhdGE7XG5cdFx0XHRcdFx0Ly8gY29uc29sZS5sb2cobW9kZWwpO1xuXHRcdFx0XHRcdC8vIGNvbnNvbGUubG9nKHN1YlByb2Nlc3NDb25mKTtcblx0XHRcdFx0XHQvLyBVcGRhdGUgdGhlIGluZGljYXRvciBzZWN0aW9ucyBvZiB0aGUgc3ViUHJvY2Vzc1xuXHRcdFx0XHRcdGluZGljYXRvcnMoc3ViUHJvY2Vzc0NvbmYuaW5kaWNhdG9ycywgX1dGSW5zdGFuY2UpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KXtcblx0XHRcdFx0XHRcdG1vZGVsLmluZGljYXRvcnMgPSByZXN1bHQuZGF0YTtcblx0XHRcdFx0XHRcdC8vIGNvbnNvbGUubG9nKHJlc3VsdC5kYXRhKTtcblx0XHRcdFx0XHRcdC8vIEV4ZWN1dGUgdGhlIHRyYW5zaXRpb25zLCBpZiBhdXRvXG5cdFx0XHRcdFx0XHR0cmFuc2l0aW9uKHByb2Nlc3NJZCwgcHJvY2Vzc1NlcSwgc3ViUHJvY2Vzc0lkLCBzdWJQcm9jZXNzU2VxLCBzdGVwSWQsIHRyYW5zaXRpb25JZCwgZGF0YSwgX1dGSW5zdGFuY2UpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KXtcblx0XHRcdFx0XHRcdFx0Ly8gVXBkYXRlIHRoZSBzdWJQcm9jZXNzIHN0ZXAgZGF0YVxuXHRcdFx0XHRcdFx0XHRtb2RlbC5zdGVwID0gcmVzdWx0LmRhdGE7XG5cdFx0XHRcdFx0XHRcdC8vIGNvbnNvbGUubG9nKHJlc3VsdC5kYXRhKTtcblx0XHQgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MocmVzdWx0Lm1lc3NhZ2UsIG1vZGVsKTtcblx0XHQgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcblx0XHQgICAgICAgIH0sIGZ1bmN0aW9uKGVycil7XG5cdFx0ICAgICAgICAgIHJlamVjdChlcnIpO1xuXHRcdCAgICAgICAgfSk7XG5cdFx0XHRcdFx0fSwgZnVuY3Rpb24oZXJyKXtcblx0XHRcdFx0XHRcdHJlamVjdChlcnIpO1xuXHRcdFx0XHRcdH0pXG5cdFx0XHRcdH0sIGZ1bmN0aW9uKGVycil7XG5cdFx0XHRcdFx0cmVqZWN0KGVycik7XG5cdFx0XHRcdH0pXG5cdFx0XHR9LCBmdW5jdGlvbihlcnIpe1xuXHRcdFx0XHRyZWplY3QoZXJyKTtcblx0XHRcdH0pXG5cdFx0fSBjYXRjaChlcnIpe1xuXHRcdFx0cmVqZWN0KGVycik7XG5cdFx0fVxuXHR9KTtcbn07XG5cbi8qKlxuICogUHJvY2VzcyBpbml0aWF0ZVxuICpcbiAqIEBwYXJhbSB7b2JqZWN0fSBpbml0aWF0ZSAtIHRoZSBpbml0aWF0ZSBjb25maWcgZGF0YVxuICogQHBhcmFtIHtvYmplY3R9IGRhdGEgLSB0aGUgdXNlciBpbnB1dCBkYXRhXG4gKlxuICogQGV4YW1wbGUgJydcbiAqXG4gKiBAcmV0dXJuICcnXG4gKlxuICovXG5mdW5jdGlvbiBpbml0aWF0ZShpbml0aWF0ZSwgc3ViUHJvY2VzcywgZGF0YSl7XG5cdHZhciBjb21wbGV0ZWQgPSBbXTtcblx0dmFyIHJlc3VsdCA9IHtcblx0XHRpbml0aWF0ZWQ6IGZhbHNlLFxuXHRcdGRhdGVzOiB7XG5cdFx0XHRjcmVhdGVkOiAnJyxcblx0XHRcdHZhbGlkOiAnJyxcblx0XHRcdGR1ZTogJycsXG5cdFx0XHRjbG9zZWQ6ICcnXG5cdFx0fVxuXHR9O1xuXHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG5cdFx0dmFyIGluaXQgPSBmdW5jdGlvbigpe1xuXHRcdFx0c3dpdGNoKGluaXRpYXRlLl90eXBlKSB7XG5cdFx0XHRcdGNhc2UgJ3VzZXInOlxuXHRcdFx0XHRcdC8vIElmIHRoZSBzdWJQcm9jZXNzIGluaXRpYXRpb24gaXMgdXNlciBkZWZpbmVkIHRoZW5cblx0XHRcdFx0XHRyZXN1bHQuZGF0ZXMuY3JlYXRlZCA9IGRhdGEuY3JlYXRlZERhdGU7XG5cdFx0XHRcdFx0aWYgKGluaXRpYXRlLmRhdGVzLnZhbGlkLl90eXBlID09PSAndXNlclNlbGVjdGVkJykge1xuXHRcdFx0XHRcdFx0aWYgKGRhdGEudmFsaWREYXRlICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdFx0XHRcdFx0cmVzdWx0LmRhdGVzLnZhbGlkID0gZGF0YS52YWxpZERhdGU7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHR2YXIgZXJyb3IgPSB1dGlsLmVycm9yKCdXRkluaXRpYXRlRXJyb3InLCAnTm8gdmFsaWQgZGF0ZSBwYXNzZWQgaW4gLSB7aW5wdXREYXRhLnZhbGlkRGF0ZX0nKTtcblx0XHRcdFx0XHRcdFx0cmVqZWN0KGVycm9yKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKGluaXRpYXRlLmRhdGVzLmR1ZS5fdHlwZSA9PT0gJ3VzZXJTZWxlY3RlZCcpIHtcblx0XHRcdFx0XHRcdGlmIChkYXRhLmR1ZURhdGUgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0XHRcdFx0XHRyZXN1bHQuZGF0ZXMuZHVlID0gZGF0YS5kdWVEYXRlO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0dmFyIGVycm9yID0gdXRpbC5lcnJvcignV0ZJbml0aWF0ZUVycm9yJywgJ05vIGR1ZSBkYXRlIHBhc3NlZCBpbiAtIHtpbnB1dERhdGEuZHVlRGF0ZX0nKTtcblx0XHRcdFx0XHRcdFx0cmVqZWN0KGVycm9yKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmVzdWx0LmluaXRpYXRlZCA9IHRydWU7XG5cdFx0XHRcdFx0dmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ1N1Yi1Qcm9jZXNzIGluaXRpYXRlIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkuJywgcmVzdWx0KTtcblx0XHRcdFx0XHRyZXNvbHZlKHN1Y2Nlc3MpO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHRcdHZhciBlcnJvciA9IHV0aWwuZXJyb3IoJ1dGSW5pdGlhdGVFcnJvcicsICdJbml0aWF0ZSB0eXBlOiAnICsgaW5pdGlhdGUuX3R5cGUgKyAnIG5vdCBkZWZpbmVkLicpO1xuXHRcdFx0XHRcdHJlamVjdChlcnJvcik7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChzdWJQcm9jZXNzLmNvbXBsZXRlID09PSB1bmRlZmluZWQpIHtcblx0XHRcdGluaXQoKTtcblx0XHR9IGVsc2UgaWYgKCFzdWJQcm9jZXNzLmNvbXBsZXRlKSB7XG5cdFx0XHRpZiAoaW5pdGlhdGUucGFyYWxsZWxJbnN0YW5jZXMpIHtcblx0XHRcdFx0aW5pdCgpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dmFyIGVycm9yID0gdXRpbC5lcnJvcignV0ZJbml0aWF0ZUVycm9yJywgJ1N1Yi1wcm9jZXNzOiAnICsgc3ViUHJvY2Vzcy5pZCArICcgc3RpbGwgYWN0aXZlIGFuZCBwYXJhbGxlbCBpbnN0YW5jZXMgYXJlIG5vdCBhbGxvd2VkLicpO1xuXHRcdFx0XHRyZWplY3QoZXJyb3IpO1xuXHRcdFx0fVxuXHRcdH1cblx0fSk7XG59O1xuXG4vKipcbiAqIFByb2Nlc3Mgc3RlcFxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBwcm9jZXNzSWQgLSB0aGUgY3VycmVudCBwcm9jZXNzIGlkXG4gKiBAcGFyYW0ge3N0cmluZ30gc3ViUHJvY2Vzc0lkIC0gdGhlIGN1cnJlbnQgc3ViLXByb2Nlc3MgaWRcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdGVwSWQgLSB0aGUgY3VycmVudCBzdWItcHJvY2VzcyBzdGVwIGlkXG4gKiBAcGFyYW0ge251bWJlcn0gc3RlcFNlcSAtIHRoZSBjdXJyZW50IHN1Yi1wcm9jZXNzIHN0ZXAgaW5zdGFuY2UgY291bnRlciAvIHNlcXVlbmNlXG4gKiBAcGFyYW0ge29iamVjdH0gaW5wdXREYXRhIC0gdGhlIHVzZXIgaW5wdXQgZGF0YVxuICogQHBhcmFtIHtvYmplY3R9IF9XRkluc3RhbmNlIC0gdGhlIGN1cnJlbnQgX1dGSW5zdGFuY2UgY29uc3RydWN0b3IgaW5zdGFuY2VcbiAqXG4gKiBAZXhhbXBsZSAnJ1xuICpcbiAqIEByZXR1cm4gJydcbiAqXG4gKi9cbmZ1bmN0aW9uIHN0ZXAocHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIHN0ZXBJZCwgc3RlcFNlcSwgaW5wdXREYXRhLCBfV0ZJbnN0YW5jZSl7XG5cdC8vIERlZmF1bHQgc3RlcCBtb2RlbFxuXHR2YXIgbW9kZWwgPSB7XG5cdFx0aWQ6ICcnLFxuXHRcdHNlcTogJycsXG5cdFx0c3RhdHVzOiAnJyxcblx0XHRtZXNzYWdlOiAnJyxcblx0XHRhc3NpZ25lZFRvOiB7XG5cdFx0XHR1c2VySWQ6ICcnLFxuXHRcdFx0bmFtZTogJydcblx0XHR9LFxuXHRcdGNvbW1lbnQ6ICcnXG5cdH07XG5cdHZhciBzdWJQcm9jZXNzID0ge307XG5cdHZhciB1dWlkID0gJyc7XG5cdHZhciBpbnN0U3ViUHJvY2Vzcztcblx0dmFyIHN0ZXAgPSB7fTtcblx0dmFyIHRyYW5zaXRpb25JZCA9ICcnO1xuXHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG5cdFx0dHJ5IHtcblx0XHRcdC8vR2V0IHRoZSBjdXJyZW50IHN1YlByb2Nlc3MgaW5zdGFuY2UgZGF0YVxuXHRcdFx0X1dGSW5zdGFuY2UuaW5zdGFuY2UucHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihvYmpQcm9jZXNzKXtcblx0XHRcdFx0aWYgKG9ialByb2Nlc3MuaWQgPT09IHByb2Nlc3NJZCAmJiBvYmpQcm9jZXNzLnNlcSA9PT0gcHJvY2Vzc1NlcSkge1xuXHRcdFx0XHRcdC8vIGNvbnNvbGUubG9nKG9ialByb2Nlc3MpO1xuXHRcdFx0XHRcdG9ialByb2Nlc3Muc3ViUHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihvYmpTdWJQcm9jZXNzKXtcblx0XHRcdFx0XHRcdGlmIChvYmpTdWJQcm9jZXNzLmlkID09PSBzdWJQcm9jZXNzSWQgJiYgb2JqU3ViUHJvY2Vzcy5zZXEgPT09IHN1YlByb2Nlc3NTZXEpIHtcblx0XHRcdFx0XHRcdFx0Ly8gaW5zdFN1YlByb2Nlc3MgPSBvYmpTdWJQcm9jZXNzO1xuXHRcdFx0XHRcdFx0XHR1dWlkID0gb2JqU3ViUHJvY2Vzcy51dWlkO1xuXHRcdFx0XHRcdFx0XHQvLyBzdWJQcm9jZXNzID0gb2JqU3ViUHJvY2Vzcztcblx0XHRcdFx0XHRcdFx0Ly8gY29uc29sZS5sb2codXVpZCk7XG5cdFx0XHRcdFx0XHRcdC8vIGNvbnNvbGUubG9nKF9XRkluc3RhbmNlLnN1YnByb2Nlc3Nlcy5sZW5ndGgpO1xuXG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0fVxuXHRcdFx0fSlcblx0XHRcdC8vIGNvbnNvbGUubG9nKF9XRkluc3RhbmNlLnN1YnByb2Nlc3Nlcyk7XG5cdFx0XHRfV0ZJbnN0YW5jZS5zdWJwcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKHN1YlByb2Nlc3NJdGVtKXtcblx0XHRcdFx0aWYgKHN1YlByb2Nlc3NJdGVtLl9pZCA9PT0gdXVpZCkge1xuXHRcdFx0XHRcdGluc3RTdWJQcm9jZXNzID0gc3ViUHJvY2Vzc0l0ZW07XG5cdFx0XHRcdFx0Ly8gY29uc29sZS5sb2coaW5zdFN1YlByb2Nlc3MpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KVxuXHRcdFx0Ly8gY29uc29sZS5sb2coaW5zdFN1YlByb2Nlc3MpO1xuXHRcdFx0Ly8gR2V0IHRoZSBjdXJyZW50IGNvbmZpZyBzdGVwXG5cdFx0XHRfV0ZJbnN0YW5jZS5jb25maWcucHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihvYmpQcm9jZXNzKXtcblx0XHRcdFx0aWYgKG9ialByb2Nlc3MuX2lkID09PSBwcm9jZXNzSWQpIHtcblx0XHRcdFx0XHRvYmpQcm9jZXNzLnN1YlByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24ob2JqU3ViUHJvY2Vzcyl7XG5cdFx0XHRcdFx0XHRpZiAob2JqU3ViUHJvY2Vzcy5faWQgPT09IHN1YlByb2Nlc3NJZCkge1xuXHRcdFx0XHRcdFx0XHRzdWJQcm9jZXNzID0gb2JqU3ViUHJvY2Vzcztcblx0XHRcdFx0XHRcdFx0b2JqU3ViUHJvY2Vzcy5zdGVwcy5maWx0ZXIoZnVuY3Rpb24ob2JqU3RlcCl7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKG9ialN0ZXAuX2lkID09PSBzdGVwSWQpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHN0ZXAgPSBvYmpTdGVwO1xuXHRcdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0fSlcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KVxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHRcdC8vIGNvbnNvbGUubG9nKHN0ZXApO1xuXHRcdFx0Ly8gVXBkYXRlIHRoZSBzdWItcHJvY2VzcyBzdGVwIGRhdGFcblx0XHRcdG1vZGVsLmlkID0gc3RlcElkO1xuXHRcdFx0bW9kZWwuc2VxID0gc3RlcFNlcTtcblx0XHRcdG1vZGVsLnN0YXR1cyA9IHN0ZXAuX3NldEluc3RhbmNlU3RhdHVzVG87XG5cdFx0XHRtb2RlbC5tZXNzYWdlID0gc3RlcC5fc2V0U3RhdHVzTXNnVG87XG5cdFx0XHRtb2RlbC5hc3NpZ25lZFRvLnVzZXJJZCA9IGlucHV0RGF0YS51c2VySWQ7XG5cdFx0XHRtb2RlbC5hc3NpZ25lZFRvLm5hbWUgPSBpbnB1dERhdGEubmFtZTtcblx0XHRcdG1vZGVsLmNvbW1lbnQgPSBpbnB1dERhdGEuY29tbWVudCAhPT0gdW5kZWZpbmVkID8gaW5wdXREYXRhLmNvbW1lbnQgOiAnJztcblx0XHRcdC8vIFVwZGF0ZSB0aGUgaW5kaWNhdG9yIGRvY3VtZW50cyBwcm9jZXNzIHN0ZXAgZGF0YVxuXHRcdFx0Ly8gY29uc29sZS5sb2coaW5zdFN1YlByb2Nlc3MpO1xuXHRcdFx0dmFyIGluZGljYXRvcnMgPSBpbnN0U3ViUHJvY2VzcyAhPT0gdW5kZWZpbmVkID8gaW5zdFN1YlByb2Nlc3MuaW5kaWNhdG9ycyA6IFtdO1xuXHRcdFx0aW5kaWNhdG9yRG9jcyhwcm9jZXNzSWQsIGluZGljYXRvcnMsIG1vZGVsLCBfV0ZJbnN0YW5jZSkudGhlbihmdW5jdGlvbihyZXN1bHQpe1xuXHRcdFx0XHQvLyBJZiBhY3Rpb25zIGFyZSBzcGVjaWZpZWQsIGV4ZWN1dGUgdGhlbVxuXHRcdFx0XHRpZiAoc3RlcC5hY3Rpb25zWzBdICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdFx0XHRhY3Rpb25zKHN0ZXAuYWN0aW9ucywgcHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIHN1YlByb2Nlc3MsIG1vZGVsLCBfV0ZJbnN0YW5jZSkudGhlbihmdW5jdGlvbihyZXN1bHQpe1xuXHRcdFx0XHRcdFx0Ly8gRXhlY3V0ZSB0aGUgdHJhbnNpdGlvbnMsIGlmIGF1dG9cblx0XHRcdFx0XHRcdC8vIGNvbnNvbGUubG9nKG1vZGVsKTtcblx0XHRcdFx0XHRcdHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdBY3Rpb25zIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkuJywgbW9kZWwpO1xuXHRcdFx0XHRcdFx0cmVzb2x2ZShzdWNjZXNzKTtcblx0XHRcdFx0XHR9LCBmdW5jdGlvbihlcnIpe1xuXHRcdFx0XHRcdFx0cmVqZWN0KGVycik7XG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0Ly8gRWxzZSB0YXNrcyBhcmUgc3ByZWNpZmllZCwgZXhlY3V0ZSB0aGVtXG5cdFx0XHRcdH0gZWxzZSBpZiAoc3RlcC50YXNrICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdFx0XHR2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnVGFzayBhd2FpdGluZyB1c2VyIGFjdGlvbi4nLCBtb2RlbCk7XG5cdFx0XHRcdFx0cmVzb2x2ZShzdWNjZXNzKTtcblx0XHRcdFx0fVxuXHRcdFx0fSwgZnVuY3Rpb24oZXJyKXtcblx0XHRcdFx0cmVqZWN0KGVycik7XG5cdFx0XHR9KVxuXHRcdH0gY2F0Y2goZXJyKSB7XG4gICAgXHRyZWplY3QoZXJyKTtcbiAgICB9XG5cdH0pO1xufTtcblxuLyoqXG4gKiBQcm9jZXNzIGluZGljYXRvciB1cGRhdGVzXG4gKlxuICogQHBhcmFtIHtvYmplY3R9IGFjdGlvbnMgLSB0aGUgYWN0aW9ucyBjb25maWcgZGF0YVxuICogQHBhcmFtIHtvYmplY3R9IHN1YlByb2Nlc3MgLSB0aGUgY3VycmVudCBzdWItcHJvY2VzcyBmb3JtIGNvbmZpZyBkYXRhXG4gKiBAcGFyYW0ge29iamVjdH0gX1dGSW5zdGFuY2UgLSB0aGUgY3VycmVudCB3b3JrZmxvdyBjb25zdHJ1Y3RvciBpbnN0YW5jZVxuICpcbiAqIEBleGFtcGxlICcnXG4gKlxuICogQHJldHVybiAnJ1xuICpcbiAqL1xuZnVuY3Rpb24gaW5kaWNhdG9ycyhpbmRpY2F0b3JzLCBfV0ZJbnN0YW5jZSl7XG5cdHZhciBtb2RlbCA9IFtdO1xuXHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG5cdFx0dHJ5IHtcblx0XHRcdC8vIFVwZGF0ZSB0aGUgaW5kaWNhdG9yIHNlY3Rpb25zIG9mIHRoZSBzdWJQcm9jZXNzXG5cdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IGluZGljYXRvcnMubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0dmFyIGluZGljYXRvcklkID0gaW5kaWNhdG9yc1tpXS5faWQ7XG5cdFx0XHRcdGZvciAodmFyIGogPSAwOyBqIDwgX1dGSW5zdGFuY2UuaW5kaWNhdG9ycy5sZW5ndGg7IGorKykge1xuXHRcdFx0XHRcdHZhciBpbmRpY2F0b3IgPSBfV0ZJbnN0YW5jZS5pbmRpY2F0b3JzW2pdO1xuXHRcdFx0XHRcdHZhciBpbmRpY2F0b3JNb2RlbCA9IHtcblx0XHRcdFx0XHRcdGlkOiAnJyxcblx0XHRcdFx0XHRcdGluc3RhbmNlczogW11cblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0dmFyIGluc3RhbmNlTW9kZWwgPSB7XG5cdFx0XHRcdFx0XHR1dWlkOiAnJyxcblx0XHRcdFx0XHRcdHRpdGxlOiAnJyxcblx0XHRcdFx0XHRcdGtleTogJycsXG5cdFx0XHRcdFx0XHRzZXE6IDFcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKGluZGljYXRvcklkID09PSBpbmRpY2F0b3IuY2F0ZWdvcnkudGVybSkge1xuXHRcdFx0XHRcdFx0aW5kaWNhdG9yTW9kZWwuaWQgPSBpbmRpY2F0b3JJZDtcblx0XHRcdFx0XHRcdGluc3RhbmNlTW9kZWwudXVpZCA9IGluZGljYXRvci5faWQ7XG5cdFx0XHRcdFx0XHRpbnN0YW5jZU1vZGVsLnRpdGxlID0gaW5kaWNhdG9yLnRpdGxlO1xuXHRcdFx0XHRcdFx0aW5zdGFuY2VNb2RlbC5rZXkgPSAnJztcblx0XHRcdFx0XHRcdGluc3RhbmNlTW9kZWwuc2VxID0gMTtcblx0XHRcdFx0XHRcdGluZGljYXRvck1vZGVsLmluc3RhbmNlcy5wdXNoKGluc3RhbmNlTW9kZWwpO1xuXHRcdFx0XHRcdFx0bW9kZWwucHVzaChpbmRpY2F0b3JNb2RlbCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHR2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnUHJvY2VzcyBpbmRpY2F0b3IgbW9kZWwgdXBkYXRlZC4nLCBtb2RlbCk7XG5cdFx0XHRyZXNvbHZlKHN1Y2Nlc3MpO1xuXHRcdH0gY2F0Y2goZXJyKSB7XG5cdFx0XHRyZWplY3QoZXJyKTtcblx0XHR9XG5cdH0pXG59O1xuXG4vKipcbiAqIFByb2Nlc3MgaW5kaWNhdG9yIGRvY3VtZW50IHVwZGF0ZXNcbiAqXG4gKiBAcGFyYW0ge29iamVjdH0gYWN0aW9ucyAtIHRoZSBhY3Rpb25zIGNvbmZpZyBkYXRhXG4gKiBAcGFyYW0ge29iamVjdH0gc3ViUHJvY2VzcyAtIHRoZSBjdXJyZW50IHN1Yi1wcm9jZXNzIGZvcm0gY29uZmlnIGRhdGFcbiAqIEBwYXJhbSB7b2JqZWN0fSBfV0ZJbnN0YW5jZSAtIHRoZSBjdXJyZW50IHdvcmtmbG93IGNvbnN0cnVjdG9yIGluc3RhbmNlXG4gKlxuICogQGV4YW1wbGUgJydcbiAqXG4gKiBAcmV0dXJuICcnXG4gKlxuICovXG5mdW5jdGlvbiBpbmRpY2F0b3JEb2NzKHByb2Nlc3NJZCwgaW5kaWNhdG9ycywgc3RlcCwgX1dGSW5zdGFuY2Upe1xuXHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG5cdFx0dHJ5IHtcblx0XHRcdC8vIFVwZGF0ZSB0aGUgaW5kaWNhdG9yIHNlY3Rpb25zIG9mIHRoZSBzdWJQcm9jZXNzXG5cdFx0XHRpZiAoaW5kaWNhdG9ycyA9PT0gdW5kZWZpbmVkKXtcblx0XHRcdFx0dmFyIGVycm9yID0gdXRpbC5lcnJvcignV0ZJbmRpY2F0b3JzVXBkYXRlJywgJ0luZGljYXRvcnMgcGFyYW1ldGVyIGlzIHJlcXVpcmVkLiAtIFZhbHVlOiAnICsgaW5kaWNhdG9ycylcblx0XHRcdFx0cmVqZWN0KGVycik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IGluZGljYXRvcnMubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0XHR2YXIgaW5kaWNhdG9yID0gaW5kaWNhdG9yc1tpXTtcblx0XHRcdFx0XHRmb3IgKHZhciBqID0gMDsgaiA8IGluZGljYXRvci5pbnN0YW5jZXMubGVuZ3RoOyBqKyspIHtcblx0XHRcdFx0XHRcdHZhciBpbnN0YW5jZSA9IGluZGljYXRvci5pbnN0YW5jZXNbal07XG5cdFx0XHRcdFx0XHRmb3IgKHZhciBrID0gMDsgayA8IF9XRkluc3RhbmNlLmluZGljYXRvcnMubGVuZ3RoOyBrKyspIHtcblx0XHRcdFx0XHRcdFx0dmFyIGRvYyA9IF9XRkluc3RhbmNlLmluZGljYXRvcnNba107XG5cdFx0XHRcdFx0XHRcdGlmIChpbnN0YW5jZS51dWlkID09PSBkb2MuX2lkKSB7XG5cdFx0XHRcdFx0XHRcdFx0ZG9jLndvcmtmbG93cy5maWx0ZXIoZnVuY3Rpb24od29ya2Zsb3cpe1xuXHRcdFx0XHRcdFx0XHRcdFx0aWYgKHdvcmtmbG93LmlkID09PSBfV0ZJbnN0YW5jZS5jb25maWcuX2lkKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdHdvcmtmbG93LnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24ocHJvY2Vzc0l0ZW0pe1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGlmIChwcm9jZXNzSXRlbS5pZCA9PT0gcHJvY2Vzc0lkKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRwcm9jZXNzSXRlbS5zdGVwLmlkID0gc3RlcC5pZDtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdHByb2Nlc3NJdGVtLnN0ZXAuc2VxID0gc3RlcC5zZXE7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRwcm9jZXNzSXRlbS5zdGVwLnN0YXR1cyA9IHN0ZXAuc3RhdHVzO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0cHJvY2Vzc0l0ZW0uc3RlcC5tZXNzYWdlID0gc3RlcC5tZXNzYWdlO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0cHJvY2Vzc0l0ZW0uc3RlcC5hc3NpZ25lZFRvLnVzZXJJZCA9IHN0ZXAuYXNzaWduZWRUby51c2VySWQ7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRwcm9jZXNzSXRlbS5zdGVwLmFzc2lnbmVkVG8ubmFtZSA9IHN0ZXAuYXNzaWduZWRUby5uYW1lO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0cHJvY2Vzc0l0ZW0uc3RlcC5jb21tZW50ID0gc3RlcC5jb21tZW50ICE9PSB1bmRlZmluZWQgPyBzdGVwLmNvbW1lbnQgOiAnJztcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0XHRcdH0pXG5cdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0fSlcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0XHR2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnSW5kaWNhdG9yIGRvY3VtZW50cyB3b3JrZmxvdyBwcm9jZXNzIG1vZGVsIHVwZGF0ZWQuJywgX1dGSW5zdGFuY2UpO1xuXHRcdFx0XHRyZXNvbHZlKHN1Y2Nlc3MpO1xuXHRcdFx0fVxuXHRcdH0gY2F0Y2goZXJyKSB7XG5cdFx0XHRyZWplY3QoZXJyKTtcblx0XHR9XG5cdH0pXG59O1xuXG4vKipcbiAqIFByb2Nlc3MgYWN0aW9uc1xuICpcbiAqIEBwYXJhbSB7b2JqZWN0fSBhY3Rpb25zIC0gdGhlIGFjdGlvbnMgY29uZmlnIGRhdGFcbiAqIEBwYXJhbSB7b2JqZWN0fSBzdWJQcm9jZXNzIC0gdGhlIGN1cnJlbnQgc3ViLXByb2Nlc3MgZm9ybSBjb25maWcgZGF0YVxuICogQHBhcmFtIHtvYmplY3R9IF9XRkluc3RhbmNlIC0gdGhlIGN1cnJlbnQgd29ya2Zsb3cgY29uc3RydWN0b3IgaW5zdGFuY2VcbiAqXG4gKiBAZXhhbXBsZSAnJ1xuICpcbiAqIEByZXR1cm4gJydcbiAqXG4gKi9cbmZ1bmN0aW9uIGFjdGlvbnMoYWN0aW9ucywgcHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIHN1YlByb2Nlc3MsIHN0ZXAsIF9XRkluc3RhbmNlKXtcblx0dmFyIGFyckFjdGlvbnMgPSBbXTtcblx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuXHRcdHV0aWwuc3luY0xvb3AoYWN0aW9ucy5sZW5ndGgsIGZ1bmN0aW9uKGxvb3Ape1xuXHRcdFx0dmFyIGNvdW50ZXIgPSBsb29wLml0ZXJhdGlvbigpO1xuXHRcdFx0YWN0aW9uKGFjdGlvbnNbY291bnRlcl0sIHByb2Nlc3NJZCwgcHJvY2Vzc1NlcSwgc3ViUHJvY2Vzc0lkLCBzdWJQcm9jZXNzU2VxLCBzdWJQcm9jZXNzLCBzdGVwLCBfV0ZJbnN0YW5jZSkudGhlbihmdW5jdGlvbihyZXN1bHQpe1xuXHRcdFx0XHR2YXIgcmV0QWN0aW9uID0geyBpZDogYWN0aW9uc1tjb3VudGVyXS5faWQsIHNlcTogY291bnRlciwgZGF0YTogcmVzdWx0IH07XG5cdFx0XHRcdGFyckFjdGlvbnMucHVzaChyZXRBY3Rpb24pO1xuXHRcdFx0XHRsb29wLm5leHQoKTtcblx0XHRcdH0sIGZ1bmN0aW9uKGVycil7XG5cdFx0XHRcdGxvb3AuYnJlYWsoKTtcblx0XHRcdFx0cmVqZWN0KGVycik7XG5cdFx0XHR9KTtcblx0XHR9LCBmdW5jdGlvbigpe1xuXHRcdFx0Ly8gT24gY29tcGxldGlvbiBvZiB0aGUgbG9vcFxuXHRcdFx0dmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ0FjdGlvbnMgY29tcGxldGVkIHN1Y2Nlc3NmdWxseS4nLCBhcnJBY3Rpb25zKTtcblx0XHRcdHJlc29sdmUoc3VjY2Vzcyk7XG5cdFx0fSk7XG5cdH0pO1xufTtcblxuLyoqXG4gKiBQcm9jZXNzIGFjdGlvblxuICpcbiAqIEBwYXJhbSB7b2JqZWN0fSBhY3Rpb24gLSB0aGUgYWN0aW9uIGNvbmZpZyBkYXRhXG4gKiBAcGFyYW0ge29iamVjdH0gc3ViUHJvY2VzcyAtIHRoZSBjdXJyZW50IHN1Yi1wcm9jZXNzIGZvcm0gY29uZmlnIGRhdGFcbiAqIEBwYXJhbSB7b2JqZWN0fSBfV0ZJbnN0YW5jZSAtIHRoZSBjdXJyZW50IHdvcmtmbG93IGNvbnN0cnVjdG9yIGluc3RhbmNlXG4gKlxuICogQGV4YW1wbGUgJydcbiAqXG4gKiBAcmV0dXJuICcnXG4gKlxuICovXG5mdW5jdGlvbiBhY3Rpb24oYWN0aW9uLCBwcm9jZXNzSWQsIHByb2Nlc3NTZXEsIHN1YlByb2Nlc3NJZCwgc3ViUHJvY2Vzc1NlcSwgc3ViUHJvY2Vzcywgc3RlcCwgX1dGSW5zdGFuY2Upe1xuXHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG5cdFx0dmFyIGFyZ3MgPSBbXTtcblx0XHR2YXIgY29udGV4dCA9ICdnbG9iYWwnO1xuXHRcdHZhciBtZXRob2QgPSAnJztcblx0XHRpZiAoYWN0aW9uLl9pZCAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRjb250ZXh0ID0gYWN0aW9uLl9pZC5zcGxpdChcIi5cIilbMF07XG5cdFx0fVxuXHRcdGlmIChhY3Rpb24uX2lkICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdG1ldGhvZCA9IGFjdGlvbi5faWQuc3BsaXQoXCIuXCIpWzFdO1xuXHRcdH1cblx0XHRhcmdzLmxlbmd0aCA9IDA7XG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBhY3Rpb24uX2FyZ3MubGVuZ3RoOyBpKyspIHtcblx0XHRcdHZhciBhcmcgPSBhY3Rpb24uX2FyZ3NbaV07XG5cdFx0XHRzd2l0Y2goYXJnKSB7XG5cdFx0XHRcdGNhc2UgJ3Byb2Nlc3NJZCc6XG5cdFx0XHRcdFx0YXJncy5wdXNoKHByb2Nlc3NJZCk7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdGNhc2UgJ3Byb2Nlc3NTZXEnOlxuXHRcdFx0XHRcdGFyZ3MucHVzaChwcm9jZXNzU2VxKTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0Y2FzZSAnc3ViUHJvY2Vzc0lkJzpcblx0XHRcdFx0XHRhcmdzLnB1c2goc3ViUHJvY2Vzc0lkKTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0Y2FzZSAnc3ViUHJvY2Vzc1NlcSc6XG5cdFx0XHRcdFx0YXJncy5wdXNoKHN1YlByb2Nlc3NTZXEpO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRjYXNlICdzdWJQcm9jZXNzJzpcblx0XHRcdFx0XHRhcmdzLnB1c2goc3ViUHJvY2Vzcyk7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdGNhc2UgJ3N0ZXAnOlxuXHRcdFx0XHRcdGFyZ3MucHVzaChzdGVwKTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0Ly8gQWRkIHRoZSByZXF1aXJlZCBwYXJhbWV0ZXJzIHRvIHRoZSBhcmdzIGFycmF5XG5cblx0XHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0XHRhcmdzID0gW107XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGFyZ3MucHVzaChfV0ZJbnN0YW5jZSk7XG5cdFx0aWYgKGFjdGlvbi5faWQgPT09ICdmb3JtLmNyZWF0ZScpIHtcblx0XHRcdGZvcm0uY3JlYXRlKGFyZ3MpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KXtcblx0XHRcdFx0cmVzb2x2ZShyZXN1bHQuZGF0YSk7XG5cdFx0XHR9LCBmdW5jdGlvbihlcnIpe1xuXHRcdFx0XHRyZWplY3QoZXJyKTtcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSBpZiAoYWN0aW9uLl9pZCA9PT0gJ2Zvcm0uYXV0aG9yaXNlJykge1xuXHRcdFx0Zm9ybS5hdXRob3Jpc2UoYXJncykudGhlbihmdW5jdGlvbihyZXN1bHQpe1xuXHRcdFx0XHRyZXNvbHZlKHJlc3VsdC5kYXRhKTtcblx0XHRcdH0sIGZ1bmN0aW9uKGVycil7XG5cdFx0XHRcdHJlamVjdChlcnIpO1xuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIGlmIChhY3Rpb24uX2lkID09PSAnZm9ybS5jbG9zZScpIHtcblx0XHRcdGZvcm0uY2xvc2UoYXJncykudGhlbihmdW5jdGlvbihyZXN1bHQpe1xuXHRcdFx0XHRyZXNvbHZlKHJlc3VsdC5kYXRhKTtcblx0XHRcdH0sIGZ1bmN0aW9uKGVycil7XG5cdFx0XHRcdHJlamVjdChlcnIpO1xuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHZhciBlcnJvciA9IHV0aWwuZXJyb3IoJ1dGQWN0aW9uRXJyb3InLCAnTWV0aG9kOiAnICsgYWN0aW9uX2lkICsgJyBub3QgZGVmaW5lZC4nKTtcblx0XHRcdHJlamVjdChlcnJvcik7XG5cdFx0fVxuXHRcdC8vIGlmIChjb250ZXh0ID09PSAnZm9ybScpIHtcblx0XHQvLyBcdGZvcm1bbWV0aG9kXShhcmdzKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCl7XG5cdFx0Ly8gXHRcdHJlc29sdmUocmVzdWx0LmRhdGEpO1xuXHRcdC8vIFx0fSwgZnVuY3Rpb24oZXJyKXtcblx0XHQvLyBcdFx0cmVqZWN0KGVycik7XG5cdFx0Ly8gXHR9KTtcblx0XHQvLyB9IGVsc2Uge1xuXHRcdC8vIFx0dmFyIGVycm9yID0gdXRpbC5lcnJvcignV0ZBY3Rpb25FcnJvcicsICdNb2R1bGU6ICcgKyBjb250ZXh0ICsgJyBub3QgZGVmaW5lZC4nKTtcblx0XHQvLyBcdHJlamVjdChlcnJvcik7XG5cdFx0Ly8gfVxuXHR9KTtcbn07XG5cbi8qKlxuICogUHJvY2VzcyB0YXNrXG4gKlxuICogQHBhcmFtIHtvYmplY3R9IHRhc2sgLSB0aGUgdGFzayBjb25maWcgZGF0YVxuICogQHBhcmFtIHtvYmplY3R9IGlucHV0RGF0YSAtIHRoZSB1c2VyIGlucHV0IGRhdGFcbiAqXG4gKiBAZXhhbXBsZSAnJ1xuICpcbiAqIEByZXR1cm4gJydcbiAqXG4gKi9cbmZ1bmN0aW9uIHRhc2sodGFzayl7XG5cdHJldHVybiAnSW1wbGVtZW50YXRpb24gcGVuZGluZy4uJztcbn07XG5cbi8qKlxuICogUHJvY2VzcyB0cmFuc2l0aW9uXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHByb2Nlc3NJZCAtIHRoZSBXb3JrZmxvdyBjb25maWcgLyBkZWZpbml0aW9uIHByb2Nlc3MgaWRcbiAqIEBwYXJhbSB7bnVtYmVyfSBwcm9jZXNzU2VxIC0gdGhlIFdvcmtmbG93IGluc3RhbmNlIHByb2Nlc3Mgc2VxXG4gKiBAcGFyYW0ge3N0cmluZ30gc3ViUHJvY2Vzc0lkIC0gdGhlIFdvcmtmbG93IGNvbmZpZyAvIGRlZmluaXRpb24gc3ViLXByb2Nlc3MgaWRcbiAqIEBwYXJhbSB7bnVtYmVyfSBzdWJQcm9jZXNzU2VxIC0gdGhlIFdvcmtmbG93IGluc3RhbmNlIHN1Yi1wcm9jZXNzIHNlcVxuICogQHBhcmFtIHtzdHJpbmd9IHN0ZXBJZCAtIHRoZSBXb3JrZmxvdyBjb25maWcgLyBkZWZpbml0aW9uIHN0ZXAgaWRcbiAqIEBwYXJhbSB7c3RyaW5nfSB0cmFuc2l0aW9uSWQgLSB0aGUgV29ya2Zsb3cgY29uZmlnIC8gZGVmaW5pdGlvbiB0cmFuc2l0aW9uIGlkXG4gKiBAcGFyYW0ge29iamVjdH0gZGF0YSAtIGFueSBhZGRpdGlvbmFsIGRhdGEgcGFzc2VkIGluIGFzIGtleSB2YWx1ZSBwYWlyc1xuICogQHBhcmFtIHtvYmplY3R9IF9XRkluc3RhbmNlIC0gdGhlIGN1cnJlbnQgd29ya2Zsb3cgY29uc3RydWN0b3IgaW5zdGFuY2VcbiAqXG4gKiBAZXhhbXBsZSAnJ1xuICpcbiAqIEByZXR1cm4gJydcbiAqXG4gKi9cbmZ1bmN0aW9uIHRyYW5zaXRpb24ocHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIHN0ZXBJZCwgdHJhbnNpdGlvbklkLCBkYXRhLCBfV0ZJbnN0YW5jZSl7XG5cdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcblx0XHR0cnkge1xuXHRcdFx0dmFyIHN0ZXBTZXEgPSAwO1xuXHRcdFx0dmFyIG5leHRTdGVwSWQgPSAnJztcblx0XHRcdHZhciBuZXh0U3RlcFNlcSA9IDA7XG5cdFx0XHR2YXIgc3ViUHJvY2VzcyA9IFtdO1xuXHRcdFx0dmFyIGN1cnJlbnRQcm9jZXNzID0gX1dGSW5zdGFuY2UuY29uZmlnLnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24ob2JqUHJvY2Vzcyl7XG5cdFx0XHRcdGlmIChvYmpQcm9jZXNzLl9pZCA9PT0gcHJvY2Vzc0lkKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG9ialByb2Nlc3M7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdFx0dmFyIGN1cnJlbnRTdWJQcm9jZXNzID0gY3VycmVudFByb2Nlc3NbMF0uc3ViUHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihvYmpTdWJQcm9jZXNzKXtcblx0XHRcdFx0aWYgKG9ialN1YlByb2Nlc3MuX2lkID09PSBzdWJQcm9jZXNzSWQpIHtcblx0XHRcdFx0XHRyZXR1cm4gb2JqU3ViUHJvY2Vzcztcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0XHR2YXIgY3VycmVudFN0ZXAgPSBjdXJyZW50U3ViUHJvY2Vzc1swXS5zdGVwcy5maWx0ZXIoZnVuY3Rpb24ob2JqU3RlcCl7XG5cdFx0XHRcdGlmIChvYmpTdGVwLl9pZCA9PT0gc3RlcElkKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG9ialN0ZXA7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdFx0dmFyIHRyYW5zaXRpb24gPSBjdXJyZW50U3RlcFswXS50cmFuc2l0aW9ucy5maWx0ZXIoZnVuY3Rpb24ob2JqVHJhbnNpdGlvbil7XG5cdFx0XHRcdGlmIChvYmpUcmFuc2l0aW9uLl9pZCA9PT0gdHJhbnNpdGlvbklkKSB7XG5cdFx0XHRcdFx0cmV0dXJuIG9ialRyYW5zaXRpb247XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBjdXJyZW50U3ViUHJvY2Vzc1swXS5zdGVwcy5sZW5ndGg7IGkrKyl7XG5cdFx0XHRcdGlmIChjdXJyZW50U3ViUHJvY2Vzc1swXS5zdGVwc1tpXS5faWQgPT09IHN0ZXBJZCkge1xuXHRcdFx0XHRcdHN0ZXBTZXEgPSBwYXJzZUludChjdXJyZW50U3ViUHJvY2Vzc1swXS5zdGVwc1tpXS5fc2VxKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0Y3VycmVudFN1YlByb2Nlc3NbMF0uc3RlcHMuZmlsdGVyKGZ1bmN0aW9uKHN0ZXBJdGVtKXtcblx0XHRcdFx0bmV4dFN0ZXBTZXEgPSBzdGVwU2VxICsgMTtcblx0XHRcdFx0aWYgKHBhcnNlSW50KHN0ZXBJdGVtLl9zZXEpID09PSBuZXh0U3RlcFNlcSkge1xuXHRcdFx0XHRcdG5leHRTdGVwSWQgPSBzdGVwSXRlbS5faWQ7XG5cdFx0XHRcdH1cblx0XHRcdH0pXG5cdFx0XHQvLyBjb25zb2xlLmxvZyhfV0ZJbnN0YW5jZS5pbnN0YW5jZSk7XG5cdFx0XHRfV0ZJbnN0YW5jZS5pbnN0YW5jZS5wcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKG9ialByb2Nlc3Mpe1xuXHRcdFx0XHRpZiAob2JqUHJvY2Vzcy5pZCA9PT0gcHJvY2Vzc0lkICYmIG9ialByb2Nlc3Muc2VxID09PSBwcm9jZXNzU2VxKSB7XG5cdFx0XHRcdFx0b2JqUHJvY2Vzcy5zdWJQcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKG9ialN1YlByb2Nlc3Mpe1xuXHRcdFx0XHRcdFx0aWYgKG9ialN1YlByb2Nlc3MuaWQgPT09IHN1YlByb2Nlc3NJZCAmJiBvYmpTdWJQcm9jZXNzLnNlcSA9PT0gc3ViUHJvY2Vzc1NlcSkge1xuXHRcdFx0XHRcdFx0XHR2YXIgdXVpZCA9IG9ialN1YlByb2Nlc3MudXVpZDtcblx0XHRcdFx0XHRcdFx0Ly8gc3ViUHJvY2VzcyA9IG9ialN1YlByb2Nlc3M7XG5cdFx0XHRcdFx0XHRcdF9XRkluc3RhbmNlLnN1YnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24oc3ViUHJvY2Vzc0l0ZW0pe1xuXHRcdFx0XHRcdFx0XHRcdGlmIChzdWJQcm9jZXNzSXRlbS5faWQgPT09IHV1aWQpIHtcblx0XHRcdFx0XHRcdFx0XHRcdHN1YlByb2Nlc3MgPSBzdWJQcm9jZXNzSXRlbTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdH0pXG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0XHR2YXIgbWF4U3RlcHMgPSBjdXJyZW50U3ViUHJvY2Vzc1swXS5zdGVwcy5sZW5ndGg7XG5cdFx0XHRzd2l0Y2godHJhbnNpdGlvblswXS5fdHlwZSkge1xuXHRcdFx0XHRjYXNlICdhdXRvJzpcblx0XHRcdFx0XHRpZiAodHJhbnNpdGlvblswXS5nb1RvLl90eXBlID09PSAnbmV4dFN0ZXAnKSB7XG5cdFx0XHRcdFx0XHRzdGVwKHByb2Nlc3NJZCwgcHJvY2Vzc1NlcSwgc3ViUHJvY2Vzc0lkLCBzdWJQcm9jZXNzU2VxLCBuZXh0U3RlcElkLCBuZXh0U3RlcFNlcSwgZGF0YSwgX1dGSW5zdGFuY2UpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KXtcblx0XHRcdFx0XHRcdFx0aWYgKG5leHRTdGVwU2VxID09PSBtYXhTdGVwcykge1xuXHRcdFx0XHRcdFx0XHRcdHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdBbGwgU3RlcCB0cmFuc2l0aW9ucyBoYXZlIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkuJywgeyBzdWJQcm9jZXNzQ29tcGxldGU6IHRydWUsIHN0ZXA6IHJlc3VsdC5kYXRhIH0pO1xuXHRcdFx0XHRcdFx0XHRcdHJlc29sdmUoc3VjY2Vzcyk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0dmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ1N0ZXAgdHJhbnNpdGlvbiBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5LicsIHJlc3VsdC5kYXRhKTtcblx0XHRcdFx0XHRcdFx0XHRyZXNvbHZlKHN1Y2Nlc3MpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdTdGVwIHRyYW5zaXRpb24gY29tcGxldGVkIHN1Y2Nlc3NmdWxseS4nLCByZXN1bHQuZGF0YSk7XG5cdFx0XHRcdFx0XHRcdHJlc29sdmUoc3VjY2Vzcyk7XG5cdFx0XHRcdFx0XHR9LCBmdW5jdGlvbihlcnIpe1xuXHRcdFx0XHRcdFx0XHRyZWplY3QoZXJyKTtcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0Y2FzZSAndXNlcic6XG5cdFx0XHRcdFx0aWYgKHRyYW5zaXRpb25bMF0uZ29Uby5fdHlwZSA9PT0gJ25leHRTdGVwJykge1xuXHRcdFx0XHRcdFx0c3RlcChwcm9jZXNzSWQsIHByb2Nlc3NTZXEsIHN1YlByb2Nlc3NJZCwgc3ViUHJvY2Vzc1NlcSwgbmV4dFN0ZXBJZCwgbmV4dFN0ZXBTZXEsIGRhdGEsIF9XRkluc3RhbmNlKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCl7XG5cdFx0XHRcdFx0XHRcdGlmIChuZXh0U3RlcFNlcSA9PT0gbWF4U3RlcHMpIHtcblx0XHRcdFx0XHRcdFx0XHR2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnQWxsIFN0ZXAgdHJhbnNpdGlvbnMgaGF2ZSBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5LicsIHsgc3ViUHJvY2Vzc0NvbXBsZXRlOiB0cnVlLCBzdGVwOiByZXN1bHQuZGF0YSB9KTtcblx0XHRcdFx0XHRcdFx0XHRyZXNvbHZlKHN1Y2Nlc3MpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdTdGVwIHRyYW5zaXRpb24gY29tcGxldGVkIHN1Y2Nlc3NmdWxseS4nLCByZXN1bHQuZGF0YSk7XG5cdFx0XHRcdFx0XHRcdFx0cmVzb2x2ZShzdWNjZXNzKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnU3RlcCB0cmFuc2l0aW9uIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkuJywgcmVzdWx0LmRhdGEpO1xuXHRcdFx0XHRcdFx0XHRyZXNvbHZlKHN1Y2Nlc3MpO1xuXHRcdFx0XHRcdFx0fSwgZnVuY3Rpb24oZXJyKXtcblx0XHRcdFx0XHRcdFx0cmVqZWN0KGVycik7XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHRyYW5zaXRpb25bMF0uZ29Uby5fdHlwZSA9PT0gJ3N0ZXBJZCcpIHtcblx0XHRcdFx0XHRcdHZhciBnb1RvU3RlcElkID0gdHJhbnNpdGlvblswXS5nb1RvLl9zdGVwSWQ7XG5cdFx0XHRcdFx0XHR2YXIgZ29Ub1N0ZXBTZXEgPSAxO1xuXHRcdFx0XHRcdFx0Y3VycmVudFN1YlByb2Nlc3NbMF0uc3RlcHMuZmlsdGVyKGZ1bmN0aW9uKHN0ZXBJdGVtKXtcblx0XHRcdFx0XHRcdFx0aWYgKHN0ZXBJdGVtLl9pZCA9PT0gZ29Ub1N0ZXBJZCkge1xuXHRcdFx0XHRcdFx0XHRcdGdvVG9TdGVwU2VxID0gcGFyc2VJbnQoc3RlcEl0ZW0uX3NlcSk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH0pXG5cdFx0XHRcdFx0XHRzdGVwKHByb2Nlc3NJZCwgcHJvY2Vzc1NlcSwgc3ViUHJvY2Vzc0lkLCBzdWJQcm9jZXNzU2VxLCBnb1RvU3RlcElkLCBnb1RvU3RlcFNlcSwgZGF0YSwgX1dGSW5zdGFuY2UpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KXtcblx0XHRcdFx0XHRcdFx0aWYgKGdvVG9TdGVwU2VxID09PSBtYXhTdGVwcykge1xuXHRcdFx0XHRcdFx0XHRcdHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdBbGwgU3RlcCB0cmFuc2l0aW9ucyBoYXZlIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkuJywgeyBzdWJQcm9jZXNzQ29tcGxldGU6IHRydWUsIHN0ZXA6IHJlc3VsdC5kYXRhIH0pO1xuXHRcdFx0XHRcdFx0XHRcdHJlc29sdmUoc3VjY2Vzcyk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0dmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ1N0ZXAgdHJhbnNpdGlvbiBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5LicsIHJlc3VsdC5kYXRhKTtcblx0XHRcdFx0XHRcdFx0XHRyZXNvbHZlKHN1Y2Nlc3MpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdTdGVwIHRyYW5zaXRpb24gY29tcGxldGVkIHN1Y2Nlc3NmdWxseS4nLCByZXN1bHQuZGF0YSk7XG5cdFx0XHRcdFx0XHRcdHJlc29sdmUoc3VjY2Vzcyk7XG5cdFx0XHRcdFx0XHR9LCBmdW5jdGlvbihlcnIpe1xuXHRcdFx0XHRcdFx0XHRyZWplY3QoZXJyKTtcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0XHR2YXIgZXJyb3IgPSB1dGlsLmVycm9yKCdXRlRyYW5zaXRpb25FcnJvcicsJ1RyYW5zaXRpb24gdHlwZTogJyArIHRyYW5zaXRpb25bMF0uX3R5cGUgKyAnIG5vdCBkZWZpbmVkLicpO1xuXHRcdFx0XHRcdHJlamVjdChlcnJvcik7XG5cdFx0XHR9XG5cdFx0fSBjYXRjaChlcnIpe1xuXHRcdFx0cmVqZWN0KGVycik7XG5cdFx0fVxuXHR9KTtcbn07XG5cbi8qKlxuICogUHJvY2VzcyBwb3N0QWN0aW9uc1xuICpcbiAqIEBwYXJhbSB7b2JqZWN0fSBwb3N0QWN0aW9ucyAtIHRoZSBwb3N0QWN0aW9ucyBjb25maWcgZGF0YVxuICpcbiAqIEBleGFtcGxlICcnXG4gKlxuICogQHJldHVybiAnJ1xuICpcbiAqL1xuZnVuY3Rpb24gcG9zdEFjdGlvbnMocG9zdEFjdGlvbnMpe1xuXHRyZXR1cm4gJ0ltcGxlbWVudGF0aW9uIHBlbmRpbmcuLic7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IHtcblxuIFx0cHJlUmVxdWlzaXRlczogcHJlUmVxdWlzaXRlcyxcbiBcdHByZUFjdGlvbnM6IHByZUFjdGlvbnMsXG4gXHRzdWJQcm9jZXNzOiBzdWJQcm9jZXNzLFxuXHRpbmRpY2F0b3JEb2NzOiBpbmRpY2F0b3JEb2NzLFxuIFx0dGFzazogdGFzayxcbiBcdHRyYW5zaXRpb246IHRyYW5zaXRpb25cblxufVxuIiwiJ3VzZSBzdHJpY3QnO1xuXG4vKipcbiAqIFV0aWxpdHkgTW9kdWxlXG4gKlxuICogQG1vZHVsZSBsaWIvdXRpbFxuICpcbiAqIEBhdXRob3IgQnJlbnQgR29yZG9uXG4gKiBAdmVyc2lvbiAwLjEuMFxuICpcbiAqIEBkZXNjcmlwdGlvblxuICogV29ya2Zsb3cgdXRpbGl0eSBtb2R1bGUgdXNlZCB0byBmb3JtYXQgdGhlIHJldHVybiBhbmQgZXJyb3Igb2JqZWN0cywgYW5kXG4gKiBjb250YWlucyBzb21lIG90aGVyIHV0aWxpdHkgZnVuY3Rpb25zIHN1Y2ggYXMgYSBzeW5jIGxvb3AgYW5kIGNvbXBhcmUuXG4gKlxuICovXG5cbi8qKlxuICogU3VjY2VzcyBibG9jayByZXR1cm4gb2JqZWN0LCBjb250YWlucyBhIG1lc3NhZ2UgYW5kIG9wdGlvbmFsIGRhdGEgb2JqZWN0LlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBtZXNzYWdlIC0gdGhlIHN1Y2Nlc3MgbWVzc2FnZVxuICogQHBhcmFtIHtzdHJpbmd8T2JqZWN0fSBbZGF0YV0gLSB0aGUgc3VjY2VzcyByZXR1cm5lZCBkYXRhXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIFJldHVybiBzdWNjZXNzIHdpdGhvdXQgYSBkYXRhIGJsb2NrXG4gKiB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnU3VjY2VzcyBtZXNzYWdlIGdvZXMgaGVyZS4uLicpO1xuICpcbiAqIEByZXR1cm4ge09iamVjdH0gLSB3aXRoIG1lc3NhZ2UgYW5kIGRhdGEgcHJvcGVydGllc1xuICpcbiAqL1xuZnVuY3Rpb24gc3VjY2VzcyhtZXNzYWdlLCBkYXRhKXtcblx0cmV0dXJuIHtcblx0XHRtZXNzYWdlOiBtZXNzYWdlLFxuXHRcdGRhdGE6IGRhdGFcblx0fTtcbn07XG5cbi8qKlxuICogV2FybmluZyBibG9jayByZXR1cm4gb2JqZWN0LCBjb250YWlucyBhIG1lc3NhZ2UgYW5kIG9wdGlvbmFsIGRhdGEgb2JqZWN0LlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBtZXNzYWdlIC0gdGhlIHdhcm5pbmcgbWVzc2FnZVxuICogQHBhcmFtIHtzdHJpbmd8T2JqZWN0fSBbZGF0YV0gLSB0aGUgcmV0dXJuZWQgZGF0YVxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyBSZXR1cm4gc3VjY2VzcyB3aXRob3V0IGEgZGF0YSBibG9ja1xuICogdmFyIHN1Y2Nlc3MgPSB1dGlsLndhcm4oJ1dhcm5pbmcgbWVzc2FnZSBnb2VzIGhlcmUuLi4nKTtcbiAqXG4gKiBAcmV0dXJuIHtPYmplY3R9IHdpdGggbWVzc2FnZSBhbmQgZGF0YSBwcm9wZXJ0aWVzLCBhbmQgbG9ncyB0aGUgd2FybmluZyB0byB0aGUgY29uc29sZS5cbiAqXG4gKi9cbmZ1bmN0aW9uIHdhcm4obWVzc2FnZSwgZGF0YSl7XG5cdGNvbnNvbGUud2FybihkYXRhKTtcblx0cmV0dXJuIHtcblx0XHR3YXJuaW5nOiBtZXNzYWdlLFxuXHRcdGRhdGE6IGRhdGFcblx0fTtcbn07XG5cbi8qKlxuICogRXJyb3IgYmxvY2sgSlMgZXJyb3Igb2JqZWN0LCBjb250YWlucyBhIGNvZGUgYW5kIG1lc3NhZ2UgZm9yIHRoZSBlcnJvci5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gY29kZSAtIHRoZSBlcnJvciBjb2RlXG4gKiBAcGFyYW0ge3N0cmluZ30gbWVzc2FnZSAtIHRoZSBlcnJvciBtZXNzYWdlXG4gKlxuICogQGV4YW1wbGVcbiAqIHZhciBzdWNjZXNzID0gdXRpbC5lcnJvcignRXJyb3IwMDEnLCdFcnJvciBtZXNzYWdlIGdvZXMgaGVyZS4uLicpO1xuICpcbiAqIEByZXR1cm4ge09iamVjdH0gd2l0aCBhIGNvZGUgYW5kIG1lc3NhZ2UgcHJvcGVydGllcy5cbiAqXG4gKi9cbmZ1bmN0aW9uIGVycm9yKGNvZGUsIG1lc3NhZ2Upe1xuXHR2YXIgZXJyID0gbmV3IEVycm9yKCcnKTtcblx0ZXJyLm5hbWUgPSBjb2RlO1xuXHRlcnIubWVzc2FnZSA9IG1lc3NhZ2U7XG5cdHJldHVybiBlcnI7XG59O1xuXG4vKipcbiAqIEEgbG9vcCB3aGljaCBjYW4gbG9vcCBYIGFtb3VudCBvZiB0aW1lcywgd2hpY2ggY2FycmllcyBvdXRcbiAqIGFzeW5jaHJvbm91cyBjb2RlLCBidXQgd2FpdHMgZm9yIHRoYXQgY29kZSB0byBjb21wbGV0ZSBiZWZvcmUgbG9vcGluZy5cbiAqXG4gKiBAcGFyYW0ge251bWJlcn0gaXRlcmF0aW9ucyAtIHRoZSBudW1iZXIgb2YgaXRlcmF0aW9ucyB0byBjYXJyeSBvdXRcbiAqIEBwYXJhbSB7ZnVuY3Rpb259IHByb2Nlc3MgLSB0aGUgY29kZS9mdW5jdGlvbiB3ZSdyZSBydW5uaW5nIGZvciBldmVyeVxuICogaXRlcmF0aW9uXG4gKiBAcGFyYW0ge2Z1bmN0aW9ufSBleGl0IC0gYW4gb3B0aW9uYWwgY2FsbGJhY2sgdG8gY2Fycnkgb3V0IG9uY2UgdGhlIGxvb3BcbiAqIGhhcyBjb21wbGV0ZWRcbiAqXG4gKiBAZXhhbXBsZVxuICogdXRpbC5zeW5jTG9vcCg1LCBmdW5jdGlvbihsb29wKXtcbiAqIFx0dmFyIGNvdW50ZXIgPSBsb29wLml0ZXJhdGlvbigpO1xuICogXHQvLyBBZGQgYXN5bmMgY2FsbHMgaGVyZS4uXG4gKlxuICogfSwgZnVuY3Rpb24oKXtcbiAqIFx0Ly8gT24gY29tcGxldGUgcGVyZm9ybSBhY3Rpb25zIGhlcmUuLi5cbiAqXG4gKiB9KTtcbiAqXG4gKiBAcmV0dXJuIHtPYmplY3R9IHRoZSBsb29wIGNvbnRyb2wgb2JqZWN0LlxuICpcbiAqL1xuZnVuY3Rpb24gc3luY0xvb3AoaXRlcmF0aW9ucywgcHJvY2VzcywgZXhpdCl7XG4gICAgdmFyIGluZGV4ID0gMCxcbiAgICAgICAgZG9uZSA9IGZhbHNlLFxuICAgICAgICBzaG91bGRFeGl0ID0gZmFsc2U7XG4gICAgdmFyIGxvb3AgPSB7XG4gICAgICAgIG5leHQ6ZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIGlmKGRvbmUpe1xuICAgICAgICAgICAgICAgIGlmKHNob3VsZEV4aXQgJiYgZXhpdCl7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBleGl0KCk7IC8vIEV4aXQgaWYgd2UncmUgZG9uZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIElmIHdlJ3JlIG5vdCBmaW5pc2hlZFxuICAgICAgICAgICAgaWYoaW5kZXggPCBpdGVyYXRpb25zKXtcbiAgICAgICAgICAgICAgICBpbmRleCsrOyAvLyBJbmNyZW1lbnQgb3VyIGluZGV4XG4gICAgICAgICAgICAgICAgcHJvY2Vzcyhsb29wKTsgLy8gUnVuIG91ciBwcm9jZXNzLCBwYXNzIGluIHRoZSBsb29wXG4gICAgICAgICAgICAvLyBPdGhlcndpc2Ugd2UncmUgZG9uZVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBkb25lID0gdHJ1ZTsgLy8gTWFrZSBzdXJlIHdlIHNheSB3ZSdyZSBkb25lXG4gICAgICAgICAgICAgICAgaWYoZXhpdCkgZXhpdCgpOyAvLyBDYWxsIHRoZSBjYWxsYmFjayBvbiBleGl0XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGl0ZXJhdGlvbjpmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIGluZGV4IC0gMTsgLy8gUmV0dXJuIHRoZSBsb29wIG51bWJlciB3ZSdyZSBvblxuICAgICAgICB9LFxuICAgICAgICBicmVhazpmdW5jdGlvbihlbmQpe1xuICAgICAgICAgICAgZG9uZSA9IHRydWU7IC8vIEVuZCB0aGUgbG9vcFxuICAgICAgICAgICAgc2hvdWxkRXhpdCA9IGVuZDsgLy8gUGFzc2luZyBlbmQgYXMgdHJ1ZSBtZWFucyB3ZSBzdGlsbCBjYWxsIHRoZSBleGl0IGNhbGxiYWNrXG4gICAgICAgIH1cbiAgICB9O1xuICAgIGxvb3AubmV4dCgpO1xuICAgIHJldHVybiBsb29wO1xufTtcblxuZnVuY3Rpb24gY29tcGFyZShzdWJqZWN0LCBvcGVyYXRvciwgdmFsdWUpIHtcbiAgXHRzd2l0Y2ggKG9wZXJhdG9yKSB7XG4gIFx0XHRjYXNlICdncmVhdGVyVGhhbic6XG5cdFx0XHRyZXR1cm4gc3ViamVjdCA+IHZhbHVlO1xuXHRcdGNhc2UgJ2xlc3NUaGFuJzpcblx0XHRcdHJldHVybiBzdWJqZWN0IDwgdmFsdWU7XG5cdFx0Y2FzZSAnZ3JlYXRlclRoYW5FcXVhbCc6XG5cdFx0XHRyZXR1cm4gc3ViamVjdCA+PSB2YWx1ZTtcblx0XHRjYXNlICdsZXNzVGhhbkVxdWFsJzpcblx0XHRcdHJldHVybiBzdWJqZWN0IDw9IHZhbHVlO1xuXHRcdGNhc2UgJ2VxdWFsVG8nOlxuXHRcdFx0cmV0dXJuIHN1YmplY3QgPT09IHZhbHVlO1xuXHRcdGNhc2UgJ25vdEVxdWFsVG8nOlxuXHRcdFx0cmV0dXJuIHN1YmplY3QgIT09IHZhbHVlO1xuICBcdH1cbn07XG5cbmZ1bmN0aW9uIGdldE5hbWUoYXJyLCBsYW5nKXtcblx0aWYgKGFyciAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBhcnIubGVuZ3RoIDsgaSsrKSB7XG5cdFx0XHRpZiAoYXJyW2ldLmkxOG4uX2xhbmcgPT09IGxhbmcpIHtcblx0XHRcdFx0cmV0dXJuIGFycltpXS5pMThuLnZhbHVlO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcblxuIFx0c3VjY2Vzczogc3VjY2VzcyxcbiBcdHdhcm46IHdhcm4sXG4gXHRlcnJvcjogZXJyb3IsXG4gXHRzeW5jTG9vcDogc3luY0xvb3AsXG4gXHRjb21wYXJlOiBjb21wYXJlLFxuXHRnZXROYW1lOiBnZXROYW1lXG5cbiB9XG4iXX0=
