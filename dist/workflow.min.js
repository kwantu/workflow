(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.Workflow = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";function Workflow(e,s,t,o){var i=this;if(""==s||void 0==s)throw util.error("ParamRequired","A community id is required.");if("string"!=typeof s)throw new Error("The community id must be a javascript string.");if(i.communityId=s||"",""==e||void 0==e)throw util.error("ParamRequired","A profile id is required.");if("string"!=typeof e)throw new Error("The profile id must be a javascript string.");if(i.profile=e||"",""==t||void 0==t)throw util.error("ParamRequired","An app id is required.");if("string"!=typeof t)throw new Error("The app id must be a javascript string.");if(i.app=t||"",""==o||void 0==o)throw util.error("ParamRequired","A workflow configuration is required.");"object"!=typeof o?i.config=JSON.parse(o):i.config=o,i.instance,i.subprocesses=[],i.indicators=[]}var Process=require("./lib/process"),util=require("utility"),userInterface=require("./lib/interface"),helper=require("./lib/helper");Workflow.prototype.getProfile=function(){return this.profile},Workflow.prototype.getApp=function(){return this.app},Workflow.prototype.getConfig=function(){return this.config},Workflow.prototype.getInstance=function(){return this.instance},Workflow.prototype.setInstance=function(e){this.instance=e},Workflow.prototype.getSubProcesses=function(){return this.subprocesses},Workflow.prototype.setSubProcesses=function(e){this.subprocesses=e},Workflow.prototype.getIndicators=function(){return this.indicators},Workflow.prototype.setIndicators=function(e){this.indicators=e},Workflow.prototype.create=function(){var e=this;return new Promise(function(s,t){try{if(void 0!==e.instance){var o=util.warn("Instance already exists.",e);s(o)}else{var i={_id:"",version:"",type:"workflowInstance",processes:[],channels:["community_"+app.SCOPE.getCommunityId(),"profile_"+app.SCOPE.profileId,"application_"+app.SCOPE.applicationId,"community_"+app.SCOPE.getCommunityId()+"_application_"+app.SCOPE.applicationId]};i._id=e.profile+":processes",i.version=e.config.version,e.instance=i;var r=util.success("Workflow processes instance created successfully.",e);s(r)}}catch(e){t(e)}})},Workflow.prototype.initialise=function(e,s,t){var o=this;return new Promise(function(i,r){try{var n=[];if(""!==e&&void 0!==e){if(n=o.config.processes.filter(function(s){if(s._id==e)return s}),void 0==n[0]._id){var c=util.error("WFConfigError","No valid process definition found with process id: "+e);r(c)}}else n.push(o.config.processes[0]),e=o.config.processes[0]._id;var u=[];o.instance.processes.filter(function(s){s.id==e&&u.push(s)});var a=u.length+1,p={id:"",seq:"",subProcesses:[]};p.id=e,p.seq=a,o.instance.processes.push(p);var f=n[0].subProcesses[0]._id,l=1;o.instance.processes.filter(function(s){s.id==e&&s.seq==a&&(l=s.subProcesses.length+1)}),Process.subProcess(e,a,f,l,s,o).then(function(n){var c=n.data._id,u=s.label,d={id:f,subprofileId:t,seq:l,uuid:c,label:u};p.subProcesses.push(d);for(var h=0;h<o.instance.processes.length;h++){var v=o.instance.processes[h];v.id==e&&v.seq==a&&o.instance.processes.splice(h,1,p)}var P=n.data.indicators,w=n.data.step;Process.indicatorDocs(e,P,w,o).then(function(e){var s=util.success("Process: "+o.config.processes[0]._id+" initialized successfully.",d);i(s)},function(e){r(e)})},function(s){o.instance.processes=o.instance.processes.filter(function(s){return!(s.id==e&&s.seq==a)}),console.log(s),r(s)})}catch(e){r(e)}})},Workflow.prototype.transition=function(e,s,t,o,i,r,n,c){var u=this;return new Promise(function(a,p){try{var f=JSON.xpath("/subprocesses[_id eq '"+c+"']/step/data",app.SCOPE.workflow,{})[0],l=JSON.xpath("/processes[_id eq '"+e+"']/subProcesses[_id eq '"+t+"']/steps[_id eq '"+i+"']",u.config,{})[0],d=function(i,r){u.instance.processes.filter(function(n){n.id==e&&n.seq==s&&n.subProcesses.filter(function(e){e.id==t&&e.seq==o&&u.subprocesses.filter(function(s){if(s._id==e.uuid)if("step"==i){s.step=r.data.step;var t=util.success(r.message,s);a(t)}else if("stepComplete"==i){s.step=r.data.step,s.complete=!0;var t=util.success(r.message,s.step);a(t)}})})})};if(void 0!=l.function.task.postActions){var h=l.function.task.postActions;Process.postActions(h,u).then(function(a){Process.transition(e,s,t,o,i,r,n,u,c,f).then(function(e){e.data.subProcessComplete?d("stepComplete",e):d("step",e)},function(e){p(e)})},function(e){p(e)})}else Process.transition(e,s,t,o,i,r,n,u,c,f).then(function(e){e.data.subProcessComplete?d("stepComplete",e):d("step",e)},function(e){p(e)})}catch(e){p(e)}})},Workflow.prototype.assignUser=function(e,s,t,o,i){var r=this;return new Promise(function(n,c){try{Process.assignUser(e,s,t,o,i,r).then(function(e){n(e)},function(e){c(e)})}catch(e){c(e)}})},Workflow.prototype.ui=function(){var e=this;return{getProcess:function(s,t){return new Promise(function(o,i){try{userInterface.getProcess(s,t,e).then(function(e){o(e)},function(e){i(e)})}catch(e){i(e)}})}}},Workflow.prototype.getNodeValue=function(e,s){var t=this;return new Promise(function(o,i){try{helper.getNodeValue(e,t,s).then(function(e){o(e)},function(e){i(e)})}catch(e){i(e)}})},Workflow.prototype.takeAssignment=function(e){var s=this;return new Promise(function(t,o){try{var i=JSON.xpath("/subprocesses[_id eq '"+e+"']",s,{})[0],r=JSON.xpath("/step/assignedTo",i,{})[0];r.name=LOCAL_SETTINGS.SUBSCRIPTIONS.username+"",r.userId=LOCAL_SETTINGS.SUBSCRIPTIONS.userId+"";var n=JSON.xpath("/instance/processes[subProcesses/uuid eq '"+e+"']/id",s,{})[0],c=JSON.xpath("/instance/processes/subProcesses[uuid eq '"+e+"']/id",s,{})[0],u=JSON.xpath("/subprocesses[_id eq '"+e+"']/step/id",s,{})[0],a=JSON.xpath("/processes[_id eq '"+n+"']/subProcesses[_id eq '"+c+"']/steps[_id eq '"+u+"']",s.config,{})[0];if(void 0!=a.function.task.preWorkActions){var p=a.function.task.preWorkActions;Process.preWorkActions(p,s).then(function(e){t(s)},function(e){o(e)})}else t(s)}catch(e){o(e)}})},module.exports=Workflow;

},{"./lib/helper":4,"./lib/interface":5,"./lib/process":7,"utility":8}],2:[function(require,module,exports){
"use strict";var util=require("utility"),nodeValue=require("./nodeValue"),form=require("./form"),helper=require("./helper"),gatekeeper=new GK,community=function(){return{createCommunity:function(e,i,n){return new Promise(function(e,i){var r=worker.getWorkerWrapper();r._id=generateUUID(),r.communityId=app.SCOPE.getCommunityId(),r.applicationId=app.SCOPE.applicationId,r.createdDateTime=(new Date).toString(),r.senderUserId=LOCAL_SETTINGS.SUBSCRIPTIONS.userId;var t=JSON.xpath("/indicators[category/term eq 'Community']/_id",n,{})[0],o={createCommunity:{newCommunityId:n.profile,indicatorUUID:{Community:t}}};r.action=o,worker.send(r).then(function(i){var n=util.success("Worker processed successfully.",i);e(n)},function(e){i(e)})})},userJoinCommunity:function(e,i,n){return new Promise(function(e,i){})},releaseAdoptedApplication:function(e,i,n){return new Promise(function(e,r){var t=worker.getWorkerWrapper();t._id=generateUUID(),t.communityId=app.SCOPE.getCommunityId(),t.applicationId=app.SCOPE.applicationId,t.createdDateTime=(new Date).toString(),t.senderUserId=LOCAL_SETTINGS.SUBSCRIPTIONS.userId;var o=JSON.xpath("/subprocesses[_id eq '"+i+"']/indicators[id eq 'adoptedApplication']/instances[1]/uuid",n,{})[0],a={releaseAdoptedApplication:{communityId:n.profile,indicatorUUID:{adoptedApplication:o}}};t.action=a,worker.send(t).then(function(i){var n=util.success("Worker processes successfully.",i);e(n)},function(e){r(e)})})}}}(),application=function(){return{createAppDefinition:function(e,i,n){return new Promise(function(e,i){var r=worker.getWorkerWrapper();r._id=generateUUID(),r.communityId=app.SCOPE.getCommunityId(),r.applicationId=app.SCOPE.applicationId,r.createdDateTime=(new Date).toString(),r.senderUserId=LOCAL_SETTINGS.SUBSCRIPTIONS.userId;var t=JSON.xpath("/indicators[category/term eq 'Application']/_id",n,{})[0],o={createApplication:{newApplicationId:n.profile,indicatorUUID:{Application:t}}};r.action=o,worker.send(r).then(function(i){var n=util.success("Worker processes successfully.",i);e(n)},function(e){i(e)})})},buildApplication:function(e,i,n){return new Promise(function(e,r){var t=worker.getWorkerWrapper();t._id=generateUUID(),t.communityId=app.SCOPE.getCommunityId(),t.applicationId=app.SCOPE.applicationId,t.createdDateTime=(new Date).toString(),t.senderUserId=LOCAL_SETTINGS.SUBSCRIPTIONS.userId;var o=JSON.xpath("/subprocesses[_id eq '"+i+"']/indicators[id eq 'PublishApplication']/instances[1]/uuid",n,{})[0],a=JSON.xpath("/indicators[category/term eq 'ApplicationDefinition']/_id",n,{})[0],s=JSON.xpath("/indicators[category/term eq 'Roles']/_id",n,{})[0],c=JSON.xpath("/indicators[category/term eq 'Application']/_id",n,{})[0],u=JSON.xpath("/indicators[category/term eq 'AppPermissions']/_id",n,{})[0],d={buildApplication:{applicationId:n.profile,indicatorUUID:{PublishApplication:o,ApplicationDefinition:a,Roles:s,Application:c,AppPermissions:u}}};t.action=d,worker.send(t).then(function(i){var n=util.success("Worker processes successfully.",i);e(n)},function(e){r(e)})})},applicationAdoption:function(e,i,n){return new Promise(function(e,r){var t=worker.getWorkerWrapper();t._id=generateUUID(),t.communityId=app.SCOPE.getCommunityId(),t.applicationId=app.SCOPE.applicationId,t.createdDateTime=(new Date).toString(),t.senderUserId=LOCAL_SETTINGS.SUBSCRIPTIONS.userId;var o=JSON.xpath("/subprocesses[_id eq '"+i+"']/indicators[id eq 'Adoption']/instances[1]/uuid",n,{})[0],a=JSON.xpath("/indicators[category/term eq 'PublishApplication']/_id",n,{})[0],s=JSON.xpath("/indicators[category/term eq 'Application']/_id",n,{})[0],c={adoptApplication:{applicationId:n.profile,indicatorUUID:{Adoption:o,PublishApplication:a,Application:s}}};t.action=c,worker.send(t).then(function(i){var n=util.success("Worker processes successfully.",i);e(n)},function(e){r(e)})})},createTaxonomy:function(e,i,n){return new Promise(function(e,r){var t=worker.getWorkerWrapper();t._id=generateUUID(),t.communityId=app.SCOPE.getCommunityId(),t.applicationId=app.SCOPE.applicationId,t.createdDateTime=(new Date).toString(),t.senderUserId=LOCAL_SETTINGS.SUBSCRIPTIONS.userId;var o=JSON.xpath("/subprocesses[_id eq '"+i+"']/indicators[id eq 'Taxonomy']/instances[1]/uuid",n,{})[0],a={createTaxonomy:{taxonomyUUID:o}};t.action=a,worker.send(t).then(function(i){var n=util.success("Worker processes successfully.",i);e(n)},function(e){r(e)})})}}}(),worker=function(){return{getWorkerWrapper:function(){var e={source:"remote",type:"workerObject",_id:"",channels:[],communityId:"",applicationId:"",message:"",messageType:"info",createdDateTime:"",senderUserId:"",action:{}};return e},send:function(e){return new Promise(function(i,n){console.log("Submitting Worker Object to server"),console.log(e),dao.save(e).done(function(e){i(e)}).fail(function(e){console.log("Error submitting worker response !!"+e),n(e)})})}}}(),performance=function(){return{create:function(e,i,n){return new Promise(function(e,i){var r=worker.getWorkerWrapper();r._id=generateUUID(),r.communityId=app.SCOPE.getCommunityId(),r.applicationId=app.SCOPE.applicationId,r.createdDateTime=(new Date).toString(),r.senderUserId=LOCAL_SETTINGS.SUBSCRIPTIONS.userId;var t=JSON.xpath("/indicators[category/term eq 'plan']/_id",n,{})[0],o={createPlan:{planUUID:t}};r.action=o,worker.send(r).then(function(i){var n=util.success("Worker processed successfully.",i);e(n)},function(e){i(e)})})},configureNode:function(e,i,n){return new Promise(function(e,r){var t=worker.getWorkerWrapper();t._id=generateUUID(),t.communityId=app.SCOPE.getCommunityId(),t.applicationId=app.SCOPE.applicationId,t.createdDateTime=(new Date).toString(),t.senderUserId=LOCAL_SETTINGS.SUBSCRIPTIONS.userId;var o=JSON.xpath("/subprocesses[_id eq '"+i+"']/indicators[id eq 'node']/instances[1]/uuid",n,{})[0],a={configureNode:{nodeUUID:o}};t.action=a,worker.send(t).then(function(i){var n=util.success("Worker processed successfully.",i);e(n)},function(e){r(e)})})},unlockPeriod:function(e,i,n){return new Promise(function(e,r){var t=JSON.xpath("/subprocesses[_id eq '"+i+"']",n,{})[0],o=JSON.xpath("/indicators[id eq '"+PERIOD_SET_ID+"']/instances/uuid",t,{})[0],a=t.dates.valid;library.unlockPeriod(o,a).then(function(i){var t=i.id;dao.get(t).done(function(i){for(var r=0;r<n.indicators.length;r++){var t=n.indicators[r];if(t._id==i._id){n.indicators.splice(r,1),n.indicators.push(i);var o=util.success("Unlock period.",i);e(o)}}}).fail(function(e){console.error(e),r(e)})},function(e){r(e)})})},lockPerformanceModel:function(e,i,n){return new Promise(function(e,r){var t=JSON.xpath("/subprocesses[_id eq '"+i+"']",n,{})[0],o=JSON.xpath("/indicators[id eq '"+PERFORMANCE_SET_ID+"']/instances/uuid",t,{})[0],a=t.dates.valid;library.lockPerformanceModel(o,a).then(function(i){var t=i.id;dao.get(t).done(function(i){for(var r=0;r<n.indicators.length;r++){var t=n.indicators[r];if(t._id==i._id){n.indicators.splice(r,1),n.indicators.push(i);var o=util.success("Lock performance model.",i);e(o)}}}).fail(function(e){console.error(e),r(e)})},function(e){r(e)})})}}}(),sdo=function(){return{create:function(e,i,n){return new Promise(function(e,r){var t=worker.getWorkerWrapper();t._id=generateUUID(),t.communityId=app.SCOPE.getCommunityId(),t.applicationId=app.SCOPE.applicationId,t.createdDateTime=(new Date).toString(),t.senderUserId=LOCAL_SETTINGS.SUBSCRIPTIONS.userId;var o=JSON.xpath("/subprocesses[_id eq '"+i+"']/indicators[id eq 'SDO']/instances[1]/uuid",n,{})[0],a={createSDO:{sdoUUID:o}};t.action=a,worker.send(t).then(function(i){var n=util.success("Worker processes successfully.",i);e(n)},function(e){r(e)})})}}}(),taxonomy=function(){return{create:function(e,i,n){return new Promise(function(e,r){var t=worker.getWorkerWrapper();t._id=generateUUID(),t.communityId=app.SCOPE.getCommunityId(),t.applicationId=app.SCOPE.applicationId,t.createdDateTime=(new Date).toString(),t.senderUserId=LOCAL_SETTINGS.SUBSCRIPTIONS.userId;var o=JSON.xpath("/subprocesses[_id eq '"+i+"']/indicators[id eq 'Taxonomy']/instances[1]/uuid",n,{})[0],a={createTaxonomy:{taxonomyUUID:o}};t.action=a,worker.send(t).then(function(i){var n=util.success("Worker processes successfully.",i);e(n)},function(e){r(e)})})}}}(),subProcessInstance=function(){return{setTitle:function(e,i,n,r){return new Promise(function(e,t){var o=JSON.xpath("/instance/processes/subProcesses[uuid eq '"+i+"']",app.SCOPE.workflow,{})[0];o.label=n;var a=[],s={};s.model=r.instance,a.push(s);var c=util.success("Subprocess setTitle success.",r.instance);e(c)})},setValidDate:function(e,i,n,r){return new Promise(function(e,t){var o=JSON.xpath("/subprocesses[_id eq '"+i+"']",app.SCOPE.workflow,{})[0];o.dates.valid=n;var a=[],s={};s.model=o,a.push(s);var c=util.success("valid date set.",r.subprocesses);e(c)})}}}(),variables=function(){return{setVariable:function(setVariable,_WFInstance,uuid){return new Promise(function(resolve,reject){helper.getNodeValue(setVariable.data,_WFInstance,uuid).then(function(dataValue){var scope=setVariable.scope,variableName=setVariable.name,variableType=setVariable.variableType,validDate=JSON.xpath("/subprocesses[_id eq '"+uuid+"']/dates/valid",_WFInstance,{})[0];switch(scope){case"profile":var profileId=_WFInstance.profile,profileVariableFileName=profileId+":variables";dao.get(profileVariableFileName).done(function(file){if("periodic"==variableType){var processObj=JSON.xpath("/instance/processes[subProcesses/uuid eq '"+uuid+"']",_WFInstance,{})[0],seq=processObj.seq,obj={subProcessUUID:uuid,user:{userName:LOCAL_SETTINGS.SUBSCRIPTIONS.username,userId:LOCAL_SETTINGS.SUBSCRIPTIONS.userProfileId},seq:seq,validDate:validDate,value:dataValue};eval("file."+variableName+".push(obj)")}else file[variableName]=dataValue;dao.upsert(file).done(function(e){resolve("Variable set successfully")}).fail(function(e){reject("Failed to set Variable")})}).fail(function(e){var i={_id:profileVariableFileName};if(i.channels=app.profile.channels,"periodic"==variableType){var n=JSON.xpath("/instance/processes[subProcesses/uuid eq '"+uuid+"']",_WFInstance,{})[0],r=n.seq;i[variableName]=[{subProcessUUID:uuid,user:{userName:LOCAL_SETTINGS.SUBSCRIPTIONS.username,userId:LOCAL_SETTINGS.SUBSCRIPTIONS.userProfileId},seq:r,validDate:validDate,value:dataValue}]}else i[variableName]=dataValue;dao.upsert(i).done(function(e){resolve("Variable set successfully")}).fail(function(e){reject("Failed to set Variable")})});break;case"subProcessInstance":resolve("not implemented");break;case"step":resolve("not implemented")}},function(e){reject("getNodeValue value not found.")})})}}}(),notification=function(){return{email:function(e,n,r){return new Promise(function(r,t){var o=worker.getWorkerWrapper();o._id=generateUUID(),o.communityId=app.SCOPE.getCommunityId(),o.applicationId=app.SCOPE.applicationId,o.createdDateTime=(new Date).toString(),o.senderUserId=LOCAL_SETTINGS.SUBSCRIPTIONS.userId;var a={};a.emailAddress=NOTIFICATION_FROM_ADDRESS,a.name=NOTIFICATION_FROM_NAME;var s=function(e){return new Promise(function(r,t){var o=[];if(void 0!=e.recipients.role){var a=e.recipients.role.roleId,s="";"current"==e.recipients.role.profile?s=n.profile:"community"==e.recipients.role.profile&&(s=app.SCOPE.getCommunityId()),library.getUsersListByRole(s,a).then(function(e){if(void 0!=e&&e.length>0){for(i=0;i<e.length;i++)o.push({name:e[i].name,id:e[i].id});r(o)}else t("ERROR: No users found in role list")},function(e){t("ERROR: Cannot fetch users from role. Exiting.")})}else void 0!=e.recipients.assignedTo&&(o.push({name:"",id:assignedTo}),r(o))})},c=[],u=[],d=e.heading,p={};void 0!=e.message.plain?p.plain=e.message.plain:void 0!=e.message.rtf&&(p.rtf={},void 0!=e.message.rtf.markup?p.rtf.markup=e.message.rtf.markup:void 0!=e.message.rtf.template);var l={notification:{email:{}}};s(e).then(function(e){l.notification.email.from=a,l.notification.email.to=e,l.notification.email.cc=c,l.notification.email.bcc=u,l.notification.email.heading=d,l.notification.email.message=p,o.action=l,worker.send(o).then(function(e){console.log(o);var i=util.success("Notification Email Worker processes successfully.",e);r(i)},function(e){t(e)})},function(e){t(e)})})},sms:function(e,i,n){return new Promise(function(e,i){})},pushAPI:function(e,i,n){return new Promise(function(e,i){})}}}();module.exports={community:community,application:application,performance:performance,worker:worker,sdo:sdo,taxonomy:taxonomy,subProcessInstance:subProcessInstance,variables:variables,notification:notification};

},{"./form":3,"./helper":4,"./nodeValue":6,"utility":8}],3:[function(require,module,exports){
"use strict";function create(args){var processId=args[0]||"",subProcess=args[1]||{},step=args[2]||{},action=args[3]||{},_WFInstance=args[6]||{},data=args[6]||{},indicators=subProcess.indicators||[],result=[],indicatorType=action._type,processSeq=args[4]||"",subProcessSeq=args[5]||"",createType=args[7]||"",subProcessId=subProcess._id,uuid=args[8]||"",baseUUID=args[9]||"",profile=_WFInstance.profile,inputData=args[10]||{},formCreateType=action.method.form.create,formType=action.method.form.type,paramObject={formCreateType:formCreateType,formType:formType};return new Promise(function(resolve,reject){for(var toProcess=indicators.length,subprocessType=JSON.xpath("/config/processes/subProcesses[_id eq '"+subProcessId+"']/type",_WFInstance,{})[0],formCreateFn=function(indicatorType,indicatorId,validDate,instantiateSource){gatekeeper.instantiate(baseUUID,indicatorType,indicatorId,_WFInstance.profile,validDate,subProcessId,subprocessType).then(function(docArray){for(var i=0;i<docArray.length;i++){var object=docArray[i];if(!object.model._id.endsWith(":approved")&&!object.model._id.endsWith(":rejected")){var workflowObj={id:_WFInstance.config._id,instance:_WFInstance.instance._id,processes:[{id:processId,subProcessId:subProcess._id,subProcessUUID:uuid,step:{id:step.id,seq:step.seq,startDate:"",status:step.status,message:step.message,assignedTo:{userId:step.assignedTo.userId,name:step.assignedTo.name},comment:step.comment,complete:!1,endDate:""}}]};void 0!=action.setWorkflowLabelInTitle&&""!=action.setWorkflowLabelInTitle&&1==action.setWorkflowLabelInTitle&&(object.model.title=inputData.label),void 0!=action.setDraft&&""!=action.setDraft&&1==action.setDraft&&(object.model.control.draft=!0),object.model.workflows.push(workflowObj);var mainId=object.model._id;gatekeeper.persist(docArray).then(function(savedArray){dao.get(mainId).done(function(data){var indicatorModel=ko.mapping.fromJS({defaultModel:{setId:indicatorId}});gatekeeper.instantiateData(mainId,instantiateSource,indicatorModel,data.model.pending.seq,paramObject).then(function(data){if("200"==data[0].status){if(void 0!=action.setWorkflowLabelInField&&""!=action.setWorkflowLabelInField){var assignmentSetId=action.setWorkflowLabelInField.split(".")[0];if(assignmentSetId==indicatorId){console.log(data[0]);var path="data[0].model.model.pending.data."+action.setWorkflowLabelInField+"='"+inputData.label+"'";eval(path)}}gatekeeper.persist(data).then(function(e){dao.get(mainId).done(function(e){if(0==_WFInstance.indicators.length){if(_WFInstance.indicators.push(e),toProcess--,0==toProcess){var s=util.success("Form created successfully.",_WFInstance.indicators);resolve(s)}}else{for(var t=!1,i=0;i<_WFInstance.indicators.length;i++){var a=_WFInstance.indicators[i];if(a._id==e._id&&(t=!0,_WFInstance.indicators.splice(i,1),_WFInstance.indicators.push(e),toProcess--,0==toProcess)){var s=util.success("Form created successfully.",_WFInstance.indicators);resolve(s)}}if(0==t&&(_WFInstance.indicators.push(e),toProcess--,0==toProcess)){var s=util.success("Form created successfully.",_WFInstance.indicators);resolve(s)}}}).fail(function(e){console.error(e);var s=util.success("1 Gatekeeper initialisation failed with initialiseData message "+e[0].message,{});reject(s)})},function(e){console.error(e);var s=util.success("2 Gatekeeper initialisation failed with initialiseData message "+e[0].message,{});reject(s)})}else{var failure=util.success("3 Gatekeeper initialisation failed with initialiseData message "+err[0].message,{});reject(failure)}},function(e){var s=util.success("4 Gatekeeper initialisation failed with initialiseData message "+e[0].message,{});reject(s)})}).fail(function(e){console.error(e);var s=util.success("5 Gatekeeper initialisation failed with initialiseData message "+e[0].message,{});reject(s)})},function(e){console.error(e);var s=util.success("6 Gatekeeper initialisation failed with initialiseData message "+e[0].message,{});reject(s)})}}},function(e){for(var s=[],t=0;t<_WFInstance.instance.processes.length;t++)_WFInstance.instance.processes[t].subProcesses.length>0&&s.push(_WFInstance.instance.processes[t]);_WFInstance.instance.processes=[],_WFInstance.instance.processes=s;for(var i=[],t=0;t<_WFInstance.subprocesses.length;t++)_WFInstance.subprocesses[t].indicators.length>0&&i.push(_WFInstance.subprocesses[t]);_WFInstance.subprocesses=[],_WFInstance.subprocesses=i,console.error(e);var a=util.success("7 Gatekeeper initialisation failed with initialiseData message "+e[0].message,{});reject(a)})},instantiateSource=FROM_DEFINITION,counter=0;counter<indicators.length;counter++){var indicatorId=indicators[counter]._id,indicatorName=util.getName(indicators[counter].name,"en"),source=indicators[counter].initiateData,initType="";void 0!=subProcess.instanceType.newSequence?initType=INSTANCE_TYPE_NEW_SEQ:void 0!=subProcess.instanceType.newInstance&&(initType=INSTANCE_TYPE_NEW_INS);var indicatorDoc={};if(void 0!=baseUUID&&""!=baseUUID&&baseUUID.length>0){var sp=JSON.xpath("/subprocesses[_id eq '"+baseUUID+"']",_WFInstance,{})[0];void 0==subProcess.periodType.periodic&&(sp.active=!1),instantiateSource=FROM_AUTHORISED}else{var cardinality=JSON.xpath("/indicators[setId eq '"+indicatorId+"']/cardinality",app.SCOPE.APP_CONFIG,{})[0];if(initType==INSTANCE_TYPE_NEW_INS)if(cardinality==INDICATOR_CARDINALITY_SINGLE){var existingUUID=JSON.xpath("/indicators[category/term eq '"+indicatorId+"']/_id",_WFInstance,{});instantiateSource=existingUUID.length>0?FROM_AUTHORISED:FROM_DEFINITION}else instantiateSource=FROM_DEFINITION;else if(cardinality==INDICATOR_CARDINALITY_SINGLE){var existingUUID=JSON.xpath("/indicators[category/term eq '"+indicatorId+"']/_id",app.SCOPE.workflow,{});instantiateSource=existingUUID.length>0?FROM_AUTHORISED:FROM_DEFINITION}else{var path="/indicators[category/term eq '"+indicatorId+"']/_id";subprocessType==PROCESS_TYPE_SUBPROFILE&&(path="/indicators[category/term eq '"+indicatorId+"' and id = /subprocesses[id = '"+subProcessId+"' and id = /instance/processes/subProcesses[subprofileId eq '"+app.profile.subprofileId+"']/uuid]/indicators/instances/uuid]/_id");var existingUUID=JSON.xpath(path,_WFInstance,{});instantiateSource=existingUUID.length>0?FROM_AUTHORISED:FROM_DEFINITION}}formCreateFn(initType,indicatorId,"",instantiateSource)}})}function setInstanceTitle(e){var s=e[0]||{},t=e[2]||"",i=e[4]||{},a=i.label;return new Promise(function(e,i){for(var n=JSON.xpath("/subprocesses[_id eq '"+t+"']",s,{})[0],r=n.indicators,o=0;o<r.length;o++){var c=r[o].instances[0].uuid,d=JSON.xpath("/indicators[_id eq '"+c+"']",s,{})[0];d.title=r[o].id+" "+a}e("Set Title Success",r)})}function deleteProfile(e){var s=e[0]||{},t=s.profile;return new Promise(function(e,s){var i={source:"remote",type:"workerObject",_id:generateUUID(),channels:[],communityId:app.SCOPE.getCommunityId(),applicationId:app.SCOPE.applicationId,message:"",messageType:"info",createdDateTime:moment().format(),senderUserId:LOCAL_SETTINGS.SUBSCRIPTIONS.userId,notification:{},profile:{action:"deleteProfile",profileId:t}};console.log(i),dao.upsert(i).done(function(s){console.log("Worker Object submitted for profile("+t+") deletion."),console.log(s),e(s)}).fail(function(e){console.log(e),s(data)})})}function createProfile(e){var s=e[1]||{},t=s.communityId,i=s.profile;return new Promise(function(e,s){library.createProfileDocuments(t,i).done(function(s){var t=util.success("Form created successfully.",s);e(t)}).fail(function(e){console.error(e);var t=util.success("ERROR: Profile creation failed"+e[0].message,{});s(t)})})}function setDraft(e){var s=e[0]||{},t=(s.communityId,s.profile,e[2]||"");return new Promise(function(e,i){for(var a=JSON.xpath("/subprocesses[_id eq '"+t+"']",s,{})[0],n=a.indicators,r=0;r<n.length;r++){var o=n[r].instances[0].uuid,c=JSON.xpath("/indicators[_id eq '"+o+"']",s,{})[0];c.control.draft=!0}e("Set Draft Success",n)})}function setUnDraft(e){var s=e[0]||{},t=(s.communityId,s.profile,e[2]||"");return new Promise(function(e,i){for(var a=JSON.xpath("/subprocesses[_id eq '"+t+"']",s,{})[0],n=a.indicators,r=0;r<n.length;r++){var o=n[r].instances[0].uuid,c=JSON.xpath("/indicators[_id eq '"+o+"']",s,{})[0];c.control.draft=!1}e("Set Draft Success",n)})}function save(e){var s={complete:!0,data:[]};return new Promise(function(e,t){var i=util.success("Form indicator set saved successfully.",s);e(i)})}function submit(e){var s={complete:!0,data:[]};return new Promise(function(e,t){var i=util.success("Form submitted successfully.",s);e(i)})}function authorise(e){var s=e[0]||"",t=e[1]||{},i=t._id,a=e[2]||"",n=e[3]||"",r=e[4]||{};return new Promise(function(e,t){for(var o=JSON.xpath("/processes[id eq '"+s+"' and seq eq '"+a+"']/subProcesses[id eq '"+i+"' and seq eq '"+n+"']/uuid",r.instance,{})[0],c=JSON.xpath("/subprocesses[_id eq '"+o+"']/indicators/instances/uuid",r,{}),d=c.length,u=[],l=0;l<d;l++)gatekeeper.authorise(c[l]).then(function(s){gatekeeper.persist(s).then(function(s){for(var t="",i=0;i<s.length;i++)s[i].id.endsWith(":approved")||(t=s[i].id);dao.get(t).done(function(s){if(0==r.indicators.length){if(r.indicators.push(s),d--,0==d){var t=util.success("Form authorised successfully.",u);e(t)}}else{for(var i=!1,a=0;a<r.indicators.length;a++){var n=r.indicators[a];if(n._id==s._id&&(i=!0,r.indicators.splice(a,1),r.indicators.push(s),d--,0==d)){var t=util.success("Form authorised successfully.",u);e(t)}}if(0==i&&(r.indicators.push(s),d--,0==d)){var t=util.success("Form authorised successfully.",u);e(t)}}}).fail(function(e){console.error(e)})},function(e){console.error(err)})},function(s){if(d--,0==d){var t=util.success("Form authorised successfully.",u);e(t)}})})}function close(e){var s={complete:!0,data:[]};return new Promise(function(e,t){var i=util.success("Form closed successfully.",s);e(i)})}function updateIndicator(args){var _WFInstance=args[0]||{},uuid=args[1]||"",path=args[2]||"",dataValue=args[3]||"";return new Promise(function(resolve,reject){var subProcessInstance=JSON.xpath("/subprocesses[_id eq '"+uuid+"']",_WFInstance,{})[0],indicatorInstances=subProcessInstance.indicators,setId=path.split(".",1)[0],indicatorUUID=JSON.xpath("/*[id eq '"+setId+"']/instances/uuid",indicatorInstances,{})[0],indObject=JSON.xpath("/indicators[_id eq '"+indicatorUUID+"']",_WFInstance,{})[0],expr="indObject.model.pending.data."+path+' = "'+dataValue+'"';eval(expr);var itemsToProcess=1,stuff=[],obj={};obj.model=indObject,stuff.push(obj),gatekeeper.persist(stuff).then(function(e){for(var s="",t=0;t<e.length;t++)e[t].id.endsWith(":approved")||(s=e[t].id);dao.get(s).done(function(e){if(0==_WFInstance.indicators.length){if(_WFInstance.indicators.push(e),itemsToProcess--,0==itemsToProcess){var s=util.success("Indicator updated.",stuff);resolve(s)}}else{for(var t=!1,i=0;i<_WFInstance.indicators.length;i++){var a=_WFInstance.indicators[i];if(a._id==e._id&&(t=!0,_WFInstance.indicators.splice(i,1),_WFInstance.indicators.push(e),itemsToProcess--,0==itemsToProcess)){var s=util.success("Indicator updated.",stuff);resolve(s)}}if(0==t&&(_WFInstance.indicators.push(e),itemsToProcess--,0==itemsToProcess)){var s=util.success("Indicator updated.",stuff);resolve(s)}}}).fail(function(e){console.error(e)})},function(e){console.error(e)})})}function markUpdateIndicator(e){var s=e[0]||{},t=(e[1]||"",e[2]||""),i=e[3]||"";return new Promise(function(e,a){var n=JSON.xpath("/indicators[category/term eq '"+i+"']",s,{})[0];n.model.pending.status=t;var r=1,o=[],c={};c.model=n,o.push(c),gatekeeper.persist(o).then(function(t){for(var i="",a=0;a<t.length;a++)t[a].id.endsWith(":approved")||(i=t[a].id);dao.get(i).done(function(t){if(0==s.indicators.length){if(s.indicators.push(t),r--,0==r){var i=util.success("Indicator updated.",o);e(i)}}else{for(var a=!1,n=0;n<s.indicators.length;n++){var c=s.indicators[n];if(c._id==t._id&&(a=!0,s.indicators.splice(n,1),s.indicators.push(t),r--,0==r)){var i=util.success("Indicator updated.",o);e(i)}}if(0==a&&(s.indicators.push(t),r--,0==r)){var i=util.success("Indicator updated.",o);e(i)}}}).fail(function(e){console.error(e)})},function(e){console.error(e)})})}var util=require("utility"),gatekeeper=new GK;module.exports={create:create,save:save,submit:submit,authorise:authorise,close:close,setDraft:setDraft,setUnDraft:setUnDraft,createProfile:createProfile,setInstanceTitle:setInstanceTitle,deleteProfile:deleteProfile,updateIndicator:updateIndicator,markUpdateIndicator:markUpdateIndicator};

},{"utility":8}],4:[function(require,module,exports){
"use strict";function getLanguageMessage(message){var language=service.getLanguage(),res=eval("message.i18n."+language);return console.log(res),res}function getNodeValue(data,_WFInstance,uuid){return new Promise(function(resolve,reject){if(void 0!=data.value)resolve(data.value.data);else if(void 0!=data.indicatorUUID)reject("ERROR: Unimplemented value type found.");else if(void 0!=data.indicator){var indicatorUUID=JSON.xpath("/subprocesses[_id eq '"+uuid+"']/indicators[id eq '"+data.indicator.indicatorSetId+"']/instances/uuid",_WFInstance,{})[0],indObject=JSON.xpath("/indicators[_id eq '"+indicatorUUID+"']",_WFInstance,{})[0],xpath="/model/pending/data/"+data.indicator.indicatorSetId+"/"+data.indicator.elementId,seq=JSON.xpath("count(/subprocesses[_id eq '"+uuid+"']/preceding-sibling::node()[id = /subprocesses[_id eq '"+uuid+"']/id])",_WFInstance,{})[0]+1,subprocessType=JSON.xpath("/config/processes/subProcesses[_id eq /subprocesses[_id eq '"+uuid+"']/id]/type",_WFInstance,{})[0];subprocessType==PROCESS_TYPE_SUBPROFILE&&(seq=JSON.xpath("count(/subprocesses[_id eq '"+uuid+"']/preceding-sibling::node()[id = /subprocesses[_id eq '"+uuid+"']/id and id = /subprocesses[_id = /instance/processes/subProcesses[subprofileId eq '"+app.profile.subprofileId+"']/uuid])",_WFInstance,{})[0]+1);var replacedPath=replaceAll(xpath,"#SEQUENCE#",seq),validDate=JSON.xpath("/subprocesses[_id eq '"+uuid+"']/dates/valid",_WFInstance,{})[0],concatValidDate="'"+validDate+"'",newPath=replaceAll(replacedPath,"#END_DATE#",concatValidDate),dotReplaced=replaceAll(newPath,"[.]","/"),retValue=JSON.xpath(dotReplaced,indObject,{})[0];resolve(retValue)}else if(void 0!=data.system)resolve("ERROR: Unimplemented system type found.");else if(void 0!=data.variable)if(void 0!=data.variable.profile){var variableName=data.variable.profile,profileId=_WFInstance.profile,profileVariableFileName=profileId+":variables";dao.get(profileVariableFileName).done(function(file){var obj=eval("file."+variableName);if("object"==typeof obj){var seq=JSON.xpath("count(/subprocesses[_id eq '"+uuid+"']/preceding-sibling::node()[id = /subprocesses[_id eq '"+uuid+"']/id])",_WFInstance,{})[0]+1,subprocessType=JSON.xpath("/config/processes/subProcesses[_id eq /subprocesses[_id eq '"+uuid+"']/id]/type",_WFInstance,{})[0];subprocessType==PROCESS_TYPE_SUBPROFILE&&(seq=JSON.xpath("count(/subprocesses[_id eq '"+uuid+"']/preceding-sibling::node()[id = /subprocesses[_id eq '"+uuid+"']/id and id = /subprocesses[_id = /instance/processes/subProcesses[subprofileId eq '"+app.profile.subprofileId+"']/uuid])",_WFInstance,{})[0]+1);var valuePath="/"+variableName+"[seq eq '"+seq+"']/value",retValue=JSON.xpath(valuePath,file,{})[0];resolve(retValue)}else"string"==typeof obj&&resolve(obj)}).fail(function(e){reject("ERROR: Profile variables not found")})}else reject("ERROR: Unimplemented profile type found.")})}function replaceAll(e,s,a){return"function"!=typeof e.replace&&(console.log(s+" "+a),console.log(e)),e.replace(new RegExp(s,"g"),a)}module.exports={getLanguageMessage:getLanguageMessage,getNodeValue:getNodeValue};

},{}],5:[function(require,module,exports){
"use strict";function getProcess(e,s,t){return new Promise(function(n,i){try{var c=[],r=[];t.instance.processes.filter(function(s){s.id==e&&(r=s)}),util.syncLoop(r.subProcesses.length,function(n){var o=n.iteration(),u=r.seq,f=r.subProcesses[o].id,a=r.subProcesses[o].seq;getSubProcess(e,u,f,a,s,t).then(function(e){c.push(e),n.next()},function(e){n.break(),i(e)})},function(){n(c)})}catch(e){i(e)}})}function getSubProcess(e,s,t,n,i,c){return new Promise(function(r,o){try{var u={id:"",seq:"",name:"",help:"",dates:"",step:""},f=[],a=[];c.instance.processes.filter(function(i){if(i.id==e&&i.seq==s){i.subProcesses.length;i.subProcesses.filter(function(e){e.id==t&&e.seq==n&&0==e.complete&&(f=e)})}}),c.config.processes.filter(function(s){s._id==e&&s.subProcesses.filter(function(e){e._id==t&&(a=e)})}),u.id=a._id,u.seq=f.seq,u.name=util.getName(a.name,i),u.help=util.getName(a.help,i),u.dates=f.dates,u.step=f.step,r(u)}catch(e){o(e)}})}function prepareNotificationScreen(){""}var util=require("utility");module.exports={getProcess:getProcess};

},{"utility":8}],6:[function(require,module,exports){
"use strict";function get(){return new Promise(function(e,t){})}module.exports={get:get};

},{}],7:[function(require,module,exports){
"use strict";function count(e){return void 0!==e?e.length:0}function preRequisites(e,t){return new Promise(function(s,n){var i=[];try{util.syncLoop(e.length,function(s){var o=s.iteration();preRequisite(e[o],t).then(function(e){i.push(!0),s.next()},function(e){i.push(!1),s.break(),n(e)})},function(){if(i.every(Boolean)){var e=util.success("Pre-requisites completed successfully.",{});s(e)}else{var t=util.error("WFPreRequisiteError","Not all pre-requisites passed.");n(t)}})}catch(e){n(e)}})}function preRequisite(e,t){return new Promise(function(s,n){var i="";if(void 0!=e.check.numberProcessInstances){var o=e.check.numberProcessInstances,a=o.operator,r="";switch(a){case"greaterThan":r="gt";break;case"lessThan":r="lt";break;case"greaterThanEqual":r="ge";break;case"lessThanEqual":r="le";break;case"equalTo":r="eq";break;case"notEqualTo":r="ne"}var c=o.subProcessId,u="step/status",d=o.type,p="/"+u+"[. eq '"+d+"']",l="count(/subprocesses[id eq '"+c+"']"+p+")",f=JSON.xpath("/config/processes/subProcesses[_id eq '"+c+"']/type",t,{})[0];void 0!=app.profile.subprofileId&&""!=app.profile.subprofileId&&void 0!=f&&f==PROCESS_TYPE_SUBPROFILE&&(l="count(/subprocesses[id eq '"+c+"' and _id = /instance/processes/subProcesses[subprofileId eq '"+app.profile.subprofileId+"']/uuid]"+p+")"),i=JSON.xpath(l,t,{})[0]}else if(void 0!=e.check.variableConfirm);else{var m=util.error("WFPreRequisiteError","Pre-requisite type not defined.");n(m)}var h="",v="";if(v=e.check.numberProcessInstances.count,e.check.numberProcessInstances.count,e.check.numberProcessInstances?h=util.compare(i,e.check.numberProcessInstances.operator,parseInt(v)):e.check.variableConfirm,h){var g=util.success("Pre-requisites passed.",{});s(g)}else{var b=helper.getLanguageMessage(e.message),m=util.error("WFPreRequisiteError",b);n(m)}})}function preActions(e,t){return new Promise(function(s,n){var i=[];try{util.syncLoop(e.length,function(s){var o=s.iteration();action(e[o],t).then(function(e){i.push(!0),s.next()},function(e){i.push(!1),s.break(),n(e)})},function(){if(i.every(Boolean)){var e=util.success("Pre-actions completed successfully.",{});s(e)}else{var t=util.error("WFPreRequisiteError","Not all pre-actions passed.");n(t)}})}catch(e){n(e)}})}function getSubProcess(e,t){return void 0==t.subprocesses?[]:void t.subprocesses.filter(function(t){if(t.id==e)return t})}function subProcess(e,t,s,n,i,o){var a=[],r=[],c=[];o.instance.processes.filter(function(i){if(i.id==e&&i.seq==t){i.subProcesses.length;i.subProcesses.filter(function(e){if(e.id==s&&e.seq==n){var t=e.uuid;o.subprocesses.filter(function(e){e._id==t&&(a=e)})}})}}),o.config.processes.filter(function(t){t._id==e&&(r=t,t.subProcesses.filter(function(e){e._id==s&&(c=e)}))});var u="",d=i.baseUUID;if(void 0!=d&&""!=d&&d.length>0){var p=JSON.xpath("/subprocesses[_id eq '"+d+"']",o,{})[0];u=p.groupKey}else u=generateUUID();var l=generateUUID(),f={_id:l,id:s,type:"workflowInstanceSubProcess",seq:n,initiated:!1,dates:{created:"",valid:"",start:"",due:"",closed:""},complete:!1,indicators:[],step:{},active:!0,groupKey:u,channels:["community_"+app.SCOPE.getCommunityId(),"profile_"+app.SCOPE.profileId,"application_"+app.SCOPE.applicationId,"community_"+app.SCOPE.getCommunityId()+"_application_"+app.SCOPE.applicationId],history:[]};return o.subprocesses.push(f),new Promise(function(u,d){try{var p=r.preActions;preActions(p,o).then(function(p){var m=r.prerequisites;preRequisites(m,o).then(function(r){var p=c.initiate;initiate(p,a,i).then(function(a){f.initiated=a.data.initiated,f.dates=a.data.dates;var r=c.steps[0]._id,p=(c.steps[0].transition[0]._id,1);step(e,t,s,n,r,p,i,o,l).then(function(e){f.step=e.data,indicators(c.indicators,o,f._id).then(function(e){f.indicators=e.data;var t=util.success(e.message,f);u(t)},function(e){d(e)})},function(e){d(e)})},function(e){o.subprocesses=o.subprocesses.filter(function(e){return!(e._id==l)}),d(e)})},function(e){o.subprocesses=o.subprocesses.filter(function(e){return!(e._id==l)}),d(e)})},function(e){o.subprocesses=o.subprocesses.filter(function(e){return!(e._id==l)}),d(e)})}catch(e){d(e)}})}function initiate(e,t,s){var n={initiated:!1,dates:{created:"",valid:"",start:"",due:"",closed:""}};return new Promise(function(i,o){var a=function(){if(void 0!=e.user){n.dates.created=s.createdDate,"userSelected"!=e.user.validDate._type&&"autoSelected"!=e.user.validDate._type||(void 0!==s.validDate?n.dates.valid=s.validDate:util.warn("WFInitiateError","No valid date passed in - {data.validDate}")),"userSelected"!=e.user.dueDate._type&&"autoSelected"!=e.user.dueDate._type||(void 0!==s.dueDate?n.dates.due=s.dueDate:util.warn("WFInitiateError","No due date passed in - {data.dueDate}")),n.dates.start=s.firstDate,n.initiated=!0;var t=util.success("Sub-Process initiate completed successfully.",n);i(t)}else if(void 0!=e.auto);else{var a=util.error("WFInitiateError","Initiate type: "+e._type+" not defined.");o(a)}};if(void 0==t.complete)a();else if(!t.complete)if(e.parallelInstances)a();else{var r=util.error("WFInitiateError","Sub-process: "+t.id+" still active and parallel instances are not allowed.");o(r)}})}function step(processId,processSeq,subProcessId,subProcessSeq,stepId,stepSeq,data,_WFInstance,spuuid){var model={id:"",seq:"",status:"",message:"",assignedTo:{userId:"",name:""},assignment:{},comment:""},subProcess={},uuid="",instSubProcess,step={},transitionId="";return new Promise(function(resolve,reject){try{_WFInstance.instance.processes.filter(function(e){e.id==processId&&e.seq==processSeq&&e.subProcesses.filter(function(e){e.id==subProcessId&&e.seq==subProcessSeq&&(uuid=e.uuid)})}),_WFInstance.subprocesses.filter(function(e){e._id==uuid&&(instSubProcess=e)}),_WFInstance.config.processes.filter(function(e){e._id==processId&&e.subProcesses.filter(function(e){e._id==subProcessId&&(subProcess=e,e.steps.filter(function(e){e._id==stepId&&(step=e)}))})}),model.id=stepId,model.seq=stepSeq;var instanceStatus="";void 0!=step.setInstanceStatusTo.NotStarted?instanceStatus="NotStarted":void 0!=step.setInstanceStatusTo.Created?instanceStatus="Created":void 0!=step.setInstanceStatusTo.InProgress?instanceStatus="InProgress":void 0!=step.setInstanceStatusTo.Submitted?instanceStatus="Submitted":void 0!=step.setInstanceStatusTo.Complete&&(instanceStatus="Complete");var language=service.getLanguage();model.status=instanceStatus,model.message=eval("step.setInstanceStatusTo."+instanceStatus+".label.i18n."+language),model.comment=void 0!==data.comment?data.comment:"";var indicators=void 0!==instSubProcess?instSubProcess.indicators:[];indicatorDocs(processId,indicators,model,_WFInstance).then(function(e){uuid=spuuid,void 0!=step.function.actions?actions(step.function.actions,processId,processSeq,subProcessId,subProcessSeq,subProcess,model,_WFInstance,data,spuuid).then(function(e){var t=step.transition[0]._id;transition(processId,processSeq,subProcessId,subProcessSeq,stepId,t,data,_WFInstance,spuuid,model).then(function(e){var t=util.success("Transition completed successfully.",e.data.step);resolve(t)},function(e){reject(e)})},function(e){reject(e)}):void 0!=step.function.task&&task(processId,processSeq,step.function.task,spuuid,model).then(function(e){console.log("Task complete.");var t=util.success("Task awaiting user action.",model);resolve(t)},function(e){reject(e)})},function(e){reject(e)})}catch(e){reject(e)}})}function indicators(e,t,s){var n=[];return new Promise(function(e,i){try{for(var o=JSON.xpath("indicators[fn:count(./workflows/processes[subProcessUUID eq '"+s+"']) gt 0]",t,{}),a=0;a<o.length;a++){var r=o[a],c={id:"",instances:[]},u={uuid:"",title:"",key:"",seq:1};c.id=r.category.term,u.uuid=r._id,u.title=r.title,u.key="",u.seq=r.model.pending.seq,c.instances.push(u),n.push(c)}var d=util.success("Process indicator model updated.",n);e(d)}catch(e){i(e)}})}function assignUser(e,t,s,n,i,o){return new Promise(function(a,r){try{var c="";o.instance.processes.filter(function(i){i.id==e&&i.seq==t&&i.subProcesses.filter(function(e){e.id==s&&e.seq==n&&(c=e.uuid)})}),o.subprocesses.filter(function(t){if(t._id==c){t.step.assignedTo.userId=i.id,t.step.assignedTo.name=i.name;for(var s=t.indicators,n=0;n<s.length;n++)for(var r=s[n],u=0;u<r.instances.length;u++)for(var d=r.instances[u],p=0;p<o.indicators.length;p++){var l=o.indicators[p];d.uuid==l._id&&l.workflows.filter(function(t){t.id==o.config._id&&t.processes.filter(function(t){t.id==e&&(t.step.assignedTo.userId=i.id,t.step.assignedTo.name=i.name)})})}var f=util.success('User assigned successfully. UserId: "'+i.id+'", Name: "'+i.name+'"',t);a(f)}})}catch(e){r(e)}})}function indicatorDocs(e,t,s,n){return new Promise(function(i,o){try{if(void 0==t){util.error("WFIndicatorsUpdate","Indicators parameter is required. - Value: "+t);o(err)}else{for(var a=0;a<t.length;a++)for(var r=t[a],c=0;c<r.instances.length;c++)for(var u=r.instances[c],d=0;d<n.indicators.length;d++){var p=n.indicators[d];u.uuid==p._id&&p.workflows.filter(function(t){t.id==n.config._id&&t.processes.filter(function(t){t.id==e&&(t.step.id=s.id,t.step.seq=s.seq,t.step.status=s.status,t.step.message=s.message,t.step.assignedTo.userId=s.assignedTo.userId,t.step.assignedTo.name=s.assignedTo.name,t.step.comment=void 0!==s.comment?s.comment:"")})})}var l=util.success("Indicator documents workflow process model updated.",n);i(l)}}catch(e){o(e)}})}function actions(e,t,s,n,i,o,a,r,c,u){var d=[];return new Promise(function(p,l){util.syncLoop(e.length,function(p){var f=p.iteration();action(e[f],t,s,n,i,o,a,r,c,u).then(function(t){var s={id:e[f]._id,seq:f,data:t};d.push(s),p.next()},function(e){p.break(),l(e)})},function(){var e=util.success("Actions completed successfully.",d);p(e)})})}function action(e,t,s,n,i,o,a,r,c,u){return new Promise(function(n,d){if(void 0!=e.method){var p=["form","indicator","profile","subProcessInstance","step","community","application","user","sdo","performance","taxonomy","variables","notification"];switch(propertyExists(e.method,p)){case"form":if(void 0!=e.method.form.create){var l=[];l.push(t),l.push(o),l.push(a),l.push(e),l.push(s),l.push(i),l.push(r),l.push(c.createType),l.push(u),l.push(c.baseUUID),l.push(c),form.create(l).then(function(e){n(e.data)},function(e){d(e)})}else if(void 0!=e.method.form.authorise){var l=[];l.push(t),l.push(o),l.push(s),l.push(i),l.push(r),l.push(c.createType),l.push(u),l.push(c.baseUUID),l.push(c),form.authorise(l).then(function(e){n(e.data)},function(e){d(e)})}else if(void 0!=e.method.form.undraft){var l=[];l.push(r),l.push(c.createType),l.push(u),l.push(c.baseUUID),l.push(c),form.setUnDraft(l).then(function(e){n(e.data)},function(e){d(e)})}else if(void 0!=e.method.form.draft){var l=[];l.push(r),l.push(c.createType),l.push(u),l.push(c.baseUUID),l.push(c),form.setDraft(l).then(function(e){n(e.data)},function(e){d(e)})}else if(void 0!=e.method.form.close){var l=[];l.push(o.indicators),l.push(r),l.push(c.createType),l.push(u),l.push(c.baseUUID),l.push(c),form.close(l).then(function(e){n(e.data)},function(e){d(e)})}break;case"indicator":if(void 0!=e.method.indicator.create);else if(void 0!=e.method.indicator.instantiate);else if(void 0!=e.method.indicator.setValue){var f=e.method.indicator.setValue.path;helper.getNodeValue(e.method.indicator.setValue.data,r,u).then(function(e){var t=[];t.push(r),t.push(u),t.push(f),t.push(e),form.updateIndicator(t).then(function(e){n(e.data)},function(e){d(e)})},function(e){d(e)})}else if(void 0!=e.method.indicator.updateStatus){var m=e.method.indicator.indicatorSetId,l=[];if(l.push(r),l.push(u),void 0!=e.method.indicator.updateStatus){var h=e.method.indicator.updateStatus;l.push(h),l.push(m),form.markUpdateIndicator(l).then(function(e){n(e.data)},function(e){d(e)})}else n("Action indicator sub type not found.")}break;case"profile":if(void 0!=e.method.profile.create){var l=[];l.push(t),l.push(r),l.push(c.createType),l.push(u),l.push(c.baseUUID),l.push(c),form.createProfile(l).then(function(e){n(e.data)},function(e){d(e)})}else void 0!=e.method.profile.X;break;case"subProcessInstance":var v=["instantiate","authorise","close","setVariable","setStatusTo","setStatusMsgTo","setTitle","setValidDate"];switch(propertyExists(e.method.subProcessInstance,v)){case"setTitle":helper.getNodeValue(e.method.subProcessInstance.setTitle,r,u).then(function(t){actionsModule.subProcessInstance.setTitle(e.method.subProcessInstance.setTitle,u,t,r).then(function(e){n(e.data)},function(e){d(e)})},function(e){d(e)});break;case"setValidDate":helper.getNodeValue(e.method.subProcessInstance.setValidDate,r,u).then(function(t){actionsModule.subProcessInstance.setValidDate(e.method.subProcessInstance.setValidDate,u,t,r).then(function(e){n(e.data)},function(e){d(e)})},function(e){d(e)});break;default:d("No method found from implemented list in subprocess action.")}break;case"step":break;case"community":var g=["createCommunity","releaseAdoptedApplication","userJoinCommunity"];switch(propertyExists(e.method.community,g)){case"createCommunity":return actionsModule.community.createCommunity(e.method.community.createCommunity,u,r).then(function(e){n(e.data)},function(e){d(e)});case"releaseAdoptedApplication":return actionsModule.community.releaseAdoptedApplication(e.method.community.releaseAdoptedApplication,u,r).then(function(e){n(e.data)},function(e){d(e)});case"userJoinCommunity":return actionsModule.community.userJoinCommunity(e.method.community.userJoinCommunity,u,r).then(function(e){n(e.data)},function(e){d(e)});default:d("No method found from implemented list.")}break;case"application":var b=["createAppDefinition","buildApplication","applicationAdoption"];switch(propertyExists(e.method.application,b)){case"createAppDefinition":return actionsModule.application.createAppDefinition(e.method.application.createAppDefinition,u,r).then(function(e){n(e.data)},function(e){d(e)});case"buildApplication":return actionsModule.application.buildApplication(e.method.application.buildApplication,u,r).then(function(e){n(e.data)},function(e){d(e)});case"applicationAdoption":return actionsModule.application.applicationAdoption(e.method.application.applicationAdoption,u,r).then(function(e){n(e.data)},function(e){d(e)});default:d("No method found from implemented list.")}break;case"user":break;case"sdo":var I=["create"];switch(propertyExists(e.method.sdo,I)){case"create":return actionsModule.sdo.create(e.method.sdo.create,u,r).then(function(e){n(e.data)},function(e){d(e)});default:d("No method found from implemented list.")}break;case"performance":var P=["create","configureNode","unlockPeriod","lockPerformanceModel"];switch(propertyExists(e.method.performance,P)){case"create":return actionsModule.performance.create(e.method.performance.create,u,r).then(function(e){n(e.data)},function(e){d(e)});case"configureNode":return actionsModule.performance.configureNode(e.method.performance.configureNode,u,r).then(function(e){n(e.data)},function(e){d(e)});case"unlockPeriod":return actionsModule.performance.unlockPeriod(e.method.performance.unlockPeriod,u,r).then(function(e){n(e.data)},function(e){d(e)});case"lockPerformanceModel":return actionsModule.performance.lockPerformanceModel(e.method.performance.lockPerformanceModel,u,r).then(function(e){n(e.data)},function(e){d(e)});default:d("No method found from implemented list.")}break;case"taxonomy":var y=["create"];switch(propertyExists(e.method.taxonomy,y)){case"create":return actionsModule.taxonomy.create(e.method.taxonomy.create,u,r).then(function(e){n(e.data)},function(e){d(e)});default:d("No method found from implemented list.")}break;case"variables":var S=["setVariable"];switch(propertyExists(e.method.variables,S)){case"setVariable":return actionsModule.variables.setVariable(e.method.variables.setVariable,r,u).then(function(e){n(e.data)},function(e){d(e)});default:d("No method found from implemented list.")}break;case"notification":var _=["email","sms","pushAPI"];switch(propertyExists(e.method.notification,_)){case"email":return actionsModule.notification.email(e.method.notification.email,r,u).then(function(e){n(e.data)},function(e){d(e)});case"sms":d("SMS functionality not implemented");break;case"pushAPI":d("pushAPI functionality not implemented");break;default:d("No method found from implemented list.")}break;default:d("method not defined in configuration")}}else d("No method found from implemented list.")})}function task(e,t,s,n,i){return new Promise(function(e,t){var o=app.SCOPE.workflow,a=s.preActions;preActions(a,o).then(function(a){if(void 0!=s.assign.role){var r=o.profile,c="";"current"==s.assign.role.profile?c=o.profile:"community"==s.assign.role.profile&&(c=app.SCOPE.getCommunityId());var u=s.assign.role.roleId;library.getUsersListByRole(c,u).then(function(t){if(void 0!=t)if(t.length>1){var a=!1,d=library.getCurrentUserRoles();if(c==app.SCOPE.getCommunityId()){var p=d.community.indexOf(u);a=p>-1}else{var p=d.profile.indexOf(u),l=d.implicit.indexOf(u);a=p>-1||l>-1}if(a){var f=i.assignedTo;f.name=LOCAL_SETTINGS.SUBSCRIPTIONS.username+"",f.userId=LOCAL_SETTINGS.SUBSCRIPTIONS.userId+""}var m="";if(void 0!=s.assign.assignment){var m=i.assignment,h={show:s.assign.assignment.accept.show,label:_getNameByLang(s.assign.assignment.accept.label.i18n)};m.accept=h,m.message=_getNameByLang(s.assign.assignment.message.i18n);var v={show:s.assign.assignment.reject.show,label:_getNameByLang(s.assign.assignment.reject.label.i18n)};m.reject=v;var g={profileId:r,roleId:u,type:"role"};m.value=g,m.profileRoleId=c}if(a){var b=JSON.xpath("/instance/processes[subProcesses/uuid eq '"+n+"']/id",o,{})[0],I=JSON.xpath("/instance/processes/subProcesses[uuid eq '"+n+"']/id",o,{})[0],P=JSON.xpath("/subprocesses[_id eq '"+n+"']/step/id",o,{})[0];JSON.xpath("/processes[_id eq '"+b+"']/subProcesses[_id eq '"+I+"']/steps[_id eq '"+P+"']",o.config,{})[0];if(void 0!=s.preWorkActions){var y=s.preWorkActions;preWorkActions(y,o).then(function(t){e("Assignment is made. Pre work actions found and executed ")},function(e){v(e)})}else e("Assignment is made. No pre work actions found. ")}else e("Notifications request submitted for acceptance.")}else if(1==t.length){var S=t[0].id,_=t[0].name,f=i.assignedTo;f.name=_+"",f.userId=S+"";var m="";if(void 0!=s.assign.assignment){var m=i.assignment,h={show:s.assign.assignment.accept.show,label:_getNameByLang(s.assign.assignment.accept.label.i18n)};m.accept=h,m.message=_getNameByLang(s.assign.assignment.message.i18n);var v={show:s.assign.assignment.reject.show,label:_getNameByLang(s.assign.assignment.reject.label.i18n)};m.reject=v;var g={profileId:r,roleId:u,type:"role"};m.value=g,m.profileRoleId=c}var b=JSON.xpath("/instance/processes[subProcesses/uuid eq '"+n+"']/id",o,{})[0],I=JSON.xpath("/instance/processes/subProcesses[uuid eq '"+n+"']/id",o,{})[0],P=JSON.xpath("/subprocesses[_id eq '"+n+"']/step/id",o,{})[0];JSON.xpath("/processes[_id eq '"+b+"']/subProcesses[_id eq '"+I+"']/steps[_id eq '"+P+"']",o.config,{})[0];if(void 0!=s.preWorkActions){var y=s.preWorkActions;preWorkActions(y,o).then(function(t){e("Assigned to the only user in role. Pre work actions executed")},function(e){v(e)})}else e("Assigned to the only user in role. No pre work actions found.")}else{var f=i.assignedTo;f.name="",f.userId="";var m="";if(void 0!=s.assign.assignment){var m=i.assignment,h={show:s.assign.assignment.accept.show,label:_getNameByLang(s.assign.assignment.accept.label.i18n)};m.accept=h,m.message=_getNameByLang(s.assign.assignment.message.i18n);var v={show:s.assign.assignment.reject.show,label:_getNameByLang(s.assign.assignment.reject.label.i18n)};m.reject=v;var g={profileId:r,roleId:u,type:"role"};m.value=g,m.profileRoleId=c}e("No users found in list. Assigning blank ")}else console.log("Error in getUsersListByRole undefined"),v(err)},function(e){console.log("Error in getUsersListByRole"),t(e)})}else void 0!=s.assign.swimlane&&(e("swimlane"),console.log("Swimlane implementation !!"))},function(e){t(e)})})}function transition(e,t,s,n,i,o,a,r,c,u){return new Promise(function(d,p){try{for(var l=0,f="",m=0,h=[],v=r.config.processes.filter(function(t){if(t._id==e)return t}),g=v[0].subProcesses.filter(function(e){if(e._id==s)return e}),b=g[0].steps.filter(function(e){if(e._id==i)return e}),I=b[0].transition.filter(function(e){if(e._id==o)return e}),P=0;P<g[0].steps.length;P++)g[0].steps[P]._id==i&&(l=parseInt(g[0].steps[P]._seq));g[0].steps.filter(function(e){m=l+1,parseInt(e._seq)==m&&(f=e._id)}),r.instance.processes.filter(function(i){i.id==e&&i.seq==t&&i.subProcesses.filter(function(e){if(e.id==s&&e.seq==n){var t=e.uuid;c=t,r.subprocesses.filter(function(e){e._id==t&&(h=e)})}})});var y=g[0].steps.length,S=JSON.xpath("/subprocesses[_id eq '"+c+"']",r,{})[0],_=JSON.xpath("/subprocesses[_id eq '"+c+"']/step",r,{})[0];if(void 0!=u&&Object.keys(u).length>0?S.history.push(u):S.history.push(_),void 0!=I[0].transitionAction.goToStep){var q=parseInt(b[0]._seq)+parseInt(I[0].transitionAction.goToStep.default),k="";g[0].steps.filter(function(e){parseInt(e._seq)==m&&(k=e._id)}),step(e,t,s,n,k,q,a,r,c).then(function(e){if(q==y){var t=util.success("All Step transitions have completed successfully.",{subProcessComplete:!0,step:e.data});d(t)}else{var t=util.success("Step transition completed successfully.",{subProcessComplete:!1,step:e.data});d(t)}},function(e){p(e)})}else if(void 0!=I[0].transitionAction.goToStepId){var A=I[0].transitionAction.goToStepId.stepId,w=1;g[0].steps.filter(function(e){e._id==A&&(w=parseInt(e._seq))}),step(e,t,s,n,A,w,a,r,c).then(function(e){if(w==y){var t=util.success("All Step transitions have completed successfully.",{subProcessComplete:!0,step:e.data});d(t)}else{var t=util.success("Step transition completed successfully.",{subProcessComplete:!1,step:e.data});d(t)}},function(e){p(e)})}else if(void 0!=I[0].transitionAction.stop){var N=v[0].postActions;postActions(N,r).then(function(e){var t=util.success("Step transition completed successfully.Workflow stopped.",{subProcessComplete:!0,step:u});d(t)},function(e){p(e)})}}catch(e){p(e)}})}function postActions(e,t){return new Promise(function(s,n){var i=[];try{util.syncLoop(e.length,function(s){var o=s.iteration();action(e[o],t).then(function(e){i.push(!0),s.next()},function(e){i.push(!1),s.break(),n(e)})},function(){if(i.every(Boolean)){var e=util.success("Post-actions completed successfully.",{});s(e)}else{var t=util.error("WFPreActionsError","Not all post-actions passed.");n(t)}})}catch(e){n(e)}})}function processWorkflowMessage(e,t){var s=e;if(s.indexOf("#INSTANCE_LABEL")!==-1){var n=JSON.xpath("/instance/processes/subProcesses[uuid eq '"+t+"']/label",app.SCOPE.workflow,{})[0];s=s.replace("#INSTANCE_LABEL",n)}if(s.indexOf("#USER_NAME")!==-1){var n=JSON.xpath("/subprocesses[_id eq '"+t+"']/step/assignedTo/name",app.SCOPE.workflow,{})[0];s=s.replace("#USER_NAME",n)}if(s.indexOf("#PROFILE_TITLE")!==-1){var n=app.profile.title;s=s.replace("#PROFILE_TITLE",n)}if(s.indexOf("#PROFILE_TYPE")!==-1){var n=app.SCOPE.APP_CONFIG.name;s=s.replace("#PROFILE_TYPE",n)}if(s.indexOf("#VAR_SPUUID")!==-1){var n=t;s=s.replace("#VAR_SPUUID",n)}return s}function _getName(e,t){if(void 0!==e)for(var s=0;s<e.length;s++)if(e[s]._lang===t)return e[s].value}function _getNameByLang(obj){var lang=service.getLanguage(),expr="obj."+lang;return eval(expr)}function preWorkActions(e,t){return new Promise(function(s,n){var i=[];try{util.syncLoop(e.length,function(s){var o=s.iteration();action(e[o],t).then(function(e){i.push(!0),s.next()},function(e){i.push(!1),s.break(),n(e)})},function(){if(i.every(Boolean)){var e=util.success("PreWork-actions completed successfully.",{});s(e)}else{var t=util.error("WFPreActionsError","Not all pre-work-actions passed.");n(t)}})}catch(e){n(e)}})}var util=require("utility"),actionsModule=require("./actions"),helper=require("./helper"),form=require("./form");module.exports={preRequisites:preRequisites,preActions:preActions,postActions:postActions,preWorkActions:preWorkActions,subProcess:subProcess,indicatorDocs:indicatorDocs,task:task,transition:transition,assignUser:assignUser};

},{"./actions":2,"./form":3,"./helper":4,"utility":8}],8:[function(require,module,exports){
"use strict";function success(r,e){return{message:r,data:e}}function warn(r,e){return console.warn(e),{warning:r,data:e}}function error(r,e){var n=new Error("");return n.name=r,n.message=e,n}function syncLoop(r,e,n){var a=0,t=!1,o=!1,u={next:function(){return t&&o&&n?n():void(a<r?(a++,e(u)):(t=!0,n&&n()))},iteration:function(){return a-1},break:function(r){t=!0,o=r}};return u.next(),u}function compare(r,e,n){switch(e){case"greaterThan":return r>n;case"lessThan":return r<n;case"greaterThanEqual":return r>=n;case"lessThanEqual":return r<=n;case"equalTo":return r===n;case"notEqualTo":return r!==n}}function getName(r,e){if(void 0!==r)for(var n=0;n<r.length;n++)if(r[n].i18n._lang===e)return r[n].i18n.value}module.exports={success:success,warn:warn,error:error,syncLoop:syncLoop,compare:compare,getName:getName};

},{}]},{},[1])(1)
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJpbmRleC5qcyIsImxpYi9hY3Rpb25zLmpzIiwibGliL2Zvcm0uanMiLCJsaWIvaGVscGVyLmpzIiwibGliL2ludGVyZmFjZS5qcyIsImxpYi9ub2RlVmFsdWUuanMiLCJsaWIvcHJvY2Vzcy5qcyIsIm5vZGVfbW9kdWxlcy91dGlsaXR5L2luZGV4LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUEsWUE4Q0EsU0FBUyxVQUFTLEVBQVMsRUFBYSxFQUFLLEdBQ3pDLEdBQUksR0FBUSxJQUdaLElBQW1CLElBQWYsR0FBb0MsUUFBZixFQUNyQixLQUFNLE1BQUssTUFBTSxnQkFBaUIsOEJBQy9CLElBQTZCLGdCQUFsQixHQUNkLEtBQU0sSUFBSSxPQUFNLGdEQU1wQixJQUpJLEVBQU0sWUFBYyxHQUFlLEdBSXhCLElBQVgsR0FBNEIsUUFBWCxFQUNqQixLQUFNLE1BQUssTUFBTSxnQkFBaUIsNEJBQy9CLElBQXlCLGdCQUFkLEdBQ2QsS0FBTSxJQUFJLE9BQU0sOENBTXBCLElBSkksRUFBTSxRQUFVLEdBQVcsR0FJcEIsSUFBUCxHQUFvQixRQUFQLEVBQ2IsS0FBTSxNQUFLLE1BQU0sZ0JBQWlCLHlCQUMvQixJQUFxQixnQkFBVixHQUNkLEtBQU0sSUFBSSxPQUFNLDBDQU1wQixJQUpJLEVBQU0sSUFBTSxHQUFPLEdBSVQsSUFBVixHQUEwQixRQUFWLEVBQ2hCLEtBQU0sTUFBSyxNQUFNLGdCQUFpQix3Q0FDUCxpQkFBYixHQUNkLEVBQU0sT0FBUyxLQUFLLE1BQU0sR0FFMUIsRUFBTSxPQUFTLEVBSW5CLEVBQU0sU0FFTixFQUFNLGdCQUVOLEVBQU0sY0F4RlYsR0FBSSxTQUFVLFFBQVEsaUJBQ2xCLEtBQU8sUUFBUSxXQUNmLGNBQWdCLFFBQVEsbUJBQ3hCLE9BQVMsUUFBUSxlQWtHckIsVUFBUyxVQUFVLFdBQWEsV0FDNUIsTUFBTyxNQUFLLFNBV2hCLFNBQVMsVUFB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LEdBSXRCLFFBQVMsU0FBUSxFQUFLLEdBQ3JCLEdBQVksU0FBUixFQUNILElBQUssR0FBSSxHQUFJLEVBQUcsRUFBSSxFQUFJLE9BQVMsSUFDaEMsR0FBSSxFQUFJLEdBQUcsS0FBSyxRQUFVLEVBQ3pCLE1BQU8sR0FBSSxHQUFHLEtBQUssTUFNdkIsT0FBTyxTQUVMLFFBQVMsUUFDVCxLQUFNLEtBQ04sTUFBTyxNQUNQLFNBQVUsU0FDVixRQUFTLFFBQ1YsUUFBUyIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCIndXNlIHN0cmljdCc7XG5cbnZhciBQcm9jZXNzID0gcmVxdWlyZSgnLi9saWIvcHJvY2VzcycpO1xudmFyIHV0aWwgPSByZXF1aXJlKCd1dGlsaXR5Jyk7XG52YXIgdXNlckludGVyZmFjZSA9IHJlcXVpcmUoJy4vbGliL2ludGVyZmFjZScpO1xudmFyIGhlbHBlciA9IHJlcXVpcmUoJy4vbGliL2hlbHBlcicpO1xuXG5cbi8qZ2xvYmFscyAqL1xuXG4vKipcbiAqIEEgbmV3IFdvcmtmbG93IGNvbnN0cnVjdG9yIGluc3RhbmNlIGNvbnRhaW5zIHRoZSByZWZlcmVuY2UgdG8gdGhlIGFwcGxpY2F0aW9uXG4gKiBhbmQgYXNzb2NpYXRlZCBwcm9maWxlIHdoaWNoIGl0IHJlcXVpcmVzIGFzIHRoZSBmaXJzdCB0d28gcGFyYW1ldGVycy4gSXQgYWxzb1xuICogcmVxdWlyZXMgYSB3b3JrZmxvdyBjb25maWd1cmF0aW9uLCBhcyB0aGUgdGhpcmQgcGFyYW1ldGVyLCB3aGljaCBpcyB1c2VkIHRvXG4gKiBkZXNjaWJlIHRoZSB3b3JrZmxvdyBwcm9jZXNzZXMuIElmIGEgd29ya2Zsb3cgaW5zdGFuY2UgZXhpc3RzIHlvdSBjYW4gcGFzcyBpdFxuICogaW4gYXMgdGhlIGZvdXJ0aCBwYXJhbWV0ZXIgd2hpY2ggaXQgd2lsbCB0aGVuIHVzZSwgZWxzZSBjcmVhdGUgYSBuZXcgb25lLlxuICpcbiAqIEBjb25zdHJ1Y3RvclxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBwcm9maWxlIC0gVGhlIGN1cnJlbnQgcHJvZmlsZSBpZFxuICogQHBhcmFtIHtzdHJpbmd9IGFwcCAtIFRoZSBhc3NvY2lhdGVkIGFwcGxpY2F0aW9uIGlkXG4gKiBAcGFyYW0ge09iamVjdH0gY29uZmlnIC0gVGhlIGFwcGxpY2F0aW9uIHdvcmtmbG93IGNvbmZpZ3VyYXRpb24gLyBkZWZpbml0aW9uXG4gKiBAcGFyYW0ge09iamVjdH0gW2luc3RhbmNlXSAtIEFuIGV4aXN0aW5nIGFwcGxpY2F0aW9uIHByb2ZpbGUgd29ya2Zsb3cgaW5zdGFuY2UgYmFzZWRcbiAqIG9uIHRoZSBkZWZpbml0aW9uXG4gKlxuICogQGF1dGhvciBCcmVudCBHb3Jkb25cbiAqIEB2ZXJzaW9uIDAuMS4wXG4gKlxuICogQGV4YW1wbGVcbiAqIHZhciBjb25maWcgPSB7ICdfaWQnOiAnYWJjMTIzJyB9O1xuXG4gKiB2YXIgaW5zdGFuY2UgPSB7ICdfaWQnOiAnaW5zdGFuY2VfYWJjMTIzJyB9O1xuXG4gKiAvLyBJZiB0aGVyZSBpc24ndCBhbiBleGlzdGluZyBpbnN0YW5jZVxuICogdmFyIHdvcmtmbG93ID0gbmV3IFdvcmtmbG93KCcxMjM0JywgJzU2NzgnLCBjb25maWcpO1xuICogLy8gSWYgdGhlcmUgaXMgYW4gZXhpc3RpbmcgaW5zdGFuY2VcbiAqIHZhciB3b3JrZmxvdyA9IG5ldyBXb3JrZmxvdygnMTIzNCcsICc1Njc4JywgY29uZmlnLCBpbnN0YW5jZSk7XG4gKlxuICogQHJldHVybiB7T2JqZWN0fSBuZXcgV29ya2Zsb3cgb2JqZWN0XG4gKlxuICogQHRocm93cyBFcnJvcjogQSBwcm9maWxlIGlkIGlzIHJlcXVpcmVkXG4gKiBAdGhyb3dzIEVycm9yOiBBbiBhcHAgaWQgaXMgcmVxdWlyZWRcbiAqIEB0aHJvd3MgRXJyb3I6IEEgd29ya2Zsb3cgY29uZmlndXJhdGlvbiBpcyByZXF1aXJlZFxuICpcbiAqL1xuXG5mdW5jdGlvbiBXb3JrZmxvdyhwcm9maWxlLCBjb21tdW5pdHlJZCwgYXBwLCBjb25maWcpIHtcbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgLy8gQ29tbXVuaXR5IElEIHZhbGlkYXRpb24gY2hlY2tzXG4gICAgaWYgKGNvbW11bml0eUlkID09ICcnIHx8IGNvbW11bml0eUlkID09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aHJvdyB1dGlsLmVycm9yKCdQYXJhbVJlcXVpcmVkJywgJ0EgY29tbXVuaXR5IGlkIGlzIHJlcXVpcmVkLicpO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIChjb21tdW5pdHlJZCkgIT09ICdzdHJpbmcnKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIGNvbW11bml0eSBpZCBtdXN0IGJlIGEgamF2YXNjcmlwdCBzdHJpbmcuJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgX3RoaXMuY29tbXVuaXR5SWQgPSBjb21tdW5pdHlJZCB8fCAnJztcbiAgICB9XG5cbiAgICAvLyBQcm9maWxlIElEIHZhbGlkYXRpb24gY2hlY2tzXG4gICAgaWYgKHByb2ZpbGUgPT0gJycgfHwgcHJvZmlsZSA9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGhyb3cgdXRpbC5lcnJvcignUGFyYW1SZXF1aXJlZCcsICdBIHByb2ZpbGUgaWQgaXMgcmVxdWlyZWQuJyk7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgKHByb2ZpbGUpICE9PSAnc3RyaW5nJykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBwcm9maWxlIGlkIG11c3QgYmUgYSBqYXZhc2NyaXB0IHN0cmluZy4nKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBfdGhpcy5wcm9maWxlID0gcHJvZmlsZSB8fCAnJztcbiAgICB9XG5cbiAgICAvLyBBcHAgSUQgdmFsaWRhdGlvbiBjaGVja3NcbiAgICBpZiAoYXBwID09ICcnIHx8IGFwcCA9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGhyb3cgdXRpbC5lcnJvcignUGFyYW1SZXF1aXJlZCcsICdBbiBhcHAgaWQgaXMgcmVxdWlyZWQuJyk7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgKGFwcCkgIT09ICdzdHJpbmcnKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIGFwcCBpZCBtdXN0IGJlIGEgamF2YXNjcmlwdCBzdHJpbmcuJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgX3RoaXMuYXBwID0gYXBwIHx8ICcnO1xuICAgIH1cblxuICAgIC8vIFdvcmtmbG93IGNvbmZpZ3VyYXRpb24gdmFsaWRhdGlvbiBjaGVja3NcbiAgICBpZiAoY29uZmlnID09ICcnIHx8IGNvbmZpZyA9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGhyb3cgdXRpbC5lcnJvcignUGFyYW1SZXF1aXJlZCcsICdBIHdvcmtmbG93IGNvbmZpZ3VyYXRpb24gaXMgcmVxdWlyZWQuJyk7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgKGNvbmZpZykgIT09ICdvYmplY3QnKSB7XG4gICAgICAgIF90aGlzLmNvbmZpZyA9IEpTT04ucGFyc2UoY29uZmlnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBfdGhpcy5jb25maWcgPSBjb25maWc7XG4gICAgfVxuXG4gICAgLy8gV29ya2Zsb3cgaW5zdGFuY2UgdmFsaWRhdGlvbiBjaGVja3NcbiAgICBfdGhpcy5pbnN0YW5jZTtcbiAgICAvLyBXb3JrZmxvdyBzdWItcHJvY2Vzc2VzIHZhbGlkYXRpb24gY2hlY2tzXG4gICAgX3RoaXMuc3VicHJvY2Vzc2VzID0gW107XG4gICAgLy8gV29ya2Zsb3cgaW5kaWNhdG9ycyBwbGFjZSBob2xkZXJcbiAgICBfdGhpcy5pbmRpY2F0b3JzID0gW107XG4gICAgXG5cbn1cblxuLyoqXG4gKiBXb3JrZmxvdyBnZXQgcHJvZmlsZSBpZC5cbiAqXG4gKiBAZXhhbXBsZSBcIlwiXG4gKlxuICogQHJldHVybiBcIlwiXG4gKlxuICovXG5Xb3JrZmxvdy5wcm90b3R5cGUuZ2V0UHJvZmlsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5wcm9maWxlO1xufTtcblxuLyoqXG4gKiBXb3JrZmxvdyBnZXQgYXBwIGlkLlxuICpcbiAqIEBleGFtcGxlIFwiXCJcbiAqXG4gKiBAcmV0dXJuIFwiXCJcbiAqXG4gKi9cbldvcmtmbG93LnByb3RvdHlwZS5nZXRBcHAgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuYXBwO1xufTtcblxuLyoqXG4gKiBXb3JrZmxvdyBnZXQgY29uZmlnLlxuICpcbiAqIEBleGFtcGxlIFwiXCJcbiAqXG4gKiBAcmV0dXJuIFwiXCJcbiAqXG4gKi9cbldvcmtmbG93LnByb3RvdHlwZS5nZXRDb25maWcgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuY29uZmlnO1xufTtcblxuLyoqXG4gKiBXb3JrZmxvdyBnZXQgaW5zdGFuY2UuXG4gKlxuICogQGV4YW1wbGUgXCJcIlxuICpcbiAqIEByZXR1cm4gXCJcIlxuICpcbiAqL1xuXG5Xb3JrZmxvdy5wcm90b3R5cGUuZ2V0SW5zdGFuY2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuaW5zdGFuY2U7XG59O1xuXG4vKipcbiAqIFdvcmtmbG93IHNldCB0aGUgaW5zdGFuY2UgZGF0YS5cbiAqXG4gKiBAcGFyYW0ge09iamVjdH0gZGF0YSAtIHRoZSB3b3JrZmxvdyBwcm9jZXNzIGluc3RhbmNlIGRhdGFcbiAqXG4gKiBAZXhhbXBsZSBcIlwiXG4gKlxuICogQHJldHVybiBcIlwiXG4gKlxuICovXG5Xb3JrZmxvdy5wcm90b3R5cGUuc2V0SW5zdGFuY2UgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgIHRoaXMuaW5zdGFuY2UgPSBkYXRhO1xufTtcblxuLyoqXG4gKiBXb3JrZmxvdyBnZXQgc3ViLXByb2Nlc3NlcyBkYXRhLlxuICpcbiAqIEBleGFtcGxlIFwiXCJcbiAqXG4gKiBAcmV0dXJuIFwiXCJcbiAqXG4gKi9cbldvcmtmbG93LnByb3RvdHlwZS5nZXRTdWJQcm9jZXNzZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuc3VicHJvY2Vzc2VzO1xufTtcblxuLyoqXG4gKiBXb3JrZmxvdyBzZXQgdGhlIHN1Yi1wcm9jZXNzZXMgZGF0YS5cbiAqXG4gKiBAcGFyYW0ge09iamVjdH0gZGF0YSAtIHRoZSB3b3JrZmxvdyBwcm9jZXNzIGluc3RhbmNlIGRhdGFcbiAqXG4gKiBAZXhhbXBsZSBcIlwiXG4gKlxuICogQHJldHVybiBcIlwiXG4gKlxuICovXG5Xb3JrZmxvdy5wcm90b3R5cGUuc2V0U3ViUHJvY2Vzc2VzID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICB0aGlzLnN1YnByb2Nlc3NlcyA9IGRhdGE7XG59O1xuXG4vKipcbiAqIFdvcmtmbG93IGdldCBpbmRpY2F0b3Igc2V0IGRhdGEuXG4gKlxuICogQGV4YW1wbGUgXCJcIlxuICpcbiAqIEByZXR1cm4gXCJcIlxuICpcbiAqL1xuV29ya2Zsb3cucHJvdG90eXBlLmdldEluZGljYXRvcnMgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuaW5kaWNhdG9ycztcbn07XG5cbi8qKlxuICogV29ya2Zsb3cgc2V0IHRoZSBpbmRpY2F0b3Igc2V0IGRhdGEuXG4gKlxuICogQHBhcmFtIHtPYmplY3R9IGRhdGEgLSB0aGUgd29ya2Zsb3cgcHJvY2VzcyBpbnN0YW5jZSBkYXRhXG4gKlxuICogQGV4YW1wbGUgXCJcIlxuICpcbiAqIEByZXR1cm4gXCJcIlxuICpcbiAqL1xuV29ya2Zsb3cucHJvdG90eXBlLnNldEluZGljYXRvcnMgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgIHRoaXMuaW5kaWNhdG9ycyA9IGRhdGE7XG59O1xuXG4vKipcbiAqIFNldCB0aGUgdmFyaWFibGUgdmFsdWUuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHByb2Nlc3NJZCAtIHRoZSBXb3JrZmxvdyBjb25maWcgLyBkZWZpbml0aW9uIHByb2Nlc3MgaWRcbiAqIEBwYXJhbSB7bnVtYmVyfSBwcm9jZXNzU2VxIC0gdGhlIFdvcmtmbG93IGluc3RhbmNlIHByb2Nlc3Mgc2VxXG4gKiBAcGFyYW0ge3N0cmluZ30gc3ViUHJvY2Vzc0lkIC0gdGhlIFdvcmtmbG93IGNvbmZpZyAvIGRlZmluaXRpb24gc3ViLXByb2Nlc3MgaWRcbiAqIEBwYXJhbSB7bnVtYmVyfSBzdWJQcm9jZXNzU2VxIC0gdGhlIFdvcmtmbG93IGluc3RhbmNlIHN1Yi1wcm9jZXNzIHNlcVxuICogQHBhcmFtIHtzdHJpbmd9IHN0ZXBJZCAtIHRoZSBXb3JrZmxvdyBjb25maWcgLyBkZWZpbml0aW9uIHN0ZXAgaWRcbiAqIEBwYXJhbSB7T2JqZWN0fSB2YXJpYWJsZSAtIHRoZSBXb3JrZmxvdyB2YXJpYWJsZSBvYmplY3RcbiAqXG4gKiBAZXhhbXBsZSAnJ1xuICpcbiAqIEByZXR1cm4gJydcbiAqXG4gKi9cbi8vIFdvcmtmbG93LnByb3RvdHlwZS5zZXRWYXJpYWJsZSA9IGZ1bmN0aW9uKHByb2Nlc3NJZCwgcHJvY2Vzc1NlcSwgc3ViUHJvY2Vzc0lkLCBzdWJQcm9jZXNzU2VxLCBzdGVwSWQsIHZhcmlhYmxlKXtcbi8vIFx0dmFyIF90aGlzID0gdGhpcztcbi8vIFx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuLy8gXHRcdHRyeSB7XG4vLyBcdFx0XHRQcm9jZXNzLmdldFZhcmlhYmxlKHByb2Nlc3NJZCwgcHJvY2Vzc1NlcSwgc3ViUHJvY2Vzc0lkLCBzdWJQcm9jZXNzU2VxLCBzdGVwSWQsIHZhcmlhYmxlKS50aGVuKGZ1bmNpb24ocmVzdWx0KXtcbi8vIFx0XHRcdFx0cmVzb2x2ZShyZXN1bHQuZGF0YSk7XG4vLyBcdFx0XHR9LCBmdW5jdGlvbihlcnIpe1xuLy8gXHRcdFx0XHRyZWplY3QoZXJyKTtcbi8vIFx0XHRcdH0pXG4vLyBcdFx0fSBjYXRjaCAoZXJyKSB7XG4vLyBcdFx0XHRyZWplY3QoZXJyKTtcbi8vIFx0XHR9XG5cbi8vIFx0fSk7XG4vLyB9O1xuXG4vKipcbiAqIEdldCB0aGUgdmFyaWFibGUgdmFsdWUuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHByb2Nlc3NJZCAtIHRoZSBXb3JrZmxvdyBjb25maWcgLyBkZWZpbml0aW9uIHByb2Nlc3MgaWRcbiAqIEBwYXJhbSB7bnVtYmVyfSBwcm9jZXNzU2VxIC0gdGhlIFdvcmtmbG93IGluc3RhbmNlIHByb2Nlc3Mgc2VxXG4gKiBAcGFyYW0ge3N0cmluZ30gc3ViUHJvY2Vzc0lkIC0gdGhlIFdvcmtmbG93IGNvbmZpZyAvIGRlZmluaXRpb24gc3ViLXByb2Nlc3MgaWRcbiAqIEBwYXJhbSB7bnVtYmVyfSBzdWJQcm9jZXNzU2VxIC0gdGhlIFdvcmtmbG93IGluc3RhbmNlIHN1Yi1wcm9jZXNzIHNlcVxuICogQHBhcmFtIHtzdHJpbmd9IHN0ZXBJZCAtIHRoZSBXb3JrZmxvdyBjb25maWcgLyBkZWZpbml0aW9uIHN0ZXAgaWRcbiAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgLSB0aGUgV29ya2Zsb3cgdmFyaWFibGUgaWRcbiAqXG4gKiBAZXhhbXBsZSAnJ1xuICpcbiAqIEByZXR1cm4gJydcbiAqXG4gKi9cbi8vIFdvcmtmbG93LnByb3RvdHlwZS5nZXRWYXJpYWJsZSA9IGZ1bmN0aW9uKHByb2Nlc3NJZCwgcHJvY2Vzc1NlcSwgc3ViUHJvY2Vzc0lkLCBzdWJQcm9jZXNzU2VxLCBzdGVwSWQsIGtleSl7XG4vLyBcdHZhciBfdGhpcyA9IHRoaXM7XG4vLyBcdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbi8vIFx0XHR0cnkge1xuLy8gXHRcdFx0UHJvY2Vzcy5zZXRWYXJpYWJsZShwcm9jZXNzSWQsIHByb2Nlc3NTZXEsIHN1YlByb2Nlc3NJZCwgc3ViUHJvY2Vzc1NlcSwgc3RlcElkLCBrZXkpLnRoZW4oZnVuY2lvbihyZXN1bHQpe1xuLy8gXHRcdFx0XHRyZXNvbHZlKHJlc3VsdC5kYXRhKTtcbi8vIFx0XHRcdH0sIGZ1bmN0aW9uKGVycil7XG4vLyBcdFx0XHRcdHJlamVjdChlcnIpO1xuLy8gXHRcdFx0fSlcbi8vIFx0XHR9IGNhdGNoIChlcnIpIHtcbi8vIFx0XHRcdHJlamVjdChlcnIpO1xuLy8gXHRcdH1cblxuLy8gXHR9KTtcbi8vIH07XG5cbi8qKlxuICogVGhpcyBtZXRob2QgY3JlYXRlcyBhIG5ldyB3b3JrZmxvdyBwcm9jZXNzIGkuZS4gaXQgY3JlYXRlcyBhIHdvcmtmbG93IHByb2Nlc3NlcyBpbnN0YW5jZVxuICogb2JqZWN0IHdpdGggdGhlIG1pbmltdW0gcmVxdWlyZWQgZGF0YS4gVGhpcyBpbnN0YW5jZSBjYW4gYmUgcmVmZXJlbmNlZCBpbiB0aGUgZm9sbG93aW5nXG4gKiB3YXksIHNlZSBleGFtcGxlIGJlbG93LlxuICpcbiAqIEBleGFtcGxlXG4gKiB2YXIgY29uZmlnID0geyAnX2lkJzogJ2FiYzEyMycgfTtcblxuICogdmFyIHdvcmtmbG93ID0gbmV3IFdvcmtmbG93KCcxMjM0JywgJzU2NzgnLCBjb25maWcpO1xuICogd29ya2Zsb3cuY3JlYXRlKCkudGhlbihmdW5jdGlvbihyZXN1bHQpe1xuICpcdGNvbnNvbGUubG9nKHJlc3VsdC5tZXNzYWdlKTtcbiAqXHQvLyBUaGUgZm9sbG93aW5nIHByb3BlcnRpZXMgY2FuIG5vdyBiZSBhY2Nlc3NlZFxuICogXHR2YXIgcHJvZmlsZSA9IHdvcmtmbG93LnByb2ZpbGU7XG4gKiBcdHZhciBhcHAgPSB3b3JrZmxvdy5hcHA7XG4gKiBcdHZhciBjb25maWcgPSB3b3JrZmxvdy5jb25maWc7XG4gKlx0Ly8gT24gc3VjY2VzcyB5b3UgY2FuIGFjY2VzcyB0aGUgaW5zdGFuY2UgdGhlIGZvbGxvd2luZyB3YXlcbiAqXHR2YXIgaW5zdGFuY2UgPSB3b3JrZmxvdy5pbnN0YW5jZTtcbiAqIH0sIGZ1bmN0aW9uKGVycm9yKXtcbiAqXHRjb25zb2xlLmxvZyhlcnJvcik7XG4gKiB9KTtcbiAqXG4gKiBAcmV0dXJuIHtPYmplY3R9IG5ldyBXb3JrZmxvdyBpbnN0YW5jZSB3aXRoIHVwZGF0ZWQgaW5zdGFuY2UgZGF0YS5cbiAqXG4gKi9cblxuV29ya2Zsb3cucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBpZiAoX3RoaXMuaW5zdGFuY2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHZhciB3YXJuID0gdXRpbC53YXJuKCdJbnN0YW5jZSBhbHJlYWR5IGV4aXN0cy4nLCBfdGhpcylcbiAgICAgICAgICAgICAgICByZXNvbHZlKHdhcm4pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBDcmVhdGUgdGhlIHdvcmtmbG93IHByb2Nlc3NlcyBpbnN0YW5jZSBvYmplY3RcbiAgICAgICAgICAgICAgICB2YXIgbW9kZWwgPSB7XG4gICAgICAgICAgICAgICAgICAgIF9pZDogJycsXG4gICAgICAgICAgICAgICAgICAgIHZlcnNpb246ICcnLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnd29ya2Zsb3dJbnN0YW5jZScsXG4gICAgICAgICAgICAgICAgICAgIHByb2Nlc3NlczogW10sXG4gICAgICAgICAgICAgICAgICAgIGNoYW5uZWxzOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICBcImNvbW11bml0eV9cIiArIGFwcC5TQ09QRS5nZXRDb21tdW5pdHlJZCgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJwcm9maWxlX1wiICsgYXBwLlNDT1BFLnByb2ZpbGVJZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiYXBwbGljYXRpb25fXCIgKyBhcHAuU0NPUEUuYXBwbGljYXRpb25JZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiY29tbXVuaXR5X1wiICsgYXBwLlNDT1BFLmdldENvbW11bml0eUlkKCkgKyBcIl9hcHBsaWNhdGlvbl9cIiArIGFwcC5TQ09QRS5hcHBsaWNhdGlvbklkXG4gICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgbW9kZWwuX2lkID0gX3RoaXMucHJvZmlsZSArICc6cHJvY2Vzc2VzJztcbiAgICAgICAgICAgICAgICBtb2RlbC52ZXJzaW9uID0gX3RoaXMuY29uZmlnLnZlcnNpb247XG4gICAgICAgICAgICAgICAgX3RoaXMuaW5zdGFuY2UgPSBtb2RlbDtcbiAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnV29ya2Zsb3cgcHJvY2Vzc2VzIGluc3RhbmNlIGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5LicsIF90aGlzKTtcbiAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgfVxuXG4gICAgfSk7XG59O1xuXG4vKipcbiAqIFdvcmtmbG93IGluaXRpYWxpc2UsIHRoaXMgZnVuY3Rpb24gZXhlY3V0ZXMgYSBwcm9jZXNzIHdpdGhpbiBhIHdvcmtmbG93XG4gKiBjb25maWd1cmF0aW9uLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBwcm9jZXNzSWQgLSB0aGUgcHJvY2VzcyBpZCB0byBwcm9jZXNzXG4gKiBAcGFyYW0ge29iamVjdH0gW2RhdGFdIC0gdGhlIGlucHV0IGRhdGEgdG8gcHJvY2Vzc1xuICpcbiAqIEBleGFtcGxlXG4gKiBXb3JrZmxvdy5pbml0aWFsaXNlKCdwcm9jZXNzSWQnLCB7IHZhbGlkRGF0ZTogJ2RhdGUnIH0pO1xuICpcbiAqIEByZXR1cm4gXCJcIlxuICpcbiAqL1xuV29ya2Zsb3cucHJvdG90eXBlLmluaXRpYWxpc2UgPSBmdW5jdGlvbiAocHJvY2Vzc0lkLCBkYXRhLCBzdWJwcm9maWxlSWQpIHtcbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICB2YXIgY29uZmlnUHJvY2VzcyA9IFtdO1xuICAgICAgICAgICAgLy8gQ2hlY2sgdGhlIHBhc3NlZCBpbiBwYXJhbWV0ZXJzXG4gICAgICAgICAgICBpZiAocHJvY2Vzc0lkICE9PSAnJyAmJiBwcm9jZXNzSWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIC8vIEdldCB0aGUgY3VycmVudCBwcm9jZXNzIGNvbmZpZ1xuICAgICAgICAgICAgICAgIGNvbmZpZ1Byb2Nlc3MgPSBfdGhpcy5jb25maWcucHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbiAob2JqUHJvY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICBpZiAob2JqUHJvY2Vzcy5faWQgPT0gcHJvY2Vzc0lkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqUHJvY2VzcztcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgaWYgKGNvbmZpZ1Byb2Nlc3NbMF0uX2lkID09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3IgPSB1dGlsLmVycm9yKCdXRkNvbmZpZ0Vycm9yJywgJ05vIHZhbGlkIHByb2Nlc3MgZGVmaW5pdGlvbiBmb3VuZCB3aXRoIHByb2Nlc3MgaWQ6ICcgKyBwcm9jZXNzSWQpO1xuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25maWdQcm9jZXNzLnB1c2goX3RoaXMuY29uZmlnLnByb2Nlc3Nlc1swXSk7XG4gICAgICAgICAgICAgICAgcHJvY2Vzc0lkID0gX3RoaXMuY29uZmlnLnByb2Nlc3Nlc1swXS5faWQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIEdldCB0aGUgY3VycmVudCBsaXN0IG9mIHByb2Nlc3MgaW5zdGFuY2VzXG4gICAgICAgICAgICAvLyB2YXIgcHJvY2Vzc1NlcSA9IDE7XG4gICAgICAgICAgICB2YXIgY3VycmVudFByb2Nlc3MgPSBbXTtcbiAgICAgICAgICAgIF90aGlzLmluc3RhbmNlLnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24gKHByb2Nlc3NJdGVtKSB7XG4gICAgICAgICAgICAgICAgaWYgKHByb2Nlc3NJdGVtLmlkID09IHByb2Nlc3NJZCkge1xuICAgICAgICAgICAgICAgICAgICBjdXJyZW50UHJvY2Vzcy5wdXNoKHByb2Nlc3NJdGVtKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdmFyIHByb2Nlc3NTZXEgPSBjdXJyZW50UHJvY2Vzcy5sZW5ndGggKyAxO1xuICAgICAgICAgICAgLy8gdmFyIG5leHRTZXEgPSBwcm9jZXNzU2VxICsgMTtcbiAgICAgICAgICAgIC8vIFB1c2ggdGhlIHByb2Nlc3Mgb2JqZWN0IGludG8gdGhlIGFycmF5XG4gICAgICAgICAgICB2YXIgcHJvY2Vzc01vZGVsID0ge1xuICAgICAgICAgICAgICAgIGlkOiAnJyxcbiAgICAgICAgICAgICAgICBzZXE6ICcnLFxuICAgICAgICAgICAgICAgIHN1YlByb2Nlc3NlczogW11cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gMS4gVXBkYXRlIHRoZSBwcm9jZXNzIGlkIGFuZCBzZXFcbiAgICAgICAgICAgIHByb2Nlc3NNb2RlbC5pZCA9IHByb2Nlc3NJZDtcbiAgICAgICAgICAgIHByb2Nlc3NNb2RlbC5zZXEgPSBwcm9jZXNzU2VxO1xuICAgICAgICAgICAgX3RoaXMuaW5zdGFuY2UucHJvY2Vzc2VzLnB1c2gocHJvY2Vzc01vZGVsKTtcbiAgICAgICAgICAgIC8vIFBhcmFtZXRlcnNcbiAgICAgICAgICAgIHZhciBzdWJQcm9jZXNzSWQgPSBjb25maWdQcm9jZXNzWzBdLnN1YlByb2Nlc3Nlc1swXS5faWQ7XG4gICAgICAgICAgICB2YXIgc3ViUHJvY2Vzc1NlcSA9IDE7XG4gICAgICAgICAgICBfdGhpcy5pbnN0YW5jZS5wcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uIChwcm9jZXNzSXRlbSkge1xuICAgICAgICAgICAgICAgIGlmIChwcm9jZXNzSXRlbS5pZCA9PSBwcm9jZXNzSWQgJiYgcHJvY2Vzc0l0ZW0uc2VxID09IHByb2Nlc3NTZXEpIHtcbiAgICAgICAgICAgICAgICAgICAgc3ViUHJvY2Vzc1NlcSA9IHByb2Nlc3NJdGVtLnN1YlByb2Nlc3Nlcy5sZW5ndGggKyAxXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLy8gQ2FsbCB0aGUgc3VicHJvY2VzcyBtZXRob2RcblxuICAgICAgICAgICAgUHJvY2Vzcy5zdWJQcm9jZXNzKHByb2Nlc3NJZCwgcHJvY2Vzc1NlcSwgc3ViUHJvY2Vzc0lkLCBzdWJQcm9jZXNzU2VxLCBkYXRhLCBfdGhpcykudGhlbihmdW5jdGlvbiAoc3ViUHJvY2Vzcykge1xuICAgICAgICAgICAgICAgIC8vIEdlbmVyYXRlIHRoZSB1dWlkXG5cbiAgICAgICAgICAgICAgICB2YXIgdXVpZCA9IHN1YlByb2Nlc3MuZGF0YS5faWQ7IC8vX3RoaXMucHJvZmlsZSArICc6JyArIF90aGlzLmFwcCArICc6JyArIHByb2Nlc3NJZCArICc6JyArIHByb2Nlc3NTZXEgKyAnOicgKyBzdWJQcm9jZXNzSWQgKyAnOicgKyBzdWJQcm9jZXNzU2VxO1xuICAgICAgICAgICAgICAgIHZhciBsYWJlbCA9IGRhdGEubGFiZWw7XG4gICAgICAgICAgICAgICAgLy8gQnVpbGQgdGhlIHN1Yi1wcm9jZXNzIHJlZmVyZW5jZSBvYmplY3RcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvL1RPRE86IENoYW5nZSByZXF1aXJlZCB0byBtb3ZlIGlzQWN0aXZlIHRvIHN1YlByb2Nlc3MgZmlsZS5SZW1vdmUgZnJvbSBoZXJlXG4gICAgICAgICAgICAgICAgdmFyIHN1YlByb2Nlc3NSZWYgPSB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiBzdWJQcm9jZXNzSWQsXG4gICAgICAgICAgICAgICAgICAgIHN1YnByb2ZpbGVJZDogc3VicHJvZmlsZUlkLFxuICAgICAgICAgICAgICAgICAgICBzZXE6IHN1YlByb2Nlc3NTZXEsXG4gICAgICAgICAgICAgICAgICAgIHV1aWQ6IHV1aWQsXG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiBsYWJlbFxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIEFkZCB0aGUgcmVmZXJlbmNlIHRvIHRoZSBwcm9jZXNzIG1vZGVsXG4gICAgICAgICAgICAgICAgcHJvY2Vzc01vZGVsLnN1YlByb2Nlc3Nlcy5wdXNoKHN1YlByb2Nlc3NSZWYpO1xuICAgICAgICAgICAgICAgIC8vIEFkZCB0aGUgc3ViUHJvY2VzcyBtb2RlbCB0byB0aGUgc3VicHJvY2Vzc2VzIGFycmF5XG4gICAgICAgICAgICAgICAgLy9fdGhpcy5zdWJwcm9jZXNzZXMucHVzaChzdWJQcm9jZXNzLmRhdGEpO1xuICAgICAgICAgICAgICAgIC8vIF90aGlzLmluc3RhbmNlLnByb2Nlc3Nlcy5wdXNoKHByb2Nlc3NNb2RlbCk7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IF90aGlzLmluc3RhbmNlLnByb2Nlc3Nlcy5sZW5ndGg7IGluZGV4KyspIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHByb2Nlc3NJdGVtID0gX3RoaXMuaW5zdGFuY2UucHJvY2Vzc2VzW2luZGV4XTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHByb2Nlc3NJdGVtLmlkID09IHByb2Nlc3NJZCAmJiBwcm9jZXNzSXRlbS5zZXEgPT0gcHJvY2Vzc1NlcSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIHRoZSBjdXJyZW50IHByb2Nlc3MgZnJvbSB0aGUgYXJyYXkgYW5kIGFkZCB0aGUgdXBkYXRlZCBwcm9jZXNzTW9kZWxcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmluc3RhbmNlLnByb2Nlc3Nlcy5zcGxpY2UoaW5kZXgsIDEsIHByb2Nlc3NNb2RlbClcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gUHJvY2VzcyB0aGUgaW5kaWNhdG9yIGRvY3VtZW50cyB3b3JrZmxvdyBwcm9jZXNzZXMgdXBkYXRlc1xuICAgICAgICAgICAgICAgIHZhciBpbmRpY2F0b3JzID0gc3ViUHJvY2Vzcy5kYXRhLmluZGljYXRvcnM7XG4gICAgICAgICAgICAgICAgdmFyIHN0ZXAgPSBzdWJQcm9jZXNzLmRhdGEuc3RlcDtcbiAgICAgICAgICAgICAgICBQcm9jZXNzLmluZGljYXRvckRvY3MocHJvY2Vzc0lkLCBpbmRpY2F0b3JzLCBzdGVwLCBfdGhpcykudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdQcm9jZXNzOiAnICsgX3RoaXMuY29uZmlnLnByb2Nlc3Nlc1swXS5faWQgKyAnIGluaXRpYWxpemVkIHN1Y2Nlc3NmdWxseS4nLCBzdWJQcm9jZXNzUmVmKTtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuaW5zdGFuY2UucHJvY2Vzc2VzID0gX3RoaXMuaW5zdGFuY2UucHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbiAob2JqKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAhKG9iai5pZCA9PSBwcm9jZXNzSWQgJiYgb2JqLnNlcSA9PSBwcm9jZXNzU2VxKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgIH1cblxuICAgIH0pO1xufTtcblxuLyoqXG4gKiBXb3JrZmxvdyB0cmFuc2l0aW9uIHRvIHRoZSBuZXh0IHN0ZXAuIFRoaXMgbW92ZXMgdGhlIHdvcmtmbG93IGZyb20gdGhlIGN1cnJlbnQgcHJvY2VzcyxcbiAqIHN1Yi1wcm9jZXNzIHN0ZXAgdG8gdGhlIG5leHQgb25lIGFzIHNwZWNpZmllZC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gcHJvY2Vzc0lkIC0gdGhlIFdvcmtmbG93IGNvbmZpZyAvIGRlZmluaXRpb24gcHJvY2VzcyBpZFxuICogQHBhcmFtIHtudW1iZXJ9IHByb2Nlc3NTZXEgLSB0aGUgV29ya2Zsb3cgaW5zdGFuY2UgcHJvY2VzcyBzZXFcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdWJQcm9jZXNzSWQgLSB0aGUgV29ya2Zsb3cgY29uZmlnIC8gZGVmaW5pdGlvbiBzdWItcHJvY2VzcyBpZFxuICogQHBhcmFtIHtudW1iZXJ9IHN1YlByb2Nlc3NTZXEgLSB0aGUgV29ya2Zsb3cgaW5zdGFuY2Ugc3ViLXByb2Nlc3Mgc2VxXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RlcElkIC0gdGhlIFdvcmtmbG93IGNvbmZpZyAvIGRlZmluaXRpb24gc3RlcCBpZCBcbiAqIEBwYXJhbSB7c3RyaW5nfSB0cmFuc2l0aW9uSWQgLSB0aGUgV29ya2Zsb3cgY29uZmlnIC8gZGVmaW5pdGlvbiB0cmFuc2l0aW9uIGlkXG4gKiBAcGFyYW0ge29iamVjdH0gZGF0YSAtIGFueSBhZGRpdGlvbmFsIGRhdGEgcGFzc2VkIGluIGFzIGtleSB2YWx1ZSBwYWlyc1xuICpcbiAqIEBleGFtcGxlXG4gKiBXb3JrZmxvdy50cmFuc2l0aW9uKCdwcm9jZXNzSWQnLCAxLCAnc3ViUHJvY2Vzc0lkJywgMSwgJ3N0ZXBJZCcsICd0cmFuc2l0aW9uSWQnLCB7IGtleTogJycsIHZhbHVlOiAnJyB9KTtcbiAqXG4gKiBAcmV0dXJuIFwiXCJcbiAqXG4gKi9cbldvcmtmbG93LnByb3RvdHlwZS50cmFuc2l0aW9uID0gZnVuY3Rpb24gKHByb2Nlc3NJZCwgcHJvY2Vzc1NlcSwgc3ViUHJvY2Vzc0lkLCBzdWJQcm9jZXNzU2VxLCBzdGVwSWQsIHRyYW5zaXRpb25JZCwgZGF0YSwgc3B1dWlkKSB7XG4gICAgLy8gUmUtYXNzaWduIHRoaXNcbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICB2YXIgbW9kZWwgPSBKU09OLnhwYXRoKFwiL3N1YnByb2Nlc3Nlc1tfaWQgZXEgJ1wiICsgc3B1dWlkICsgXCInXS9zdGVwL2RhdGFcIiwgYXBwLlNDT1BFLndvcmtmbG93LCB7fSlbMF07XG4gICAgICAgICAgICB2YXIgc3RlcE9iamVjdCA9IEpTT04ueHBhdGgoXCIvcHJvY2Vzc2VzW19pZCBlcSAnXCIgKyBwcm9jZXNzSWQgKyBcIiddL3N1YlByb2Nlc3Nlc1tfaWQgZXEgJ1wiICsgc3ViUHJvY2Vzc0lkICsgXCInXS9zdGVwc1tfaWQgZXEgJ1wiICsgc3RlcElkICsgXCInXVwiLCBfdGhpcy5jb25maWcsIHt9KVswXTtcblxuXG4gICAgICAgICAgICAvLyBVcGRhdGUgdGhlIGN1cnJlbnQgc3ViLXByb2Nlc3Mgc3RlcCBkYXRhXG4gICAgICAgICAgICB2YXIgdXBkYXRlID0gZnVuY3Rpb24gKHR5cGUsIHJlc3VsdCkge1xuICAgICAgICAgICAgICAgIF90aGlzLmluc3RhbmNlLnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24gKHByb2Nlc3NJdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChwcm9jZXNzSXRlbS5pZCA9PSBwcm9jZXNzSWQgJiYgcHJvY2Vzc0l0ZW0uc2VxID09IHByb2Nlc3NTZXEpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc0l0ZW0uc3ViUHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbiAoc3ViUHJvY2Vzc0l0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3ViUHJvY2Vzc0l0ZW0uaWQgPT0gc3ViUHJvY2Vzc0lkICYmIHN1YlByb2Nlc3NJdGVtLnNlcSA9PSBzdWJQcm9jZXNzU2VxKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuc3VicHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbiAoc3ViUHJvY2Vzc09iaikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN1YlByb2Nlc3NPYmouX2lkID09IHN1YlByb2Nlc3NJdGVtLnV1aWQpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlID09ICdzdGVwJykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1YlByb2Nlc3NPYmouc3RlcCA9IHJlc3VsdC5kYXRhLnN0ZXA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKHJlc3VsdC5tZXNzYWdlLCBzdWJQcm9jZXNzT2JqKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSAnc3RlcENvbXBsZXRlJykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1YlByb2Nlc3NPYmouc3RlcCA9IHJlc3VsdC5kYXRhLnN0ZXA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1YlByb2Nlc3NPYmouY29tcGxldGUgPSB0cnVlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKHJlc3VsdC5tZXNzYWdlLCBzdWJQcm9jZXNzT2JqLnN0ZXApO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9XG5cblxuICAgICAgICAgICAgaWYgKHN0ZXBPYmplY3QuZnVuY3Rpb24udGFzay5wb3N0QWN0aW9ucyAhPSB1bmRlZmluZWQpIHtcblxuXG4gICAgICAgICAgICAgICAgdmFyIHBvc3RBY3Rpb25zID0gc3RlcE9iamVjdC5mdW5jdGlvbi50YXNrLnBvc3RBY3Rpb25zO1xuICAgICAgICAgICAgICAgIFByb2Nlc3MucG9zdEFjdGlvbnMocG9zdEFjdGlvbnMsIF90aGlzKS50aGVuKGZ1bmN0aW9uIChzdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgXG5cblxuXG4gICAgICAgICAgICAgICAgICAgIFByb2Nlc3MudHJhbnNpdGlvbihwcm9jZXNzSWQsIHByb2Nlc3NTZXEsIHN1YlByb2Nlc3NJZCwgc3ViUHJvY2Vzc1NlcSwgc3RlcElkLCB0cmFuc2l0aW9uSWQsIGRhdGEsIF90aGlzLCBzcHV1aWQsIG1vZGVsKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5kYXRhLnN1YlByb2Nlc3NDb21wbGV0ZSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlKCdzdGVwQ29tcGxldGUnLCByZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZSgnc3RlcCcsIHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG5cbiAgICAgICAgICAgICAgICB9KTtcblxuXG4gICAgICAgICAgICB9IGVsc2Uge1xuXG5cbiAgICAgICAgICAgICAgICBQcm9jZXNzLnRyYW5zaXRpb24ocHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIHN0ZXBJZCwgdHJhbnNpdGlvbklkLCBkYXRhLCBfdGhpcywgc3B1dWlkLCBtb2RlbCkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5kYXRhLnN1YlByb2Nlc3NDb21wbGV0ZSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGUoJ3N0ZXBDb21wbGV0ZScsIHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZSgnc3RlcCcsIHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcblxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuXG4gICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgfVxuXG4gICAgfSk7XG59O1xuXG4vKipcbiAqIFdvcmtmbG93IGFzc2lnbiB1c2VyLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBwcm9jZXNzSWQgLSB0aGUgV29ya2Zsb3cgY29uZmlnIC8gZGVmaW5pdGlvbiBwcm9jZXNzIGlkXG4gKiBAcGFyYW0ge251bWJlcn0gcHJvY2Vzc1NlcSAtIHRoZSBXb3JrZmxvdyBpbnN0YW5jZSBwcm9jZXNzIHNlcVxuICogQHBhcmFtIHtzdHJpbmd9IHN1YlByb2Nlc3NJZCAtIHRoZSBXb3JrZmxvdyBjb25maWcgLyBkZWZpbml0aW9uIHN1Yi1wcm9jZXNzIGlkXG4gKiBAcGFyYW0ge251bWJlcn0gc3ViUHJvY2Vzc1NlcSAtIHRoZSBXb3JrZmxvdyBpbnN0YW5jZSBzdWItcHJvY2VzcyBzZXFcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdGVwSWQgLSB0aGUgV29ya2Zsb3cgY29uZmlnIC8gZGVmaW5pdGlvbiBzdGVwIGlkXG4gKiBAcGFyYW0ge29iamVjdH0gdXNlciAtIHRoZSB1c2VyIGlkIGFuZCBuYW1lIGRhdGFcbiAqXG4gKiBAZXhhbXBsZSBcIlwiXG4gKlxuICogQHJldHVybiBcIlwiXG4gKlxuICovXG5Xb3JrZmxvdy5wcm90b3R5cGUuYXNzaWduVXNlciA9IGZ1bmN0aW9uIChwcm9jZXNzSWQsIHByb2Nlc3NTZXEsIHN1YlByb2Nlc3NJZCwgc3ViUHJvY2Vzc1NlcSwgdXNlcikge1xuICAgIC8vIFJlLWFzc2lnbiB0aGUgV29ya2Zsb3cgY29uc3RydWN0b3IgaW5zdGFuY2UgYXMgX3RoaXNcbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBQcm9jZXNzLmFzc2lnblVzZXIocHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIHVzZXIsIF90aGlzKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICB9KVxuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICB9XG5cbiAgICB9KVxufTtcblxuLyoqXG4gKiBXb3JrZmxvdyB0YXNrLCB0aGlzIG1ldGhvZCBleGVjdXRlcyBhIHNwZWNpZmljIHRhc2suXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHByb2Nlc3NJZCAtIHRoZSBwcm9jZXNzIGlkIHRvIHByb2Nlc3NcbiAqIEBwYXJhbSB7b2JqZWN0fSBpbnB1dERhdGEgLSB0aGUgaW5wdXQgZGF0YSB0byBwcm9jZXNzXG4gKlxuICogQGV4YW1wbGVcbiAqIFdvcmtmbG93LmluaXRpYWxpemUoJ3Byb2Nlc3NJZCcsIHsgdmFsaWREYXRlOiAnZGF0ZScgfSk7XG4gKlxuICogQHJldHVybiBcIlwiXG4gKlxuICovXG5Xb3JrZmxvdy5wcm90b3R5cGUudWkgPSBmdW5jdGlvbiAoKSB7XG4gICAgLy8gUmUtYXNzaWduIHRoZSBXb3JrZmxvdyBjb25zdHJ1Y3RvciBpbnN0YW5jZSBhcyBfdGhpc1xuICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgZ2V0UHJvY2VzczogZnVuY3Rpb24gKHByb2Nlc3NJZCwgbGFuZykge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICB1c2VySW50ZXJmYWNlLmdldFByb2Nlc3MocHJvY2Vzc0lkLCBsYW5nLCBfdGhpcykudGhlbihmdW5jdGlvbiAobW9kZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUobW9kZWwpO1xuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG5cbiAgICB9XG5cbn07XG5cbi8qKlxuICogV29ya2Zsb3cgdGFzaywgdGhpcyBtZXRob2QgZXhlY3V0ZXMgYSBzcGVjaWZpYyB0YXNrLlxuICpcbiAqIEBwYXJhbSB7b2JqZWN0fSBkYXRhIC0gdGhlIHByb2Nlc3MgaWQgdG8gcHJvY2Vzc1xuICogQHBhcmFtIHtvYmplY3R9IF9XRkluc3RhbmNlIC0gdGhlIGlucHV0IGRhdGEgdG8gcHJvY2Vzc1xuICogKiBAcGFyYW0ge3N0cmluZ30gdXVpZCAtIHRoZSBpbnB1dCBkYXRhIHRvIHByb2Nlc3NcbiAqXG4gKiBAZXhhbXBsZVxuICogV29ya2Zsb3cuZ2V0Tm9kZVZhbHVlKGRhdGEsIF9XRkluc3RhbmNlLCB1dWlkKTtcbiAqXG4gKiBAcmV0dXJuIFwiXCJcbiAqXG4gKi9cblxuV29ya2Zsb3cucHJvdG90eXBlLmdldE5vZGVWYWx1ZSA9IGZ1bmN0aW9uIChkYXRhLCB1dWlkKSB7XG4gICAgLy8gUmUtYXNzaWduIHRoZSBXb3JrZmxvdyBjb25zdHJ1Y3RvciBpbnN0YW5jZSBhcyBfdGhpc1xuICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGhlbHBlci5nZXROb2RlVmFsdWUoZGF0YSwgX3RoaXMsIHV1aWQpLnRoZW4oZnVuY3Rpb24gKHJlcykge1xuICAgICAgICAgICAgICAgIHJlc29sdmUocmVzKTtcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICB9XG5cbiAgICB9KVxufTtcblxuLyoqXG4gKiBXb3JrZmxvdyB0YXNrLCB0aGlzIG1ldGhvZCBleGVjdXRlcyBhIHNwZWNpZmljIHRhc2suXG4gKlxuICogQHBhcmFtIHtvYmplY3R9IGRhdGEgLSB0aGUgcHJvY2VzcyBpZCB0byBwcm9jZXNzXG4gKiBAcGFyYW0ge29iamVjdH0gX1dGSW5zdGFuY2UgLSB0aGUgaW5wdXQgZGF0YSB0byBwcm9jZXNzXG4gKlxuICogQGV4YW1wbGVcbiAqIFdvcmtmbG93LnRha2VBc3NpZ25tZW50KHNwdXVpZCwgX1dGSW5zdGFuY2UpO1xuICpcbiAqIEByZXR1cm4gXCJcIlxuICpcbiAqL1xuXG5Xb3JrZmxvdy5wcm90b3R5cGUudGFrZUFzc2lnbm1lbnQgPSBmdW5jdGlvbiAoc3B1dWlkKSB7XG4gICAgLy8gUmUtYXNzaWduIHRoZSBXb3JrZmxvdyBjb25zdHJ1Y3RvciBpbnN0YW5jZSBhcyBfdGhpc1xuICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuXG4gICAgICAgIHRyeSB7XG5cbiAgICAgICAgICAgIC8vQXNzaWdubWVudCBhcmUgZXhlY3V0aW5nIGhlcmVcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgdmFyIHNwT2JqZWN0ID0gSlNPTi54cGF0aChcIi9zdWJwcm9jZXNzZXNbX2lkIGVxICdcIiArIHNwdXVpZCArIFwiJ11cIiwgX3RoaXMsIHt9KVswXTtcbiAgICAgICAgICAgIHZhciBhc3NpZ25lZSA9IEpTT04ueHBhdGgoXCIvc3RlcC9hc3NpZ25lZFRvXCIsIHNwT2JqZWN0LCB7fSlbMF07XG4gICAgICAgICAgICBhc3NpZ25lZS5uYW1lID0gTE9DQUxfU0VUVElOR1MuU1VCU0NSSVBUSU9OUy51c2VybmFtZSArIFwiXCI7XG4gICAgICAgICAgICBhc3NpZ25lZS51c2VySWQgPSBMT0NBTF9TRVRUSU5HUy5TVUJTQ1JJUFRJT05TLnVzZXJJZCArIFwiXCI7XG5cbiAgICAgICAgICAgIC8vZmV0Y2ggcHJlV29ya0FjdGlvbnMgaGVyZSBcblxuICAgICAgICAgICAgdmFyIHByb2Nlc3NJZCA9IEpTT04ueHBhdGgoXCIvaW5zdGFuY2UvcHJvY2Vzc2VzW3N1YlByb2Nlc3Nlcy91dWlkIGVxICdcIiArIHNwdXVpZCArIFwiJ10vaWRcIiwgX3RoaXMsIHt9KVswXTtcbiAgICAgICAgICAgIHZhciBzdWJQcm9jZXNzSWQgPSBKU09OLnhwYXRoKFwiL2luc3RhbmNlL3Byb2Nlc3Nlcy9zdWJQcm9jZXNzZXNbdXVpZCBlcSAnXCIgKyBzcHV1aWQgKyBcIiddL2lkXCIsIF90aGlzLCB7fSlbMF07XG4gICAgICAgICAgICB2YXIgc3RlcElkID0gSlNPTi54cGF0aChcIi9zdWJwcm9jZXNzZXNbX2lkIGVxICdcIiArIHNwdXVpZCArIFwiJ10vc3RlcC9pZFwiLCBfdGhpcywge30pWzBdO1xuICAgICAgICAgICAgdmFyIHN0ZXBPYmplY3QgPSBKU09OLnhwYXRoKFwiL3Byb2Nlc3Nlc1tfaWQgZXEgJ1wiICsgcHJvY2Vzc0lkICsgXCInXS9zdWJQcm9jZXNzZXNbX2lkIGVxICdcIiArIHN1YlByb2Nlc3NJZCArIFwiJ10vc3RlcHNbX2lkIGVxICdcIiArIHN0ZXBJZCArIFwiJ11cIiwgX3RoaXMuY29uZmlnLCB7fSlbMF07XG5cbiAgICAgICAgICAgIGlmIChzdGVwT2JqZWN0LmZ1bmN0aW9uLnRhc2sucHJlV29ya0FjdGlvbnMgIT0gdW5kZWZpbmVkKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgcHJlV29ya0FjdGlvbnMgPSBzdGVwT2JqZWN0LmZ1bmN0aW9uLnRhc2sucHJlV29ya0FjdGlvbnM7XG4gICAgICAgICAgICAgICAgUHJvY2Vzcy5wcmVXb3JrQWN0aW9ucyhwcmVXb3JrQWN0aW9ucywgX3RoaXMpLnRoZW4oZnVuY3Rpb24gKHN1Y2Nlc3MpIHtcblxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKF90aGlzKTtcblxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcblxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcblxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShfdGhpcyk7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9IGNhdGNoIChlcnIpIHtcblxuICAgICAgICAgICAgcmVqZWN0KGVycik7XG5cbiAgICAgICAgfVxuXG4gICAgfSk7XG59O1xuXG5cblxubW9kdWxlLmV4cG9ydHMgPSBXb3JrZmxvdzsiLCIndXNlIHN0cmljdCc7XG5cbnZhciB1dGlsID0gcmVxdWlyZSgndXRpbGl0eScpO1xudmFyIG5vZGVWYWx1ZSA9IHJlcXVpcmUoJy4vbm9kZVZhbHVlJyk7XG52YXIgZm9ybSA9IHJlcXVpcmUoJy4vZm9ybScpO1xudmFyIGhlbHBlciA9IHJlcXVpcmUoJy4vaGVscGVyJyk7XG5cbnZhciBnYXRla2VlcGVyID0gbmV3IEdLKCk7XG5cbi8qKlxuICogQWN0aW9ucyBNb2R1bGVcbiAqXG4gKiBAbW9kdWxlIGxpYi9hY3Rpb25zXG4gKiBAYXV0aG9yIEhhc2FuIEFiYmFzXG4gKiBAdmVyc2lvbiAyLjAuMFxuICogQGRlc2NyaXB0aW9uIHRlc3QgZGVzY3JpcHRpb25cbiAqIEBjb3B5cmlnaHQgS3dhbnR1IEx0ZCBSU0EgMjAwOS0yMDE1LlxuICpcbiAqL1xuXG4vKipcbiAqICBGb3JtIE1vZHVsZSBhY3Rpb25zIG5lZWRzIHRvIGJlIG1vdmVkIGhlcmUuXG4gKiAgVGhpcyBhY3Rpb25zIG1vZHVsZSB3aWxsIGJlIGNlbnRhbCBwbGFjZSB0byBob2xkIGFsbCBmdW5jdGlvbnMuXG4gKiAgXG4gKi9cblxudmFyIGNvbW11bml0eSA9IChmdW5jdGlvbiAoKSB7XG5cbiAgICByZXR1cm4ge1xuXG4gICAgICAgIGNyZWF0ZUNvbW11bml0eTogZnVuY3Rpb24gKF9kZWYsIHV1aWQsIF9XRkluc3RhbmNlKSB7XG5cbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgd29ya2VyT2JqZWN0ID0gd29ya2VyLmdldFdvcmtlcldyYXBwZXIoKTtcblxuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5faWQgPSBnZW5lcmF0ZVVVSUQoKTtcbiAgICAgICAgICAgICAgICB3b3JrZXJPYmplY3QuY29tbXVuaXR5SWQgPSBhcHAuU0NPUEUuZ2V0Q29tbXVuaXR5SWQoKTtcbiAgICAgICAgICAgICAgICB3b3JrZXJPYmplY3QuYXBwbGljYXRpb25JZCA9IGFwcC5TQ09QRS5hcHBsaWNhdGlvbklkO1xuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5jcmVhdGVkRGF0ZVRpbWUgPSBuZXcgRGF0ZSgpLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0LnNlbmRlclVzZXJJZCA9IExPQ0FMX1NFVFRJTkdTLlNVQlNDUklQVElPTlMudXNlcklkO1xuICAgICAgICAgICAgICAgIHZhciB1dWlkQ29tbXVuaXR5ID0gSlNPTi54cGF0aChcIi9pbmRpY2F0b3JzW2NhdGVnb3J5L3Rlcm0gZXEgJ0NvbW11bml0eSddL19pZFwiLCBfV0ZJbnN0YW5jZSwge30pWzBdO1xuICAgICAgICAgICAgICAgIHZhciBhY3Rpb24gPSB7XG4gICAgICAgICAgICAgICAgICAgIFwiY3JlYXRlQ29tbXVuaXR5XCI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwibmV3Q29tbXVuaXR5SWRcIjogX1dGSW5zdGFuY2UucHJvZmlsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiaW5kaWNhdG9yVVVJRFwiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJDb21tdW5pdHlcIjogdXVpZENvbW11bml0eVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICB3b3JrZXJPYmplY3QuYWN0aW9uID0gYWN0aW9uO1xuICAgICAgICAgICAgICAgIHdvcmtlci5zZW5kKHdvcmtlck9iamVjdCkudGhlbihmdW5jdGlvbiAod29ya2VyU3VjY2Vzcykge1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdXb3JrZXIgcHJvY2Vzc2VkIHN1Y2Nlc3NmdWxseS4nLCB3b3JrZXJTdWNjZXNzKTtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcblxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uICh3b3JrZXJGYWlsKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdCh3b3JrZXJGYWlsKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICB1c2VySm9pbkNvbW11bml0eTogZnVuY3Rpb24gKF9kZWYsIHV1aWQsIF9XRkluc3RhbmNlKSB7XG5cbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG5cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH0sXG4gICAgICAgIHJlbGVhc2VBZG9wdGVkQXBwbGljYXRpb246IGZ1bmN0aW9uIChfZGVmLCB1dWlkLCBfV0ZJbnN0YW5jZSkge1xuXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuXG4gICAgICAgICAgICAgICAgdmFyIHdvcmtlck9iamVjdCA9IHdvcmtlci5nZXRXb3JrZXJXcmFwcGVyKCk7XG5cbiAgICAgICAgICAgICAgICB3b3JrZXJPYmplY3QuX2lkID0gZ2VuZXJhdGVVVUlEKCk7XG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0LmNvbW11bml0eUlkID0gYXBwLlNDT1BFLmdldENvbW11bml0eUlkKCk7XG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0LmFwcGxpY2F0aW9uSWQgPSBhcHAuU0NPUEUuYXBwbGljYXRpb25JZDtcbiAgICAgICAgICAgICAgICB3b3JrZXJPYmplY3QuY3JlYXRlZERhdGVUaW1lID0gbmV3IERhdGUoKS50b1N0cmluZygpO1xuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5zZW5kZXJVc2VySWQgPSBMT0NBTF9TRVRUSU5HUy5TVUJTQ1JJUFRJT05TLnVzZXJJZDtcblxuICAgICAgICAgICAgICAgIHZhciB1dWlkUmVsZWFzZUFkb3B0ZWRBcHBsaWNhdGlvbiA9IEpTT04ueHBhdGgoXCIvc3VicHJvY2Vzc2VzW19pZCBlcSAnXCIgKyB1dWlkICsgXCInXS9pbmRpY2F0b3JzW2lkIGVxICdhZG9wdGVkQXBwbGljYXRpb24nXS9pbnN0YW5jZXNbMV0vdXVpZFwiLCBfV0ZJbnN0YW5jZSwge30pWzBdO1xuXG4gICAgICAgICAgICAgICAgdmFyIGFjdGlvbiA9IHtcbiAgICAgICAgICAgICAgICAgICAgXCJyZWxlYXNlQWRvcHRlZEFwcGxpY2F0aW9uXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiY29tbXVuaXR5SWRcIjogX1dGSW5zdGFuY2UucHJvZmlsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiaW5kaWNhdG9yVVVJRFwiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJhZG9wdGVkQXBwbGljYXRpb25cIjogdXVpZFJlbGVhc2VBZG9wdGVkQXBwbGljYXRpb25cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0LmFjdGlvbiA9IGFjdGlvbjtcbiAgICAgICAgICAgICAgICB3b3JrZXIuc2VuZCh3b3JrZXJPYmplY3QpLnRoZW4oZnVuY3Rpb24gKHdvcmtlclN1Y2Nlc3MpIHtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnV29ya2VyIHByb2Nlc3NlcyBzdWNjZXNzZnVsbHkuJywgd29ya2VyU3VjY2Vzcyk7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XG5cbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAod29ya2VyRmFpbCkge1xuICAgICAgICAgICAgICAgICAgICByZWplY3Qod29ya2VyRmFpbCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgfVxuXG59KSgpO1xuXG52YXIgYXBwbGljYXRpb24gPSAoZnVuY3Rpb24gKCkge1xuXG4gICAgcmV0dXJuIHtcblxuICAgICAgICBjcmVhdGVBcHBEZWZpbml0aW9uOiBmdW5jdGlvbiAoX2RlZiwgdXVpZCwgX1dGSW5zdGFuY2UpIHtcblxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcblxuICAgICAgICAgICAgICAgIHZhciB3b3JrZXJPYmplY3QgPSB3b3JrZXIuZ2V0V29ya2VyV3JhcHBlcigpO1xuXG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0Ll9pZCA9IGdlbmVyYXRlVVVJRCgpO1xuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5jb21tdW5pdHlJZCA9IGFwcC5TQ09QRS5nZXRDb21tdW5pdHlJZCgpO1xuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5hcHBsaWNhdGlvbklkID0gYXBwLlNDT1BFLmFwcGxpY2F0aW9uSWQ7XG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0LmNyZWF0ZWREYXRlVGltZSA9IG5ldyBEYXRlKCkudG9TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICB3b3JrZXJPYmplY3Quc2VuZGVyVXNlcklkID0gTE9DQUxfU0VUVElOR1MuU1VCU0NSSVBUSU9OUy51c2VySWQ7XG5cbiAgICAgICAgICAgICAgICB2YXIgdXVpZEFwcGxpY2F0aW9uID0gSlNPTi54cGF0aChcIi9pbmRpY2F0b3JzW2NhdGVnb3J5L3Rlcm0gZXEgJ0FwcGxpY2F0aW9uJ10vX2lkXCIsIF9XRkluc3RhbmNlLCB7fSlbMF07XG4gICAgICAgICAgICAgICAgdmFyIGFjdGlvbiA9IHtcbiAgICAgICAgICAgICAgICAgICAgXCJjcmVhdGVBcHBsaWNhdGlvblwiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBcIm5ld0FwcGxpY2F0aW9uSWRcIjogX1dGSW5zdGFuY2UucHJvZmlsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiaW5kaWNhdG9yVVVJRFwiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJBcHBsaWNhdGlvblwiOiB1dWlkQXBwbGljYXRpb25cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0LmFjdGlvbiA9IGFjdGlvbjtcbiAgICAgICAgICAgICAgICB3b3JrZXIuc2VuZCh3b3JrZXJPYmplY3QpLnRoZW4oZnVuY3Rpb24gKHdvcmtlclN1Y2Nlc3MpIHtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnV29ya2VyIHByb2Nlc3NlcyBzdWNjZXNzZnVsbHkuJywgd29ya2VyU3VjY2Vzcyk7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XG5cbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAod29ya2VyRmFpbCkge1xuICAgICAgICAgICAgICAgICAgICByZWplY3Qod29ya2VyRmFpbCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9LFxuXG4gICAgICAgIGJ1aWxkQXBwbGljYXRpb246IGZ1bmN0aW9uIChfZGVmLCB1dWlkLCBfV0ZJbnN0YW5jZSkge1xuXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuXG4gICAgICAgICAgICAgICAgdmFyIHdvcmtlck9iamVjdCA9IHdvcmtlci5nZXRXb3JrZXJXcmFwcGVyKCk7XG5cbiAgICAgICAgICAgICAgICB3b3JrZXJPYmplY3QuX2lkID0gZ2VuZXJhdGVVVUlEKCk7XG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0LmNvbW11bml0eUlkID0gYXBwLlNDT1BFLmdldENvbW11bml0eUlkKCk7XG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0LmFwcGxpY2F0aW9uSWQgPSBhcHAuU0NPUEUuYXBwbGljYXRpb25JZDtcbiAgICAgICAgICAgICAgICB3b3JrZXJPYmplY3QuY3JlYXRlZERhdGVUaW1lID0gbmV3IERhdGUoKS50b1N0cmluZygpO1xuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5zZW5kZXJVc2VySWQgPSBMT0NBTF9TRVRUSU5HUy5TVUJTQ1JJUFRJT05TLnVzZXJJZDtcblxuICAgICAgICAgICAgICAgIHZhciB1dWlkUHVibGlzaEFwcGxpY2F0aW9uID0gSlNPTi54cGF0aChcIi9zdWJwcm9jZXNzZXNbX2lkIGVxICdcIiArIHV1aWQgKyBcIiddL2luZGljYXRvcnNbaWQgZXEgJ1B1Ymxpc2hBcHBsaWNhdGlvbiddL2luc3RhbmNlc1sxXS91dWlkXCIsIF9XRkluc3RhbmNlLCB7fSlbMF07XG5cbiAgICAgICAgICAgICAgICB2YXIgdXVpZEFwcGxpY2F0aW9uRGVmaW5pdGlvbiA9IEpTT04ueHBhdGgoXCIvaW5kaWNhdG9yc1tjYXRlZ29yeS90ZXJtIGVxICdBcHBsaWNhdGlvbkRlZmluaXRpb24nXS9faWRcIiwgX1dGSW5zdGFuY2UsIHt9KVswXTtcbiAgICAgICAgICAgICAgICB2YXIgdXVpZFJvbGVzID0gSlNPTi54cGF0aChcIi9pbmRpY2F0b3JzW2NhdGVnb3J5L3Rlcm0gZXEgJ1JvbGVzJ10vX2lkXCIsIF9XRkluc3RhbmNlLCB7fSlbMF07XG4gICAgICAgICAgICAgICAgdmFyIHV1aWRBcHBsaWNhdGlvbiA9IEpTT04ueHBhdGgoXCIvaW5kaWNhdG9yc1tjYXRlZ29yeS90ZXJtIGVxICdBcHBsaWNhdGlvbiddL19pZFwiLCBfV0ZJbnN0YW5jZSwge30pWzBdO1xuICAgICAgICAgICAgICAgIHZhciB1dWlkQXBwUGVybWlzc2lvbnMgPSBKU09OLnhwYXRoKFwiL2luZGljYXRvcnNbY2F0ZWdvcnkvdGVybSBlcSAnQXBwUGVybWlzc2lvbnMnXS9faWRcIiwgX1dGSW5zdGFuY2UsIHt9KVswXTtcblxuICAgICAgICAgICAgICAgIHZhciBhY3Rpb24gPSB7XG4gICAgICAgICAgICAgICAgICAgIFwiYnVpbGRBcHBsaWNhdGlvblwiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBcImFwcGxpY2F0aW9uSWRcIjogX1dGSW5zdGFuY2UucHJvZmlsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiaW5kaWNhdG9yVVVJRFwiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJQdWJsaXNoQXBwbGljYXRpb25cIjogdXVpZFB1Ymxpc2hBcHBsaWNhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIkFwcGxpY2F0aW9uRGVmaW5pdGlvblwiOiB1dWlkQXBwbGljYXRpb25EZWZpbml0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiUm9sZXNcIjogdXVpZFJvbGVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiQXBwbGljYXRpb25cIjogdXVpZEFwcGxpY2F0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiQXBwUGVybWlzc2lvbnNcIjogdXVpZEFwcFBlcm1pc3Npb25zXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5hY3Rpb24gPSBhY3Rpb247XG4gICAgICAgICAgICAgICAgd29ya2VyLnNlbmQod29ya2VyT2JqZWN0KS50aGVuKGZ1bmN0aW9uICh3b3JrZXJTdWNjZXNzKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ1dvcmtlciBwcm9jZXNzZXMgc3VjY2Vzc2Z1bGx5LicsIHdvcmtlclN1Y2Nlc3MpO1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xuXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHdvcmtlckZhaWwpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHdvcmtlckZhaWwpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfSxcblxuICAgICAgICBhcHBsaWNhdGlvbkFkb3B0aW9uOiBmdW5jdGlvbiAoX2RlZiwgdXVpZCwgX1dGSW5zdGFuY2UpIHtcblxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcblxuICAgICAgICAgICAgICAgIHZhciB3b3JrZXJPYmplY3QgPSB3b3JrZXIuZ2V0V29ya2VyV3JhcHBlcigpO1xuXG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0Ll9pZCA9IGdlbmVyYXRlVVVJRCgpO1xuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5jb21tdW5pdHlJZCA9IGFwcC5TQ09QRS5nZXRDb21tdW5pdHlJZCgpO1xuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5hcHBsaWNhdGlvbklkID0gYXBwLlNDT1BFLmFwcGxpY2F0aW9uSWQ7XG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0LmNyZWF0ZWREYXRlVGltZSA9IG5ldyBEYXRlKCkudG9TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICB3b3JrZXJPYmplY3Quc2VuZGVyVXNlcklkID0gTE9DQUxfU0VUVElOR1MuU1VCU0NSSVBUSU9OUy51c2VySWQ7XG5cbiAgICAgICAgICAgICAgICB2YXIgdXVpZEFkb3B0aW9uID0gSlNPTi54cGF0aChcIi9zdWJwcm9jZXNzZXNbX2lkIGVxICdcIiArIHV1aWQgKyBcIiddL2luZGljYXRvcnNbaWQgZXEgJ0Fkb3B0aW9uJ10vaW5zdGFuY2VzWzFdL3V1aWRcIiwgX1dGSW5zdGFuY2UsIHt9KVswXTtcblxuICAgICAgICAgICAgICAgIHZhciB1dWlkUHVibGlzaEFwcGxpY2F0aW9uID0gSlNPTi54cGF0aChcIi9pbmRpY2F0b3JzW2NhdGVnb3J5L3Rlcm0gZXEgJ1B1Ymxpc2hBcHBsaWNhdGlvbiddL19pZFwiLCBfV0ZJbnN0YW5jZSwge30pWzBdO1xuICAgICAgICAgICAgICAgIHZhciB1dWlkQXBwbGljYXRpb24gPSBKU09OLnhwYXRoKFwiL2luZGljYXRvcnNbY2F0ZWdvcnkvdGVybSBlcSAnQXBwbGljYXRpb24nXS9faWRcIiwgX1dGSW5zdGFuY2UsIHt9KVswXTtcblxuICAgICAgICAgICAgICAgIHZhciBhY3Rpb24gPSB7XG4gICAgICAgICAgICAgICAgICAgIFwiYWRvcHRBcHBsaWNhdGlvblwiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBcImFwcGxpY2F0aW9uSWRcIjogX1dGSW5zdGFuY2UucHJvZmlsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiaW5kaWNhdG9yVVVJRFwiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJBZG9wdGlvblwiOiB1dWlkQWRvcHRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJQdWJsaXNoQXBwbGljYXRpb25cIjogdXVpZFB1Ymxpc2hBcHBsaWNhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIkFwcGxpY2F0aW9uXCI6IHV1aWRBcHBsaWNhdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICB3b3JrZXJPYmplY3QuYWN0aW9uID0gYWN0aW9uO1xuICAgICAgICAgICAgICAgIHdvcmtlci5zZW5kKHdvcmtlck9iamVjdCkudGhlbihmdW5jdGlvbiAod29ya2VyU3VjY2Vzcykge1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdXb3JrZXIgcHJvY2Vzc2VzIHN1Y2Nlc3NmdWxseS4nLCB3b3JrZXJTdWNjZXNzKTtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcblxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uICh3b3JrZXJGYWlsKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdCh3b3JrZXJGYWlsKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH0sXG5cbiAgICAgICAgY3JlYXRlVGF4b25vbXk6IGZ1bmN0aW9uIChfZGVmLCB1dWlkLCBfV0ZJbnN0YW5jZSkge1xuXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuXG4gICAgICAgICAgICAgICAgdmFyIHdvcmtlck9iamVjdCA9IHdvcmtlci5nZXRXb3JrZXJXcmFwcGVyKCk7XG5cbiAgICAgICAgICAgICAgICB3b3JrZXJPYmplY3QuX2lkID0gZ2VuZXJhdGVVVUlEKCk7XG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0LmNvbW11bml0eUlkID0gYXBwLlNDT1BFLmdldENvbW11bml0eUlkKCk7XG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0LmFwcGxpY2F0aW9uSWQgPSBhcHAuU0NPUEUuYXBwbGljYXRpb25JZDtcbiAgICAgICAgICAgICAgICB3b3JrZXJPYmplY3QuY3JlYXRlZERhdGVUaW1lID0gbmV3IERhdGUoKS50b1N0cmluZygpO1xuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5zZW5kZXJVc2VySWQgPSBMT0NBTF9TRVRUSU5HUy5TVUJTQ1JJUFRJT05TLnVzZXJJZDtcblxuICAgICAgICAgICAgICAgIHZhciB0YXhvbm9teVVVSUQgPSBKU09OLnhwYXRoKFwiL3N1YnByb2Nlc3Nlc1tfaWQgZXEgJ1wiICsgdXVpZCArIFwiJ10vaW5kaWNhdG9yc1tpZCBlcSAnVGF4b25vbXknXS9pbnN0YW5jZXNbMV0vdXVpZFwiLCBfV0ZJbnN0YW5jZSwge30pWzBdO1xuXG4gICAgICAgICAgICAgICAgdmFyIGFjdGlvbiA9IHtcbiAgICAgICAgICAgICAgICAgICAgXCJjcmVhdGVUYXhvbm9teVwiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBcInRheG9ub215VVVJRFwiOiB0YXhvbm9teVVVSURcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5hY3Rpb24gPSBhY3Rpb247XG4gICAgICAgICAgICAgICAgd29ya2VyLnNlbmQod29ya2VyT2JqZWN0KS50aGVuKGZ1bmN0aW9uICh3b3JrZXJTdWNjZXNzKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ1dvcmtlciBwcm9jZXNzZXMgc3VjY2Vzc2Z1bGx5LicsIHdvcmtlclN1Y2Nlc3MpO1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xuXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHdvcmtlckZhaWwpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHdvcmtlckZhaWwpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfVxuXG4gICAgfVxuXG59KSgpO1xuXG52YXIgd29ya2VyID0gKGZ1bmN0aW9uICgpIHtcblxuICAgIHJldHVybiB7XG5cbiAgICAgICAgZ2V0V29ya2VyV3JhcHBlcjogZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICB2YXIgd3JhcHBlciA9IHtcbiAgICAgICAgICAgICAgICBcInNvdXJjZVwiOiBcInJlbW90ZVwiLFxuICAgICAgICAgICAgICAgIFwidHlwZVwiOiBcIndvcmtlck9iamVjdFwiLFxuICAgICAgICAgICAgICAgIFwiX2lkXCI6IFwiXCIsXG4gICAgICAgICAgICAgICAgXCJjaGFubmVsc1wiOiBbXSxcbiAgICAgICAgICAgICAgICBcImNvbW11bml0eUlkXCI6IFwiXCIsXG4gICAgICAgICAgICAgICAgXCJhcHBsaWNhdGlvbklkXCI6IFwiXCIsXG4gICAgICAgICAgICAgICAgXCJtZXNzYWdlXCI6IFwiXCIsXG4gICAgICAgICAgICAgICAgXCJtZXNzYWdlVHlwZVwiOiBcImluZm9cIixcbiAgICAgICAgICAgICAgICBcImNyZWF0ZWREYXRlVGltZVwiOiBcIlwiLFxuICAgICAgICAgICAgICAgIFwic2VuZGVyVXNlcklkXCI6IFwiXCIsXG4gICAgICAgICAgICAgICAgXCJhY3Rpb25cIjoge1xuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICByZXR1cm4gd3JhcHBlcjtcblxuICAgICAgICB9LFxuICAgICAgICBzZW5kOiBmdW5jdGlvbiAod29ya2VyT2JqZWN0KSB7XG5cbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG5cbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnU3VibWl0dGluZyBXb3JrZXIgT2JqZWN0IHRvIHNlcnZlcicpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHdvcmtlck9iamVjdCk7XG4gICAgICAgICAgICAgICAgZGFvLnNhdmUod29ya2VyT2JqZWN0KS5kb25lKGZ1bmN0aW9uICh3b3JrZXJSZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHdvcmtlclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICB9KS5mYWlsKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0Vycm9yIHN1Ym1pdHRpbmcgd29ya2VyIHJlc3BvbnNlICEhJyArIGVycik7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH1cblxuICAgIH1cblxufSkoKTtcblxudmFyIHBlcmZvcm1hbmNlID0gKGZ1bmN0aW9uICgpIHtcblxuICAgIHJldHVybiB7XG5cbiAgICAgICAgY3JlYXRlOiBmdW5jdGlvbiAoX2RlZiwgdXVpZCwgX1dGSW5zdGFuY2UpIHtcblxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcblxuICAgICAgICAgICAgICAgIHZhciB3b3JrZXJPYmplY3QgPSB3b3JrZXIuZ2V0V29ya2VyV3JhcHBlcigpO1xuXG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0Ll9pZCA9IGdlbmVyYXRlVVVJRCgpO1xuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5jb21tdW5pdHlJZCA9IGFwcC5TQ09QRS5nZXRDb21tdW5pdHlJZCgpO1xuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5hcHBsaWNhdGlvbklkID0gYXBwLlNDT1BFLmFwcGxpY2F0aW9uSWQ7XG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0LmNyZWF0ZWREYXRlVGltZSA9IG5ldyBEYXRlKCkudG9TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICB3b3JrZXJPYmplY3Quc2VuZGVyVXNlcklkID0gTE9DQUxfU0VUVElOR1MuU1VCU0NSSVBUSU9OUy51c2VySWQ7XG5cbiAgICAgICAgICAgICAgICB2YXIgdXVpZENvbW11bml0eSA9IEpTT04ueHBhdGgoXCIvaW5kaWNhdG9yc1tjYXRlZ29yeS90ZXJtIGVxICdwbGFuJ10vX2lkXCIsIF9XRkluc3RhbmNlLCB7fSlbMF07XG4gICAgICAgICAgICAgICAgdmFyIGFjdGlvbiA9IHtcbiAgICAgICAgICAgICAgICAgICAgXCJjcmVhdGVQbGFuXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwicGxhblVVSURcIjogdXVpZENvbW11bml0eVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0LmFjdGlvbiA9IGFjdGlvbjtcbiAgICAgICAgICAgICAgICB3b3JrZXIuc2VuZCh3b3JrZXJPYmplY3QpLnRoZW4oZnVuY3Rpb24gKHdvcmtlclN1Y2Nlc3MpIHtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnV29ya2VyIHByb2Nlc3NlZCBzdWNjZXNzZnVsbHkuJywgd29ya2VyU3VjY2Vzcyk7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XG5cbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAod29ya2VyRmFpbCkge1xuICAgICAgICAgICAgICAgICAgICByZWplY3Qod29ya2VyRmFpbCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBjb25maWd1cmVOb2RlOiBmdW5jdGlvbiAoX2RlZiwgdXVpZCwgX1dGSW5zdGFuY2UpIHtcblxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcblxuICAgICAgICAgICAgICAgIHZhciB3b3JrZXJPYmplY3QgPSB3b3JrZXIuZ2V0V29ya2VyV3JhcHBlcigpO1xuXG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0Ll9pZCA9IGdlbmVyYXRlVVVJRCgpO1xuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5jb21tdW5pdHlJZCA9IGFwcC5TQ09QRS5nZXRDb21tdW5pdHlJZCgpO1xuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5hcHBsaWNhdGlvbklkID0gYXBwLlNDT1BFLmFwcGxpY2F0aW9uSWQ7XG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0LmNyZWF0ZWREYXRlVGltZSA9IG5ldyBEYXRlKCkudG9TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICB3b3JrZXJPYmplY3Quc2VuZGVyVXNlcklkID0gTE9DQUxfU0VUVElOR1MuU1VCU0NSSVBUSU9OUy51c2VySWQ7XG5cbiAgICAgICAgICAgICAgICB2YXIgdXVpZE5vZGVJblN1YlByb2Nlc3MgPSBKU09OLnhwYXRoKFwiL3N1YnByb2Nlc3Nlc1tfaWQgZXEgJ1wiICsgdXVpZCArIFwiJ10vaW5kaWNhdG9yc1tpZCBlcSAnbm9kZSddL2luc3RhbmNlc1sxXS91dWlkXCIsIF9XRkluc3RhbmNlLCB7fSlbMF07XG5cbiAgICAgICAgICAgICAgICB2YXIgYWN0aW9uID0ge1xuICAgICAgICAgICAgICAgICAgICBcImNvbmZpZ3VyZU5vZGVcIjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJub2RlVVVJRFwiOiB1dWlkTm9kZUluU3ViUHJvY2Vzc1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0LmFjdGlvbiA9IGFjdGlvbjtcbiAgICAgICAgICAgICAgICB3b3JrZXIuc2VuZCh3b3JrZXJPYmplY3QpLnRoZW4oZnVuY3Rpb24gKHdvcmtlclN1Y2Nlc3MpIHtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnV29ya2VyIHByb2Nlc3NlZCBzdWNjZXNzZnVsbHkuJywgd29ya2VyU3VjY2Vzcyk7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XG5cbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAod29ya2VyRmFpbCkge1xuICAgICAgICAgICAgICAgICAgICByZWplY3Qod29ya2VyRmFpbCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgdW5sb2NrUGVyaW9kOiBmdW5jdGlvbiAoX2RlZiwgdXVpZCwgX1dGSW5zdGFuY2UpIHtcblxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcblxuICAgICAgICAgICAgICAgIHZhciBzdWJwcm9jZXNzT2JqZWN0ID0gSlNPTi54cGF0aChcIi9zdWJwcm9jZXNzZXNbX2lkIGVxICdcIiArIHV1aWQgKyBcIiddXCIsIF9XRkluc3RhbmNlLCB7fSlbMF07XG5cbiAgICAgICAgICAgICAgICB2YXIgZW50cnlVVUlEID0gSlNPTi54cGF0aChcIi9pbmRpY2F0b3JzW2lkIGVxICdcIiArIFBFUklPRF9TRVRfSUQgKyBcIiddL2luc3RhbmNlcy91dWlkXCIsIHN1YnByb2Nlc3NPYmplY3QsIHt9KVswXTtcbiAgICAgICAgICAgICAgICB2YXIgZW5kZGF0ZSA9IHN1YnByb2Nlc3NPYmplY3QuZGF0ZXMudmFsaWQ7XG5cbiAgICAgICAgICAgICAgICBsaWJyYXJ5LnVubG9ja1BlcmlvZChlbnRyeVVVSUQsIGVuZGRhdGUpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgdXVpZFNhdmVkSW5kaWNhdG9yID0gZGF0YS5pZDtcblxuICAgICAgICAgICAgICAgICAgICBkYW8uZ2V0KHV1aWRTYXZlZEluZGljYXRvcikuZG9uZShmdW5jdGlvbiAoZGF0YSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgX1dGSW5zdGFuY2UuaW5kaWNhdG9ycy5sZW5ndGg7IGluZGV4KyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5kaWNhdG9yID0gX1dGSW5zdGFuY2UuaW5kaWNhdG9yc1tpbmRleF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZGljYXRvci5faWQgPT0gZGF0YS5faWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX1dGSW5zdGFuY2UuaW5kaWNhdG9ycy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfV0ZJbnN0YW5jZS5pbmRpY2F0b3JzLnB1c2goZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdVbmxvY2sgcGVyaW9kLicsIGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xuXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB9KS5mYWlsKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG5cblxuXG5cblxuXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgbG9ja1BlcmZvcm1hbmNlTW9kZWw6IGZ1bmN0aW9uIChfZGVmLCB1dWlkLCBfV0ZJbnN0YW5jZSkge1xuXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuXG4gICAgICAgICAgICAgICAgdmFyIHN1YnByb2Nlc3NPYmplY3QgPSBKU09OLnhwYXRoKFwiL3N1YnByb2Nlc3Nlc1tfaWQgZXEgJ1wiICsgdXVpZCArIFwiJ11cIiwgX1dGSW5zdGFuY2UsIHt9KVswXTtcblxuICAgICAgICAgICAgICAgIHZhciBlbnRyeVVVSUQgPSBKU09OLnhwYXRoKFwiL2luZGljYXRvcnNbaWQgZXEgJ1wiICsgUEVSRk9STUFOQ0VfU0VUX0lEICsgXCInXS9pbnN0YW5jZXMvdXVpZFwiLCBzdWJwcm9jZXNzT2JqZWN0LCB7fSlbMF07XG4gICAgICAgICAgICAgICAgdmFyIGVuZGRhdGUgPSBzdWJwcm9jZXNzT2JqZWN0LmRhdGVzLnZhbGlkO1xuXG4gICAgICAgICAgICAgICAgbGlicmFyeS5sb2NrUGVyZm9ybWFuY2VNb2RlbChlbnRyeVVVSUQsIGVuZGRhdGUpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgdXVpZFNhdmVkSW5kaWNhdG9yID0gZGF0YS5pZDtcblxuICAgICAgICAgICAgICAgICAgICBkYW8uZ2V0KHV1aWRTYXZlZEluZGljYXRvcikuZG9uZShmdW5jdGlvbiAoZGF0YSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgX1dGSW5zdGFuY2UuaW5kaWNhdG9ycy5sZW5ndGg7IGluZGV4KyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5kaWNhdG9yID0gX1dGSW5zdGFuY2UuaW5kaWNhdG9yc1tpbmRleF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZGljYXRvci5faWQgPT0gZGF0YS5faWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX1dGSW5zdGFuY2UuaW5kaWNhdG9ycy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfV0ZJbnN0YW5jZS5pbmRpY2F0b3JzLnB1c2goZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdMb2NrIHBlcmZvcm1hbmNlIG1vZGVsLicsIGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xuXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB9KS5mYWlsKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG5cblxuXG5cblxuXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgfVxuXG59KSgpO1xuXG52YXIgc2RvID0gKGZ1bmN0aW9uICgpIHtcblxuICAgIHJldHVybiB7XG5cbiAgICAgICAgY3JlYXRlOiBmdW5jdGlvbiAoX2RlZiwgdXVpZCwgX1dGSW5zdGFuY2UpIHtcblxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcblxuICAgICAgICAgICAgICAgIHZhciB3b3JrZXJPYmplY3QgPSB3b3JrZXIuZ2V0V29ya2VyV3JhcHBlcigpO1xuXG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0Ll9pZCA9IGdlbmVyYXRlVVVJRCgpO1xuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5jb21tdW5pdHlJZCA9IGFwcC5TQ09QRS5nZXRDb21tdW5pdHlJZCgpO1xuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5hcHBsaWNhdGlvbklkID0gYXBwLlNDT1BFLmFwcGxpY2F0aW9uSWQ7XG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0LmNyZWF0ZWREYXRlVGltZSA9IG5ldyBEYXRlKCkudG9TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICB3b3JrZXJPYmplY3Quc2VuZGVyVXNlcklkID0gTE9DQUxfU0VUVElOR1MuU1VCU0NSSVBUSU9OUy51c2VySWQ7XG5cbiAgICAgICAgICAgICAgICB2YXIgc2RvVVVJRCA9IEpTT04ueHBhdGgoXCIvc3VicHJvY2Vzc2VzW19pZCBlcSAnXCIgKyB1dWlkICsgXCInXS9pbmRpY2F0b3JzW2lkIGVxICdTRE8nXS9pbnN0YW5jZXNbMV0vdXVpZFwiLCBfV0ZJbnN0YW5jZSwge30pWzBdO1xuXG4gICAgICAgICAgICAgICAgdmFyIGFjdGlvbiA9IHtcbiAgICAgICAgICAgICAgICAgICAgXCJjcmVhdGVTRE9cIjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJzZG9VVUlEXCI6IHNkb1VVSURcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5hY3Rpb24gPSBhY3Rpb247XG4gICAgICAgICAgICAgICAgd29ya2VyLnNlbmQod29ya2VyT2JqZWN0KS50aGVuKGZ1bmN0aW9uICh3b3JrZXJTdWNjZXNzKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ1dvcmtlciBwcm9jZXNzZXMgc3VjY2Vzc2Z1bGx5LicsIHdvcmtlclN1Y2Nlc3MpO1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xuXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHdvcmtlckZhaWwpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHdvcmtlckZhaWwpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfVxuXG4gICAgfVxuXG59KSgpO1xuXG52YXIgdGF4b25vbXkgPSAoZnVuY3Rpb24gKCkge1xuXG4gICAgcmV0dXJuIHtcblxuICAgICAgICBjcmVhdGU6IGZ1bmN0aW9uIChfZGVmLCB1dWlkLCBfV0ZJbnN0YW5jZSkge1xuXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuXG4gICAgICAgICAgICAgICAgdmFyIHdvcmtlck9iamVjdCA9IHdvcmtlci5nZXRXb3JrZXJXcmFwcGVyKCk7XG5cbiAgICAgICAgICAgICAgICB3b3JrZXJPYmplY3QuX2lkID0gZ2VuZXJhdGVVVUlEKCk7XG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0LmNvbW11bml0eUlkID0gYXBwLlNDT1BFLmdldENvbW11bml0eUlkKCk7XG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0LmFwcGxpY2F0aW9uSWQgPSBhcHAuU0NPUEUuYXBwbGljYXRpb25JZDtcbiAgICAgICAgICAgICAgICB3b3JrZXJPYmplY3QuY3JlYXRlZERhdGVUaW1lID0gbmV3IERhdGUoKS50b1N0cmluZygpO1xuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5zZW5kZXJVc2VySWQgPSBMT0NBTF9TRVRUSU5HUy5TVUJTQ1JJUFRJT05TLnVzZXJJZDtcblxuICAgICAgICAgICAgICAgIHZhciB0YXhvbm9teVVVSUQgPSBKU09OLnhwYXRoKFwiL3N1YnByb2Nlc3Nlc1tfaWQgZXEgJ1wiICsgdXVpZCArIFwiJ10vaW5kaWNhdG9yc1tpZCBlcSAnVGF4b25vbXknXS9pbnN0YW5jZXNbMV0vdXVpZFwiLCBfV0ZJbnN0YW5jZSwge30pWzBdO1xuXG4gICAgICAgICAgICAgICAgdmFyIGFjdGlvbiA9IHtcbiAgICAgICAgICAgICAgICAgICAgXCJjcmVhdGVUYXhvbm9teVwiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBcInRheG9ub215VVVJRFwiOiB0YXhvbm9teVVVSURcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5hY3Rpb24gPSBhY3Rpb247XG4gICAgICAgICAgICAgICAgd29ya2VyLnNlbmQod29ya2VyT2JqZWN0KS50aGVuKGZ1bmN0aW9uICh3b3JrZXJTdWNjZXNzKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ1dvcmtlciBwcm9jZXNzZXMgc3VjY2Vzc2Z1bGx5LicsIHdvcmtlclN1Y2Nlc3MpO1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xuXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHdvcmtlckZhaWwpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHdvcmtlckZhaWwpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfVxuXG4gICAgfVxuXG59KSgpO1xuXG52YXIgc3ViUHJvY2Vzc0luc3RhbmNlID0gKGZ1bmN0aW9uICgpIHtcblxuICAgIHJldHVybiB7XG5cbiAgICAgICAgc2V0VGl0bGU6IGZ1bmN0aW9uIChfZGVmLCB1dWlkLCBkYXRhVmFsdWUsIF9XRkluc3RhbmNlKSB7XG5cbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgc3BQcm9jZXNzT2JqZWN0ID0gSlNPTi54cGF0aChcIi9pbnN0YW5jZS9wcm9jZXNzZXMvc3ViUHJvY2Vzc2VzW3V1aWQgZXEgJ1wiICsgdXVpZCArIFwiJ11cIiwgYXBwLlNDT1BFLndvcmtmbG93LCB7fSlbMF07XG4gICAgICAgICAgICAgICAgc3BQcm9jZXNzT2JqZWN0LmxhYmVsID0gZGF0YVZhbHVlO1xuXG4gICAgICAgICAgICAgICAgdmFyIGl0ZW1zVG9Qcm9jZXNzID0gMTtcbiAgICAgICAgICAgICAgICB2YXIgc3R1ZmYgPSBbXTtcbiAgICAgICAgICAgICAgICB2YXIgb2JqID0ge307XG5cbiAgICAgICAgICAgICAgICBvYmoubW9kZWwgPSBfV0ZJbnN0YW5jZS5pbnN0YW5jZTtcbiAgICAgICAgICAgICAgICBzdHVmZi5wdXNoKG9iaik7XG4gICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ1N1YnByb2Nlc3Mgc2V0VGl0bGUgc3VjY2Vzcy4nLCBfV0ZJbnN0YW5jZS5pbnN0YW5jZSk7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0VmFsaWREYXRlOiBmdW5jdGlvbiAoX2RlZiwgdXVpZCwgZGF0YVZhbHVlLCBfV0ZJbnN0YW5jZSkge1xuXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuXG4gICAgICAgICAgICAgICAgdmFyIHNwUHJvY2Vzc09iamVjdCA9IEpTT04ueHBhdGgoXCIvc3VicHJvY2Vzc2VzW19pZCBlcSAnXCIgKyB1dWlkICsgXCInXVwiLCBhcHAuU0NPUEUud29ya2Zsb3csIHt9KVswXTtcbiAgICAgICAgICAgICAgICBzcFByb2Nlc3NPYmplY3QuZGF0ZXMudmFsaWQgPSBkYXRhVmFsdWU7XG5cbiAgICAgICAgICAgICAgICB2YXIgaXRlbXNUb1Byb2Nlc3MgPSAxO1xuICAgICAgICAgICAgICAgIHZhciBzdHVmZiA9IFtdO1xuICAgICAgICAgICAgICAgIHZhciBvYmogPSB7fTtcblxuICAgICAgICAgICAgICAgIG9iai5tb2RlbCA9IHNwUHJvY2Vzc09iamVjdDtcbiAgICAgICAgICAgICAgICBzdHVmZi5wdXNoKG9iaik7XG5cbiAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygndmFsaWQgZGF0ZSBzZXQuJywgX1dGSW5zdGFuY2Uuc3VicHJvY2Vzc2VzKTtcbiAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfVxuXG4gICAgfVxuXG59KSgpO1xuXG52YXIgdmFyaWFibGVzID0gKGZ1bmN0aW9uICgpIHtcblxuICAgIHJldHVybiB7XG5cbiAgICAgICAgc2V0VmFyaWFibGU6IGZ1bmN0aW9uIChzZXRWYXJpYWJsZSwgX1dGSW5zdGFuY2UsIHV1aWQpIHtcblxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcblxuICAgICAgICAgICAgICAgIGhlbHBlci5nZXROb2RlVmFsdWUoc2V0VmFyaWFibGUuZGF0YSwgX1dGSW5zdGFuY2UsIHV1aWQpLnRoZW4oZnVuY3Rpb24gKGRhdGFWYWx1ZSkge1xuXG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHNjb3BlID0gc2V0VmFyaWFibGUuc2NvcGU7XG4gICAgICAgICAgICAgICAgICAgIHZhciB2YXJpYWJsZU5hbWUgPSBzZXRWYXJpYWJsZS5uYW1lO1xuICAgICAgICAgICAgICAgICAgICB2YXIgdmFyaWFibGVUeXBlID0gc2V0VmFyaWFibGUudmFyaWFibGVUeXBlO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciB2YWxpZERhdGUgPSBKU09OLnhwYXRoKFwiL3N1YnByb2Nlc3Nlc1tfaWQgZXEgJ1wiICsgdXVpZCArIFwiJ10vZGF0ZXMvdmFsaWRcIiwgX1dGSW5zdGFuY2UsIHt9KVswXTtcblxuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHNjb3BlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdwcm9maWxlJzpcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwcm9maWxlSWQgPSBfV0ZJbnN0YW5jZS5wcm9maWxlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwcm9maWxlVmFyaWFibGVGaWxlTmFtZSA9IHByb2ZpbGVJZCArICc6dmFyaWFibGVzJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYW8uZ2V0KHByb2ZpbGVWYXJpYWJsZUZpbGVOYW1lKS5kb25lKGZ1bmN0aW9uIChmaWxlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhcmlhYmxlVHlwZSA9PSAncGVyaW9kaWMnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcHJvY2Vzc09iaiA9IEpTT04ueHBhdGgoXCIvaW5zdGFuY2UvcHJvY2Vzc2VzW3N1YlByb2Nlc3Nlcy91dWlkIGVxICdcIiArIHV1aWQgKyBcIiddXCIsIF9XRkluc3RhbmNlLCB7fSlbMF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2VxID0gcHJvY2Vzc09iai5zZXE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgb2JqID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3ViUHJvY2Vzc1VVSURcIjogdXVpZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInVzZXJcIjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInVzZXJOYW1lXCI6IExPQ0FMX1NFVFRJTkdTLlNVQlNDUklQVElPTlMudXNlcm5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidXNlcklkXCI6IExPQ0FMX1NFVFRJTkdTLlNVQlNDUklQVElPTlMudXNlclByb2ZpbGVJZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJzZXFcIjogc2VxLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsaWREYXRlXCI6IHZhbGlkRGF0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IGRhdGFWYWx1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZhbCgnZmlsZS4nICsgdmFyaWFibGVOYW1lICsgJy5wdXNoKG9iaiknKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZVt2YXJpYWJsZU5hbWVdID0gZGF0YVZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGFvLnVwc2VydChmaWxlKS5kb25lKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKFwiVmFyaWFibGUgc2V0IHN1Y2Nlc3NmdWxseVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChcIkZhaWxlZCB0byBzZXQgVmFyaWFibGVcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbiAoZXJyb3IpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmlsZSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiX2lkXCI6IHByb2ZpbGVWYXJpYWJsZUZpbGVOYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS5jaGFubmVscyA9IGFwcC5wcm9maWxlLmNoYW5uZWxzO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YXJpYWJsZVR5cGUgPT0gJ3BlcmlvZGljJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHByb2Nlc3NPYmogPSBKU09OLnhwYXRoKFwiL2luc3RhbmNlL3Byb2Nlc3Nlc1tzdWJQcm9jZXNzZXMvdXVpZCBlcSAnXCIgKyB1dWlkICsgXCInXVwiLCBfV0ZJbnN0YW5jZSwge30pWzBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNlcSA9IHByb2Nlc3NPYmouc2VxO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZVt2YXJpYWJsZU5hbWVdID0gW3tcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInN1YlByb2Nlc3NVVUlEXCI6IHV1aWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ1c2VyXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ1c2VyTmFtZVwiOiBMT0NBTF9TRVRUSU5HUy5TVUJTQ1JJUFRJT05TLnVzZXJuYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInVzZXJJZFwiOiBMT0NBTF9TRVRUSU5HUy5TVUJTQ1JJUFRJT05TLnVzZXJQcm9maWxlSWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic2VxXCI6IHNlcSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInZhbGlkRGF0ZVwiOiB2YWxpZERhdGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ2YWx1ZVwiOiBkYXRhVmFsdWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1dO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZVt2YXJpYWJsZU5hbWVdID0gZGF0YVZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGFvLnVwc2VydChmaWxlKS5kb25lKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKFwiVmFyaWFibGUgc2V0IHN1Y2Nlc3NmdWxseVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChcIkZhaWxlZCB0byBzZXQgVmFyaWFibGVcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cblxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdzdWJQcm9jZXNzSW5zdGFuY2UnOlxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShcIm5vdCBpbXBsZW1lbnRlZFwiKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnc3RlcCc6XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKFwibm90IGltcGxlbWVudGVkXCIpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChcImdldE5vZGVWYWx1ZSB2YWx1ZSBub3QgZm91bmQuXCIpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG5cblxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfVxuXG4gICAgfVxuXG59KSgpO1xuXG5cblxudmFyIG5vdGlmaWNhdGlvbiA9IChmdW5jdGlvbiAoKSB7XG5cbiAgICByZXR1cm4ge1xuXG4gICAgICAgIGVtYWlsOiBmdW5jdGlvbiAoZW1haWwsIF9XRkluc3RhbmNlLCB1dWlkKSB7XG5cbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgICAgICAgICAgdmFyIHdvcmtlck9iamVjdCA9IHdvcmtlci5nZXRXb3JrZXJXcmFwcGVyKCk7XG5cbiAgICAgICAgICAgICAgICB3b3JrZXJPYmplY3QuX2lkID0gZ2VuZXJhdGVVVUlEKCk7XG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0LmNvbW11bml0eUlkID0gYXBwLlNDT1BFLmdldENvbW11bml0eUlkKCk7XG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0LmFwcGxpY2F0aW9uSWQgPSBhcHAuU0NPUEUuYXBwbGljYXRpb25JZDtcbiAgICAgICAgICAgICAgICB3b3JrZXJPYmplY3QuY3JlYXRlZERhdGVUaW1lID0gbmV3IERhdGUoKS50b1N0cmluZygpO1xuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5zZW5kZXJVc2VySWQgPSBMT0NBTF9TRVRUSU5HUy5TVUJTQ1JJUFRJT05TLnVzZXJJZDtcblxuICAgICAgICAgICAgICAgIHZhciBmcm9tT2JqZWN0ID0ge307XG4gICAgICAgICAgICAgICAgZnJvbU9iamVjdC5lbWFpbEFkZHJlc3MgPSBOT1RJRklDQVRJT05fRlJPTV9BRERSRVNTO1xuICAgICAgICAgICAgICAgIGZyb21PYmplY3QubmFtZSA9IE5PVElGSUNBVElPTl9GUk9NX05BTUU7XG5cbiAgICAgICAgICAgICAgICB2YXIgZ2V0TGlzdCA9IGZ1bmN0aW9uIChlbWFpbCkge1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0b0FycmF5ID0gW107XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbWFpbC5yZWNpcGllbnRzLnJvbGUgIT0gdW5kZWZpbmVkKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcm9sZSA9IGVtYWlsLnJlY2lwaWVudHMucm9sZS5yb2xlSWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlkID0gJyc7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZW1haWwucmVjaXBpZW50cy5yb2xlLnByb2ZpbGUgPT0gJ2N1cnJlbnQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkID0gX1dGSW5zdGFuY2UucHJvZmlsZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVtYWlsLnJlY2lwaWVudHMucm9sZS5wcm9maWxlID09ICdjb21tdW5pdHknKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkID0gYXBwLlNDT1BFLmdldENvbW11bml0eUlkKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlicmFyeS5nZXRVc2Vyc0xpc3RCeVJvbGUoaWQsIHJvbGUpLnRoZW4oZnVuY3Rpb24gKGxpc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxpc3QgIT0gdW5kZWZpbmVkICYmIGxpc3QubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b0FycmF5LnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogbGlzdFtpXS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImlkXCI6IGxpc3RbaV0uaWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUodG9BcnJheSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChcIkVSUk9SOiBObyB1c2VycyBmb3VuZCBpbiByb2xlIGxpc3RcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KFwiRVJST1I6IENhbm5vdCBmZXRjaCB1c2VycyBmcm9tIHJvbGUuIEV4aXRpbmcuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVtYWlsLnJlY2lwaWVudHMuYXNzaWduZWRUbyAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b0FycmF5LnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJpZFwiOiBhc3NpZ25lZFRvXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh0b0FycmF5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuXG5cbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgdmFyIGNjQXJyYXkgPSBbXTtcbiAgICAgICAgICAgICAgICB2YXIgYmNjQXJyYXkgPSBbXTtcbiAgICAgICAgICAgICAgICB2YXIgaGVhZGluZyA9IGVtYWlsLmhlYWRpbmc7XG4gICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSB7XG5cbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgaWYgKGVtYWlsLm1lc3NhZ2UucGxhaW4gIT0gdW5kZWZpbmVkKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5wbGFpbiA9IGVtYWlsLm1lc3NhZ2UucGxhaW47XG5cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVtYWlsLm1lc3NhZ2UucnRmICE9IHVuZGVmaW5lZCkge1xuXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UucnRmID0ge31cblxuICAgICAgICAgICAgICAgICAgICBpZiAoZW1haWwubWVzc2FnZS5ydGYubWFya3VwICE9IHVuZGVmaW5lZCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLnJ0Zi5tYXJrdXAgPSBlbWFpbC5tZXNzYWdlLnJ0Zi5tYXJrdXA7XG5cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlbWFpbC5tZXNzYWdlLnJ0Zi50ZW1wbGF0ZSAhPSB1bmRlZmluZWQpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gTm90IGltcGxlbWVudGVkXG5cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfVxuXG5cblxuICAgICAgICAgICAgICAgIHZhciBhY3Rpb24gPSB7XG4gICAgICAgICAgICAgICAgICAgIFwibm90aWZpY2F0aW9uXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiZW1haWxcIjoge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICBnZXRMaXN0KGVtYWlsKS50aGVuKGZ1bmN0aW9uICh0b0FycmF5KSB7XG5cbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uLm5vdGlmaWNhdGlvbi5lbWFpbC5mcm9tID0gZnJvbU9iamVjdDtcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uLm5vdGlmaWNhdGlvbi5lbWFpbC50byA9IHRvQXJyYXk7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbi5ub3RpZmljYXRpb24uZW1haWwuY2MgPSBjY0FycmF5O1xuICAgICAgICAgICAgICAgICAgICBhY3Rpb24ubm90aWZpY2F0aW9uLmVtYWlsLmJjYyA9IGJjY0FycmF5O1xuICAgICAgICAgICAgICAgICAgICBhY3Rpb24ubm90aWZpY2F0aW9uLmVtYWlsLmhlYWRpbmcgPSBoZWFkaW5nO1xuICAgICAgICAgICAgICAgICAgICBhY3Rpb24ubm90aWZpY2F0aW9uLmVtYWlsLm1lc3NhZ2UgPSBtZXNzYWdlO1xuICAgICAgICAgICAgICAgICAgICB3b3JrZXJPYmplY3QuYWN0aW9uID0gYWN0aW9uO1xuICAgICAgICAgICAgICAgICAgICB3b3JrZXIuc2VuZCh3b3JrZXJPYmplY3QpLnRoZW4oZnVuY3Rpb24gKHdvcmtlclN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHdvcmtlck9iamVjdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnTm90aWZpY2F0aW9uIEVtYWlsIFdvcmtlciBwcm9jZXNzZXMgc3VjY2Vzc2Z1bGx5LicsIHdvcmtlclN1Y2Nlc3MpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcblxuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAod29ya2VyRmFpbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHdvcmtlckZhaWwpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9LFxuICAgICAgICBzbXM6IGZ1bmN0aW9uIChzbXMsIF9XRkluc3RhbmNlLCB1dWlkKSB7XG5cbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG5cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH0sXG4gICAgICAgIHB1c2hBUEk6IGZ1bmN0aW9uIChwdXNoQVBJLCBfV0ZJbnN0YW5jZSwgdXVpZCkge1xuXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9XG5cblxuICAgIH1cblxufSkoKTtcblxubW9kdWxlLmV4cG9ydHMgPSB7XG5cbiAgICBjb21tdW5pdHk6IGNvbW11bml0eSxcbiAgICBhcHBsaWNhdGlvbjogYXBwbGljYXRpb24sXG4gICAgcGVyZm9ybWFuY2U6IHBlcmZvcm1hbmNlLFxuICAgIHdvcmtlcjogd29ya2VyLFxuICAgIHNkbzogc2RvLFxuICAgIHRheG9ub215OiB0YXhvbm9teSxcbiAgICBzdWJQcm9jZXNzSW5zdGFuY2U6IHN1YlByb2Nlc3NJbnN0YW5jZSxcbiAgICB2YXJpYWJsZXM6IHZhcmlhYmxlcyxcbiAgICBub3RpZmljYXRpb246IG5vdGlmaWNhdGlvblxufSIsIid1c2Ugc3RyaWN0JztcblxuLy92YXIgZ2F0ZWtlZXBlciA9IHJlcXVpcmUoJy4uL2Jvd2VyX2NvbXBvbmVudHMvZ2F0ZWtlZXBlcicpO1xudmFyIHV0aWwgPSByZXF1aXJlKCd1dGlsaXR5Jyk7XG5cbi8vIHZhciB1dWlkID0gcmVxdWlyZSgnbm9kZS11dWlkJyk7XG5cbnZhciBnYXRla2VlcGVyID0gbmV3IEdLKCk7XG5cbi8qKlxuICogRm9ybSBNb2R1bGVcbiAqXG4gKiBAbW9kdWxlIGxpYi9mb3JtXG4gKiBAYXV0aG9yIEJyZW50IEdvcmRvblxuICogQHZlcnNpb24gMi4wLjBcbiAqIEBkZXNjcmlwdGlvbiB0ZXN0IGRlc2NyaXB0aW9uXG4gKiBAY29weXJpZ2h0IEt3YW50dSBMdGQgUlNBIDIwMDktMjAxNS5cbiAqXG4gKi9cblxuZnVuY3Rpb24gY3JlYXRlKGFyZ3MpIHtcblxuICAgIHZhciBwcm9jZXNzSWQgPSBhcmdzWzBdIHx8ICcnO1xuXG4gICAgdmFyIHN1YlByb2Nlc3MgPSBhcmdzWzFdIHx8IHt9O1xuXG4gICAgdmFyIHN0ZXAgPSBhcmdzWzJdIHx8IHt9O1xuXG4gICAgdmFyIGFjdGlvbiA9IGFyZ3NbM10gfHwge307XG5cbiAgICB2YXIgX1dGSW5zdGFuY2UgPSBhcmdzWzZdIHx8IHt9O1xuXG4gICAgdmFyIGRhdGEgPSBhcmdzWzZdIHx8IHt9O1xuXG4gICAgdmFyIGluZGljYXRvcnMgPSBzdWJQcm9jZXNzLmluZGljYXRvcnMgfHwgW107XG5cbiAgICB2YXIgcmVzdWx0ID0gW107XG5cbiAgICB2YXIgaW5kaWNhdG9yVHlwZSA9IGFjdGlvbi5fdHlwZTtcblxuICAgIHZhciBwcm9jZXNzU2VxID0gYXJnc1s0XSB8fCAnJztcblxuICAgIHZhciBzdWJQcm9jZXNzU2VxID0gYXJnc1s1XSB8fCAnJztcblxuICAgIHZhciBjcmVhdGVUeXBlID0gYXJnc1s3XSB8fCAnJztcblxuICAgIHZhciBzdWJQcm9jZXNzSWQgPSBzdWJQcm9jZXNzLl9pZDtcblxuICAgIHZhciB1dWlkID0gYXJnc1s4XSB8fCAnJztcblxuICAgIHZhciBiYXNlVVVJRCA9IGFyZ3NbOV0gfHwgJyc7XG5cbiAgICB2YXIgcHJvZmlsZSA9IF9XRkluc3RhbmNlLnByb2ZpbGU7XG5cbiAgICB2YXIgaW5wdXREYXRhID0gYXJnc1sxMF0gfHwge307XG5cbiAgICB2YXIgZm9ybUNyZWF0ZVR5cGUgPSBhY3Rpb24ubWV0aG9kLmZvcm0uY3JlYXRlO1xuXG4gICAgdmFyIGZvcm1UeXBlID0gYWN0aW9uLm1ldGhvZC5mb3JtLnR5cGU7XG5cbiAgICB2YXIgcGFyYW1PYmplY3QgPSB7XG5cbiAgICAgICAgXCJmb3JtQ3JlYXRlVHlwZVwiOiBmb3JtQ3JlYXRlVHlwZSxcbiAgICAgICAgXCJmb3JtVHlwZVwiOiBmb3JtVHlwZVxuXG4gICAgfVxuXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICB2YXIgdG9Qcm9jZXNzID0gaW5kaWNhdG9ycy5sZW5ndGg7XG5cbiAgICAgICAgdmFyIHN1YnByb2Nlc3NUeXBlID0gSlNPTi54cGF0aChcIi9jb25maWcvcHJvY2Vzc2VzL3N1YlByb2Nlc3Nlc1tfaWQgZXEgJ1wiICsgc3ViUHJvY2Vzc0lkICsgXCInXS90eXBlXCIsIF9XRkluc3RhbmNlLCB7fSlbMF07XG5cbiAgICAgICAgdmFyIGZvcm1DcmVhdGVGbiA9IGZ1bmN0aW9uKGluZGljYXRvclR5cGUsIGluZGljYXRvcklkLCB2YWxpZERhdGUsIGluc3RhbnRpYXRlU291cmNlKSB7XG5cbiAgICAgICAgICAgIGdhdGVrZWVwZXIuaW5zdGFudGlhdGUoYmFzZVVVSUQsIGluZGljYXRvclR5cGUsIGluZGljYXRvcklkLCBfV0ZJbnN0YW5jZS5wcm9maWxlLCB2YWxpZERhdGUsIHN1YlByb2Nlc3NJZCwgc3VicHJvY2Vzc1R5cGUpLnRoZW4oZnVuY3Rpb24oZG9jQXJyYXkpIHtcbiAgICAgICAgICAgICAgICAvLyBVcGRhdGUgdGhlIGluZGljYXRvciB3b3JrZmxvdyBwcm9jZXNzZXMgc2VjdGlvblxuXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkb2NBcnJheS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgb2JqZWN0ID0gZG9jQXJyYXlbaV07XG4gICAgICAgICAgICAgICAgICAgIGlmICghb2JqZWN0Lm1vZGVsLl9pZC5lbmRzV2l0aCgnOmFwcHJvdmVkJykgJiYgIW9iamVjdC5tb2RlbC5faWQuZW5kc1dpdGgoJzpyZWplY3RlZCcpKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB3b3JrZmxvd09iaiA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImlkXCI6IF9XRkluc3RhbmNlLmNvbmZpZy5faWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJpbnN0YW5jZVwiOiBfV0ZJbnN0YW5jZS5pbnN0YW5jZS5faWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJwcm9jZXNzZXNcIjogW3tcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJpZFwiOiBwcm9jZXNzSWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3ViUHJvY2Vzc0lkXCI6IHN1YlByb2Nlc3MuX2lkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInN1YlByb2Nlc3NVVUlEXCI6IHV1aWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3RlcFwiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImlkXCI6IHN0ZXAuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInNlcVwiOiBzdGVwLnNlcSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhcnREYXRlXCI6IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInN0YXR1c1wiOiBzdGVwLnN0YXR1cyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibWVzc2FnZVwiOiBzdGVwLm1lc3NhZ2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImFzc2lnbmVkVG9cIjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidXNlcklkXCI6IHN0ZXAuYXNzaWduZWRUby51c2VySWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IHN0ZXAuYXNzaWduZWRUby5uYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJjb21tZW50XCI6IHN0ZXAuY29tbWVudCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiY29tcGxldGVcIjogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImVuZERhdGVcIjogXCJcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWN0aW9uLnNldFdvcmtmbG93TGFiZWxJblRpdGxlICE9IHVuZGVmaW5lZCAmJiBhY3Rpb24uc2V0V29ya2Zsb3dMYWJlbEluVGl0bGUgIT0gJycgJiYgYWN0aW9uLnNldFdvcmtmbG93TGFiZWxJblRpdGxlID09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QubW9kZWwudGl0bGUgPSBpbnB1dERhdGEubGFiZWw7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhY3Rpb24uc2V0RHJhZnQgIT0gdW5kZWZpbmVkICYmIGFjdGlvbi5zZXREcmFmdCAhPSAnJyAmJiBhY3Rpb24uc2V0RHJhZnQgPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC5tb2RlbC5jb250cm9sLmRyYWZ0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0Lm1vZGVsLndvcmtmbG93cy5wdXNoKHdvcmtmbG93T2JqKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtYWluSWQgPSBvYmplY3QubW9kZWwuX2lkO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gcGVyc2lzdCB2aWEgZ2sgc28gdGhhdCBpdCBpcyBzYXZlIGluIGNvdWNoXG4gICAgICAgICAgICAgICAgICAgICAgICBnYXRla2VlcGVyLnBlcnNpc3QoZG9jQXJyYXkpLnRoZW4oZnVuY3Rpb24oc2F2ZWRBcnJheSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vdXNpbmcgc2FtZSBpZCBjYWxsIGluaXRpYWxpc2VEYXRhXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9jYWxsIGNvZGUgdG8gc2V0IHRvIHNldEluc3RhbmNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGFvLmdldChtYWluSWQpLmRvbmUoZnVuY3Rpb24oZGF0YSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbmRpY2F0b3JNb2RlbCA9IGtvLm1hcHBpbmcuZnJvbUpTKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiZGVmYXVsdE1vZGVsXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInNldElkXCI6IGluZGljYXRvcklkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhdGVrZWVwZXIuaW5zdGFudGlhdGVEYXRhKG1haW5JZCwgaW5zdGFudGlhdGVTb3VyY2UsIGluZGljYXRvck1vZGVsLCBkYXRhLm1vZGVsLnBlbmRpbmcuc2VxLCBwYXJhbU9iamVjdCkudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YVswXS5zdGF0dXMgPT0gXCIyMDBcIikge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFjdGlvbi5zZXRXb3JrZmxvd0xhYmVsSW5GaWVsZCAhPSB1bmRlZmluZWQgJiYgYWN0aW9uLnNldFdvcmtmbG93TGFiZWxJbkZpZWxkICE9ICcnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhc3NpZ25tZW50U2V0SWQgPSBhY3Rpb24uc2V0V29ya2Zsb3dMYWJlbEluRmllbGQuc3BsaXQoXCIuXCIpWzBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXNzaWdubWVudFNldElkID09IGluZGljYXRvcklkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYXRoID0gXCJkYXRhWzBdLm1vZGVsLm1vZGVsLnBlbmRpbmcuZGF0YS5cIiArIGFjdGlvbi5zZXRXb3JrZmxvd0xhYmVsSW5GaWVsZCArIFwiPSdcIiArIGlucHV0RGF0YS5sYWJlbCArIFwiJ1wiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZhbChwYXRoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2F0ZWtlZXBlci5wZXJzaXN0KGRhdGEpLnRoZW4oZnVuY3Rpb24oc2F2ZWRBcnJheSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYW8uZ2V0KG1haW5JZCkuZG9uZShmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoX1dGSW5zdGFuY2UuaW5kaWNhdG9ycy5sZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9XRkluc3RhbmNlLmluZGljYXRvcnMucHVzaChkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1Byb2Nlc3MtLTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodG9Qcm9jZXNzID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ0Zvcm0gY3JlYXRlZCBzdWNjZXNzZnVsbHkuJywgX1dGSW5zdGFuY2UuaW5kaWNhdG9ycyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZvdW5kID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IF9XRkluc3RhbmNlLmluZGljYXRvcnMubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbmRpY2F0b3IgPSBfV0ZJbnN0YW5jZS5pbmRpY2F0b3JzW2luZGV4XTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZGljYXRvci5faWQgPT0gZGF0YS5faWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZSB0aGUgY3VycmVudCBpdGVtIGZyb20gdGhlIGFycmF5IGFuZCBhZGQgdGhlIHVwZGF0ZWQgcHJvY2Vzc01vZGVsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfV0ZJbnN0YW5jZS5pbmRpY2F0b3JzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfV0ZJbnN0YW5jZS5pbmRpY2F0b3JzLnB1c2goZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1Byb2Nlc3MtLTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0b1Byb2Nlc3MgPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdGb3JtIGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5LicsIF9XRkluc3RhbmNlLmluZGljYXRvcnMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZvdW5kID09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9XRkluc3RhbmNlLmluZGljYXRvcnMucHVzaChkYXRhKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1Byb2Nlc3MtLTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRvUHJvY2VzcyA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnRm9ybSBjcmVhdGVkIHN1Y2Nlc3NmdWxseS4nLCBfV0ZJbnN0YW5jZS5pbmRpY2F0b3JzKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmYWlsdXJlID0gdXRpbC5zdWNjZXNzKCcxIEdhdGVrZWVwZXIgaW5pdGlhbGlzYXRpb24gZmFpbGVkIHdpdGggaW5pdGlhbGlzZURhdGEgbWVzc2FnZSAnICsgZXJyWzBdLm1lc3NhZ2UsIHt9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChmYWlsdXJlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmFpbHVyZSA9IHV0aWwuc3VjY2VzcygnMiBHYXRla2VlcGVyIGluaXRpYWxpc2F0aW9uIGZhaWxlZCB3aXRoIGluaXRpYWxpc2VEYXRhIG1lc3NhZ2UgJyArIGVyclswXS5tZXNzYWdlLCB7fSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChmYWlsdXJlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmFpbHVyZSA9IHV0aWwuc3VjY2VzcygnMyBHYXRla2VlcGVyIGluaXRpYWxpc2F0aW9uIGZhaWxlZCB3aXRoIGluaXRpYWxpc2VEYXRhIG1lc3NhZ2UgJyArIGVyclswXS5tZXNzYWdlLCB7fSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGZhaWx1cmUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZhaWx1cmUgPSB1dGlsLnN1Y2Nlc3MoJzQgR2F0ZWtlZXBlciBpbml0aWFsaXNhdGlvbiBmYWlsZWQgd2l0aCBpbml0aWFsaXNlRGF0YSBtZXNzYWdlICcgKyBlcnJbMF0ubWVzc2FnZSwge30pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGZhaWx1cmUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLmZhaWwoZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZhaWx1cmUgPSB1dGlsLnN1Y2Nlc3MoJzUgR2F0ZWtlZXBlciBpbml0aWFsaXNhdGlvbiBmYWlsZWQgd2l0aCBpbml0aWFsaXNlRGF0YSBtZXNzYWdlICcgKyBlcnJbMF0ubWVzc2FnZSwge30pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZmFpbHVyZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmFpbHVyZSA9IHV0aWwuc3VjY2VzcygnNiBHYXRla2VlcGVyIGluaXRpYWxpc2F0aW9uIGZhaWxlZCB3aXRoIGluaXRpYWxpc2VEYXRhIG1lc3NhZ2UgJyArIGVyclswXS5tZXNzYWdlLCB7fSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGZhaWx1cmUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgdG9BZGRQcm9jZXNzID0gW107XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBfV0ZJbnN0YW5jZS5pbnN0YW5jZS5wcm9jZXNzZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKF9XRkluc3RhbmNlLmluc3RhbmNlLnByb2Nlc3Nlc1tpXS5zdWJQcm9jZXNzZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdG9BZGRQcm9jZXNzLnB1c2goX1dGSW5zdGFuY2UuaW5zdGFuY2UucHJvY2Vzc2VzW2ldKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgX1dGSW5zdGFuY2UuaW5zdGFuY2UucHJvY2Vzc2VzID0gW107XG4gICAgICAgICAgICAgICAgX1dGSW5zdGFuY2UuaW5zdGFuY2UucHJvY2Vzc2VzID0gdG9BZGRQcm9jZXNzO1xuXG4gICAgICAgICAgICAgICAgdmFyIHRvQWRkU3ViUHJvY2VzcyA9IFtdO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgX1dGSW5zdGFuY2Uuc3VicHJvY2Vzc2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChfV0ZJbnN0YW5jZS5zdWJwcm9jZXNzZXNbaV0uaW5kaWNhdG9ycy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0b0FkZFN1YlByb2Nlc3MucHVzaChfV0ZJbnN0YW5jZS5zdWJwcm9jZXNzZXNbaV0pO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBfV0ZJbnN0YW5jZS5zdWJwcm9jZXNzZXMgPSBbXTtcbiAgICAgICAgICAgICAgICBfV0ZJbnN0YW5jZS5zdWJwcm9jZXNzZXMgPSB0b0FkZFN1YlByb2Nlc3M7XG5cbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgICAgICAgICAgICAgdmFyIGZhaWx1cmUgPSB1dGlsLnN1Y2Nlc3MoJzcgR2F0ZWtlZXBlciBpbml0aWFsaXNhdGlvbiBmYWlsZWQgd2l0aCBpbml0aWFsaXNlRGF0YSBtZXNzYWdlICcgKyBlcnJbMF0ubWVzc2FnZSwge30pO1xuICAgICAgICAgICAgICAgIHJlamVjdChmYWlsdXJlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBpbnN0YW50aWF0ZVNvdXJjZSA9IEZST01fREVGSU5JVElPTjtcblxuICAgICAgICBmb3IgKHZhciBjb3VudGVyID0gMDsgY291bnRlciA8IGluZGljYXRvcnMubGVuZ3RoOyBjb3VudGVyKyspIHtcbiAgICAgICAgICAgIHZhciBpbmRpY2F0b3JJZCA9IGluZGljYXRvcnNbY291bnRlcl0uX2lkO1xuICAgICAgICAgICAgdmFyIGluZGljYXRvck5hbWUgPSB1dGlsLmdldE5hbWUoaW5kaWNhdG9yc1tjb3VudGVyXS5uYW1lLCAnZW4nKTtcblxuICAgICAgICAgICAgdmFyIHNvdXJjZSA9IGluZGljYXRvcnNbY291bnRlcl0uaW5pdGlhdGVEYXRhO1xuXG4gICAgICAgICAgICB2YXIgaW5pdFR5cGUgPSAnJztcbiAgICAgICAgICAgIGlmIChzdWJQcm9jZXNzLmluc3RhbmNlVHlwZS5uZXdTZXF1ZW5jZSAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBpbml0VHlwZSA9IElOU1RBTkNFX1RZUEVfTkVXX1NFUTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3ViUHJvY2Vzcy5pbnN0YW5jZVR5cGUubmV3SW5zdGFuY2UgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgaW5pdFR5cGUgPSBJTlNUQU5DRV9UWVBFX05FV19JTlM7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBpbmRpY2F0b3JEb2MgPSB7fTtcbiAgICAgICAgICAgIGlmIChiYXNlVVVJRCAhPSB1bmRlZmluZWQgJiYgYmFzZVVVSUQgIT0gJycgJiYgYmFzZVVVSUQubGVuZ3RoID4gMCkge1xuXG4gICAgICAgICAgICAgICAgdmFyIHNwID0gSlNPTi54cGF0aChcIi9zdWJwcm9jZXNzZXNbX2lkIGVxICdcIiArIGJhc2VVVUlEICsgXCInXVwiLCBfV0ZJbnN0YW5jZSwge30pWzBdO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGlmKHN1YlByb2Nlc3MucGVyaW9kVHlwZS5wZXJpb2RpYyA9PSB1bmRlZmluZWQpe1xuICAgICAgICAgICAgICAgICAgICBzcC5hY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgaW5zdGFudGlhdGVTb3VyY2UgPSBGUk9NX0FVVEhPUklTRUQ7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyIGNhcmRpbmFsaXR5ID0gSlNPTi54cGF0aChcIi9pbmRpY2F0b3JzW3NldElkIGVxICdcIiArIGluZGljYXRvcklkICsgXCInXS9jYXJkaW5hbGl0eVwiLCBhcHAuU0NPUEUuQVBQX0NPTkZJRywge30pWzBdO1xuXG4gICAgICAgICAgICAgICAgaWYgKGluaXRUeXBlID09IElOU1RBTkNFX1RZUEVfTkVXX0lOUykge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChjYXJkaW5hbGl0eSA9PSBJTkRJQ0FUT1JfQ0FSRElOQUxJVFlfU0lOR0xFKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBleGlzdGluZ1VVSUQgPSBKU09OLnhwYXRoKFwiL2luZGljYXRvcnNbY2F0ZWdvcnkvdGVybSBlcSAnXCIgKyBpbmRpY2F0b3JJZCArIFwiJ10vX2lkXCIsIF9XRkluc3RhbmNlLCB7fSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChleGlzdGluZ1VVSUQubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc3RhbnRpYXRlU291cmNlID0gRlJPTV9BVVRIT1JJU0VEO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnN0YW50aWF0ZVNvdXJjZSA9IEZST01fREVGSU5JVElPTjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGluc3RhbnRpYXRlU291cmNlID0gRlJPTV9ERUZJTklUSU9OO1xuXG4gICAgICAgICAgICAgICAgICAgIH1cblxuXG5cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChjYXJkaW5hbGl0eSA9PSBJTkRJQ0FUT1JfQ0FSRElOQUxJVFlfU0lOR0xFKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBleGlzdGluZ1VVSUQgPSBKU09OLnhwYXRoKFwiL2luZGljYXRvcnNbY2F0ZWdvcnkvdGVybSBlcSAnXCIgKyBpbmRpY2F0b3JJZCArIFwiJ10vX2lkXCIsIGFwcC5TQ09QRS53b3JrZmxvdywge30pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXhpc3RpbmdVVUlELmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnN0YW50aWF0ZVNvdXJjZSA9IEZST01fQVVUSE9SSVNFRDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zdGFudGlhdGVTb3VyY2UgPSBGUk9NX0RFRklOSVRJT047XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhdGggPSBcIi9pbmRpY2F0b3JzW2NhdGVnb3J5L3Rlcm0gZXEgJ1wiICsgaW5kaWNhdG9ySWQgKyBcIiddL19pZFwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN1YnByb2Nlc3NUeXBlID09IFBST0NFU1NfVFlQRV9TVUJQUk9GSUxFKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aCA9IFwiL2luZGljYXRvcnNbY2F0ZWdvcnkvdGVybSBlcSAnXCIgKyBpbmRpY2F0b3JJZCArIFwiJyBhbmQgaWQgPSAvc3VicHJvY2Vzc2VzW2lkID0gJ1wiICsgc3ViUHJvY2Vzc0lkICsgXCInIGFuZCBpZCA9IC9pbnN0YW5jZS9wcm9jZXNzZXMvc3ViUHJvY2Vzc2VzW3N1YnByb2ZpbGVJZCBlcSAnXCIgKyBhcHAucHJvZmlsZS5zdWJwcm9maWxlSWQgKyBcIiddL3V1aWRdL2luZGljYXRvcnMvaW5zdGFuY2VzL3V1aWRdL19pZFwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGV4aXN0aW5nVVVJRCA9IEpTT04ueHBhdGgocGF0aCwgX1dGSW5zdGFuY2UsIHt9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV4aXN0aW5nVVVJRC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zdGFudGlhdGVTb3VyY2UgPSBGUk9NX0FVVEhPUklTRUQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc3RhbnRpYXRlU291cmNlID0gRlJPTV9ERUZJTklUSU9OO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIH1cblxuXG5cbiAgICAgICAgICAgICAgICB9XG5cblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmb3JtQ3JlYXRlRm4oaW5pdFR5cGUsIGluZGljYXRvcklkLCAnJywgaW5zdGFudGlhdGVTb3VyY2UpO1xuICAgICAgICB9XG5cbiAgICB9KTtcbn07XG5cbmZ1bmN0aW9uIHNldEluc3RhbmNlVGl0bGUoYXJncykge1xuXG4gICAgdmFyIF9XRkluc3RhbmNlID0gYXJnc1swXSB8fCB7fTtcblxuICAgIHZhciB1dWlkID0gYXJnc1syXSB8fCAnJztcbiAgICB2YXIgZGF0YSA9IGFyZ3NbNF0gfHwge307XG5cbiAgICB2YXIgdGl0bGUgPSBkYXRhLmxhYmVsO1xuXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuXG4gICAgICAgIHZhciBzdWJQcm9jZXNzSW5zdGFuY2UgPSBKU09OLnhwYXRoKFwiL3N1YnByb2Nlc3Nlc1tfaWQgZXEgJ1wiICsgdXVpZCArIFwiJ11cIiwgX1dGSW5zdGFuY2UsIHt9KVswXTtcbiAgICAgICAgdmFyIGluZGljYXRvckluc3RhbmNlcyA9IHN1YlByb2Nlc3NJbnN0YW5jZS5pbmRpY2F0b3JzO1xuXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaW5kaWNhdG9ySW5zdGFuY2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgaW5kaWNhdG9yVVVJRCA9IGluZGljYXRvckluc3RhbmNlc1tpXS5pbnN0YW5jZXNbMF0udXVpZDtcbiAgICAgICAgICAgIHZhciBpbmRpY2F0b3JJbnN0YW5jZSA9IEpTT04ueHBhdGgoXCIvaW5kaWNhdG9yc1tfaWQgZXEgJ1wiICsgaW5kaWNhdG9yVVVJRCArIFwiJ11cIiwgX1dGSW5zdGFuY2UsIHt9KVswXTtcbiAgICAgICAgICAgIGluZGljYXRvckluc3RhbmNlLnRpdGxlID0gaW5kaWNhdG9ySW5zdGFuY2VzW2ldLmlkICsgJyAnICsgdGl0bGU7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmVzb2x2ZShcIlNldCBUaXRsZSBTdWNjZXNzXCIsIGluZGljYXRvckluc3RhbmNlcyk7XG5cbiAgICB9KTtcblxufTtcblxuZnVuY3Rpb24gZGVsZXRlUHJvZmlsZShhcmdzKSB7XG5cbiAgICB2YXIgX1dGSW5zdGFuY2UgPSBhcmdzWzBdIHx8IHt9O1xuXG4gICAgdmFyIHByb2ZpbGVJZCA9IF9XRkluc3RhbmNlLnByb2ZpbGU7XG5cbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG5cbiAgICAgICAgdmFyIHdvcmtlck9iamVjdCA9IHtcbiAgICAgICAgICAgIFwic291cmNlXCI6IFwicmVtb3RlXCIsXG4gICAgICAgICAgICBcInR5cGVcIjogXCJ3b3JrZXJPYmplY3RcIixcbiAgICAgICAgICAgIFwiX2lkXCI6IGdlbmVyYXRlVVVJRCgpLFxuICAgICAgICAgICAgXCJjaGFubmVsc1wiOiBbXSxcbiAgICAgICAgICAgIFwiY29tbXVuaXR5SWRcIjogYXBwLlNDT1BFLmdldENvbW11bml0eUlkKCksXG4gICAgICAgICAgICBcImFwcGxpY2F0aW9uSWRcIjogYXBwLlNDT1BFLmFwcGxpY2F0aW9uSWQsXG4gICAgICAgICAgICBcIm1lc3NhZ2VcIjogXCJcIixcbiAgICAgICAgICAgIFwibWVzc2FnZVR5cGVcIjogXCJpbmZvXCIsXG4gICAgICAgICAgICBcImNyZWF0ZWREYXRlVGltZVwiOiBtb21lbnQoKS5mb3JtYXQoKSxcbiAgICAgICAgICAgIFwic2VuZGVyVXNlcklkXCI6IExPQ0FMX1NFVFRJTkdTLlNVQlNDUklQVElPTlMudXNlcklkLFxuICAgICAgICAgICAgXCJub3RpZmljYXRpb25cIjoge1xuXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJwcm9maWxlXCI6IHtcbiAgICAgICAgICAgICAgICBcImFjdGlvblwiOiBcImRlbGV0ZVByb2ZpbGVcIixcbiAgICAgICAgICAgICAgICBcInByb2ZpbGVJZFwiOiBwcm9maWxlSWRcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9XG5cbiAgICAgICAgY29uc29sZS5sb2cod29ya2VyT2JqZWN0KTtcbiAgICAgICAgZGFvLnVwc2VydCh3b3JrZXJPYmplY3QpLmRvbmUoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJXb3JrZXIgT2JqZWN0IHN1Ym1pdHRlZCBmb3IgcHJvZmlsZShcIiArIHByb2ZpbGVJZCArIFwiKSBkZWxldGlvbi5cIik7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcbiAgICAgICAgICAgIHJlc29sdmUoZGF0YSk7XG4gICAgICAgIH0pLmZhaWwoZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICAgICAgcmVqZWN0KGRhdGEpO1xuICAgICAgICB9KTtcblxuICAgIH0pO1xuXG59O1xuXG5mdW5jdGlvbiBjcmVhdGVQcm9maWxlKGFyZ3MpIHtcblxuICAgIHZhciBfV0ZJbnN0YW5jZSA9IGFyZ3NbMV0gfHwge307XG5cbiAgICB2YXIgY29tbXVuaXR5SWQgPSBfV0ZJbnN0YW5jZS5jb21tdW5pdHlJZDtcbiAgICB2YXIgcHJvZmlsZUlkID0gX1dGSW5zdGFuY2UucHJvZmlsZTtcblxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcblxuICAgICAgICBsaWJyYXJ5LmNyZWF0ZVByb2ZpbGVEb2N1bWVudHMoY29tbXVuaXR5SWQsIHByb2ZpbGVJZCkuZG9uZShmdW5jdGlvbihkYXRhKSB7XG5cbiAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdGb3JtIGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5LicsIGRhdGEpO1xuICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcblxuICAgICAgICB9KS5mYWlsKGZ1bmN0aW9uKGVycikge1xuXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgICAgICAgICB2YXIgZmFpbHVyZSA9IHV0aWwuc3VjY2VzcygnRVJST1I6IFByb2ZpbGUgY3JlYXRpb24gZmFpbGVkJyArIGVyclswXS5tZXNzYWdlLCB7fSk7XG4gICAgICAgICAgICByZWplY3QoZmFpbHVyZSk7XG5cbiAgICAgICAgfSk7XG5cbiAgICB9KTtcbn07XG5cbmZ1bmN0aW9uIHNldERyYWZ0KGFyZ3MpIHtcblxuICAgIHZhciBfV0ZJbnN0YW5jZSA9IGFyZ3NbMF0gfHwge307XG5cbiAgICB2YXIgY29tbXVuaXR5SWQgPSBfV0ZJbnN0YW5jZS5jb21tdW5pdHlJZDtcbiAgICB2YXIgcHJvZmlsZUlkID0gX1dGSW5zdGFuY2UucHJvZmlsZTtcbiAgICB2YXIgdXVpZCA9IGFyZ3NbMl0gfHwgJyc7XG5cbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG5cbiAgICAgICAgdmFyIHN1YlByb2Nlc3NJbnN0YW5jZSA9IEpTT04ueHBhdGgoXCIvc3VicHJvY2Vzc2VzW19pZCBlcSAnXCIgKyB1dWlkICsgXCInXVwiLCBfV0ZJbnN0YW5jZSwge30pWzBdO1xuICAgICAgICB2YXIgaW5kaWNhdG9ySW5zdGFuY2VzID0gc3ViUHJvY2Vzc0luc3RhbmNlLmluZGljYXRvcnM7XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpbmRpY2F0b3JJbnN0YW5jZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBpbmRpY2F0b3JVVUlEID0gaW5kaWNhdG9ySW5zdGFuY2VzW2ldLmluc3RhbmNlc1swXS51dWlkO1xuICAgICAgICAgICAgdmFyIGluZGljYXRvckluc3RhbmNlID0gSlNPTi54cGF0aChcIi9pbmRpY2F0b3JzW19pZCBlcSAnXCIgKyBpbmRpY2F0b3JVVUlEICsgXCInXVwiLCBfV0ZJbnN0YW5jZSwge30pWzBdO1xuICAgICAgICAgICAgaW5kaWNhdG9ySW5zdGFuY2UuY29udHJvbC5kcmFmdCA9IHRydWU7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmVzb2x2ZShcIlNldCBEcmFmdCBTdWNjZXNzXCIsIGluZGljYXRvckluc3RhbmNlcyk7XG5cbiAgICB9KTtcbn07XG5cbmZ1bmN0aW9uIHNldFVuRHJhZnQoYXJncykge1xuXG4gICAgdmFyIF9XRkluc3RhbmNlID0gYXJnc1swXSB8fCB7fTtcblxuICAgIHZhciBjb21tdW5pdHlJZCA9IF9XRkluc3RhbmNlLmNvbW11bml0eUlkO1xuICAgIHZhciBwcm9maWxlSWQgPSBfV0ZJbnN0YW5jZS5wcm9maWxlO1xuICAgIHZhciB1dWlkID0gYXJnc1syXSB8fCAnJztcblxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcblxuICAgICAgICB2YXIgc3ViUHJvY2Vzc0luc3RhbmNlID0gSlNPTi54cGF0aChcIi9zdWJwcm9jZXNzZXNbX2lkIGVxICdcIiArIHV1aWQgKyBcIiddXCIsIF9XRkluc3RhbmNlLCB7fSlbMF07XG4gICAgICAgIHZhciBpbmRpY2F0b3JJbnN0YW5jZXMgPSBzdWJQcm9jZXNzSW5zdGFuY2UuaW5kaWNhdG9ycztcblxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGluZGljYXRvckluc3RhbmNlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGluZGljYXRvclVVSUQgPSBpbmRpY2F0b3JJbnN0YW5jZXNbaV0uaW5zdGFuY2VzWzBdLnV1aWQ7XG4gICAgICAgICAgICB2YXIgaW5kaWNhdG9ySW5zdGFuY2UgPSBKU09OLnhwYXRoKFwiL2luZGljYXRvcnNbX2lkIGVxICdcIiArIGluZGljYXRvclVVSUQgKyBcIiddXCIsIF9XRkluc3RhbmNlLCB7fSlbMF07XG4gICAgICAgICAgICBpbmRpY2F0b3JJbnN0YW5jZS5jb250cm9sLmRyYWZ0ID0gZmFsc2U7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmVzb2x2ZShcIlNldCBEcmFmdCBTdWNjZXNzXCIsIGluZGljYXRvckluc3RhbmNlcyk7XG5cbiAgICB9KTtcbn07XG5cbmZ1bmN0aW9uIHNhdmUoaW5kaWNhdG9yKSB7XG4gICAgdmFyIGNvbXBsZXRlZCA9IFtdO1xuICAgIHZhciByZXN1bHQgPSB7XG4gICAgICAgIGNvbXBsZXRlOiB0cnVlLFxuICAgICAgICBkYXRhOiBbXVxuICAgIH07XG5cbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdGb3JtIGluZGljYXRvciBzZXQgc2F2ZWQgc3VjY2Vzc2Z1bGx5LicsIHJlc3VsdCk7XG4gICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XG4gICAgfSk7XG59O1xuXG5mdW5jdGlvbiBzdWJtaXQoZm9ybSkge1xuICAgIHZhciBjb21wbGV0ZWQgPSBbXTtcbiAgICB2YXIgcmVzdWx0ID0ge1xuICAgICAgICBjb21wbGV0ZTogdHJ1ZSxcbiAgICAgICAgZGF0YTogW11cbiAgICB9O1xuXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnRm9ybSBzdWJtaXR0ZWQgc3VjY2Vzc2Z1bGx5LicsIHJlc3VsdCk7XG4gICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XG4gICAgfSk7XG59O1xuXG5mdW5jdGlvbiBhdXRob3Jpc2UoZm9ybSkge1xuICAgIHZhciBjb21wbGV0ZWQgPSBbXTtcbiAgICB2YXIgcmVzdWx0ID0ge1xuICAgICAgICBjb21wbGV0ZTogdHJ1ZSxcbiAgICAgICAgZGF0YTogW11cbiAgICB9O1xuXG4gICAgdmFyIHByb2Nlc3NJZCA9IGZvcm1bMF0gfHwgJyc7XG5cbiAgICB2YXIgc3ViUHJvY2VzcyA9IGZvcm1bMV0gfHwge307XG5cbiAgICB2YXIgc3ViUHJvY2Vzc0lkID0gc3ViUHJvY2Vzcy5faWQ7XG5cbiAgICB2YXIgcHJvY2Vzc1NlcSA9IGZvcm1bMl0gfHwgJyc7XG5cbiAgICB2YXIgc3ViUHJvY2Vzc1NlcSA9IGZvcm1bM10gfHwgJyc7XG5cbiAgICB2YXIgX1dGSW5zdGFuY2UgPSBmb3JtWzRdIHx8IHt9O1xuXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuXG4gICAgICAgIHZhciBzdWJQcm9jZXNzVVVJRCA9IEpTT04ueHBhdGgoXCIvcHJvY2Vzc2VzW2lkIGVxICdcIiArIHByb2Nlc3NJZCArIFwiJyBhbmQgc2VxIGVxICdcIiArIHByb2Nlc3NTZXEgKyBcIiddL3N1YlByb2Nlc3Nlc1tpZCBlcSAnXCIgKyBzdWJQcm9jZXNzSWQgKyBcIicgYW5kIHNlcSBlcSAnXCIgKyBzdWJQcm9jZXNzU2VxICsgXCInXS91dWlkXCIsIF9XRkluc3RhbmNlLmluc3RhbmNlLCB7fSlbMF07XG4gICAgICAgIHZhciBzcEluZGljYXRvcnMgPSBKU09OLnhwYXRoKFwiL3N1YnByb2Nlc3Nlc1tfaWQgZXEgJ1wiICsgc3ViUHJvY2Vzc1VVSUQgKyBcIiddL2luZGljYXRvcnMvaW5zdGFuY2VzL3V1aWRcIiwgX1dGSW5zdGFuY2UsIHt9KTtcbiAgICAgICAgdmFyIGl0ZW1zVG9Qcm9jZXNzID0gc3BJbmRpY2F0b3JzLmxlbmd0aDtcbiAgICAgICAgdmFyIHVwZGF0ZWRPYmplY3RzQXJyYXkgPSBbXTtcblxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGl0ZW1zVG9Qcm9jZXNzOyBpKyspIHtcblxuICAgICAgICAgICAgZ2F0ZWtlZXBlci5hdXRob3Jpc2Uoc3BJbmRpY2F0b3JzW2ldKS50aGVuKGZ1bmN0aW9uKGF1dGhvcmlzZWRSZXR1cm4pIHtcblxuICAgICAgICAgICAgICAgIGdhdGVrZWVwZXIucGVyc2lzdChhdXRob3Jpc2VkUmV0dXJuKS50aGVuKGZ1bmN0aW9uKHNhdmVkQXJyYXkpIHtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgdXVpZFNhdmVkSW5kaWNhdG9yID0gJyc7XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGMgPSAwOyBjIDwgc2F2ZWRBcnJheS5sZW5ndGg7IGMrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzYXZlZEFycmF5W2NdLmlkLmVuZHNXaXRoKCc6YXBwcm92ZWQnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV1aWRTYXZlZEluZGljYXRvciA9IHNhdmVkQXJyYXlbY10uaWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGRhby5nZXQodXVpZFNhdmVkSW5kaWNhdG9yKS5kb25lKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfV0ZJbnN0YW5jZS5pbmRpY2F0b3JzLmxlbmd0aCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX1dGSW5zdGFuY2UuaW5kaWNhdG9ycy5wdXNoKGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zVG9Qcm9jZXNzLS07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW1zVG9Qcm9jZXNzID09IDApIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnRm9ybSBhdXRob3Jpc2VkIHN1Y2Nlc3NmdWxseS4nLCB1cGRhdGVkT2JqZWN0c0FycmF5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZvdW5kID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IF9XRkluc3RhbmNlLmluZGljYXRvcnMubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbmRpY2F0b3IgPSBfV0ZJbnN0YW5jZS5pbmRpY2F0b3JzW2luZGV4XTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZGljYXRvci5faWQgPT0gZGF0YS5faWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZSB0aGUgY3VycmVudCBpdGVtIGZyb20gdGhlIGFycmF5IGFuZCBhZGQgdGhlIHVwZGF0ZWQgcHJvY2Vzc01vZGVsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfV0ZJbnN0YW5jZS5pbmRpY2F0b3JzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfV0ZJbnN0YW5jZS5pbmRpY2F0b3JzLnB1c2goZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtc1RvUHJvY2Vzcy0tO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW1zVG9Qcm9jZXNzID09IDApIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdGb3JtIGF1dGhvcmlzZWQgc3VjY2Vzc2Z1bGx5LicsIHVwZGF0ZWRPYmplY3RzQXJyYXkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZvdW5kID09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9XRkluc3RhbmNlLmluZGljYXRvcnMucHVzaChkYXRhKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtc1RvUHJvY2Vzcy0tO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbXNUb1Byb2Nlc3MgPT0gMCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnRm9ybSBhdXRob3Jpc2VkIHN1Y2Nlc3NmdWxseS4nLCB1cGRhdGVkT2JqZWN0c0FycmF5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIH0pLmZhaWwoZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9LCBmdW5jdGlvbihlcnJvcikge1xuICAgICAgICAgICAgICAgIGl0ZW1zVG9Qcm9jZXNzLS07XG4gICAgICAgICAgICAgICAgaWYgKGl0ZW1zVG9Qcm9jZXNzID09IDApIHtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnRm9ybSBhdXRob3Jpc2VkIHN1Y2Nlc3NmdWxseS4nLCB1cGRhdGVkT2JqZWN0c0FycmF5KTtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH1cblxuICAgIH0pO1xufTtcblxuZnVuY3Rpb24gY2xvc2UoZm9ybSkge1xuICAgIHZhciBjb21wbGV0ZWQgPSBbXTtcbiAgICB2YXIgcmVzdWx0ID0ge1xuICAgICAgICBjb21wbGV0ZTogdHJ1ZSxcbiAgICAgICAgZGF0YTogW11cbiAgICB9O1xuXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnRm9ybSBjbG9zZWQgc3VjY2Vzc2Z1bGx5LicsIHJlc3VsdCk7XG4gICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XG4gICAgfSk7XG59O1xuXG5mdW5jdGlvbiB1cGRhdGVJbmRpY2F0b3IoYXJncykge1xuXG4gICAgdmFyIF9XRkluc3RhbmNlID0gYXJnc1swXSB8fCB7fTtcblxuICAgIHZhciB1dWlkID0gYXJnc1sxXSB8fCAnJztcbiAgICB2YXIgcGF0aCA9IGFyZ3NbMl0gfHwgJyc7XG4gICAgdmFyIGRhdGFWYWx1ZSA9IGFyZ3NbM10gfHwgJyc7XG5cbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG5cbiAgICAgICAgdmFyIHN1YlByb2Nlc3NJbnN0YW5jZSA9IEpTT04ueHBhdGgoXCIvc3VicHJvY2Vzc2VzW19pZCBlcSAnXCIgKyB1dWlkICsgXCInXVwiLCBfV0ZJbnN0YW5jZSwge30pWzBdO1xuICAgICAgICB2YXIgaW5kaWNhdG9ySW5zdGFuY2VzID0gc3ViUHJvY2Vzc0luc3RhbmNlLmluZGljYXRvcnM7XG4gICAgICAgIHZhciBzZXRJZCA9IHBhdGguc3BsaXQoXCIuXCIsIDEpWzBdO1xuICAgICAgICB2YXIgaW5kaWNhdG9yVVVJRCA9IEpTT04ueHBhdGgoXCIvKltpZCBlcSAnXCIgKyBzZXRJZCArIFwiJ10vaW5zdGFuY2VzL3V1aWRcIiwgaW5kaWNhdG9ySW5zdGFuY2VzLCB7fSlbMF07XG4gICAgICAgIHZhciBpbmRPYmplY3QgPSBKU09OLnhwYXRoKFwiL2luZGljYXRvcnNbX2lkIGVxICdcIiArIGluZGljYXRvclVVSUQgKyBcIiddXCIsIF9XRkluc3RhbmNlLCB7fSlbMF07XG4gICAgICAgIHZhciBleHByID0gJ2luZE9iamVjdC5tb2RlbC5wZW5kaW5nLmRhdGEuJyArIHBhdGggKyAnID0gXCInICsgZGF0YVZhbHVlICsgJ1wiJztcbiAgICAgICAgZXZhbChleHByKTtcbiAgICAgICAgdmFyIGl0ZW1zVG9Qcm9jZXNzID0gMTtcbiAgICAgICAgdmFyIHN0dWZmID0gW107XG4gICAgICAgIHZhciBvYmogPSB7fTtcblxuICAgICAgICBvYmoubW9kZWwgPSBpbmRPYmplY3Q7XG4gICAgICAgIHN0dWZmLnB1c2gob2JqKTtcblxuICAgICAgICBnYXRla2VlcGVyLnBlcnNpc3Qoc3R1ZmYpLnRoZW4oZnVuY3Rpb24oc2F2ZWRBcnJheSkge1xuXG4gICAgICAgICAgICB2YXIgdXVpZFNhdmVkSW5kaWNhdG9yID0gJyc7XG4gICAgICAgICAgICBmb3IgKHZhciBjID0gMDsgYyA8IHNhdmVkQXJyYXkubGVuZ3RoOyBjKyspIHtcbiAgICAgICAgICAgICAgICBpZiAoIXNhdmVkQXJyYXlbY10uaWQuZW5kc1dpdGgoJzphcHByb3ZlZCcpKSB7XG4gICAgICAgICAgICAgICAgICAgIHV1aWRTYXZlZEluZGljYXRvciA9IHNhdmVkQXJyYXlbY10uaWQ7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGRhby5nZXQodXVpZFNhdmVkSW5kaWNhdG9yKVxuICAgICAgICAgICAgICAgIC5kb25lKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKF9XRkluc3RhbmNlLmluZGljYXRvcnMubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9XRkluc3RhbmNlLmluZGljYXRvcnMucHVzaChkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zVG9Qcm9jZXNzLS07XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbXNUb1Byb2Nlc3MgPT0gMCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ0luZGljYXRvciB1cGRhdGVkLicsIHN0dWZmKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZm91bmQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGluZGV4ID0gMDsgaW5kZXggPCBfV0ZJbnN0YW5jZS5pbmRpY2F0b3JzLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbmRpY2F0b3IgPSBfV0ZJbnN0YW5jZS5pbmRpY2F0b3JzW2luZGV4XTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5kaWNhdG9yLl9pZCA9PSBkYXRhLl9pZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZSB0aGUgY3VycmVudCBpdGVtIGZyb20gdGhlIGFycmF5IGFuZCBhZGQgdGhlIHVwZGF0ZWQgcHJvY2Vzc01vZGVsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9XRkluc3RhbmNlLmluZGljYXRvcnMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX1dGSW5zdGFuY2UuaW5kaWNhdG9ycy5wdXNoKGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtc1RvUHJvY2Vzcy0tO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbXNUb1Byb2Nlc3MgPT0gMCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnSW5kaWNhdG9yIHVwZGF0ZWQuJywgc3R1ZmYpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmb3VuZCA9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9XRkluc3RhbmNlLmluZGljYXRvcnMucHVzaChkYXRhKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zVG9Qcm9jZXNzLS07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW1zVG9Qcm9jZXNzID09IDApIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnSW5kaWNhdG9yIHVwZGF0ZWQuJywgc3R1ZmYpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH0pLmZhaWwoZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICB9LCBmdW5jdGlvbihlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgIH0pO1xuXG4gICAgfSk7XG59O1xuXG5mdW5jdGlvbiBtYXJrVXBkYXRlSW5kaWNhdG9yKGFyZ3MpIHtcblxuICAgIHZhciBfV0ZJbnN0YW5jZSA9IGFyZ3NbMF0gfHwge307XG5cbiAgICB2YXIgdXVpZCA9IGFyZ3NbMV0gfHwgJyc7XG4gICAgdmFyIHN0YXR1cyA9IGFyZ3NbMl0gfHwgJyc7XG4gICAgdmFyIGluZGljYXRvclNldElkID0gYXJnc1szXSB8fCAnJztcblxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcblxuICAgICAgICB2YXIgaW5kT2JqZWN0ID0gSlNPTi54cGF0aChcIi9pbmRpY2F0b3JzW2NhdGVnb3J5L3Rlcm0gZXEgJ1wiICsgaW5kaWNhdG9yU2V0SWQgKyBcIiddXCIsIF9XRkluc3RhbmNlLCB7fSlbMF07XG4gICAgICAgIGluZE9iamVjdC5tb2RlbC5wZW5kaW5nLnN0YXR1cyA9IHN0YXR1cztcblxuICAgICAgICB2YXIgaXRlbXNUb1Byb2Nlc3MgPSAxO1xuICAgICAgICB2YXIgc3R1ZmYgPSBbXTtcbiAgICAgICAgdmFyIG9iaiA9IHt9O1xuXG4gICAgICAgIG9iai5tb2RlbCA9IGluZE9iamVjdDtcbiAgICAgICAgc3R1ZmYucHVzaChvYmopO1xuXG4gICAgICAgIGdhdGVrZWVwZXIucGVyc2lzdChzdHVmZikudGhlbihmdW5jdGlvbihzYXZlZEFycmF5KSB7XG5cbiAgICAgICAgICAgIHZhciB1dWlkU2F2ZWRJbmRpY2F0b3IgPSAnJztcbiAgICAgICAgICAgIGZvciAodmFyIGMgPSAwOyBjIDwgc2F2ZWRBcnJheS5sZW5ndGg7IGMrKykge1xuICAgICAgICAgICAgICAgIGlmICghc2F2ZWRBcnJheVtjXS5pZC5lbmRzV2l0aCgnOmFwcHJvdmVkJykpIHtcbiAgICAgICAgICAgICAgICAgICAgdXVpZFNhdmVkSW5kaWNhdG9yID0gc2F2ZWRBcnJheVtjXS5pZDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZGFvLmdldCh1dWlkU2F2ZWRJbmRpY2F0b3IpXG4gICAgICAgICAgICAgICAgLmRvbmUoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoX1dGSW5zdGFuY2UuaW5kaWNhdG9ycy5sZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX1dGSW5zdGFuY2UuaW5kaWNhdG9ycy5wdXNoKGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXNUb1Byb2Nlc3MtLTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtc1RvUHJvY2VzcyA9PSAwKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnSW5kaWNhdG9yIHVwZGF0ZWQuJywgc3R1ZmYpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmb3VuZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IF9XRkluc3RhbmNlLmluZGljYXRvcnMubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGluZGljYXRvciA9IF9XRkluc3RhbmNlLmluZGljYXRvcnNbaW5kZXhdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmRpY2F0b3IuX2lkID09IGRhdGEuX2lkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIHRoZSBjdXJyZW50IGl0ZW0gZnJvbSB0aGUgYXJyYXkgYW5kIGFkZCB0aGUgdXBkYXRlZCBwcm9jZXNzTW9kZWxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX1dGSW5zdGFuY2UuaW5kaWNhdG9ycy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfV0ZJbnN0YW5jZS5pbmRpY2F0b3JzLnB1c2goZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zVG9Qcm9jZXNzLS07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtc1RvUHJvY2VzcyA9PSAwKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdJbmRpY2F0b3IgdXBkYXRlZC4nLCBzdHVmZik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZvdW5kID09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX1dGSW5zdGFuY2UuaW5kaWNhdG9ycy5wdXNoKGRhdGEpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXNUb1Byb2Nlc3MtLTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbXNUb1Byb2Nlc3MgPT0gMCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdJbmRpY2F0b3IgdXBkYXRlZC4nLCBzdHVmZik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH0sIGZ1bmN0aW9uKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICAgICAgfSk7XG5cbiAgICB9KTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuXG4gICAgY3JlYXRlOiBjcmVhdGUsXG4gICAgc2F2ZTogc2F2ZSxcbiAgICBzdWJtaXQ6IHN1Ym1pdCxcbiAgICBhdXRob3Jpc2U6IGF1dGhvcmlzZSxcbiAgICBjbG9zZTogY2xvc2UsXG4gICAgc2V0RHJhZnQ6IHNldERyYWZ0LFxuICAgIHNldFVuRHJhZnQ6IHNldFVuRHJhZnQsXG4gICAgY3JlYXRlUHJvZmlsZTogY3JlYXRlUHJvZmlsZSxcbiAgICBzZXRJbnN0YW5jZVRpdGxlOiBzZXRJbnN0YW5jZVRpdGxlLFxuICAgIGRlbGV0ZVByb2ZpbGU6IGRlbGV0ZVByb2ZpbGUsXG4gICAgdXBkYXRlSW5kaWNhdG9yOiB1cGRhdGVJbmRpY2F0b3IsXG4gICAgbWFya1VwZGF0ZUluZGljYXRvcjogbWFya1VwZGF0ZUluZGljYXRvclxuXG59IiwiJ3VzZSBzdHJpY3QnO1xuXG5cbmZ1bmN0aW9uIGdldExhbmd1YWdlTWVzc2FnZShtZXNzYWdlKSB7XG5cbiAgICB2YXIgbGFuZ3VhZ2UgPSBzZXJ2aWNlLmdldExhbmd1YWdlKCk7XG4gICAgdmFyIHJlcyA9IGV2YWwoXCJtZXNzYWdlLmkxOG4uXCIgKyBsYW5ndWFnZSk7XG4gICAgY29uc29sZS5sb2cocmVzKTtcbiAgICByZXR1cm4gcmVzO1xuXG59O1xuXG5mdW5jdGlvbiBnZXROb2RlVmFsdWUoZGF0YSwgX1dGSW5zdGFuY2UsIHV1aWQpIHtcblxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcblxuICAgICAgICBpZiAoZGF0YS52YWx1ZSAhPSB1bmRlZmluZWQpIHtcblxuICAgICAgICAgICAgcmVzb2x2ZShkYXRhLnZhbHVlLmRhdGEpO1xuXG4gICAgICAgIH0gZWxzZSBpZiAoZGF0YS5pbmRpY2F0b3JVVUlEICE9IHVuZGVmaW5lZCkge1xuXG4gICAgICAgICAgICByZWplY3QoXCJFUlJPUjogVW5pbXBsZW1lbnRlZCB2YWx1ZSB0eXBlIGZvdW5kLlwiKTtcblxuICAgICAgICB9IGVsc2UgaWYgKGRhdGEuaW5kaWNhdG9yICE9IHVuZGVmaW5lZCkge1xuXG4gICAgICAgICAgICB2YXIgaW5kaWNhdG9yVVVJRCA9IEpTT04ueHBhdGgoXCIvc3VicHJvY2Vzc2VzW19pZCBlcSAnXCIgKyB1dWlkICsgXCInXS9pbmRpY2F0b3JzW2lkIGVxICdcIiArIGRhdGEuaW5kaWNhdG9yLmluZGljYXRvclNldElkICsgXCInXS9pbnN0YW5jZXMvdXVpZFwiLCBfV0ZJbnN0YW5jZSwge30pWzBdO1xuICAgICAgICAgICAgdmFyIGluZE9iamVjdCA9IEpTT04ueHBhdGgoXCIvaW5kaWNhdG9yc1tfaWQgZXEgJ1wiICsgaW5kaWNhdG9yVVVJRCArIFwiJ11cIiwgX1dGSW5zdGFuY2UsIHt9KVswXTtcbiAgICAgICAgICAgIHZhciB4cGF0aCA9ICcvbW9kZWwvcGVuZGluZy9kYXRhLycgKyBkYXRhLmluZGljYXRvci5pbmRpY2F0b3JTZXRJZCArICcvJyArIGRhdGEuaW5kaWNhdG9yLmVsZW1lbnRJZDtcblxuICAgICAgICAgICAgdmFyIHNlcSA9IEpTT04ueHBhdGgoXCJjb3VudCgvc3VicHJvY2Vzc2VzW19pZCBlcSAnXCIgKyB1dWlkICsgXCInXS9wcmVjZWRpbmctc2libGluZzo6bm9kZSgpW2lkID0gL3N1YnByb2Nlc3Nlc1tfaWQgZXEgJ1wiICsgdXVpZCArIFwiJ10vaWRdKVwiLCBfV0ZJbnN0YW5jZSwge30pWzBdICsgMTtcbiAgICAgICAgICAgIHZhciBzdWJwcm9jZXNzVHlwZSA9IEpTT04ueHBhdGgoXCIvY29uZmlnL3Byb2Nlc3Nlcy9zdWJQcm9jZXNzZXNbX2lkIGVxIC9zdWJwcm9jZXNzZXNbX2lkIGVxICdcIiArIHV1aWQgKyBcIiddL2lkXS90eXBlXCIsIF9XRkluc3RhbmNlLCB7fSlbMF07XG5cbiAgICAgICAgICAgIGlmIChzdWJwcm9jZXNzVHlwZSA9PSBQUk9DRVNTX1RZUEVfU1VCUFJPRklMRSkge1xuICAgICAgICAgICAgICAgIHNlcSA9IEpTT04ueHBhdGgoXCJjb3VudCgvc3VicHJvY2Vzc2VzW19pZCBlcSAnXCIgKyB1dWlkICsgXCInXS9wcmVjZWRpbmctc2libGluZzo6bm9kZSgpW2lkID0gL3N1YnByb2Nlc3Nlc1tfaWQgZXEgJ1wiICsgdXVpZCArIFwiJ10vaWQgYW5kIGlkID0gL3N1YnByb2Nlc3Nlc1tfaWQgPSAvaW5zdGFuY2UvcHJvY2Vzc2VzL3N1YlByb2Nlc3Nlc1tzdWJwcm9maWxlSWQgZXEgJ1wiICsgYXBwLnByb2ZpbGUuc3VicHJvZmlsZUlkICsgXCInXS91dWlkXSlcIiwgX1dGSW5zdGFuY2UsIHt9KVswXSArIDE7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciByZXBsYWNlZFBhdGggPSByZXBsYWNlQWxsKHhwYXRoLCAnI1NFUVVFTkNFIycsIHNlcSk7XG5cbiAgICAgICAgICAgIHZhciB2YWxpZERhdGUgPSBKU09OLnhwYXRoKFwiL3N1YnByb2Nlc3Nlc1tfaWQgZXEgJ1wiICsgdXVpZCArIFwiJ10vZGF0ZXMvdmFsaWRcIiwgX1dGSW5zdGFuY2UsIHt9KVswXTtcbiAgICAgICAgICAgIHZhciBjb25jYXRWYWxpZERhdGUgPSBcIidcIiArIHZhbGlkRGF0ZSArIFwiJ1wiO1xuICAgICAgICAgICAgdmFyIG5ld1BhdGggPSByZXBsYWNlQWxsKHJlcGxhY2VkUGF0aCwgJyNFTkRfREFURSMnLCBjb25jYXRWYWxpZERhdGUpO1xuICAgICAgICAgICAgdmFyIGRvdFJlcGxhY2VkID0gcmVwbGFjZUFsbChuZXdQYXRoLCAnWy5dJywgJy8nKTtcbiAgICAgICAgICAgIHZhciByZXRWYWx1ZSA9IEpTT04ueHBhdGgoZG90UmVwbGFjZWQsIGluZE9iamVjdCwge30pWzBdO1xuXG4gICAgICAgICAgICByZXNvbHZlKHJldFZhbHVlKTtcblxuICAgICAgICB9IGVsc2UgaWYgKGRhdGEuc3lzdGVtICE9IHVuZGVmaW5lZCkge1xuXG4gICAgICAgICAgICByZXNvbHZlKFwiRVJST1I6IFVuaW1wbGVtZW50ZWQgc3lzdGVtIHR5cGUgZm91bmQuXCIpO1xuXG4gICAgICAgIH0gZWxzZSBpZiAoZGF0YS52YXJpYWJsZSAhPSB1bmRlZmluZWQpIHtcblxuICAgICAgICAgICAgaWYgKGRhdGEudmFyaWFibGUucHJvZmlsZSAhPSB1bmRlZmluZWQpIHtcblxuICAgICAgICAgICAgICAgIHZhciB2YXJpYWJsZU5hbWUgPSBkYXRhLnZhcmlhYmxlLnByb2ZpbGU7XG5cbiAgICAgICAgICAgICAgICB2YXIgcHJvZmlsZUlkID0gX1dGSW5zdGFuY2UucHJvZmlsZTtcbiAgICAgICAgICAgICAgICB2YXIgcHJvZmlsZVZhcmlhYmxlRmlsZU5hbWUgPSBwcm9maWxlSWQgKyAnOnZhcmlhYmxlcyc7XG5cbiAgICAgICAgICAgICAgICBkYW8uZ2V0KHByb2ZpbGVWYXJpYWJsZUZpbGVOYW1lKS5kb25lKGZ1bmN0aW9uKGZpbGUpIHtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgb2JqID0gZXZhbCgnZmlsZS4nICsgdmFyaWFibGVOYW1lKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG9iaiA9PSAnb2JqZWN0Jykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2VxID0gSlNPTi54cGF0aChcImNvdW50KC9zdWJwcm9jZXNzZXNbX2lkIGVxICdcIiArIHV1aWQgKyBcIiddL3ByZWNlZGluZy1zaWJsaW5nOjpub2RlKClbaWQgPSAvc3VicHJvY2Vzc2VzW19pZCBlcSAnXCIgKyB1dWlkICsgXCInXS9pZF0pXCIsIF9XRkluc3RhbmNlLCB7fSlbMF0gKyAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN1YnByb2Nlc3NUeXBlID0gSlNPTi54cGF0aChcIi9jb25maWcvcHJvY2Vzc2VzL3N1YlByb2Nlc3Nlc1tfaWQgZXEgL3N1YnByb2Nlc3Nlc1tfaWQgZXEgJ1wiICsgdXVpZCArIFwiJ10vaWRdL3R5cGVcIiwgX1dGSW5zdGFuY2UsIHt9KVswXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdWJwcm9jZXNzVHlwZSA9PSBQUk9DRVNTX1RZUEVfU1VCUFJPRklMRSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlcSA9IEpTT04ueHBhdGgoXCJjb3VudCgvc3VicHJvY2Vzc2VzW19pZCBlcSAnXCIgKyB1dWlkICsgXCInXS9wcmVjZWRpbmctc2libGluZzo6bm9kZSgpW2lkID0gL3N1YnByb2Nlc3Nlc1tfaWQgZXEgJ1wiICsgdXVpZCArIFwiJ10vaWQgYW5kIGlkID0gL3N1YnByb2Nlc3Nlc1tfaWQgPSAvaW5zdGFuY2UvcHJvY2Vzc2VzL3N1YlByb2Nlc3Nlc1tzdWJwcm9maWxlSWQgZXEgJ1wiICsgYXBwLnByb2ZpbGUuc3VicHJvZmlsZUlkICsgXCInXS91dWlkXSlcIiwgX1dGSW5zdGFuY2UsIHt9KVswXSArIDE7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZVBhdGggPSBcIi9cIiArIHZhcmlhYmxlTmFtZSArIFwiW3NlcSBlcSAnXCIgKyBzZXEgKyBcIiddL3ZhbHVlXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmV0VmFsdWUgPSBKU09OLnhwYXRoKHZhbHVlUGF0aCwgZmlsZSwge30pWzBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXRWYWx1ZSk7XG5cblxuXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIG9iaiA9PSAnc3RyaW5nJykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG9iaik7XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbihlcnJvcikge1xuXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChcIkVSUk9SOiBQcm9maWxlIHZhcmlhYmxlcyBub3QgZm91bmRcIik7XG5cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZWplY3QoXCJFUlJPUjogVW5pbXBsZW1lbnRlZCBwcm9maWxlIHR5cGUgZm91bmQuXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH1cblxuICAgIH0pO1xuXG5cblxufTtcblxuXG5mdW5jdGlvbiByZXBsYWNlQWxsKHR4dCwgcmVwbGFjZSwgd2l0aF90aGlzKSB7XG4gICAgaWYgKHR5cGVvZiB0eHQucmVwbGFjZSAhPSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKHJlcGxhY2UgKyAnICcgKyB3aXRoX3RoaXMpO1xuICAgICAgICBjb25zb2xlLmxvZyh0eHQpO1xuICAgIH1cbiAgICByZXR1cm4gdHh0LnJlcGxhY2UobmV3IFJlZ0V4cChyZXBsYWNlLCAnZycpLCB3aXRoX3RoaXMpO1xufVxuXG5cbm1vZHVsZS5leHBvcnRzID0ge1xuXG4gICAgZ2V0TGFuZ3VhZ2VNZXNzYWdlOiBnZXRMYW5ndWFnZU1lc3NhZ2UsXG4gICAgZ2V0Tm9kZVZhbHVlOiBnZXROb2RlVmFsdWVcblxufSIsIid1c2Ugc3RyaWN0JztcblxudmFyIHV0aWwgPSByZXF1aXJlKCd1dGlsaXR5Jyk7XG5cbi8qKlxuICogVXNlciBJbnRlcmZhY2UgTW9kdWxlXG4gKlxuICogQG1vZHVsZSBsaWIvdWlcbiAqIEBhdXRob3IgQnJlbnQgR29yZG9uXG4gKiBAdmVyc2lvbiAwLjEuMFxuICogQGRlc2NyaXB0aW9uIHRlc3QgZGVzY3JpcHRpb25cbiAqXG4gKi9cblxuIC8qKlxuICAqIEdldCBhbGwgcHJvY2VzcyBzdWItcHJvY2Vzc2VzIHVzZXIgaW50ZXJmYWNlIGRhdGFcbiAgKlxuICAqIEBwYXJhbSB7c3RyaW5nfSBwcm9jZXNzSWQgLSB0aGUgV29ya2Zsb3cgY29uZmlnIC8gZGVmaW5pdGlvbiBwcm9jZXNzIGlkXG4gICogQHBhcmFtIHtzdHJpbmd9IGxhbmcgLSB0aGUgdXNlciBwcmVmZmVyZWQgbGFuZ2F1Z2VcbiAgKiBAcGFyYW0ge29iamVjdH0gX1dGSW5zdGFuY2UgLSB0aGUgY3VycmVudCB3b3JrZmxvdyBjb25zdHJ1Y3RvciBpbnN0YW5jZVxuICAqXG4gICogQGV4YW1wbGUgJydcbiAgKlxuICAqIEByZXR1cm4gJydcbiAgKlxuICAqL1xuIGZ1bmN0aW9uIGdldFByb2Nlc3MocHJvY2Vzc0lkLCBsYW5nLCBfV0ZJbnN0YW5jZSl7XG4gIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICB0cnkge1xuICAgICAgdmFyIHByb2Nlc3NNb2RlbCA9IFtdO1xuICAgICAgdmFyIHByb2Nlc3NJbnN0YW5jZSA9IFtdO1xuICAgIFx0X1dGSW5zdGFuY2UuaW5zdGFuY2UucHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihwcm9jZXNzSXRlbSl7XG4gICAgXHRcdGlmIChwcm9jZXNzSXRlbS5pZCA9PSBwcm9jZXNzSWQpIHtcbiAgICBcdFx0XHRwcm9jZXNzSW5zdGFuY2UgPSBwcm9jZXNzSXRlbTtcbiAgICBcdFx0fVxuICAgIFx0fSlcbiAgICAgIC8vIGNvbnNvbGUubG9nKHByb2Nlc3NJbnN0YW5jZS5zdWJQcm9jZXNzZXMubGVuZ3RoKTtcbiAgICAgIHV0aWwuc3luY0xvb3AocHJvY2Vzc0luc3RhbmNlLnN1YlByb2Nlc3Nlcy5sZW5ndGgsIGZ1bmN0aW9uKGxvb3Ape1xuICBcdFx0XHR2YXIgY291bnRlciA9IGxvb3AuaXRlcmF0aW9uKCk7XG4gICAgICAgIHZhciBwcm9jZXNzU2VxID0gcHJvY2Vzc0luc3RhbmNlLnNlcTtcbiAgICAgICAgdmFyIHN1YlByb2Nlc3NJZCA9IHByb2Nlc3NJbnN0YW5jZS5zdWJQcm9jZXNzZXNbY291bnRlcl0uaWQ7XG4gICAgICAgIHZhciBzdWJQcm9jZXNzU2VxID0gcHJvY2Vzc0luc3RhbmNlLnN1YlByb2Nlc3Nlc1tjb3VudGVyXS5zZXE7XG4gICAgICAgIGdldFN1YlByb2Nlc3MocHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIGxhbmcsIF9XRkluc3RhbmNlKS50aGVuKGZ1bmN0aW9uKG1vZGVsKXtcbiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhtb2RlbCk7XG4gICAgICAgICAgcHJvY2Vzc01vZGVsLnB1c2gobW9kZWwpO1xuICAgICAgICAgIGxvb3AubmV4dCgpO1xuICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHByb2Nlc3NNb2RlbCk7XG4gIFx0XHRcdH0sIGZ1bmN0aW9uKGVycil7XG4gICAgICAgICAgLy8gY29uc29sZS5sb2cocHJvY2Vzc01vZGVsKTtcbiAgXHRcdFx0XHRsb29wLmJyZWFrKCk7XG4gIFx0XHRcdFx0cmVqZWN0KGVycik7XG4gIFx0XHRcdH0pO1xuICBcdFx0fSwgZnVuY3Rpb24oKXtcbiAgICAgICAgLy8gY29uc29sZS5sb2cocHJvY2Vzc01vZGVsKTtcbiAgXHRcdFx0cmVzb2x2ZShwcm9jZXNzTW9kZWwpO1xuICBcdFx0fSk7XG4gICAgfSBjYXRjaChlcnIpe1xuICAgICAgcmVqZWN0KGVycik7XG4gICAgfVxuICB9KVxufTtcblxuIC8qKlxuICAqIEdldCBTdWJQcm9jZXNzIHVzZXIgaW50ZXJmYWNlIGRhdGFcbiAgKlxuICAqIEBwYXJhbSB7c3RyaW5nfSBwcm9jZXNzSWQgLSB0aGUgV29ya2Zsb3cgY29uZmlnIC8gZGVmaW5pdGlvbiBwcm9jZXNzIGlkXG4gICogQHBhcmFtIHtudW1iZXJ9IHByb2Nlc3NTZXEgLSB0aGUgV29ya2Zsb3cgaW5zdGFuY2UgcHJvY2VzcyBzZXFcbiAgKiBAcGFyYW0ge3N0cmluZ30gc3ViUHJvY2Vzc0lkIC0gdGhlIFdvcmtmbG93IGNvbmZpZyAvIGRlZmluaXRpb24gc3ViLXByb2Nlc3MgaWRcbiAgKiBAcGFyYW0ge251bWJlcn0gc3ViUHJvY2Vzc1NlcSAtIHRoZSBXb3JrZmxvdyBpbnN0YW5jZSBzdWItcHJvY2VzcyBzZXFcbiAgKiBAcGFyYW0ge29iamVjdH0gX1dGSW5zdGFuY2UgLSB0aGUgY3VycmVudCB3b3JrZmxvdyBjb25zdHJ1Y3RvciBpbnN0YW5jZVxuICAqXG4gICogQGV4YW1wbGUgJydcbiAgKlxuICAqIEByZXR1cm4gJydcbiAgKlxuICAqL1xuZnVuY3Rpb24gZ2V0U3ViUHJvY2Vzcyhwcm9jZXNzSWQsIHByb2Nlc3NTZXEsIHN1YlByb2Nlc3NJZCwgc3ViUHJvY2Vzc1NlcSwgbGFuZywgX1dGSW5zdGFuY2Upe1xuICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgdHJ5IHtcbiAgICAgIHZhciBtb2RlbCA9IHtcbiAgICAgICAgaWQ6ICcnLFxuICAgICAgICBzZXE6ICcnLFxuICAgICAgICBuYW1lOiAnJyxcbiAgICAgICAgaGVscDogJycsXG4gICAgICAgIGRhdGVzOiAnJyxcbiAgICAgICAgc3RlcDogJydcbiAgICAgIH07XG4gICAgICB2YXIgc3ViUHJvY2VzcyA9IFtdO1xuICAgIFx0dmFyIHN1YlByb2Nlc3NDb25mID0gW107XG4gICAgXHRfV0ZJbnN0YW5jZS5pbnN0YW5jZS5wcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKHByb2Nlc3NJdGVtKXtcbiAgICBcdFx0aWYgKHByb2Nlc3NJdGVtLmlkID09IHByb2Nlc3NJZCAmJiBwcm9jZXNzSXRlbS5zZXEgPT0gcHJvY2Vzc1NlcSkge1xuICAgIFx0XHRcdHZhciBzcExlbmd0aCA9IHByb2Nlc3NJdGVtLnN1YlByb2Nlc3Nlcy5sZW5ndGg7XG4gICAgXHRcdFx0cHJvY2Vzc0l0ZW0uc3ViUHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihzdWJQcm9jZXNzSXRlbSl7XG4gICAgXHRcdFx0XHRpZiAoc3ViUHJvY2Vzc0l0ZW0uaWQgPT0gc3ViUHJvY2Vzc0lkICYmIHN1YlByb2Nlc3NJdGVtLnNlcSA9PSBzdWJQcm9jZXNzU2VxICYmIHN1YlByb2Nlc3NJdGVtLmNvbXBsZXRlID09IGZhbHNlKSB7XG4gICAgXHRcdFx0XHRcdHN1YlByb2Nlc3MgPSBzdWJQcm9jZXNzSXRlbTtcbiAgICBcdFx0XHRcdH1cbiAgICBcdFx0XHR9KVxuICAgIFx0XHR9XG4gICAgXHR9KVxuICAgIFx0Ly8gR2V0IHRoZSBjdXJyZW50IHN1YlByb2Nlc3MgY29uZmlndXJhdGlvblxuICAgIFx0X1dGSW5zdGFuY2UuY29uZmlnLnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24ocHJvY2Vzc0NvbmZpZyl7XG4gICAgXHRcdGlmIChwcm9jZXNzQ29uZmlnLl9pZCA9PSBwcm9jZXNzSWQpIHtcbiAgICBcdFx0XHRwcm9jZXNzQ29uZmlnLnN1YlByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24oc3ViUHJvY2Vzc0NvbmZpZyl7XG4gICAgXHRcdFx0XHRpZiAoc3ViUHJvY2Vzc0NvbmZpZy5faWQgPT0gc3ViUHJvY2Vzc0lkKSB7XG4gICAgXHRcdFx0XHRcdHN1YlByb2Nlc3NDb25mID0gc3ViUHJvY2Vzc0NvbmZpZztcbiAgICBcdFx0XHRcdH1cbiAgICBcdFx0XHR9KVxuICAgIFx0XHR9XG4gICAgXHR9KVxuICAgICAgLy8gVXBkYXRlIHRoZSBtb2RlbFxuICAgICAgbW9kZWwuaWQgPSBzdWJQcm9jZXNzQ29uZi5faWQ7XG4gICAgICBtb2RlbC5zZXEgPSBzdWJQcm9jZXNzLnNlcTtcbiAgICAgIG1vZGVsLm5hbWUgPSB1dGlsLmdldE5hbWUoc3ViUHJvY2Vzc0NvbmYubmFtZSwgbGFuZyk7XG4gICAgICBtb2RlbC5oZWxwID0gdXRpbC5nZXROYW1lKHN1YlByb2Nlc3NDb25mLmhlbHAsIGxhbmcpO1xuICAgICAgbW9kZWwuZGF0ZXMgPSBzdWJQcm9jZXNzLmRhdGVzO1xuICAgICAgbW9kZWwuc3RlcCA9IHN1YlByb2Nlc3Muc3RlcDtcbiAgICAgIHJlc29sdmUobW9kZWwpO1xuICAgIH0gY2F0Y2goZXJyKSB7XG4gICAgICByZWplY3QoZXJyKTtcbiAgICB9XG4gIH0pXG59O1xuXG5cblxuXG5mdW5jdGlvbiBwcmVwYXJlTm90aWZpY2F0aW9uU2NyZWVuKCl7XG5cbiAgXCJcIlxufTtcblxuIG1vZHVsZS5leHBvcnRzID0ge1xuXG4gIGdldFByb2Nlc3M6IGdldFByb2Nlc3NcblxuIH1cbiIsIid1c2Ugc3RyaWN0JztcblxuXG5mdW5jdGlvbiBnZXQoKSB7XG5cbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG5cbiAgICB9KTtcblxufTtcblxubW9kdWxlLmV4cG9ydHMgPSB7XG5cbiAgICBnZXQ6IGdldFxuXG59IiwiJ3VzZSBzdHJpY3QnO1xuXG52YXIgdXRpbCA9IHJlcXVpcmUoJ3V0aWxpdHknKTtcbnZhciBhY3Rpb25zTW9kdWxlID0gcmVxdWlyZSgnLi9hY3Rpb25zJyk7XG52YXIgaGVscGVyID0gcmVxdWlyZSgnLi9oZWxwZXInKTtcbnZhciBmb3JtID0gcmVxdWlyZSgnLi9mb3JtJyk7XG5cbi8qKlxuICogUHJvY2VzcyBNb2R1bGVcbiAqXG4gKiBAbW9kdWxlIGxpYi9wcm9jZXNzXG4gKiBAYXV0aG9yIEhhc2FuIEFiYmFzXG4gKiBAdmVyc2lvbiAwLjIuMVxuICogQGRlc2NyaXB0aW9uIFdvcmtmbG93IGltcGxlbWVudGF0aW9uIGNoYW5nZWQgYXMgcGVyIG5ldyBzY2hlbWEgaW1wbGVtZW50YXRpb25cbiAqXG4gKi9cblxuLyoqXG4gKiBDb3VudCBhbiBhcnJheSBvZiBpdGVtc1xuICpcbiAqIEBwYXJhbSB7QXJyYXl9IGFyciAtIHRoZSBhcnJheSBkYXRhXG4gKlxuICogQGV4YW1wbGUgJydcbiAqXG4gKiBAcmV0dXJuICcnXG4gKlxuICovXG5mdW5jdGlvbiBjb3VudChhcnIpIHtcbiAgICBpZiAoYXJyICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcmV0dXJuIGFyci5sZW5ndGg7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgfVxuXG59O1xuXG4vKipcbiAqIFByb2Nlc3MgcHJlLXJlcXVpc2l0ZXNcbiAqXG4gKiBAcGFyYW0ge29iamVjdH0gcHJlcmVxdWlzaXRlcyAtIHRoZSBwcmUtcmVxdWlzaXRlcyBjb25maWcgZGF0YVxuICpcbiAqIEBleGFtcGxlICcnXG4gKlxuICogQHJldHVybiAnJ1xuICpcbiAqL1xuZnVuY3Rpb24gcHJlUmVxdWlzaXRlcyhwcmVyZXF1aXNpdGVzLCBfV0ZJbnN0YW5jZSkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIC8vIFVuY29tbWVudCBiZWxvdyBzZWN0aW9uIHdoZW4gcmVhZHkgdG8gaW1wbGVtZW50XG4gICAgICAgIHZhciBjb21wbGV0ZWQgPSBbXTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHV0aWwuc3luY0xvb3AocHJlcmVxdWlzaXRlcy5sZW5ndGgsIGZ1bmN0aW9uIChsb29wKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNvdW50ZXIgPSBsb29wLml0ZXJhdGlvbigpO1xuICAgICAgICAgICAgICAgIHByZVJlcXVpc2l0ZShwcmVyZXF1aXNpdGVzW2NvdW50ZXJdLCBfV0ZJbnN0YW5jZSkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBDaGVjayBpZiBhbGwgcHJlLXJlcXVpc2l0ZXMgY29tcGxldGVkIHN1Y2Nlc3NmdWxseS5cbiAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkLnB1c2godHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIGxvb3AubmV4dCgpO1xuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkLnB1c2goZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICBsb29wLmJyZWFrKCk7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmIChjb21wbGV0ZWQuZXZlcnkoQm9vbGVhbikpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ1ByZS1yZXF1aXNpdGVzIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkuJywge30pO1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvciA9IHV0aWwuZXJyb3IoJ1dGUHJlUmVxdWlzaXRlRXJyb3InLCAnTm90IGFsbCBwcmUtcmVxdWlzaXRlcyBwYXNzZWQuJyk7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgfVxuXG4gICAgfSk7XG59O1xuXG4vKipcbiAqIFByb2Nlc3MgcHJlLXJlcXVpc2l0ZSwgZXhlY3V0ZSB0aGUgcHJlLXJlcXVpc2l0ZSBjb25kaXRpb24uXG4gKlxuICogQHBhcmFtIHtvYmplY3R9IHByZXJlcXVpc2l0ZSAtIHRoZSBwcmUtcmVxdWlzaXRlIGNvbmZpZyBkYXRhXG4gKiBAcGFyYW0ge29iamVjdH0gX1dGSW5zdGFuY2UgLSB0aGUgd29ya2Zsb3cgY29uc3RydWN0b3IgaW5zdGFuY2VcbiAqXG4gKiBAZXhhbXBsZVxuICogUHJvY2Vzcy5wcmVSZXF1aXNpdGUoY29uZmlnLCBjb3VudGVyLCBpbnN0YW5jZSwgZG9jKTtcbiAqXG4gKiBAcmV0dXJuICcnXG4gKlxuICovXG5mdW5jdGlvbiBwcmVSZXF1aXNpdGUocHJlcmVxdWlzaXRlLCBfV0ZJbnN0YW5jZSkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG5cbiAgICAgICAgdmFyIHN1YmplY3RDb3VudCA9ICcnO1xuXG4gICAgICAgIGlmIChwcmVyZXF1aXNpdGUuY2hlY2subnVtYmVyUHJvY2Vzc0luc3RhbmNlcyAhPSB1bmRlZmluZWQpIHtcblxuICAgICAgICAgICAgdmFyIG51bWJlclByb2Nlc3NJbnN0YW5jZXMgPSBwcmVyZXF1aXNpdGUuY2hlY2subnVtYmVyUHJvY2Vzc0luc3RhbmNlcztcbiAgICAgICAgICAgIHZhciBfZmlsdGVyT3BlcmF0b3IgPSBudW1iZXJQcm9jZXNzSW5zdGFuY2VzLm9wZXJhdG9yO1xuICAgICAgICAgICAgdmFyIHhwYXRoT3BlcmF0b3IgPSAnJztcbiAgICAgICAgICAgIHN3aXRjaCAoX2ZpbHRlck9wZXJhdG9yKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnZ3JlYXRlclRoYW4nOlxuICAgICAgICAgICAgICAgICAgICB4cGF0aE9wZXJhdG9yID0gJ2d0JztcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnbGVzc1RoYW4nOlxuICAgICAgICAgICAgICAgICAgICB4cGF0aE9wZXJhdG9yID0gJ2x0JztcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnZ3JlYXRlclRoYW5FcXVhbCc6XG4gICAgICAgICAgICAgICAgICAgIHhwYXRoT3BlcmF0b3IgPSAnZ2UnO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdsZXNzVGhhbkVxdWFsJzpcbiAgICAgICAgICAgICAgICAgICAgeHBhdGhPcGVyYXRvciA9ICdsZSc7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ2VxdWFsVG8nOlxuICAgICAgICAgICAgICAgICAgICB4cGF0aE9wZXJhdG9yID0gJ2VxJztcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnbm90RXF1YWxUbyc6XG4gICAgICAgICAgICAgICAgICAgIHhwYXRoT3BlcmF0b3IgPSAnbmUnO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIF9zdWJwcm9jZXNzSWQgPSBudW1iZXJQcm9jZXNzSW5zdGFuY2VzLnN1YlByb2Nlc3NJZDtcbiAgICAgICAgICAgIHZhciBfZmlsdGVyRWxlbWVudCA9IFwic3RlcC9zdGF0dXNcIjtcbiAgICAgICAgICAgIHZhciBfZmlsdGVyVmFsdWUgPSBudW1iZXJQcm9jZXNzSW5zdGFuY2VzLnR5cGU7XG4gICAgICAgICAgICB2YXIgaW5uZXJYcGF0aCA9IFwiL1wiICsgX2ZpbHRlckVsZW1lbnQgKyBcIlsuIGVxICdcIiArIF9maWx0ZXJWYWx1ZSArIFwiJ11cIjtcblxuICAgICAgICAgICAgdmFyIGZ1bGxQYXRoID0gXCJjb3VudCgvc3VicHJvY2Vzc2VzW2lkIGVxICdcIiArIF9zdWJwcm9jZXNzSWQgKyBcIiddXCIgKyBpbm5lclhwYXRoICsgXCIpXCI7XG5cbiAgICAgICAgICAgIHZhciBwcmVyZXFQcm9jZXNzVHlwZSA9IEpTT04ueHBhdGgoXCIvY29uZmlnL3Byb2Nlc3Nlcy9zdWJQcm9jZXNzZXNbX2lkIGVxICdcIiArIF9zdWJwcm9jZXNzSWQgKyBcIiddL3R5cGVcIiwgX1dGSW5zdGFuY2UsIHt9KVswXTtcbiAgICAgICAgICAgIGlmIChhcHAucHJvZmlsZS5zdWJwcm9maWxlSWQgIT0gdW5kZWZpbmVkICYmIGFwcC5wcm9maWxlLnN1YnByb2ZpbGVJZCAhPSAnJyAmJiBwcmVyZXFQcm9jZXNzVHlwZSAhPSB1bmRlZmluZWQgJiYgcHJlcmVxUHJvY2Vzc1R5cGUgPT0gUFJPQ0VTU19UWVBFX1NVQlBST0ZJTEUpIHtcbiAgICAgICAgICAgICAgICBmdWxsUGF0aCA9IFwiY291bnQoL3N1YnByb2Nlc3Nlc1tpZCBlcSAnXCIgKyBfc3VicHJvY2Vzc0lkICsgXCInIGFuZCBfaWQgPSAvaW5zdGFuY2UvcHJvY2Vzc2VzL3N1YlByb2Nlc3Nlc1tzdWJwcm9maWxlSWQgZXEgJ1wiICsgYXBwLnByb2ZpbGUuc3VicHJvZmlsZUlkICsgXCInXS91dWlkXVwiICsgaW5uZXJYcGF0aCArIFwiKVwiO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzdWJqZWN0Q291bnQgPSBKU09OLnhwYXRoKGZ1bGxQYXRoLCBfV0ZJbnN0YW5jZSwge30pWzBdO1xuXG5cblxuICAgICAgICB9IGVsc2UgaWYgKHByZXJlcXVpc2l0ZS5jaGVjay52YXJpYWJsZUNvbmZpcm0gIT0gdW5kZWZpbmVkKSB7XG5cbiAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgdmFyIGVycm9yID0gdXRpbC5lcnJvcignV0ZQcmVSZXF1aXNpdGVFcnJvcicsICdQcmUtcmVxdWlzaXRlIHR5cGUgbm90IGRlZmluZWQuJyk7XG4gICAgICAgICAgICByZWplY3QoZXJyb3IpO1xuXG4gICAgICAgIH1cblxuICAgICAgICB2YXIgY29tcGFyZSA9ICcnO1xuICAgICAgICB2YXIgY291bnRWYWx1ZSA9ICcnO1xuXG4gICAgICAgIC8vIGlmIChzb21lKSB7XG4gICAgICAgIC8vICAgICBjb3VudFZhbHVlID0gWFhYO1xuICAgICAgICAvLyB9IGVsc2Uge1xuICAgICAgICAvLyAgICAgY291bnRWYWx1ZSA9IHByZXJlcXVpc2l0ZS5jaGVjay5udW1iZXJQcm9jZXNzSW5zdGFuY2VzLmNvdW50O1xuICAgICAgICAvLyB9XG5cbiAgICAgICAgY291bnRWYWx1ZSA9IHByZXJlcXVpc2l0ZS5jaGVjay5udW1iZXJQcm9jZXNzSW5zdGFuY2VzLmNvdW50O1xuXG4gICAgICAgIHByZXJlcXVpc2l0ZS5jaGVjay5udW1iZXJQcm9jZXNzSW5zdGFuY2VzLmNvdW50XG4gICAgICAgIGlmIChwcmVyZXF1aXNpdGUuY2hlY2subnVtYmVyUHJvY2Vzc0luc3RhbmNlcykge1xuICAgICAgICAgICAgY29tcGFyZSA9IHV0aWwuY29tcGFyZShzdWJqZWN0Q291bnQsIHByZXJlcXVpc2l0ZS5jaGVjay5udW1iZXJQcm9jZXNzSW5zdGFuY2VzLm9wZXJhdG9yLCBwYXJzZUludChjb3VudFZhbHVlKSk7XG4gICAgICAgIH0gZWxzZSBpZiAocHJlcmVxdWlzaXRlLmNoZWNrLnZhcmlhYmxlQ29uZmlybSkge1xuXG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY29tcGFyZSkge1xuICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ1ByZS1yZXF1aXNpdGVzIHBhc3NlZC4nLCB7fSk7XG4gICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xuICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICB2YXIgbWVzc2FnZSA9IGhlbHBlci5nZXRMYW5ndWFnZU1lc3NhZ2UocHJlcmVxdWlzaXRlLm1lc3NhZ2UpO1xuICAgICAgICAgICAgdmFyIGVycm9yID0gdXRpbC5lcnJvcignV0ZQcmVSZXF1aXNpdGVFcnJvcicsIG1lc3NhZ2UpO1xuICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcbiAgICAgICAgfVxuXG4gICAgfSk7XG59O1xuXG4vKipcbiAqIFByb2Nlc3MgcHJlLWFjdGlvbnNzXG4gKlxuICogQHBhcmFtIHtvYmplY3R9IHByZUFjdGlvbnMgLSB0aGUgcHJlLWFjdGlvbnMgY29uZmlnIGRhdGFcbiAqIEBwYXJhbSB7b2JqZWN0fSBfV0ZJbnN0YW5jZSAtIHRoZSBjdXJyZW50IHdvcmtmbG93IGNvbnN0cnVjdG9yIGluc3RhbmNlXG4gKlxuICogQGV4YW1wbGUgJydcbiAqXG4gKiBAcmV0dXJuICcnXG4gKlxuICovXG5mdW5jdGlvbiBwcmVBY3Rpb25zKHByZUFjdGlvbnMsIF9XRkluc3RhbmNlKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgdmFyIGNvbXBsZXRlZCA9IFtdO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgdXRpbC5zeW5jTG9vcChwcmVBY3Rpb25zLmxlbmd0aCwgZnVuY3Rpb24gKGxvb3ApIHtcbiAgICAgICAgICAgICAgICB2YXIgY291bnRlciA9IGxvb3AuaXRlcmF0aW9uKCk7XG4gICAgICAgICAgICAgICAgYWN0aW9uKHByZUFjdGlvbnNbY291bnRlcl0sIF9XRkluc3RhbmNlKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIGFsbCBwcmUtcmVxdWlzaXRlcyBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5LlxuICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWQucHVzaCh0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgbG9vcC5uZXh0KCk7XG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWQucHVzaChmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIGxvb3AuYnJlYWsoKTtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKGNvbXBsZXRlZC5ldmVyeShCb29sZWFuKSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnUHJlLWFjdGlvbnMgY29tcGxldGVkIHN1Y2Nlc3NmdWxseS4nLCB7fSk7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yID0gdXRpbC5lcnJvcignV0ZQcmVSZXF1aXNpdGVFcnJvcicsICdOb3QgYWxsIHByZS1hY3Rpb25zIHBhc3NlZC4nKTtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICB9XG5cbiAgICB9KTtcbn07XG5cbi8qKlxuICogV29ya2Zsb3cgZ2V0IHN1Yi1wcm9jZXNzIGRhdGEuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGlkIC0gdGhlIHN1YlByb2Nlc3MgY29uZmlnIGlkXG4gKiBAcGFyYW0ge29iamVjdH0gX1dGSW5zdGFuY2UgLSB0aGUgY3VycmVudCB3b3JrZmxvdyBjb25zdHJ1Y3RvciBpbnN0YW5jZVxuICpcbiAqIEBleGFtcGxlIFwiXCJcbiAqXG4gKiBAcmV0dXJuIFwiXCJcbiAqXG4gKi9cbmZ1bmN0aW9uIGdldFN1YlByb2Nlc3MoaWQsIF9XRkluc3RhbmNlKSB7XG4gICAgaWYgKF9XRkluc3RhbmNlLnN1YnByb2Nlc3NlcyA9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIF9XRkluc3RhbmNlLnN1YnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24gKHN1YlByb2Nlc3MpIHtcbiAgICAgICAgICAgIGlmIChzdWJQcm9jZXNzLmlkID09IGlkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN1YlByb2Nlc3M7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSk7XG4gICAgfVxuXG59O1xuXG4vKipcbiAqIFByb2Nlc3Mgc3ViLXByb2Nlc3NcbiAqXG4gKiBAcGFyYW0ge29iamVjdH0gcHJvY2VzcyAtIHRoZSBjdXJyZW50IHByb2Nlc3MgaWQgYW5kIHNlcVxuICogQHBhcmFtIHtvYmplY3R9IHN1YlByb2Nlc3MgLSB0aGUgc3ViLXByb2Nlc3MgaWQgYW5kIHNlcVxuICogQHBhcmFtIHtvYmplY3R9IGRhdGEgLSB0aGUgdXNlciBpbnB1dCBkYXRhXG4gKiBAcGFyYW0ge29iamVjdH0gX1dGSW5zdGFuY2UgLSB0aGUgY3VycmVudCB3b3JrZmxvdyBjb25zdHJ1Y3RvciBpbnN0YW5jZVxuICpcbiAqIEBleGFtcGxlICcnXG4gKlxuICogQHJldHVybiAnJ1xuICpcbiAqL1xuZnVuY3Rpb24gc3ViUHJvY2Vzcyhwcm9jZXNzSWQsIHByb2Nlc3NTZXEsIHN1YlByb2Nlc3NJZCwgc3ViUHJvY2Vzc1NlcSwgZGF0YSwgX1dGSW5zdGFuY2UpIHtcbiAgICAvLyBHZXQgdGhlIGN1cnJlbnQgcHJvY2VzcyBzdWJQcm9jZXNzIGluc3RhbmNlXG4gICAgLy8gdmFyIHN1YlByb2Nlc3NTZXEgPSAxO1xuICAgIHZhciBzdWJQcm9jZXNzID0gW107XG4gICAgdmFyIHByb2Nlc3NDb25mID0gW107XG4gICAgdmFyIHN1YlByb2Nlc3NDb25mID0gW107XG4gICAgX1dGSW5zdGFuY2UuaW5zdGFuY2UucHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbiAob2JqUHJvY2Vzcykge1xuICAgICAgICBpZiAob2JqUHJvY2Vzcy5pZCA9PSBwcm9jZXNzSWQgJiYgb2JqUHJvY2Vzcy5zZXEgPT0gcHJvY2Vzc1NlcSkge1xuICAgICAgICAgICAgdmFyIHNwTGVuZ3RoID0gb2JqUHJvY2Vzcy5zdWJQcm9jZXNzZXMubGVuZ3RoO1xuICAgICAgICAgICAgb2JqUHJvY2Vzcy5zdWJQcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uIChvYmpTdWJQcm9jZXNzKSB7XG4gICAgICAgICAgICAgICAgaWYgKG9ialN1YlByb2Nlc3MuaWQgPT0gc3ViUHJvY2Vzc0lkICYmIG9ialN1YlByb2Nlc3Muc2VxID09IHN1YlByb2Nlc3NTZXEpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHV1aWQgPSBvYmpTdWJQcm9jZXNzLnV1aWQ7XG4gICAgICAgICAgICAgICAgICAgIF9XRkluc3RhbmNlLnN1YnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24gKHN1YlByb2Nlc3NJdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3ViUHJvY2Vzc0l0ZW0uX2lkID09IHV1aWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJQcm9jZXNzID0gc3ViUHJvY2Vzc0l0ZW07XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cblxuICAgIH0pO1xuICAgIC8vIEdldCB0aGUgY3VycmVudCBzdWJQcm9jZXNzIGNvbmZpZ3VyYXRpb25cbiAgICBfV0ZJbnN0YW5jZS5jb25maWcucHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbiAocHJvY2Vzc0NvbmZpZykge1xuICAgICAgICBpZiAocHJvY2Vzc0NvbmZpZy5faWQgPT0gcHJvY2Vzc0lkKSB7XG4gICAgICAgICAgICBwcm9jZXNzQ29uZiA9IHByb2Nlc3NDb25maWc7XG4gICAgICAgICAgICBwcm9jZXNzQ29uZmlnLnN1YlByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24gKHN1YlByb2Nlc3NDb25maWcpIHtcbiAgICAgICAgICAgICAgICBpZiAoc3ViUHJvY2Vzc0NvbmZpZy5faWQgPT0gc3ViUHJvY2Vzc0lkKSB7XG4gICAgICAgICAgICAgICAgICAgIHN1YlByb2Nlc3NDb25mID0gc3ViUHJvY2Vzc0NvbmZpZztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cblxuICAgIH0pO1xuXG4gICAgLy9UT0RPOiBDaGFuZ2UgcmVxdWlyZWQgdG8gbW92ZSBpc0FjdGl2ZSB0byBzdWJQcm9jZXNzIGZpbGUuSGVyZVxuICAgIHZhciBncm91cEtleSA9ICcnO1xuICAgIHZhciBiYXNlVVVJRCA9IGRhdGEuYmFzZVVVSUQ7XG4gICAgaWYgKGJhc2VVVUlEICE9IHVuZGVmaW5lZCAmJiBiYXNlVVVJRCAhPSAnJyAmJiBiYXNlVVVJRC5sZW5ndGggPiAwKSB7XG4gICAgICAgIHZhciBwcmV2aW91c09iamVjdCA9IEpTT04ueHBhdGgoXCIvc3VicHJvY2Vzc2VzW19pZCBlcSAnXCIgKyBiYXNlVVVJRCArIFwiJ11cIiwgX1dGSW5zdGFuY2UsIHt9KVswXTtcbiAgICAgICAgZ3JvdXBLZXkgPSBwcmV2aW91c09iamVjdC5ncm91cEtleTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBncm91cEtleSA9IGdlbmVyYXRlVVVJRCgpO1xuICAgIH1cblxuICAgIHZhciBzdWJQcm9jZXNzT2JqZWN0SWQgPSBnZW5lcmF0ZVVVSUQoKTtcbiAgICB2YXIgbW9kZWwgPSB7XG4gICAgICAgIF9pZDogc3ViUHJvY2Vzc09iamVjdElkLFxuICAgICAgICBpZDogc3ViUHJvY2Vzc0lkLFxuICAgICAgICB0eXBlOiAnd29ya2Zsb3dJbnN0YW5jZVN1YlByb2Nlc3MnLFxuICAgICAgICBzZXE6IHN1YlByb2Nlc3NTZXEsXG4gICAgICAgIGluaXRpYXRlZDogZmFsc2UsXG4gICAgICAgIGRhdGVzOiB7XG4gICAgICAgICAgICBjcmVhdGVkOiAnJyxcbiAgICAgICAgICAgIHZhbGlkOiAnJyxcbiAgICAgICAgICAgIHN0YXJ0OiAnJyxcbiAgICAgICAgICAgIGR1ZTogJycsXG4gICAgICAgICAgICBjbG9zZWQ6ICcnXG4gICAgICAgIH0sXG4gICAgICAgIGNvbXBsZXRlOiBmYWxzZSxcbiAgICAgICAgaW5kaWNhdG9yczogW10sXG4gICAgICAgIHN0ZXA6IHt9LFxuICAgICAgICBhY3RpdmU6IHRydWUsXG4gICAgICAgIGdyb3VwS2V5OiBncm91cEtleSxcbiAgICAgICAgY2hhbm5lbHM6IFtcbiAgICAgICAgICAgIFwiY29tbXVuaXR5X1wiICsgYXBwLlNDT1BFLmdldENvbW11bml0eUlkKCksXG4gICAgICAgICAgICBcInByb2ZpbGVfXCIgKyBhcHAuU0NPUEUucHJvZmlsZUlkLFxuICAgICAgICAgICAgXCJhcHBsaWNhdGlvbl9cIiArIGFwcC5TQ09QRS5hcHBsaWNhdGlvbklkLFxuICAgICAgICAgICAgXCJjb21tdW5pdHlfXCIgKyBhcHAuU0NPUEUuZ2V0Q29tbXVuaXR5SWQoKSArIFwiX2FwcGxpY2F0aW9uX1wiICsgYXBwLlNDT1BFLmFwcGxpY2F0aW9uSWRcbiAgICAgICAgXSxcbiAgICAgICAgaGlzdG9yeTogW11cbiAgICB9O1xuXG4gICAgX1dGSW5zdGFuY2Uuc3VicHJvY2Vzc2VzLnB1c2gobW9kZWwpO1xuICAgIC8vIFJldHVybiBhIHByb21pc2VcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAvLyBDYXRjaCBhbGwgdW5jYXVnaHQgZXJyb3JzXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICAvLyAxLiBQcm9jZXNzIHRoZSBwcmUtYWN0aW9uc1xuICAgICAgICAgICAgdmFyIHByZUFjdGlvbnNDb25mID0gcHJvY2Vzc0NvbmYucHJlQWN0aW9ucztcbiAgICAgICAgICAgIHByZUFjdGlvbnMocHJlQWN0aW9uc0NvbmYsIF9XRkluc3RhbmNlKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAvLyAyLiBQcm9jZXNzIHRoZSBwcmUtcmVxdWlzaXRlc1xuICAgICAgICAgICAgICAgIHZhciBwcmVyZXF1aXNpdGVDb25mID0gcHJvY2Vzc0NvbmYucHJlcmVxdWlzaXRlcztcbiAgICAgICAgICAgICAgICBwcmVSZXF1aXNpdGVzKHByZXJlcXVpc2l0ZUNvbmYsIF9XRkluc3RhbmNlKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gMy4gSW5pdGlhdGUgdGhlIHN1YlByb2Nlc3NcbiAgICAgICAgICAgICAgICAgICAgdmFyIGluaXRpYXRlQ29uZiA9IHN1YlByb2Nlc3NDb25mLmluaXRpYXRlO1xuICAgICAgICAgICAgICAgICAgICBpbml0aWF0ZShpbml0aWF0ZUNvbmYsIHN1YlByb2Nlc3MsIGRhdGEpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy9VcGRhdGUgdGhlIHN1YlByb2Nlc3MgbW9kZWxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsLmluaXRpYXRlZCA9IHJlc3VsdC5kYXRhLmluaXRpYXRlZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsLmRhdGVzID0gcmVzdWx0LmRhdGEuZGF0ZXM7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBFeGVjdXRlIHRoZSBmaXJzdCBzdGVwXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3RlcElkID0gc3ViUHJvY2Vzc0NvbmYuc3RlcHNbMF0uX2lkO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRyYW5zaXRpb25JZCA9IHN1YlByb2Nlc3NDb25mLnN0ZXBzWzBdLnRyYW5zaXRpb25bMF0uX2lkO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN0ZXBTZXEgPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RlcChwcm9jZXNzSWQsIHByb2Nlc3NTZXEsIHN1YlByb2Nlc3NJZCwgc3ViUHJvY2Vzc1NlcSwgc3RlcElkLCBzdGVwU2VxLCBkYXRhLCBfV0ZJbnN0YW5jZSwgc3ViUHJvY2Vzc09iamVjdElkKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWwuc3RlcCA9IHJlc3VsdC5kYXRhO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRpY2F0b3JzKHN1YlByb2Nlc3NDb25mLmluZGljYXRvcnMsIF9XRkluc3RhbmNlLCBtb2RlbC5faWQpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsLmluZGljYXRvcnMgPSByZXN1bHQxLmRhdGE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBFeGVjdXRlIHRoZSB0cmFuc2l0aW9ucywgaWYgYXV0b1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9TdWJwcm9jZXNzIHBvc3RBY3Rpb25zIHJlbW92ZWQgZnJvbSBoZXJlIGFzIHRoZXkgc2hvdWxkIGJlIGV4ZWN1dGVkIGF0IHRoZSBlbmQgb2YgdGhlIHN1YlByb2Nlc3MsIG1lYW5zIGF0IGxhc3Qgc3RlcCBhZnRlciB0cmFuc2l0aW9uLCBqdXN0IGJlZm9yZSBmaW5pc2guXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDYW4gYWRkIGhpc3Rvcnkgb2JqZWN0IGhlcmUgaW4gY2FzZSBmb3IgZmlyc3Qgc3RlcCwgaS5lIGluaXRpYWxpc2F0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBtb2RlbC5oaXN0b3J5LnB1c2gocmVzdWx0LmRhdGEpO1xuXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKHJlc3VsdDEubWVzc2FnZSwgbW9kZWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcblxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgX1dGSW5zdGFuY2Uuc3VicHJvY2Vzc2VzID0gX1dGSW5zdGFuY2Uuc3VicHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbiAob2JqKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICEob2JqLl9pZCA9PSBzdWJQcm9jZXNzT2JqZWN0SWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgIF9XRkluc3RhbmNlLnN1YnByb2Nlc3NlcyA9IF9XRkluc3RhbmNlLnN1YnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24gKG9iaikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICEob2JqLl9pZCA9PSBzdWJQcm9jZXNzT2JqZWN0SWQpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICBfV0ZJbnN0YW5jZS5zdWJwcm9jZXNzZXMgPSBfV0ZJbnN0YW5jZS5zdWJwcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uIChvYmopIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICEob2JqLl9pZCA9PSBzdWJQcm9jZXNzT2JqZWN0SWQpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgfVxuXG4gICAgfSk7XG59O1xuXG4vKipcbiAqIFByb2Nlc3MgaW5pdGlhdGVcbiAqXG4gKiBAcGFyYW0ge29iamVjdH0gaW5pdGlhdGUgLSB0aGUgaW5pdGlhdGUgY29uZmlnIGRhdGFcbiAqIEBwYXJhbSB7b2JqZWN0fSBkYXRhIC0gdGhlIHVzZXIgaW5wdXQgZGF0YVxuICpcbiAqIEBleGFtcGxlICcnXG4gKlxuICogQHJldHVybiAnJ1xuICpcbiAqL1xuZnVuY3Rpb24gaW5pdGlhdGUoaW5pdGlhdGUsIHN1YlByb2Nlc3MsIGRhdGEpIHtcbiAgICB2YXIgY29tcGxldGVkID0gW107XG4gICAgdmFyIHJlc3VsdCA9IHtcbiAgICAgICAgaW5pdGlhdGVkOiBmYWxzZSxcbiAgICAgICAgZGF0ZXM6IHtcbiAgICAgICAgICAgIGNyZWF0ZWQ6ICcnLFxuICAgICAgICAgICAgdmFsaWQ6ICcnLFxuICAgICAgICAgICAgc3RhcnQ6ICcnLFxuICAgICAgICAgICAgZHVlOiAnJyxcbiAgICAgICAgICAgIGNsb3NlZDogJydcbiAgICAgICAgfVxuXG4gICAgfTtcblxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIHZhciBpbml0ID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICBpZiAoaW5pdGlhdGUudXNlciAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQuZGF0ZXMuY3JlYXRlZCA9IGRhdGEuY3JlYXRlZERhdGU7XG4gICAgICAgICAgICAgICAgaWYgKGluaXRpYXRlLnVzZXIudmFsaWREYXRlLl90eXBlID09ICd1c2VyU2VsZWN0ZWQnIHx8IGluaXRpYXRlLnVzZXIudmFsaWREYXRlLl90eXBlID09ICdhdXRvU2VsZWN0ZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLnZhbGlkRGF0ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuZGF0ZXMudmFsaWQgPSBkYXRhLnZhbGlkRGF0ZTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHV0aWwud2FybignV0ZJbml0aWF0ZUVycm9yJywgJ05vIHZhbGlkIGRhdGUgcGFzc2VkIGluIC0ge2RhdGEudmFsaWREYXRlfScpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoaW5pdGlhdGUudXNlci5kdWVEYXRlLl90eXBlID09ICd1c2VyU2VsZWN0ZWQnIHx8IGluaXRpYXRlLnVzZXIuZHVlRGF0ZS5fdHlwZSA9PSAnYXV0b1NlbGVjdGVkJykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5kdWVEYXRlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5kYXRlcy5kdWUgPSBkYXRhLmR1ZURhdGU7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB1dGlsLndhcm4oJ1dGSW5pdGlhdGVFcnJvcicsICdObyBkdWUgZGF0ZSBwYXNzZWQgaW4gLSB7ZGF0YS5kdWVEYXRlfScpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXN1bHQuZGF0ZXMuc3RhcnQgPSBkYXRhLmZpcnN0RGF0ZTtcblxuXG5cbiAgICAgICAgICAgICAgICByZXN1bHQuaW5pdGlhdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnU3ViLVByb2Nlc3MgaW5pdGlhdGUgY29tcGxldGVkIHN1Y2Nlc3NmdWxseS4nLCByZXN1bHQpO1xuICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XG5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaW5pdGlhdGUuYXV0byAhPSB1bmRlZmluZWQpIHtcblxuICAgICAgICAgICAgICAgIC8qXG4gICAgICAgICAgICAgICAgcmVzdWx0LmRhdGVzLmNyZWF0ZWQgPSBkYXRhLmNyZWF0ZWREYXRlO1xuXG4gICAgICAgICAgICAgICAgaWYgKGluaXRpYXRlLmRhdGVzLnZhbGlkLl90eXBlID09ICd1c2VyU2VsZWN0ZWQnIHx8IGluaXRpYXRlLmRhdGVzLnZhbGlkLl90eXBlID09ICdhdXRvU2VsZWN0ZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLnZhbGlkRGF0ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuZGF0ZXMudmFsaWQgPSBkYXRhLnZhbGlkRGF0ZTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHV0aWwud2FybignV0ZJbml0aWF0ZUVycm9yJywgJ05vIHZhbGlkIGRhdGUgcGFzc2VkIGluIC0ge2RhdGEudmFsaWREYXRlfScpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoaW5pdGlhdGUuZGF0ZXMuZHVlLl90eXBlID09ICd1c2VyU2VsZWN0ZWQnIHx8IGluaXRpYXRlLmRhdGVzLmR1ZS5fdHlwZSA9PSAnYXV0b1NlbGVjdGVkJykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5kdWVEYXRlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5kYXRlcy5kdWUgPSBkYXRhLmR1ZURhdGU7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB1dGlsLndhcm4oJ1dGSW5pdGlhdGVFcnJvcicsICdObyBkdWUgZGF0ZSBwYXNzZWQgaW4gLSB7ZGF0YS5kdWVEYXRlfScpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXN1bHQuaW5pdGlhdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnU3ViLVByb2Nlc3MgaW5pdGlhdGUgY29tcGxldGVkIHN1Y2Nlc3NmdWxseS4nLCByZXN1bHQpO1xuICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7Ki9cblxuICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgIHZhciBlcnJvciA9IHV0aWwuZXJyb3IoJ1dGSW5pdGlhdGVFcnJvcicsICdJbml0aWF0ZSB0eXBlOiAnICsgaW5pdGlhdGUuX3R5cGUgKyAnIG5vdCBkZWZpbmVkLicpO1xuICAgICAgICAgICAgICAgIHJlamVjdChlcnJvcik7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHN1YlByb2Nlc3MuY29tcGxldGUgPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBpbml0KCk7XG4gICAgICAgIH0gZWxzZSBpZiAoIXN1YlByb2Nlc3MuY29tcGxldGUpIHtcbiAgICAgICAgICAgIGlmIChpbml0aWF0ZS5wYXJhbGxlbEluc3RhbmNlcykge1xuICAgICAgICAgICAgICAgIGluaXQoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yID0gdXRpbC5lcnJvcignV0ZJbml0aWF0ZUVycm9yJywgJ1N1Yi1wcm9jZXNzOiAnICsgc3ViUHJvY2Vzcy5pZCArICcgc3RpbGwgYWN0aXZlIGFuZCBwYXJhbGxlbCBpbnN0YW5jZXMgYXJlIG5vdCBhbGxvd2VkLicpO1xuICAgICAgICAgICAgICAgIHJlamVjdChlcnJvcik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfVxuXG4gICAgfSk7XG59O1xuXG4vKipcbiAqIFByb2Nlc3Mgc3RlcFxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBwcm9jZXNzSWQgLSB0aGUgY3VycmVudCBwcm9jZXNzIGlkXG4gKiBAcGFyYW0ge3N0cmluZ30gc3ViUHJvY2Vzc0lkIC0gdGhlIGN1cnJlbnQgc3ViLXByb2Nlc3MgaWRcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdGVwSWQgLSB0aGUgY3VycmVudCBzdWItcHJvY2VzcyBzdGVwIGlkXG4gKiBAcGFyYW0ge251bWJlcn0gc3RlcFNlcSAtIHRoZSBjdXJyZW50IHN1Yi1wcm9jZXNzIHN0ZXAgaW5zdGFuY2UgY291bnRlciAvIHNlcXVlbmNlXG4gKiBAcGFyYW0ge29iamVjdH0gZGF0YSAtIHRoZSB1c2VyIGlucHV0IGRhdGFcbiAqIEBwYXJhbSB7b2JqZWN0fSBfV0ZJbnN0YW5jZSAtIHRoZSBjdXJyZW50IF9XRkluc3RhbmNlIGNvbnN0cnVjdG9yIGluc3RhbmNlXG4gKlxuICogQGV4YW1wbGUgJydcbiAqXG4gKiBAcmV0dXJuICcnXG4gKlxuICovXG5mdW5jdGlvbiBzdGVwKHByb2Nlc3NJZCwgcHJvY2Vzc1NlcSwgc3ViUHJvY2Vzc0lkLCBzdWJQcm9jZXNzU2VxLCBzdGVwSWQsIHN0ZXBTZXEsIGRhdGEsIF9XRkluc3RhbmNlLCBzcHV1aWQpIHtcblxuICAgIC8vIERlZmF1bHQgc3RlcCBtb2RlbFxuICAgIHZhciBtb2RlbCA9IHtcbiAgICAgICAgaWQ6ICcnLFxuICAgICAgICBzZXE6ICcnLFxuICAgICAgICBzdGF0dXM6ICcnLFxuICAgICAgICBtZXNzYWdlOiAnJyxcbiAgICAgICAgYXNzaWduZWRUbzoge1xuICAgICAgICAgICAgdXNlcklkOiAnJyxcbiAgICAgICAgICAgIG5hbWU6ICcnXG4gICAgICAgIH0sXG4gICAgICAgIGFzc2lnbm1lbnQ6IHt9LFxuICAgICAgICBjb21tZW50OiAnJ1xuICAgIH07XG5cbiAgICB2YXIgc3ViUHJvY2VzcyA9IHt9O1xuXG4gICAgdmFyIHV1aWQgPSAnJztcbiAgICB2YXIgaW5zdFN1YlByb2Nlc3M7XG4gICAgdmFyIHN0ZXAgPSB7fTtcblxuICAgIHZhciB0cmFuc2l0aW9uSWQgPSAnJztcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy9HZXQgdGhlIGN1cnJlbnQgc3ViUHJvY2VzcyBpbnN0YW5jZSBkYXRhXG4gICAgICAgICAgICBfV0ZJbnN0YW5jZS5pbnN0YW5jZS5wcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uIChvYmpQcm9jZXNzKSB7XG4gICAgICAgICAgICAgICAgaWYgKG9ialByb2Nlc3MuaWQgPT0gcHJvY2Vzc0lkICYmIG9ialByb2Nlc3Muc2VxID09IHByb2Nlc3NTZXEpIHtcbiAgICAgICAgICAgICAgICAgICAgb2JqUHJvY2Vzcy5zdWJQcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uIChvYmpTdWJQcm9jZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqU3ViUHJvY2Vzcy5pZCA9PSBzdWJQcm9jZXNzSWQgJiYgb2JqU3ViUHJvY2Vzcy5zZXEgPT0gc3ViUHJvY2Vzc1NlcSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV1aWQgPSBvYmpTdWJQcm9jZXNzLnV1aWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICBfV0ZJbnN0YW5jZS5zdWJwcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uIChzdWJQcm9jZXNzSXRlbSkge1xuICAgICAgICAgICAgICAgIGlmIChzdWJQcm9jZXNzSXRlbS5faWQgPT0gdXVpZCkge1xuICAgICAgICAgICAgICAgICAgICBpbnN0U3ViUHJvY2VzcyA9IHN1YlByb2Nlc3NJdGVtO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIF9XRkluc3RhbmNlLmNvbmZpZy5wcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uIChvYmpQcm9jZXNzKSB7XG4gICAgICAgICAgICAgICAgaWYgKG9ialByb2Nlc3MuX2lkID09IHByb2Nlc3NJZCkge1xuICAgICAgICAgICAgICAgICAgICBvYmpQcm9jZXNzLnN1YlByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24gKG9ialN1YlByb2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmpTdWJQcm9jZXNzLl9pZCA9PSBzdWJQcm9jZXNzSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJQcm9jZXNzID0gb2JqU3ViUHJvY2VzcztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmpTdWJQcm9jZXNzLnN0ZXBzLmZpbHRlcihmdW5jdGlvbiAob2JqU3RlcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqU3RlcC5faWQgPT0gc3RlcElkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGVwID0gb2JqU3RlcDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvLyBVcGRhdGUgdGhlIHN1Yi1wcm9jZXNzIHN0ZXAgZGF0YVxuICAgICAgICAgICAgbW9kZWwuaWQgPSBzdGVwSWQ7XG4gICAgICAgICAgICBtb2RlbC5zZXEgPSBzdGVwU2VxO1xuXG4gICAgICAgICAgICB2YXIgaW5zdGFuY2VTdGF0dXMgPSAnJztcbiAgICAgICAgICAgIGlmIChzdGVwLnNldEluc3RhbmNlU3RhdHVzVG8uTm90U3RhcnRlZCAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBpbnN0YW5jZVN0YXR1cyA9IFwiTm90U3RhcnRlZFwiO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChzdGVwLnNldEluc3RhbmNlU3RhdHVzVG8uQ3JlYXRlZCAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBpbnN0YW5jZVN0YXR1cyA9IFwiQ3JlYXRlZFwiO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChzdGVwLnNldEluc3RhbmNlU3RhdHVzVG8uSW5Qcm9ncmVzcyAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBpbnN0YW5jZVN0YXR1cyA9IFwiSW5Qcm9ncmVzc1wiO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChzdGVwLnNldEluc3RhbmNlU3RhdHVzVG8uU3VibWl0dGVkICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGluc3RhbmNlU3RhdHVzID0gXCJTdWJtaXR0ZWRcIjtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RlcC5zZXRJbnN0YW5jZVN0YXR1c1RvLkNvbXBsZXRlICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGluc3RhbmNlU3RhdHVzID0gXCJDb21wbGV0ZVwiO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgbGFuZ3VhZ2UgPSBzZXJ2aWNlLmdldExhbmd1YWdlKCk7XG5cbiAgICAgICAgICAgIG1vZGVsLnN0YXR1cyA9IGluc3RhbmNlU3RhdHVzO1xuICAgICAgICAgICAgbW9kZWwubWVzc2FnZSA9IGV2YWwoXCJzdGVwLnNldEluc3RhbmNlU3RhdHVzVG8uXCIgKyBpbnN0YW5jZVN0YXR1cyArIFwiLmxhYmVsLmkxOG4uXCIgKyBsYW5ndWFnZSk7XG4gICAgICAgICAgICBtb2RlbC5jb21tZW50ID0gZGF0YS5jb21tZW50ICE9PSB1bmRlZmluZWQgPyBkYXRhLmNvbW1lbnQgOiAnJztcbiAgICAgICAgICAgIHZhciBpbmRpY2F0b3JzID0gaW5zdFN1YlByb2Nlc3MgIT09IHVuZGVmaW5lZCA/IGluc3RTdWJQcm9jZXNzLmluZGljYXRvcnMgOiBbXTtcbiAgICAgICAgICAgIGluZGljYXRvckRvY3MocHJvY2Vzc0lkLCBpbmRpY2F0b3JzLCBtb2RlbCwgX1dGSW5zdGFuY2UpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgIHV1aWQgPSBzcHV1aWQ7XG5cbiAgICAgICAgICAgICAgICBpZiAoc3RlcC5mdW5jdGlvbi5hY3Rpb25zICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBhY3Rpb25zKHN0ZXAuZnVuY3Rpb24uYWN0aW9ucywgcHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIHN1YlByb2Nlc3MsIG1vZGVsLCBfV0ZJbnN0YW5jZSwgZGF0YSwgc3B1dWlkKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWRkIHNldCBvYmplY3QgdG8gc3VicHJvY2VzcyBoaXN0b3J5IG9iamVjdFxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIHZhciBzcGluc3RhbmNlT2JqZWN0ID0gSlNPTi54cGF0aChcIi9zdWJwcm9jZXNzZXNbX2lkIGVxICdcIisgc3B1dWlkICtcIiddXCIsIF9XRkluc3RhbmNlLCB7fSlbMF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgLy8gICBzcGluc3RhbmNlT2JqZWN0Lmhpc3RvcnkucHVzaChtb2RlbCk7XG5cblxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRXhlY3V0ZSB0aGUgdHJhbnNpdGlvbnMsIGlmIGF1dG9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdHJhbnNpdGlvbklkID0gc3RlcC50cmFuc2l0aW9uWzBdLl9pZDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2l0aW9uKHByb2Nlc3NJZCwgcHJvY2Vzc1NlcSwgc3ViUHJvY2Vzc0lkLCBzdWJQcm9jZXNzU2VxLCBzdGVwSWQsIHRyYW5zaXRpb25JZCwgZGF0YSwgX1dGSW5zdGFuY2UsIHNwdXVpZCwgbW9kZWwpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnVHJhbnNpdGlvbiBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5LicsIHJlc3VsdC5kYXRhLnN0ZXApO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAvLyBFbHNlIHRhc2tzIGFyZSBzcHJlY2lmaWVkLCBleGVjdXRlIHRoZW1cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHN0ZXAuZnVuY3Rpb24udGFzayAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gTWFrZSBhc3NpZ25tZW50c1xuICAgICAgICAgICAgICAgICAgICB0YXNrKHByb2Nlc3NJZCwgcHJvY2Vzc1NlcSwgc3RlcC5mdW5jdGlvbi50YXNrLCBzcHV1aWQsIG1vZGVsKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWRkIHNldCBvYmplY3QgdG8gc3VicHJvY2VzcyBoaXN0b3J5IG9iamVjdFxuXG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICBcblxuXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnVGFzayBjb21wbGV0ZS4nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdUYXNrIGF3YWl0aW5nIHVzZXIgYWN0aW9uLicsIG1vZGVsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgfVxuXG4gICAgfSk7XG59O1xuXG4vKipcbiAqIFByb2Nlc3MgaW5kaWNhdG9yIHVwZGF0ZXNcbiAqXG4gKiBAcGFyYW0ge29iamVjdH0gYWN0aW9ucyAtIHRoZSBhY3Rpb25zIGNvbmZpZyBkYXRhXG4gKiBAcGFyYW0ge29iamVjdH0gc3ViUHJvY2VzcyAtIHRoZSBjdXJyZW50IHN1Yi1wcm9jZXNzIGZvcm0gY29uZmlnIGRhdGFcbiAqIEBwYXJhbSB7b2JqZWN0fSBfV0ZJbnN0YW5jZSAtIHRoZSBjdXJyZW50IHdvcmtmbG93IGNvbnN0cnVjdG9yIGluc3RhbmNlXG4gKlxuICogQGV4YW1wbGUgJydcbiAqXG4gKiBAcmV0dXJuICcnXG4gKlxuICovXG5mdW5jdGlvbiBpbmRpY2F0b3JzKGluZGljYXRvcnMsIF9XRkluc3RhbmNlLCBzcHV1aWQpIHtcbiAgICB2YXIgbW9kZWwgPSBbXTtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgdmFyIGFycmF5ID0gSlNPTi54cGF0aChcImluZGljYXRvcnNbZm46Y291bnQoLi93b3JrZmxvd3MvcHJvY2Vzc2VzW3N1YlByb2Nlc3NVVUlEIGVxICdcIiArIHNwdXVpZCArIFwiJ10pIGd0IDBdXCIsIF9XRkluc3RhbmNlLCB7fSk7XG4gICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGFycmF5Lmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgdmFyIGluZGljYXRvciA9IGFycmF5W2pdO1xuICAgICAgICAgICAgICAgIHZhciBpbmRpY2F0b3JNb2RlbCA9IHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6ICcnLFxuICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZXM6IFtdXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIGluc3RhbmNlTW9kZWwgPSB7XG4gICAgICAgICAgICAgICAgICAgIHV1aWQ6ICcnLFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogJycsXG4gICAgICAgICAgICAgICAgICAgIGtleTogJycsXG4gICAgICAgICAgICAgICAgICAgIHNlcTogMVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGluZGljYXRvck1vZGVsLmlkID0gaW5kaWNhdG9yLmNhdGVnb3J5LnRlcm07XG4gICAgICAgICAgICAgICAgaW5zdGFuY2VNb2RlbC51dWlkID0gaW5kaWNhdG9yLl9pZDtcbiAgICAgICAgICAgICAgICBpbnN0YW5jZU1vZGVsLnRpdGxlID0gaW5kaWNhdG9yLnRpdGxlO1xuICAgICAgICAgICAgICAgIGluc3RhbmNlTW9kZWwua2V5ID0gJyc7XG4gICAgICAgICAgICAgICAgaW5zdGFuY2VNb2RlbC5zZXEgPSBpbmRpY2F0b3IubW9kZWwucGVuZGluZy5zZXE7IC8vIGluZGljYXRvciBzZXEgbnVtYmVyIGhlcmUgd2hpY2ggaXMgZ2V0dGluZyB1cGRhdGVkLlxuICAgICAgICAgICAgICAgIGluZGljYXRvck1vZGVsLmluc3RhbmNlcy5wdXNoKGluc3RhbmNlTW9kZWwpO1xuICAgICAgICAgICAgICAgIG1vZGVsLnB1c2goaW5kaWNhdG9yTW9kZWwpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnUHJvY2VzcyBpbmRpY2F0b3IgbW9kZWwgdXBkYXRlZC4nLCBtb2RlbCk7XG4gICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICB9XG5cbiAgICB9KVxufTtcblxuLyoqXG4gKiBQcm9jZXNzIGFzc2lnbiB1c2VyXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHByb2Nlc3NJZCAtIHRoZSBXb3JrZmxvdyBjb25maWcgLyBkZWZpbml0aW9uIHByb2Nlc3MgaWRcbiAqIEBwYXJhbSB7bnVtYmVyfSBwcm9jZXNzU2VxIC0gdGhlIFdvcmtmbG93IGluc3RhbmNlIHByb2Nlc3Mgc2VxXG4gKiBAcGFyYW0ge3N0cmluZ30gc3ViUHJvY2Vzc0lkIC0gdGhlIFdvcmtmbG93IGNvbmZpZyAvIGRlZmluaXRpb24gc3ViLXByb2Nlc3MgaWRcbiAqIEBwYXJhbSB7bnVtYmVyfSBzdWJQcm9jZXNzU2VxIC0gdGhlIFdvcmtmbG93IGluc3RhbmNlIHN1Yi1wcm9jZXNzIHNlcVxuICogQHBhcmFtIHtzdHJpbmd9IHN0ZXBJZCAtIHRoZSBXb3JrZmxvdyBjb25maWcgLyBkZWZpbml0aW9uIHN0ZXAgaWRcbiAqIEBwYXJhbSB7c3RyaW5nfSB0cmFuc2l0aW9uSWQgLSB0aGUgV29ya2Zsb3cgY29uZmlnIC8gZGVmaW5pdGlvbiB0cmFuc2l0aW9uIGlkXG4gKiBAcGFyYW0ge29iamVjdH0gdXNlciAtIHRoZSB1c2VyIHRvIGFzc2lnbiB0b1xuICogQHBhcmFtIHtvYmplY3R9IF9XRkluc3RhbmNlIC0gdGhlIGN1cnJlbnQgd29ya2Zsb3cgY29uc3RydWN0b3IgaW5zdGFuY2VcbiAqXG4gKiBAZXhhbXBsZSAnJ1xuICpcbiAqIEByZXR1cm4gJydcbiAqXG4gKi9cbmZ1bmN0aW9uIGFzc2lnblVzZXIocHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIHVzZXIsIF9XRkluc3RhbmNlKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHZhciB1dWlkID0gJyc7XG4gICAgICAgICAgICAvLyBHZXQgdGhlIGN1cnJlbnQgc3ViUHJvY2VzcyBpbnN0YW5jZSBkYXRhXG4gICAgICAgICAgICBfV0ZJbnN0YW5jZS5pbnN0YW5jZS5wcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uIChvYmpQcm9jZXNzKSB7XG4gICAgICAgICAgICAgICAgaWYgKG9ialByb2Nlc3MuaWQgPT0gcHJvY2Vzc0lkICYmIG9ialByb2Nlc3Muc2VxID09IHByb2Nlc3NTZXEpIHtcbiAgICAgICAgICAgICAgICAgICAgb2JqUHJvY2Vzcy5zdWJQcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uIChvYmpTdWJQcm9jZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqU3ViUHJvY2Vzcy5pZCA9PSBzdWJQcm9jZXNzSWQgJiYgb2JqU3ViUHJvY2Vzcy5zZXEgPT0gc3ViUHJvY2Vzc1NlcSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV1aWQgPSBvYmpTdWJQcm9jZXNzLnV1aWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIF9XRkluc3RhbmNlLnN1YnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24gKHN1YlByb2Nlc3NJdGVtKSB7XG4gICAgICAgICAgICAgICAgaWYgKHN1YlByb2Nlc3NJdGVtLl9pZCA9PSB1dWlkKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgdXNlciBkZXRhaWxzXG4gICAgICAgICAgICAgICAgICAgIHN1YlByb2Nlc3NJdGVtLnN0ZXAuYXNzaWduZWRUby51c2VySWQgPSB1c2VyLmlkO1xuICAgICAgICAgICAgICAgICAgICBzdWJQcm9jZXNzSXRlbS5zdGVwLmFzc2lnbmVkVG8ubmFtZSA9IHVzZXIubmFtZTtcbiAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSBpbmRpY2F0b3JzIHVzZXIgZGV0YWlsc1xuICAgICAgICAgICAgICAgICAgICB2YXIgaW5kaWNhdG9ycyA9IHN1YlByb2Nlc3NJdGVtLmluZGljYXRvcnM7XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaW5kaWNhdG9ycy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGluZGljYXRvciA9IGluZGljYXRvcnNbaV07XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGluZGljYXRvci5pbnN0YW5jZXMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5zdGFuY2UgPSBpbmRpY2F0b3IuaW5zdGFuY2VzW2pdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgX1dGSW5zdGFuY2UuaW5kaWNhdG9ycy5sZW5ndGg7IGsrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZG9jID0gX1dGSW5zdGFuY2UuaW5kaWNhdG9yc1trXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluc3RhbmNlLnV1aWQgPT0gZG9jLl9pZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jLndvcmtmbG93cy5maWx0ZXIoZnVuY3Rpb24gKHdvcmtmbG93KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdvcmtmbG93LmlkID09IF9XRkluc3RhbmNlLmNvbmZpZy5faWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd29ya2Zsb3cucHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbiAocHJvY2Vzc0l0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcm9jZXNzSXRlbS5pZCA9PSBwcm9jZXNzSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgdGhlIHVzZXIgaWQgYW5kIG5hbWUgaW4gdGhlIGRvY3VtZW50XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc0l0ZW0uc3RlcC5hc3NpZ25lZFRvLnVzZXJJZCA9IHVzZXIuaWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc0l0ZW0uc3RlcC5hc3NpZ25lZFRvLm5hbWUgPSB1c2VyLm5hbWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnVXNlciBhc3NpZ25lZCBzdWNjZXNzZnVsbHkuIFVzZXJJZDogXCInICsgdXNlci5pZCArICdcIiwgTmFtZTogXCInICsgdXNlci5uYW1lICsgJ1wiJywgc3ViUHJvY2Vzc0l0ZW0pO1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgfVxuXG4gICAgfSk7XG59O1xuXG4vKipcbiAqIFByb2Nlc3MgaW5kaWNhdG9yIGRvY3VtZW50IHVwZGF0ZXNcbiAqXG4gKiBAcGFyYW0ge29iamVjdH0gYWN0aW9ucyAtIHRoZSBhY3Rpb25zIGNvbmZpZyBkYXRhXG4gKiBAcGFyYW0ge29iamVjdH0gc3ViUHJvY2VzcyAtIHRoZSBjdXJyZW50IHN1Yi1wcm9jZXNzIGZvcm0gY29uZmlnIGRhdGFcbiAqIEBwYXJhbSB7b2JqZWN0fSBfV0ZJbnN0YW5jZSAtIHRoZSBjdXJyZW50IHdvcmtmbG93IGNvbnN0cnVjdG9yIGluc3RhbmNlXG4gKlxuICogQGV4YW1wbGUgJydcbiAqXG4gKiBAcmV0dXJuICcnXG4gKlxuICovXG5mdW5jdGlvbiBpbmRpY2F0b3JEb2NzKHByb2Nlc3NJZCwgaW5kaWNhdG9ycywgc3RlcCwgX1dGSW5zdGFuY2UpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSBpbmRpY2F0b3Igc2VjdGlvbnMgb2YgdGhlIHN1YlByb2Nlc3NcbiAgICAgICAgICAgIGlmIChpbmRpY2F0b3JzID09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvciA9IHV0aWwuZXJyb3IoJ1dGSW5kaWNhdG9yc1VwZGF0ZScsICdJbmRpY2F0b3JzIHBhcmFtZXRlciBpcyByZXF1aXJlZC4gLSBWYWx1ZTogJyArIGluZGljYXRvcnMpXG4gICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaW5kaWNhdG9ycy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgaW5kaWNhdG9yID0gaW5kaWNhdG9yc1tpXTtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBpbmRpY2F0b3IuaW5zdGFuY2VzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5zdGFuY2UgPSBpbmRpY2F0b3IuaW5zdGFuY2VzW2pdO1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCBfV0ZJbnN0YW5jZS5pbmRpY2F0b3JzLmxlbmd0aDsgaysrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRvYyA9IF9XRkluc3RhbmNlLmluZGljYXRvcnNba107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluc3RhbmNlLnV1aWQgPT0gZG9jLl9pZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2Mud29ya2Zsb3dzLmZpbHRlcihmdW5jdGlvbiAod29ya2Zsb3cpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3b3JrZmxvdy5pZCA9PSBfV0ZJbnN0YW5jZS5jb25maWcuX2lkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd29ya2Zsb3cucHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbiAocHJvY2Vzc0l0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHByb2Nlc3NJdGVtLmlkID09IHByb2Nlc3NJZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc0l0ZW0uc3RlcC5pZCA9IHN0ZXAuaWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzSXRlbS5zdGVwLnNlcSA9IHN0ZXAuc2VxO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc0l0ZW0uc3RlcC5zdGF0dXMgPSBzdGVwLnN0YXR1cztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NJdGVtLnN0ZXAubWVzc2FnZSA9IHN0ZXAubWVzc2FnZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NJdGVtLnN0ZXAuYXNzaWduZWRUby51c2VySWQgPSBzdGVwLmFzc2lnbmVkVG8udXNlcklkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc0l0ZW0uc3RlcC5hc3NpZ25lZFRvLm5hbWUgPSBzdGVwLmFzc2lnbmVkVG8ubmFtZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NJdGVtLnN0ZXAuY29tbWVudCA9IHN0ZXAuY29tbWVudCAhPT0gdW5kZWZpbmVkID8gc3RlcC5jb21tZW50IDogJyc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnSW5kaWNhdG9yIGRvY3VtZW50cyB3b3JrZmxvdyBwcm9jZXNzIG1vZGVsIHVwZGF0ZWQuJywgX1dGSW5zdGFuY2UpO1xuICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgfVxuXG4gICAgfSlcbn07XG5cbi8qKlxuICogUHJvY2VzcyBhY3Rpb25zXG4gKlxuICogQHBhcmFtIHtvYmplY3R9IGFjdGlvbnMgLSB0aGUgYWN0aW9ucyBjb25maWcgZGF0YVxuICogQHBhcmFtIHtvYmplY3R9IHN1YlByb2Nlc3MgLSB0aGUgY3VycmVudCBzdWItcHJvY2VzcyBmb3JtIGNvbmZpZyBkYXRhXG4gKiBAcGFyYW0ge29iamVjdH0gX1dGSW5zdGFuY2UgLSB0aGUgY3VycmVudCB3b3JrZmxvdyBjb25zdHJ1Y3RvciBpbnN0YW5jZVxuICpcbiAqIEBleGFtcGxlICcnXG4gKlxuICogQHJldHVybiAnJ1xuICpcbiAqL1xuZnVuY3Rpb24gYWN0aW9ucyhhY3Rpb25zLCBwcm9jZXNzSWQsIHByb2Nlc3NTZXEsIHN1YlByb2Nlc3NJZCwgc3ViUHJvY2Vzc1NlcSwgc3ViUHJvY2Vzcywgc3RlcCwgX1dGSW5zdGFuY2UsIGRhdGEsIHV1aWQpIHtcbiAgICB2YXIgYXJyQWN0aW9ucyA9IFtdO1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIHV0aWwuc3luY0xvb3AoYWN0aW9ucy5sZW5ndGgsIGZ1bmN0aW9uIChsb29wKSB7XG4gICAgICAgICAgICB2YXIgY291bnRlciA9IGxvb3AuaXRlcmF0aW9uKCk7XG4gICAgICAgICAgICBhY3Rpb24oYWN0aW9uc1tjb3VudGVyXSwgcHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIHN1YlByb2Nlc3MsIHN0ZXAsIF9XRkluc3RhbmNlLCBkYXRhLCB1dWlkKVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJldEFjdGlvbiA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBhY3Rpb25zW2NvdW50ZXJdLl9pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlcTogY291bnRlcixcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHJlc3VsdFxuICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgIGFyckFjdGlvbnMucHVzaChyZXRBY3Rpb24pO1xuICAgICAgICAgICAgICAgICAgICBsb29wLm5leHQoKTtcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgIGxvb3AuYnJlYWsoKTtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdBY3Rpb25zIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkuJywgYXJyQWN0aW9ucyk7XG4gICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn07XG5cbi8qKlxuICogUHJvY2VzcyBhY3Rpb25cbiAqXG4gKiBAcGFyYW0ge29iamVjdH0gYWN0aW9uIC0gdGhlIGFjdGlvbiBjb25maWcgZGF0YVxuICogQHBhcmFtIHtvYmplY3R9IHN1YlByb2Nlc3MgLSB0aGUgY3VycmVudCBzdWItcHJvY2VzcyBmb3JtIGNvbmZpZyBkYXRhXG4gKiBAcGFyYW0ge29iamVjdH0gX1dGSW5zdGFuY2UgLSB0aGUgY3VycmVudCB3b3JrZmxvdyBjb25zdHJ1Y3RvciBpbnN0YW5jZVxuICpcbiAqIEBleGFtcGxlICcnXG4gKlxuICogQHJldHVybiAnJ1xuICpcbiAqL1xuZnVuY3Rpb24gYWN0aW9uKGFjdGlvbiwgcHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIHN1YlByb2Nlc3MsIHN0ZXAsIF9XRkluc3RhbmNlLCBkYXRhLCB1dWlkKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcblxuICAgICAgICBpZiAoYWN0aW9uLm1ldGhvZCAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHZhciBtZXRob2RQb3NzaWJsZUl0ZW1zID0gW1wiZm9ybVwiLCBcImluZGljYXRvclwiLCBcInByb2ZpbGVcIiwgXCJzdWJQcm9jZXNzSW5zdGFuY2VcIiwgXCJzdGVwXCIsIFwiY29tbXVuaXR5XCIsIFwiYXBwbGljYXRpb25cIiwgXCJ1c2VyXCIsIFwic2RvXCIsIFwicGVyZm9ybWFuY2VcIiwgXCJ0YXhvbm9teVwiLCBcInZhcmlhYmxlc1wiLCBcIm5vdGlmaWNhdGlvblwiXTtcbiAgICAgICAgICAgIHN3aXRjaCAocHJvcGVydHlFeGlzdHMoYWN0aW9uLm1ldGhvZCwgbWV0aG9kUG9zc2libGVJdGVtcykpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdmb3JtJzpcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFjdGlvbi5tZXRob2QuZm9ybS5jcmVhdGUgIT0gdW5kZWZpbmVkKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhcmdzID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2gocHJvY2Vzc0lkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaChzdWJQcm9jZXNzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaChzdGVwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaChhY3Rpb24pO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKHByb2Nlc3NTZXEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKHN1YlByb2Nlc3NTZXEpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2goX1dGSW5zdGFuY2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKGRhdGEuY3JlYXRlVHlwZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2godXVpZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2goZGF0YS5iYXNlVVVJRCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2goZGF0YSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm0uY3JlYXRlKGFyZ3MpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0LmRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhY3Rpb24ubWV0aG9kLmZvcm0uYXV0aG9yaXNlICE9IHVuZGVmaW5lZCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXJncyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKHByb2Nlc3NJZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2goc3ViUHJvY2Vzcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2gocHJvY2Vzc1NlcSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2goc3ViUHJvY2Vzc1NlcSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2goX1dGSW5zdGFuY2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKGRhdGEuY3JlYXRlVHlwZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2godXVpZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2goZGF0YS5iYXNlVVVJRCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2goZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JtLmF1dGhvcmlzZShhcmdzKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdC5kYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYWN0aW9uLm1ldGhvZC5mb3JtLnVuZHJhZnQgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXJncyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKF9XRkluc3RhbmNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaChkYXRhLmNyZWF0ZVR5cGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKHV1aWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKGRhdGEuYmFzZVVVSUQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9ybS5zZXRVbkRyYWZ0KGFyZ3MpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0LmRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhY3Rpb24ubWV0aG9kLmZvcm0uZHJhZnQgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXJncyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKF9XRkluc3RhbmNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaChkYXRhLmNyZWF0ZVR5cGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKHV1aWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKGRhdGEuYmFzZVVVSUQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9ybS5zZXREcmFmdChhcmdzKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdC5kYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYWN0aW9uLm1ldGhvZC5mb3JtLmNsb3NlICE9IHVuZGVmaW5lZCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXJncyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKHN1YlByb2Nlc3MuaW5kaWNhdG9ycyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2goX1dGSW5zdGFuY2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKGRhdGEuY3JlYXRlVHlwZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2godXVpZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2goZGF0YS5iYXNlVVVJRCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2goZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JtLmNsb3NlKGFyZ3MpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0LmRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ2luZGljYXRvcic6XG4gICAgICAgICAgICAgICAgICAgIGlmIChhY3Rpb24ubWV0aG9kLmluZGljYXRvci5jcmVhdGUgIT0gdW5kZWZpbmVkKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhY3Rpb24ubWV0aG9kLmluZGljYXRvci5pbnN0YW50aWF0ZSAhPSB1bmRlZmluZWQpIHtcblxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFjdGlvbi5tZXRob2QuaW5kaWNhdG9yLnNldFZhbHVlICE9IHVuZGVmaW5lZCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGF0aCA9IGFjdGlvbi5tZXRob2QuaW5kaWNhdG9yLnNldFZhbHVlLnBhdGg7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGhlbHBlci5nZXROb2RlVmFsdWUoYWN0aW9uLm1ldGhvZC5pbmRpY2F0b3Iuc2V0VmFsdWUuZGF0YSwgX1dGSW5zdGFuY2UsIHV1aWQpLnRoZW4oZnVuY3Rpb24gKGRhdGFWYWx1ZSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2goX1dGSW5zdGFuY2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaCh1dWlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2gocGF0aCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKGRhdGFWYWx1ZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtLnVwZGF0ZUluZGljYXRvcihhcmdzKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQuZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cblxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFjdGlvbi5tZXRob2QuaW5kaWNhdG9yLnVwZGF0ZVN0YXR1cyAhPSB1bmRlZmluZWQpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGluZGljYXRvclNldElkID0gYWN0aW9uLm1ldGhvZC5pbmRpY2F0b3IuaW5kaWNhdG9yU2V0SWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXJncyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKF9XRkluc3RhbmNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaCh1dWlkKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFjdGlvbi5tZXRob2QuaW5kaWNhdG9yLnVwZGF0ZVN0YXR1cyAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3RhdHVzID0gYWN0aW9uLm1ldGhvZC5pbmRpY2F0b3IudXBkYXRlU3RhdHVzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaChzdGF0dXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaChpbmRpY2F0b3JTZXRJZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gS2VlcCBpbmRpY2F0b3IgZnVuY3Rpb25zIGluIGluZGlhdG9yIGZpbGUgaXN0ZWFkIG9mIGZvcm0gZmlsZS5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtLm1hcmtVcGRhdGVJbmRpY2F0b3IoYXJncykudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0LmRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShcIkFjdGlvbiBpbmRpY2F0b3Igc3ViIHR5cGUgbm90IGZvdW5kLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAncHJvZmlsZSc6XG4gICAgICAgICAgICAgICAgICAgIGlmIChhY3Rpb24ubWV0aG9kLnByb2ZpbGUuY3JlYXRlICE9IHVuZGVmaW5lZCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXJncyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKHByb2Nlc3NJZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2goX1dGSW5zdGFuY2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKGRhdGEuY3JlYXRlVHlwZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2godXVpZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2goZGF0YS5iYXNlVVVJRCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2goZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JtLmNyZWF0ZVByb2ZpbGUoYXJncykudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQuZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFjdGlvbi5tZXRob2QucHJvZmlsZS5YICE9IHVuZGVmaW5lZCkge1xuXG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdzdWJQcm9jZXNzSW5zdGFuY2UnOlxuICAgICAgICAgICAgICAgICAgICB2YXIgc3BQb3NzaWJsZUl0ZW1zID0gW1wiaW5zdGFudGlhdGVcIiwgXCJhdXRob3Jpc2VcIiwgXCJjbG9zZVwiLCBcInNldFZhcmlhYmxlXCIsIFwic2V0U3RhdHVzVG9cIiwgXCJzZXRTdGF0dXNNc2dUb1wiLCBcInNldFRpdGxlXCIsIFwic2V0VmFsaWREYXRlXCJdO1xuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHByb3BlcnR5RXhpc3RzKGFjdGlvbi5tZXRob2Quc3ViUHJvY2Vzc0luc3RhbmNlLCBzcFBvc3NpYmxlSXRlbXMpKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ3NldFRpdGxlJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWxwZXIuZ2V0Tm9kZVZhbHVlKGFjdGlvbi5tZXRob2Quc3ViUHJvY2Vzc0luc3RhbmNlLnNldFRpdGxlLCBfV0ZJbnN0YW5jZSwgdXVpZCkudGhlbihmdW5jdGlvbiAoZGF0YVZhbHVlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uc01vZHVsZS5zdWJQcm9jZXNzSW5zdGFuY2Uuc2V0VGl0bGUoYWN0aW9uLm1ldGhvZC5zdWJQcm9jZXNzSW5zdGFuY2Uuc2V0VGl0bGUsIHV1aWQsIGRhdGFWYWx1ZSwgX1dGSW5zdGFuY2UpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQuZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3VwZGF0ZSBzdWJwcm9jZXNzIGxhYmVsIGluIHdvcmtmbG93IGluc3RhbmNlIHByb2Nlc3Mgb2JqZWN0OiBUT0RPXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ3NldFZhbGlkRGF0ZSc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVscGVyLmdldE5vZGVWYWx1ZShhY3Rpb24ubWV0aG9kLnN1YlByb2Nlc3NJbnN0YW5jZS5zZXRWYWxpZERhdGUsIF9XRkluc3RhbmNlLCB1dWlkKS50aGVuKGZ1bmN0aW9uIChkYXRhVmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uc01vZHVsZS5zdWJQcm9jZXNzSW5zdGFuY2Uuc2V0VmFsaWREYXRlKGFjdGlvbi5tZXRob2Quc3ViUHJvY2Vzc0luc3RhbmNlLnNldFZhbGlkRGF0ZSwgdXVpZCwgZGF0YVZhbHVlLCBfV0ZJbnN0YW5jZSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdC5kYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3VwZGF0ZSBzdWJwcm9jZXNzIGxhYmVsIGluIHdvcmtmbG93IGluc3RhbmNlIHByb2Nlc3Mgb2JqZWN0OiBUT0RPXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KFwiTm8gbWV0aG9kIGZvdW5kIGZyb20gaW1wbGVtZW50ZWQgbGlzdCBpbiBzdWJwcm9jZXNzIGFjdGlvbi5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdzdGVwJzpcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnY29tbXVuaXR5JzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbW11bml0eVBvc3NpYmxlSXRlbXMgPSBbXCJjcmVhdGVDb21tdW5pdHlcIiwgXCJyZWxlYXNlQWRvcHRlZEFwcGxpY2F0aW9uXCIsIFwidXNlckpvaW5Db21tdW5pdHlcIl07XG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAocHJvcGVydHlFeGlzdHMoYWN0aW9uLm1ldGhvZC5jb21tdW5pdHksIGNvbW11bml0eVBvc3NpYmxlSXRlbXMpKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2NyZWF0ZUNvbW11bml0eSc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFjdGlvbnNNb2R1bGUuY29tbXVuaXR5LmNyZWF0ZUNvbW11bml0eShhY3Rpb24ubWV0aG9kLmNvbW11bml0eS5jcmVhdGVDb21tdW5pdHksIHV1aWQsIF9XRkluc3RhbmNlKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQuZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAncmVsZWFzZUFkb3B0ZWRBcHBsaWNhdGlvbic6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFjdGlvbnNNb2R1bGUuY29tbXVuaXR5LnJlbGVhc2VBZG9wdGVkQXBwbGljYXRpb24oYWN0aW9uLm1ldGhvZC5jb21tdW5pdHkucmVsZWFzZUFkb3B0ZWRBcHBsaWNhdGlvbiwgdXVpZCwgX1dGSW5zdGFuY2UpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdC5kYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICd1c2VySm9pbkNvbW11bml0eSc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFjdGlvbnNNb2R1bGUuY29tbXVuaXR5LnVzZXJKb2luQ29tbXVuaXR5KGFjdGlvbi5tZXRob2QuY29tbXVuaXR5LnVzZXJKb2luQ29tbXVuaXR5LCB1dWlkLCBfV0ZJbnN0YW5jZSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0LmRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KFwiTm8gbWV0aG9kIGZvdW5kIGZyb20gaW1wbGVtZW50ZWQgbGlzdC5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdhcHBsaWNhdGlvbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciBhcHBsaWNhdGlvblBvc3NpYmxlSXRlbXMgPSBbXCJjcmVhdGVBcHBEZWZpbml0aW9uXCIsIFwiYnVpbGRBcHBsaWNhdGlvblwiLCBcImFwcGxpY2F0aW9uQWRvcHRpb25cIl07XG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAocHJvcGVydHlFeGlzdHMoYWN0aW9uLm1ldGhvZC5hcHBsaWNhdGlvbiwgYXBwbGljYXRpb25Qb3NzaWJsZUl0ZW1zKSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdjcmVhdGVBcHBEZWZpbml0aW9uJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYWN0aW9uc01vZHVsZS5hcHBsaWNhdGlvbi5jcmVhdGVBcHBEZWZpbml0aW9uKGFjdGlvbi5tZXRob2QuYXBwbGljYXRpb24uY3JlYXRlQXBwRGVmaW5pdGlvbiwgdXVpZCwgX1dGSW5zdGFuY2UpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdC5kYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdidWlsZEFwcGxpY2F0aW9uJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYWN0aW9uc01vZHVsZS5hcHBsaWNhdGlvbi5idWlsZEFwcGxpY2F0aW9uKGFjdGlvbi5tZXRob2QuYXBwbGljYXRpb24uYnVpbGRBcHBsaWNhdGlvbiwgdXVpZCwgX1dGSW5zdGFuY2UpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdC5kYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdhcHBsaWNhdGlvbkFkb3B0aW9uJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYWN0aW9uc01vZHVsZS5hcHBsaWNhdGlvbi5hcHBsaWNhdGlvbkFkb3B0aW9uKGFjdGlvbi5tZXRob2QuYXBwbGljYXRpb24uYXBwbGljYXRpb25BZG9wdGlvbiwgdXVpZCwgX1dGSW5zdGFuY2UpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdC5kYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChcIk5vIG1ldGhvZCBmb3VuZCBmcm9tIGltcGxlbWVudGVkIGxpc3QuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBjYXNlICd1c2VyJzpcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnc2RvJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNkb1Bvc3NpYmxlSXRlbXMgPSBbXCJjcmVhdGVcIl07XG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAocHJvcGVydHlFeGlzdHMoYWN0aW9uLm1ldGhvZC5zZG8sIHNkb1Bvc3NpYmxlSXRlbXMpKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2NyZWF0ZSc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFjdGlvbnNNb2R1bGUuc2RvLmNyZWF0ZShhY3Rpb24ubWV0aG9kLnNkby5jcmVhdGUsIHV1aWQsIF9XRkluc3RhbmNlKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQuZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoXCJObyBtZXRob2QgZm91bmQgZnJvbSBpbXBsZW1lbnRlZCBsaXN0LlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgY2FzZSAncGVyZm9ybWFuY2UnOlxuICAgICAgICAgICAgICAgICAgICB2YXIgcGVyZm9ybWFuY2VQb3NzaWJsZUl0ZW1zID0gW1wiY3JlYXRlXCIsIFwiY29uZmlndXJlTm9kZVwiLCBcInVubG9ja1BlcmlvZFwiLCBcImxvY2tQZXJmb3JtYW5jZU1vZGVsXCJdO1xuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHByb3BlcnR5RXhpc3RzKGFjdGlvbi5tZXRob2QucGVyZm9ybWFuY2UsIHBlcmZvcm1hbmNlUG9zc2libGVJdGVtcykpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnY3JlYXRlJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYWN0aW9uc01vZHVsZS5wZXJmb3JtYW5jZS5jcmVhdGUoYWN0aW9uLm1ldGhvZC5wZXJmb3JtYW5jZS5jcmVhdGUsIHV1aWQsIF9XRkluc3RhbmNlKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQuZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2NvbmZpZ3VyZU5vZGUnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhY3Rpb25zTW9kdWxlLnBlcmZvcm1hbmNlLmNvbmZpZ3VyZU5vZGUoYWN0aW9uLm1ldGhvZC5wZXJmb3JtYW5jZS5jb25maWd1cmVOb2RlLCB1dWlkLCBfV0ZJbnN0YW5jZSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0LmRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICd1bmxvY2tQZXJpb2QnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhY3Rpb25zTW9kdWxlLnBlcmZvcm1hbmNlLnVubG9ja1BlcmlvZChhY3Rpb24ubWV0aG9kLnBlcmZvcm1hbmNlLnVubG9ja1BlcmlvZCwgdXVpZCwgX1dGSW5zdGFuY2UpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdC5kYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnbG9ja1BlcmZvcm1hbmNlTW9kZWwnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhY3Rpb25zTW9kdWxlLnBlcmZvcm1hbmNlLmxvY2tQZXJmb3JtYW5jZU1vZGVsKGFjdGlvbi5tZXRob2QucGVyZm9ybWFuY2UubG9ja1BlcmZvcm1hbmNlTW9kZWwsIHV1aWQsIF9XRkluc3RhbmNlKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQuZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChcIk5vIG1ldGhvZCBmb3VuZCBmcm9tIGltcGxlbWVudGVkIGxpc3QuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBjYXNlICd0YXhvbm9teSc6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0YXhvbm9teVBvc3NpYmxlSXRlbXMgPSBbXCJjcmVhdGVcIl07XG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAocHJvcGVydHlFeGlzdHMoYWN0aW9uLm1ldGhvZC50YXhvbm9teSwgdGF4b25vbXlQb3NzaWJsZUl0ZW1zKSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdjcmVhdGUnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhY3Rpb25zTW9kdWxlLnRheG9ub215LmNyZWF0ZShhY3Rpb24ubWV0aG9kLnRheG9ub215LmNyZWF0ZSwgdXVpZCwgX1dGSW5zdGFuY2UpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdC5kYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChcIk5vIG1ldGhvZCBmb3VuZCBmcm9tIGltcGxlbWVudGVkIGxpc3QuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAndmFyaWFibGVzJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhcmlhYmxlc1Bvc3NpYmxlSXRlbXMgPSBbXCJzZXRWYXJpYWJsZVwiXTtcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChwcm9wZXJ0eUV4aXN0cyhhY3Rpb24ubWV0aG9kLnZhcmlhYmxlcywgdmFyaWFibGVzUG9zc2libGVJdGVtcykpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnc2V0VmFyaWFibGUnOlxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFjdGlvbnNNb2R1bGUudmFyaWFibGVzLnNldFZhcmlhYmxlKGFjdGlvbi5tZXRob2QudmFyaWFibGVzLnNldFZhcmlhYmxlLCBfV0ZJbnN0YW5jZSwgdXVpZCkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0LmRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KFwiTm8gbWV0aG9kIGZvdW5kIGZyb20gaW1wbGVtZW50ZWQgbGlzdC5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdub3RpZmljYXRpb24nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgbm90aWZpY2F0aW9uUG9zc2libGVJdGVtcyA9IFtcImVtYWlsXCIsIFwic21zXCIsIFwicHVzaEFQSVwiXTtcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChwcm9wZXJ0eUV4aXN0cyhhY3Rpb24ubWV0aG9kLm5vdGlmaWNhdGlvbiwgbm90aWZpY2F0aW9uUG9zc2libGVJdGVtcykpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnZW1haWwnOlxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFjdGlvbnNNb2R1bGUubm90aWZpY2F0aW9uLmVtYWlsKGFjdGlvbi5tZXRob2Qubm90aWZpY2F0aW9uLmVtYWlsLCBfV0ZJbnN0YW5jZSwgdXVpZCkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0LmRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ3Ntcyc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KFwiU01TIGZ1bmN0aW9uYWxpdHkgbm90IGltcGxlbWVudGVkXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdwdXNoQVBJJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoXCJwdXNoQVBJIGZ1bmN0aW9uYWxpdHkgbm90IGltcGxlbWVudGVkXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChcIk5vIG1ldGhvZCBmb3VuZCBmcm9tIGltcGxlbWVudGVkIGxpc3QuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cblxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChcIm1ldGhvZCBub3QgZGVmaW5lZCBpbiBjb25maWd1cmF0aW9uXCIpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVqZWN0KFwiTm8gbWV0aG9kIGZvdW5kIGZyb20gaW1wbGVtZW50ZWQgbGlzdC5cIik7XG5cbiAgICAgICAgfVxuXG4gICAgfSk7XG59O1xuXG4vKipcbiAqIFByb2Nlc3MgdGFza3NcbiAqXG4gKiBAcGFyYW0ge29iamVjdH0gdGFzayAtIHRoZSB0YXNrIGNvbmZpZyBkYXRhXG4gKiBAcGFyYW0ge29iamVjdH0gaW5wdXREYXRhIC0gdGhlIHVzZXIgaW5wdXQgZGF0YVxuICpcbiAqIEBleGFtcGxlICcnXG4gKlxuICogQHJldHVybiAnJ1xuICpcbiAqL1xuZnVuY3Rpb24gdGFzayhzdWJwcm9jZXNzSUQsIHN1YnByb2Nlc3NTRVEsIHRhc2ssIHNwdXVpZCwgbW9kZWwpIHtcblxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG5cbiAgICAgICAgdmFyIF9XRkluc3RhbmNlID0gYXBwLlNDT1BFLndvcmtmbG93O1xuICAgICAgICB2YXIgcHJlQWN0aW9uc0NvbmYgPSB0YXNrLnByZUFjdGlvbnM7XG4gICAgICAgIHByZUFjdGlvbnMocHJlQWN0aW9uc0NvbmYsIF9XRkluc3RhbmNlKS50aGVuKGZ1bmN0aW9uIChwcmVBY3Rpb25SZXN1bHQpIHtcblxuICAgICAgICAgICAgdmFyIGxpc3QgPSBbXTtcbiAgICAgICAgICAgIGlmICh0YXNrLmFzc2lnbi5yb2xlICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHZhciBhc3NpZ25UeXBlID0gJ3Byb2ZpbGVSb2xlJztcbiAgICAgICAgICAgICAgICB2YXIgcHJvZmlsZUlkID0gX1dGSW5zdGFuY2UucHJvZmlsZTtcbiAgICAgICAgICAgICAgICB2YXIgaWQgPSAnJztcbiAgICAgICAgICAgICAgICBpZiAodGFzay5hc3NpZ24ucm9sZS5wcm9maWxlID09ICdjdXJyZW50Jykge1xuICAgICAgICAgICAgICAgICAgICBpZCA9IF9XRkluc3RhbmNlLnByb2ZpbGU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0YXNrLmFzc2lnbi5yb2xlLnByb2ZpbGUgPT0gJ2NvbW11bml0eScpIHtcbiAgICAgICAgICAgICAgICAgICAgaWQgPSBhcHAuU0NPUEUuZ2V0Q29tbXVuaXR5SWQoKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgcm9sZSA9IHRhc2suYXNzaWduLnJvbGUucm9sZUlkO1xuXG4gICAgICAgICAgICAgICAgbGlicmFyeS5nZXRVc2Vyc0xpc3RCeVJvbGUoaWQsIHJvbGUpLnRoZW4oZnVuY3Rpb24gKGxpc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGxpc3QgIT0gdW5kZWZpbmVkKSB7XG5cblxuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobGlzdC5sZW5ndGggPiAxKSB7XG5cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5ldyByZXF1aXJlbWVudCBoZXJlIHdpbGwgYXV0b21hdGljYWxseSBhc3NpZ24gdGhlIHN0ZXAgdG8gY3VycmVudCB1c2VyIGlmIHRoaXMgdXNlciBmYWxscyB1bmRlciB0aGUgcHJvdmlkZWQgZ3JvdXAuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUlVMRSBJTlRST0RVQ0VEIE9OIDE2LU1BUkNILTIwMTdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiBjdXJyZW50IHVzZXIgbGllcyB3aXRoaW4gdGhlIHNwZWNpZmllZCByb2xlLCBpdCB3aWxsIGJlIGF1dG9tYXRpY2FsbHkgYXNzaWduZWQgdG8gdGhhdCB1c2VyLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpc0N1cnJlbnRVc2VyRXhpc3RJbkdpdmVuUm9sZSA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJvbGVzT2JqZWN0ID0gbGlicmFyeS5nZXRDdXJyZW50VXNlclJvbGVzKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaWQgPT0gYXBwLlNDT1BFLmdldENvbW11bml0eUlkKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlzQ3VycmVudFVzZXJSb2xlID0gcm9sZXNPYmplY3QuY29tbXVuaXR5LmluZGV4T2Yocm9sZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0N1cnJlbnRVc2VyUm9sZSA+IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzQ3VycmVudFVzZXJFeGlzdEluR2l2ZW5Sb2xlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzQ3VycmVudFVzZXJFeGlzdEluR2l2ZW5Sb2xlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpc0N1cnJlbnRVc2VyUm9sZSA9IHJvbGVzT2JqZWN0LnByb2ZpbGUuaW5kZXhPZihyb2xlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlzQ3VycmVudFVzZXJJbXBsaWNpdFJvbGUgPSByb2xlc09iamVjdC5pbXBsaWNpdC5pbmRleE9mKHJvbGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKGlzQ3VycmVudFVzZXJSb2xlID4gLTEgfHwgaXNDdXJyZW50VXNlckltcGxpY2l0Um9sZSA+IC0xKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzQ3VycmVudFVzZXJFeGlzdEluR2l2ZW5Sb2xlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNDdXJyZW50VXNlckV4aXN0SW5HaXZlblJvbGUgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzQ3VycmVudFVzZXJFeGlzdEluR2l2ZW5Sb2xlKXtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXNzaWduZWUgPSBtb2RlbC5hc3NpZ25lZFRvO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc3NpZ25lZS5uYW1lID0gTE9DQUxfU0VUVElOR1MuU1VCU0NSSVBUSU9OUy51c2VybmFtZSArIFwiXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzc2lnbmVlLnVzZXJJZCA9IExPQ0FMX1NFVFRJTkdTLlNVQlNDUklQVElPTlMudXNlcklkICsgXCJcIjtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXNzaWdubWVudCA9ICcnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0YXNrLmFzc2lnbi5hc3NpZ25tZW50ICE9IHVuZGVmaW5lZCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhc3NpZ25tZW50ID0gbW9kZWwuYXNzaWdubWVudDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFjY2VwdCA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic2hvd1wiOiB0YXNrLmFzc2lnbi5hc3NpZ25tZW50LmFjY2VwdC5zaG93LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJsYWJlbFwiOiBfZ2V0TmFtZUJ5TGFuZyh0YXNrLmFzc2lnbi5hc3NpZ25tZW50LmFjY2VwdC5sYWJlbC5pMThuKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzc2lnbm1lbnQuYWNjZXB0ID0gYWNjZXB0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc3NpZ25tZW50Lm1lc3NhZ2UgPSBfZ2V0TmFtZUJ5TGFuZyh0YXNrLmFzc2lnbi5hc3NpZ25tZW50Lm1lc3NhZ2UuaTE4bik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZWplY3QgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInNob3dcIjogdGFzay5hc3NpZ24uYXNzaWdubWVudC5yZWplY3Quc2hvdyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibGFiZWxcIjogX2dldE5hbWVCeUxhbmcodGFzay5hc3NpZ24uYXNzaWdubWVudC5yZWplY3QubGFiZWwuaTE4bilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc3NpZ25tZW50LnJlamVjdCA9IHJlamVjdDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJwcm9maWxlSWRcIjogcHJvZmlsZUlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJyb2xlSWRcIjogcm9sZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidHlwZVwiOiBcInJvbGVcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzc2lnbm1lbnQudmFsdWUgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNzaWdubWVudC5wcm9maWxlUm9sZUlkID0gaWQ7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzQ3VycmVudFVzZXJFeGlzdEluR2l2ZW5Sb2xlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vRmlyZSBQcmUtd29ya0FjdGlvbnMgaGVyZVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwcm9jZXNzSWQgPSBKU09OLnhwYXRoKFwiL2luc3RhbmNlL3Byb2Nlc3Nlc1tzdWJQcm9jZXNzZXMvdXVpZCBlcSAnXCIgKyBzcHV1aWQgKyBcIiddL2lkXCIsIF9XRkluc3RhbmNlLCB7fSlbMF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdWJQcm9jZXNzSWQgPSBKU09OLnhwYXRoKFwiL2luc3RhbmNlL3Byb2Nlc3Nlcy9zdWJQcm9jZXNzZXNbdXVpZCBlcSAnXCIgKyBzcHV1aWQgKyBcIiddL2lkXCIsIF9XRkluc3RhbmNlLCB7fSlbMF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdGVwSWQgPSBKU09OLnhwYXRoKFwiL3N1YnByb2Nlc3Nlc1tfaWQgZXEgJ1wiICsgc3B1dWlkICsgXCInXS9zdGVwL2lkXCIsIF9XRkluc3RhbmNlLCB7fSlbMF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdGVwT2JqZWN0ID0gSlNPTi54cGF0aChcIi9wcm9jZXNzZXNbX2lkIGVxICdcIiArIHByb2Nlc3NJZCArIFwiJ10vc3ViUHJvY2Vzc2VzW19pZCBlcSAnXCIgKyBzdWJQcm9jZXNzSWQgKyBcIiddL3N0ZXBzW19pZCBlcSAnXCIgKyBzdGVwSWQgKyBcIiddXCIsIF9XRkluc3RhbmNlLmNvbmZpZywge30pWzBdO1xuXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhc2sucHJlV29ya0FjdGlvbnMgIT0gdW5kZWZpbmVkKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwcmVXb3JrQWN0aW9uc09iaiA9IHRhc2sucHJlV29ya0FjdGlvbnM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmVXb3JrQWN0aW9ucyhwcmVXb3JrQWN0aW9uc09iaiwgX1dGSW5zdGFuY2UpLnRoZW4oZnVuY3Rpb24gKHN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCdBc3NpZ25tZW50IGlzIG1hZGUuIFByZSB3b3JrIGFjdGlvbnMgZm91bmQgYW5kIGV4ZWN1dGVkICcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoJ0Fzc2lnbm1lbnQgaXMgbWFkZS4gTm8gcHJlIHdvcmsgYWN0aW9ucyBmb3VuZC4gJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgnTm90aWZpY2F0aW9ucyByZXF1ZXN0IHN1Ym1pdHRlZCBmb3IgYWNjZXB0YW5jZS4nKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcblxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChsaXN0Lmxlbmd0aCA9PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSW1wbGVtZW50IGhlcmUgcHJlV29ya0FjdGlvbiBhcyB0aGlzIGlzIGF1dG9tYXRpY2FsbHkgYXNzaWduZWQgaW4gY2FzZSBvZiAxIHVzZXIgYW5kIHdpbGwgbm90IGdvIHRyb3VnaCBhY2NlcHRhbmNlIGZ1bmN0aW9uLlxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHVzZXJJZCA9IGxpc3RbMF0uaWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHVzZXJuYW1lID0gbGlzdFswXS5uYW1lO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhc3NpZ25lZSA9IG1vZGVsLmFzc2lnbmVkVG87XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNzaWduZWUubmFtZSA9IHVzZXJuYW1lICsgXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc3NpZ25lZS51c2VySWQgPSB1c2VySWQgKyBcIlwiO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFzc2lnbm1lbnQgPSAnJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGFzay5hc3NpZ24uYXNzaWdubWVudCAhPSB1bmRlZmluZWQpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXNzaWdubWVudCA9IG1vZGVsLmFzc2lnbm1lbnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhY2NlcHQgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInNob3dcIjogdGFzay5hc3NpZ24uYXNzaWdubWVudC5hY2NlcHQuc2hvdyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibGFiZWxcIjogX2dldE5hbWVCeUxhbmcodGFzay5hc3NpZ24uYXNzaWdubWVudC5hY2NlcHQubGFiZWwuaTE4bilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc3NpZ25tZW50LmFjY2VwdCA9IGFjY2VwdDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNzaWdubWVudC5tZXNzYWdlID0gX2dldE5hbWVCeUxhbmcodGFzay5hc3NpZ24uYXNzaWdubWVudC5tZXNzYWdlLmkxOG4pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVqZWN0ID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJzaG93XCI6IHRhc2suYXNzaWduLmFzc2lnbm1lbnQucmVqZWN0LnNob3csXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImxhYmVsXCI6IF9nZXROYW1lQnlMYW5nKHRhc2suYXNzaWduLmFzc2lnbm1lbnQucmVqZWN0LmxhYmVsLmkxOG4pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNzaWdubWVudC5yZWplY3QgPSByZWplY3Q7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwicHJvZmlsZUlkXCI6IHByb2ZpbGVJZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwicm9sZUlkXCI6IHJvbGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInR5cGVcIjogXCJyb2xlXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc3NpZ25tZW50LnZhbHVlID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzc2lnbm1lbnQucHJvZmlsZVJvbGVJZCA9IGlkO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL0ZpcmUgUHJlLXdvcmtBY3Rpb25zIGhlcmVcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcHJvY2Vzc0lkID0gSlNPTi54cGF0aChcIi9pbnN0YW5jZS9wcm9jZXNzZXNbc3ViUHJvY2Vzc2VzL3V1aWQgZXEgJ1wiICsgc3B1dWlkICsgXCInXS9pZFwiLCBfV0ZJbnN0YW5jZSwge30pWzBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3ViUHJvY2Vzc0lkID0gSlNPTi54cGF0aChcIi9pbnN0YW5jZS9wcm9jZXNzZXMvc3ViUHJvY2Vzc2VzW3V1aWQgZXEgJ1wiICsgc3B1dWlkICsgXCInXS9pZFwiLCBfV0ZJbnN0YW5jZSwge30pWzBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3RlcElkID0gSlNPTi54cGF0aChcIi9zdWJwcm9jZXNzZXNbX2lkIGVxICdcIiArIHNwdXVpZCArIFwiJ10vc3RlcC9pZFwiLCBfV0ZJbnN0YW5jZSwge30pWzBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3RlcE9iamVjdCA9IEpTT04ueHBhdGgoXCIvcHJvY2Vzc2VzW19pZCBlcSAnXCIgKyBwcm9jZXNzSWQgKyBcIiddL3N1YlByb2Nlc3Nlc1tfaWQgZXEgJ1wiICsgc3ViUHJvY2Vzc0lkICsgXCInXS9zdGVwc1tfaWQgZXEgJ1wiICsgc3RlcElkICsgXCInXVwiLCBfV0ZJbnN0YW5jZS5jb25maWcsIHt9KVswXTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGFzay5wcmVXb3JrQWN0aW9ucyAhPSB1bmRlZmluZWQpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHByZVdvcmtBY3Rpb25zT2JqID0gdGFzay5wcmVXb3JrQWN0aW9ucztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZVdvcmtBY3Rpb25zKHByZVdvcmtBY3Rpb25zT2JqLCBfV0ZJbnN0YW5jZSkudGhlbihmdW5jdGlvbiAoc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCdBc3NpZ25lZCB0byB0aGUgb25seSB1c2VyIGluIHJvbGUuIFByZSB3b3JrIGFjdGlvbnMgZXhlY3V0ZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCdBc3NpZ25lZCB0byB0aGUgb25seSB1c2VyIGluIHJvbGUuIE5vIHByZSB3b3JrIGFjdGlvbnMgZm91bmQuJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhc3NpZ25lZSA9IG1vZGVsLmFzc2lnbmVkVG87XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNzaWduZWUubmFtZSA9IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNzaWduZWUudXNlcklkID0gXCJcIjtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhc3NpZ25tZW50ID0gJyc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhc2suYXNzaWduLmFzc2lnbm1lbnQgIT0gdW5kZWZpbmVkKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFzc2lnbm1lbnQgPSBtb2RlbC5hc3NpZ25tZW50O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYWNjZXB0ID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJzaG93XCI6IHRhc2suYXNzaWduLmFzc2lnbm1lbnQuYWNjZXB0LnNob3csXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImxhYmVsXCI6IF9nZXROYW1lQnlMYW5nKHRhc2suYXNzaWduLmFzc2lnbm1lbnQuYWNjZXB0LmxhYmVsLmkxOG4pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNzaWdubWVudC5hY2NlcHQgPSBhY2NlcHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzc2lnbm1lbnQubWVzc2FnZSA9IF9nZXROYW1lQnlMYW5nKHRhc2suYXNzaWduLmFzc2lnbm1lbnQubWVzc2FnZS5pMThuKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlamVjdCA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic2hvd1wiOiB0YXNrLmFzc2lnbi5hc3NpZ25tZW50LnJlamVjdC5zaG93LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJsYWJlbFwiOiBfZ2V0TmFtZUJ5TGFuZyh0YXNrLmFzc2lnbi5hc3NpZ25tZW50LnJlamVjdC5sYWJlbC5pMThuKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzc2lnbm1lbnQucmVqZWN0ID0gcmVqZWN0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInByb2ZpbGVJZFwiOiBwcm9maWxlSWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInJvbGVJZFwiOiByb2xlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ0eXBlXCI6IFwicm9sZVwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNzaWdubWVudC52YWx1ZSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc3NpZ25tZW50LnByb2ZpbGVSb2xlSWQgPSBpZDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1dpbGwgYmUgZmlyZWQgZnJvbSBUYWtlQXNzaWdubWVudCBwYXRoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShcIk5vIHVzZXJzIGZvdW5kIGluIGxpc3QuIEFzc2lnbmluZyBibGFuayBcIik7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0Vycm9yIGluIGdldFVzZXJzTGlzdEJ5Um9sZSB1bmRlZmluZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdFcnJvciBpbiBnZXRVc2Vyc0xpc3RCeVJvbGUnKTtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRhc2suYXNzaWduLnN3aW1sYW5lICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHJlc29sdmUoJ3N3aW1sYW5lJyk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1N3aW1sYW5lIGltcGxlbWVudGF0aW9uICEhJyk7XG4gICAgICAgICAgICB9XG5cblxuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG5cbiAgICAgICAgICAgIHJlamVjdChlcnIpO1xuXG4gICAgICAgIH0pO1xuXG5cblxuXG4gICAgfSk7XG5cbn07XG5cbi8qKlxuICogUHJvY2VzcyB0cmFuc2l0aW9uXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHByb2Nlc3NJZCAtIHRoZSBXb3JrZmxvdyBjb25maWcgLyBkZWZpbml0aW9uIHByb2Nlc3MgaWRcbiAqIEBwYXJhbSB7bnVtYmVyfSBwcm9jZXNzU2VxIC0gdGhlIFdvcmtmbG93IGluc3RhbmNlIHByb2Nlc3Mgc2VxXG4gKiBAcGFyYW0ge3N0cmluZ30gc3ViUHJvY2Vzc0lkIC0gdGhlIFdvcmtmbG93IGNvbmZpZyAvIGRlZmluaXRpb24gc3ViLXByb2Nlc3MgaWRcbiAqIEBwYXJhbSB7bnVtYmVyfSBzdWJQcm9jZXNzU2VxIC0gdGhlIFdvcmtmbG93IGluc3RhbmNlIHN1Yi1wcm9jZXNzIHNlcVxuICogQHBhcmFtIHtzdHJpbmd9IHN0ZXBJZCAtIHRoZSBXb3JrZmxvdyBjb25maWcgLyBkZWZpbml0aW9uIHN0ZXAgaWRcbiAqIEBwYXJhbSB7c3RyaW5nfSB0cmFuc2l0aW9uSWQgLSB0aGUgV29ya2Zsb3cgY29uZmlnIC8gZGVmaW5pdGlvbiB0cmFuc2l0aW9uIGlkXG4gKiBAcGFyYW0ge29iamVjdH0gZGF0YSAtIGFueSBhZGRpdGlvbmFsIGRhdGEgcGFzc2VkIGluIGFzIGtleSB2YWx1ZSBwYWlyc1xuICogQHBhcmFtIHtvYmplY3R9IF9XRkluc3RhbmNlIC0gdGhlIGN1cnJlbnQgd29ya2Zsb3cgY29uc3RydWN0b3IgaW5zdGFuY2VcbiAqXG4gKiBAZXhhbXBsZSAnJ1xuICpcbiAqIEByZXR1cm4gJydcbiAqXG4gKi9cbmZ1bmN0aW9uIHRyYW5zaXRpb24ocHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIHN0ZXBJZCwgdHJhbnNpdGlvbklkLCBkYXRhLCBfV0ZJbnN0YW5jZSwgc3B1dWlkLCBtb2RlbCkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICB2YXIgc3RlcFNlcSA9IDA7XG4gICAgICAgICAgICB2YXIgbmV4dFN0ZXBJZCA9ICcnO1xuICAgICAgICAgICAgdmFyIG5leHRTdGVwU2VxID0gMDtcbiAgICAgICAgICAgIHZhciBzdWJQcm9jZXNzID0gW107XG4gICAgICAgICAgICB2YXIgY3VycmVudFByb2Nlc3MgPSBfV0ZJbnN0YW5jZS5jb25maWcucHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbiAob2JqUHJvY2Vzcykge1xuICAgICAgICAgICAgICAgIGlmIChvYmpQcm9jZXNzLl9pZCA9PSBwcm9jZXNzSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9ialByb2Nlc3M7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHZhciBjdXJyZW50U3ViUHJvY2VzcyA9IGN1cnJlbnRQcm9jZXNzWzBdLnN1YlByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24gKG9ialN1YlByb2Nlc3MpIHtcbiAgICAgICAgICAgICAgICBpZiAob2JqU3ViUHJvY2Vzcy5faWQgPT0gc3ViUHJvY2Vzc0lkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvYmpTdWJQcm9jZXNzO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2YXIgY3VycmVudFN0ZXAgPSBjdXJyZW50U3ViUHJvY2Vzc1swXS5zdGVwcy5maWx0ZXIoZnVuY3Rpb24gKG9ialN0ZXApIHtcbiAgICAgICAgICAgICAgICBpZiAob2JqU3RlcC5faWQgPT0gc3RlcElkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvYmpTdGVwO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2YXIgdHJhbnNpdGlvbiA9IGN1cnJlbnRTdGVwWzBdLnRyYW5zaXRpb24uZmlsdGVyKGZ1bmN0aW9uIChvYmpUcmFuc2l0aW9uKSB7XG4gICAgICAgICAgICAgICAgaWYgKG9ialRyYW5zaXRpb24uX2lkID09IHRyYW5zaXRpb25JZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqVHJhbnNpdGlvbjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjdXJyZW50U3ViUHJvY2Vzc1swXS5zdGVwcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50U3ViUHJvY2Vzc1swXS5zdGVwc1tpXS5faWQgPT0gc3RlcElkKSB7XG4gICAgICAgICAgICAgICAgICAgIHN0ZXBTZXEgPSBwYXJzZUludChjdXJyZW50U3ViUHJvY2Vzc1swXS5zdGVwc1tpXS5fc2VxKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY3VycmVudFN1YlByb2Nlc3NbMF0uc3RlcHMuZmlsdGVyKGZ1bmN0aW9uIChzdGVwSXRlbSkge1xuICAgICAgICAgICAgICAgIG5leHRTdGVwU2VxID0gc3RlcFNlcSArIDE7XG4gICAgICAgICAgICAgICAgaWYgKHBhcnNlSW50KHN0ZXBJdGVtLl9zZXEpID09IG5leHRTdGVwU2VxKSB7XG4gICAgICAgICAgICAgICAgICAgIG5leHRTdGVwSWQgPSBzdGVwSXRlbS5faWQ7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgX1dGSW5zdGFuY2UuaW5zdGFuY2UucHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbiAob2JqUHJvY2Vzcykge1xuICAgICAgICAgICAgICAgIGlmIChvYmpQcm9jZXNzLmlkID09IHByb2Nlc3NJZCAmJiBvYmpQcm9jZXNzLnNlcSA9PSBwcm9jZXNzU2VxKSB7XG4gICAgICAgICAgICAgICAgICAgIG9ialByb2Nlc3Muc3ViUHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbiAob2JqU3ViUHJvY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9ialN1YlByb2Nlc3MuaWQgPT0gc3ViUHJvY2Vzc0lkICYmIG9ialN1YlByb2Nlc3Muc2VxID09IHN1YlByb2Nlc3NTZXEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdXVpZCA9IG9ialN1YlByb2Nlc3MudXVpZDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcHV1aWQgPSB1dWlkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9XRkluc3RhbmNlLnN1YnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24gKHN1YlByb2Nlc3NJdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdWJQcm9jZXNzSXRlbS5faWQgPT0gdXVpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ViUHJvY2VzcyA9IHN1YlByb2Nlc3NJdGVtO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHZhciBtYXhTdGVwcyA9IGN1cnJlbnRTdWJQcm9jZXNzWzBdLnN0ZXBzLmxlbmd0aDtcblxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHZhciBzcGluc3RhbmNlT2JqZWN0ID0gSlNPTi54cGF0aChcIi9zdWJwcm9jZXNzZXNbX2lkIGVxICdcIisgc3B1dWlkICtcIiddXCIsIF9XRkluc3RhbmNlLCB7fSlbMF07XG4gICAgICAgICAgICAgICAgdmFyIHNwSW5zdGFuY2VTdGVwT2JqZWN0ID0gSlNPTi54cGF0aChcIi9zdWJwcm9jZXNzZXNbX2lkIGVxICdcIisgc3B1dWlkICtcIiddL3N0ZXBcIiwgX1dGSW5zdGFuY2UsIHt9KVswXTtcblxuICAgICAgICAgICAgICAgIC8vIEFkZGluZyBzdGVwIE9iamVjdCBpbiBzdWJwcm9jZXNzIGhpc3RvcnkgRnJvbSBzZWNvbmQgc3RlcC4gQXMgZmlyc3Qgc3RlcCBpcyBhZGRlZCBhdCBzdWJQcm9jZXNzKCkgZnVuY3Rpb24gXG5cbiAgICAgICAgICAgICAgICBpZihtb2RlbCAhPSB1bmRlZmluZWQgJiYgT2JqZWN0LmtleXMobW9kZWwpLmxlbmd0aCA+IDApe1xuICAgICAgICAgICAgICAgICAgICBzcGluc3RhbmNlT2JqZWN0Lmhpc3RvcnkucHVzaChtb2RlbCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc3BpbnN0YW5jZU9iamVjdC5oaXN0b3J5LnB1c2goc3BJbnN0YW5jZVN0ZXBPYmplY3QpO1xuICAgICAgICAgICAgICAgIH1cblxuXG4gICAgICAgICAgICAgICAgLy9zcGluc3RhbmNlT2JqZWN0Lmhpc3RvcnkucHVzaChtb2RlbCk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgaWYgKHRyYW5zaXRpb25bMF0udHJhbnNpdGlvbkFjdGlvbi5nb1RvU3RlcCAhPSB1bmRlZmluZWQpIHtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgbmV4dFNlcSA9IHBhcnNlSW50KGN1cnJlbnRTdGVwWzBdLl9zZXEpICsgcGFyc2VJbnQodHJhbnNpdGlvblswXS50cmFuc2l0aW9uQWN0aW9uLmdvVG9TdGVwLmRlZmF1bHQpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgbmV4dElkID0gJyc7XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTdWJQcm9jZXNzWzBdLnN0ZXBzLmZpbHRlcihmdW5jdGlvbiAoc3RlcEl0ZW0pIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlSW50KHN0ZXBJdGVtLl9zZXEpID09IG5leHRTdGVwU2VxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dElkID0gc3RlcEl0ZW0uX2lkO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIHN0ZXAocHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIG5leHRJZCwgbmV4dFNlcSwgZGF0YSwgX1dGSW5zdGFuY2UsIHNwdXVpZCkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobmV4dFNlcSA9PSBtYXhTdGVwcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdBbGwgU3RlcCB0cmFuc2l0aW9ucyBoYXZlIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkuJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJQcm9jZXNzQ29tcGxldGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ZXA6IHJlc3VsdC5kYXRhXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnU3RlcCB0cmFuc2l0aW9uIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkuJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJQcm9jZXNzQ29tcGxldGU6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGVwOiByZXN1bHQuZGF0YVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRyYW5zaXRpb25bMF0udHJhbnNpdGlvbkFjdGlvbi5nb1RvU3RlcElkICE9IHVuZGVmaW5lZCkge1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBnb1RvU3RlcElkID0gdHJhbnNpdGlvblswXS50cmFuc2l0aW9uQWN0aW9uLmdvVG9TdGVwSWQuc3RlcElkO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZ29Ub1N0ZXBTZXEgPSAxO1xuXG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTdWJQcm9jZXNzWzBdLnN0ZXBzLmZpbHRlcihmdW5jdGlvbiAoc3RlcEl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGVwSXRlbS5faWQgPT0gZ29Ub1N0ZXBJZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdvVG9TdGVwU2VxID0gcGFyc2VJbnQoc3RlcEl0ZW0uX3NlcSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgc3RlcChwcm9jZXNzSWQsIHByb2Nlc3NTZXEsIHN1YlByb2Nlc3NJZCwgc3ViUHJvY2Vzc1NlcSwgZ29Ub1N0ZXBJZCwgZ29Ub1N0ZXBTZXEsIGRhdGEsIF9XRkluc3RhbmNlLCBzcHV1aWQpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGdvVG9TdGVwU2VxID09IG1heFN0ZXBzKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnQWxsIFN0ZXAgdHJhbnNpdGlvbnMgaGF2ZSBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5LicsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ViUHJvY2Vzc0NvbXBsZXRlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGVwOiByZXN1bHQuZGF0YVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnU3RlcCB0cmFuc2l0aW9uIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkuJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJQcm9jZXNzQ29tcGxldGU6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGVwOiByZXN1bHQuZGF0YVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0cmFuc2l0aW9uWzBdLnRyYW5zaXRpb25BY3Rpb24uc3RvcCAhPSB1bmRlZmluZWQpIHtcblxuICAgICAgICAgICAgICAgICAgICAvLyBBcyB0aGlzIGlzIHRoZSBsYXN0IHN0ZXAgKHdoZXJlIHN0b3AgaXMgZGVmaWVkKSAsIHN1YlByb2Nlc3MgcG9zdEFjdGlvbnMgc2hvdWxkIGNvbWUgaGVyZS5cblxuICAgICAgICAgICAgICAgICAgICB2YXIgcG9zdEFjdGlvbnNDb25mID0gY3VycmVudFByb2Nlc3NbMF0ucG9zdEFjdGlvbnM7XG4gICAgICAgICAgICAgICAgICAgIHBvc3RBY3Rpb25zKHBvc3RBY3Rpb25zQ29uZiwgX1dGSW5zdGFuY2UpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnU3RlcCB0cmFuc2l0aW9uIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkuV29ya2Zsb3cgc3RvcHBlZC4nLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ViUHJvY2Vzc0NvbXBsZXRlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ZXA6IG1vZGVsXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XG5cbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgIH1cblxuICAgIH0pO1xufTtcblxuLyoqXG4gKiBQcm9jZXNzIHBvc3RBY3Rpb25zXG4gKlxuICogQHBhcmFtIHtvYmplY3R9IHBvc3RBY3Rpb25zIC0gdGhlIHBvc3RBY3Rpb25zIGNvbmZpZyBkYXRhXG4gKlxuICogQGV4YW1wbGUgJydcbiAqXG4gKiBAcmV0dXJuICcnXG4gKlxuICovXG5mdW5jdGlvbiBwb3N0QWN0aW9ucyhwb3N0QWN0aW9ucywgX1dGSW5zdGFuY2UpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICB2YXIgY29tcGxldGVkID0gW107XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICB1dGlsLnN5bmNMb29wKHBvc3RBY3Rpb25zLmxlbmd0aCwgZnVuY3Rpb24gKGxvb3ApIHtcbiAgICAgICAgICAgICAgICB2YXIgY291bnRlciA9IGxvb3AuaXRlcmF0aW9uKCk7XG4gICAgICAgICAgICAgICAgYWN0aW9uKHBvc3RBY3Rpb25zW2NvdW50ZXJdLCBfV0ZJbnN0YW5jZSkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBDaGVjayBpZiBhbGwgcHJlLXJlcXVpc2l0ZXMgY29tcGxldGVkIHN1Y2Nlc3NmdWxseS5cbiAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkLnB1c2godHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIGxvb3AubmV4dCgpO1xuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkLnB1c2goZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICBsb29wLmJyZWFrKCk7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmIChjb21wbGV0ZWQuZXZlcnkoQm9vbGVhbikpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ1Bvc3QtYWN0aW9ucyBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5LicsIHt9KTtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3IgPSB1dGlsLmVycm9yKCdXRlByZUFjdGlvbnNFcnJvcicsICdOb3QgYWxsIHBvc3QtYWN0aW9ucyBwYXNzZWQuJyk7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgfVxuXG4gICAgfSk7XG59O1xuXG4vKlxuZnVuY3Rpb24gc2VuZE5vdGlmaWNhdGlvbnModXNlcnNMaXN0LCBzcHV1aWQpe1xuXG4gIC8vIGdldCB1c2VycyBsaXN0IFxuICAvLyBzZW4gbm90aWZpY2F0aW9ucyB0byB1c2VycyB5IGFkZGluZyBjaGFubmVscyB0byB0aGVtXG5cbiAgdmFyIGNoYW5uZWxBcnJheSA9IFtdO1xuXG4gIGZvcihpPTA7aTx1c2Vyc0xpc3QubGVuZ3RoOyBpKyspe1xuICAgIGNoYW5uZWxBcnJheS5wdXNoKFwidXNlcl9cIit1c2Vyc0xpc3RbaV0uaWQpO1xuICB9XG5cbiAgYXNzaWduVG9Vc2Vycyhwcm9jZXNzV29ya2Zsb3dNZXNzYWdlKE5PVElGSUNBVElPTl9VU0VSX01TR19BQ0NFUFQsIHNwdXVpZCksIGNoYW5uZWxBcnJheSk7XG5cbn07Ki9cblxuLypmdW5jdGlvbiBhc3NpZ25Ub1VzZXJzKG1lc3NhZ2UsIGNoYW5uZWxBcnJheSl7XG5cbiAgICAgdmFyIGNoYW5uZWxzID0gY2hhbm5lbEFycmF5O1xuXG4gICAgIHZhciBub3RpZmljYXRpb24gPSAgeyBcbiAgICAgICAgICBcIl9pZFwiOiBnZW5lcmF0ZVVVSUQoKSxcbiAgICAgICAgICBcImNoYW5uZWxzXCI6Y2hhbm5lbHMsXG4gICAgICAgICAgXCJtZXNzYWdlXCI6IG1lc3NhZ2UsXG4gICAgICAgICAgXCJtZXNzYWdlVHlwZVwiOiBcImluZm9cIixcbiAgICAgICAgICBcImNyZWF0ZWREYXRlVGltZVwiOiBtb21lbnQoKS5mb3JtYXQoKSxcbiAgICAgICAgICBcInJlYWRcIjogZmFsc2UsXG4gICAgICAgICAgXCJyZWFkRGF0ZVRpbWVcIjogXCJcIixcbiAgICAgICAgICBcInR5cGVcIjogXCJub3RpZmljYXRpb25cIixcbiAgICAgICAgICBcInNlbmRlclVzZXJJZFwiOiBMT0NBTF9TRVRUSU5HUy5TVUJTQ1JJUFRJT05TLnVzZXJJZFxuICAgICAgIH07XG5cbiAgICAgICBjb25zb2xlLmxvZyhub3RpZmljYXRpb24pO1xuICAgICAgIGRhby51cHNlcnQobm90aWZpY2F0aW9uKTtcblxuICB9OyovXG5cbmZ1bmN0aW9uIHByb2Nlc3NXb3JrZmxvd01lc3NhZ2UobWVzc2FnZSwgc3B1dWlkKSB7XG5cbiAgICB2YXIgcmVwbGFjZWRNc2cgPSBtZXNzYWdlO1xuXG4gICAgaWYgKHJlcGxhY2VkTXNnLmluZGV4T2YoJyNJTlNUQU5DRV9MQUJFTCcpICE9PSAtMSkge1xuICAgICAgICB2YXIgdmFsID0gSlNPTi54cGF0aChcIi9pbnN0YW5jZS9wcm9jZXNzZXMvc3ViUHJvY2Vzc2VzW3V1aWQgZXEgJ1wiICsgc3B1dWlkICsgXCInXS9sYWJlbFwiLCBhcHAuU0NPUEUud29ya2Zsb3csIHt9KVswXTtcbiAgICAgICAgcmVwbGFjZWRNc2cgPSByZXBsYWNlZE1zZy5yZXBsYWNlKCcjSU5TVEFOQ0VfTEFCRUwnLCB2YWwpO1xuXG4gICAgfVxuXG4gICAgaWYgKHJlcGxhY2VkTXNnLmluZGV4T2YoJyNVU0VSX05BTUUnKSAhPT0gLTEpIHtcbiAgICAgICAgdmFyIHZhbCA9IEpTT04ueHBhdGgoXCIvc3VicHJvY2Vzc2VzW19pZCBlcSAnXCIgKyBzcHV1aWQgKyBcIiddL3N0ZXAvYXNzaWduZWRUby9uYW1lXCIsIGFwcC5TQ09QRS53b3JrZmxvdywge30pWzBdO1xuICAgICAgICByZXBsYWNlZE1zZyA9IHJlcGxhY2VkTXNnLnJlcGxhY2UoJyNVU0VSX05BTUUnLCB2YWwpO1xuXG4gICAgfVxuXG4gICAgaWYgKHJlcGxhY2VkTXNnLmluZGV4T2YoJyNQUk9GSUxFX1RJVExFJykgIT09IC0xKSB7XG4gICAgICAgIHZhciB2YWwgPSBhcHAucHJvZmlsZS50aXRsZTtcbiAgICAgICAgcmVwbGFjZWRNc2cgPSByZXBsYWNlZE1zZy5yZXBsYWNlKCcjUFJPRklMRV9USVRMRScsIHZhbCk7XG5cbiAgICB9XG5cbiAgICBpZiAocmVwbGFjZWRNc2cuaW5kZXhPZignI1BST0ZJTEVfVFlQRScpICE9PSAtMSkge1xuICAgICAgICB2YXIgdmFsID0gYXBwLlNDT1BFLkFQUF9DT05GSUcubmFtZTtcbiAgICAgICAgcmVwbGFjZWRNc2cgPSByZXBsYWNlZE1zZy5yZXBsYWNlKCcjUFJPRklMRV9UWVBFJywgdmFsKTtcblxuICAgIH1cblxuICAgIGlmIChyZXBsYWNlZE1zZy5pbmRleE9mKCcjVkFSX1NQVVVJRCcpICE9PSAtMSkge1xuICAgICAgICB2YXIgdmFsID0gc3B1dWlkO1xuICAgICAgICByZXBsYWNlZE1zZyA9IHJlcGxhY2VkTXNnLnJlcGxhY2UoJyNWQVJfU1BVVUlEJywgdmFsKTtcblxuICAgIH1cblxuICAgIHJldHVybiByZXBsYWNlZE1zZztcbn07XG5cbmZ1bmN0aW9uIF9nZXROYW1lKGFyciwgbGFuZykge1xuICAgIGlmIChhcnIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKGFycltpXS5fbGFuZyA9PT0gbGFuZykge1xuICAgICAgICAgICAgICAgIHJldHVybiBhcnJbaV0udmFsdWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfVxuXG4gICAgfVxuXG59O1xuXG5mdW5jdGlvbiBfZ2V0TmFtZUJ5TGFuZyhvYmopIHtcbiAgICB2YXIgbGFuZyA9IHNlcnZpY2UuZ2V0TGFuZ3VhZ2UoKTtcbiAgICB2YXIgZXhwciA9ICdvYmouJyArIGxhbmc7XG4gICAgcmV0dXJuIGV2YWwoZXhwcik7XG59O1xuXG5cblxuXG5cbi8qKlxuICogUHJvY2VzcyBwcmVXb3JrQWN0aW9uc1xuICpcbiAqIEBwYXJhbSB7b2JqZWN0fSBwcmVXb3JrQWN0aW9ucyAtIHRoZSBwcmVXb3JrQWN0aW9ucyBjb25maWcgZGF0YVxuICpcbiAqIEBleGFtcGxlICcnXG4gKlxuICogQHJldHVybiAnJ1xuICpcbiAqL1xuXG5mdW5jdGlvbiBwcmVXb3JrQWN0aW9ucyhwcmVXb3JrQWN0aW9ucywgX1dGSW5zdGFuY2UpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICB2YXIgY29tcGxldGVkID0gW107XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICB1dGlsLnN5bmNMb29wKHByZVdvcmtBY3Rpb25zLmxlbmd0aCwgZnVuY3Rpb24gKGxvb3ApIHtcbiAgICAgICAgICAgICAgICB2YXIgY291bnRlciA9IGxvb3AuaXRlcmF0aW9uKCk7XG4gICAgICAgICAgICAgICAgYWN0aW9uKHByZVdvcmtBY3Rpb25zW2NvdW50ZXJdLCBfV0ZJbnN0YW5jZSkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBDaGVjayBpZiBhbGwgcHJlLXJlcXVpc2l0ZXMgY29tcGxldGVkIHN1Y2Nlc3NmdWxseS5cbiAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkLnB1c2godHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIGxvb3AubmV4dCgpO1xuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkLnB1c2goZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICBsb29wLmJyZWFrKCk7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmIChjb21wbGV0ZWQuZXZlcnkoQm9vbGVhbikpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ1ByZVdvcmstYWN0aW9ucyBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5LicsIHt9KTtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3IgPSB1dGlsLmVycm9yKCdXRlByZUFjdGlvbnNFcnJvcicsICdOb3QgYWxsIHByZS13b3JrLWFjdGlvbnMgcGFzc2VkLicpO1xuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgIH1cblxuICAgIH0pO1xufTtcblxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcblxuICAgIHByZVJlcXVpc2l0ZXM6IHByZVJlcXVpc2l0ZXMsXG4gICAgcHJlQWN0aW9uczogcHJlQWN0aW9ucyxcbiAgICBwb3N0QWN0aW9uczogcG9zdEFjdGlvbnMsXG4gICAgcHJlV29ya0FjdGlvbnM6IHByZVdvcmtBY3Rpb25zLFxuICAgIHN1YlByb2Nlc3M6IHN1YlByb2Nlc3MsXG4gICAgaW5kaWNhdG9yRG9jczogaW5kaWNhdG9yRG9jcyxcbiAgICB0YXNrOiB0YXNrLFxuICAgIHRyYW5zaXRpb246IHRyYW5zaXRpb24sXG4gICAgYXNzaWduVXNlcjogYXNzaWduVXNlclxuXG59IiwiJ3VzZSBzdHJpY3QnO1xuXG4vKipcbiAqIFV0aWxpdHkgTW9kdWxlXG4gKlxuICogQG1vZHVsZSBsaWIvdXRpbFxuICpcbiAqIEBhdXRob3IgQnJlbnQgR29yZG9uXG4gKiBAdmVyc2lvbiAwLjEuMFxuICpcbiAqIEBkZXNjcmlwdGlvblxuICogV29ya2Zsb3cgdXRpbGl0eSBtb2R1bGUgdXNlZCB0byBmb3JtYXQgdGhlIHJldHVybiBhbmQgZXJyb3Igb2JqZWN0cywgYW5kXG4gKiBjb250YWlucyBzb21lIG90aGVyIHV0aWxpdHkgZnVuY3Rpb25zIHN1Y2ggYXMgYSBzeW5jIGxvb3AgYW5kIGNvbXBhcmUuXG4gKlxuICovXG5cbi8qKlxuICogU3VjY2VzcyBibG9jayByZXR1cm4gb2JqZWN0LCBjb250YWlucyBhIG1lc3NhZ2UgYW5kIG9wdGlvbmFsIGRhdGEgb2JqZWN0LlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBtZXNzYWdlIC0gdGhlIHN1Y2Nlc3MgbWVzc2FnZVxuICogQHBhcmFtIHtzdHJpbmd8T2JqZWN0fSBbZGF0YV0gLSB0aGUgc3VjY2VzcyByZXR1cm5lZCBkYXRhXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIFJldHVybiBzdWNjZXNzIHdpdGhvdXQgYSBkYXRhIGJsb2NrXG4gKiB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnU3VjY2VzcyBtZXNzYWdlIGdvZXMgaGVyZS4uLicpO1xuICpcbiAqIEByZXR1cm4ge09iamVjdH0gLSB3aXRoIG1lc3NhZ2UgYW5kIGRhdGEgcHJvcGVydGllc1xuICpcbiAqL1xuZnVuY3Rpb24gc3VjY2VzcyhtZXNzYWdlLCBkYXRhKXtcblx0cmV0dXJuIHtcblx0XHRtZXNzYWdlOiBtZXNzYWdlLFxuXHRcdGRhdGE6IGRhdGFcblx0fTtcbn07XG5cbi8qKlxuICogV2FybmluZyBibG9jayByZXR1cm4gb2JqZWN0LCBjb250YWlucyBhIG1lc3NhZ2UgYW5kIG9wdGlvbmFsIGRhdGEgb2JqZWN0LlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBtZXNzYWdlIC0gdGhlIHdhcm5pbmcgbWVzc2FnZVxuICogQHBhcmFtIHtzdHJpbmd8T2JqZWN0fSBbZGF0YV0gLSB0aGUgcmV0dXJuZWQgZGF0YVxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyBSZXR1cm4gc3VjY2VzcyB3aXRob3V0IGEgZGF0YSBibG9ja1xuICogdmFyIHN1Y2Nlc3MgPSB1dGlsLndhcm4oJ1dhcm5pbmcgbWVzc2FnZSBnb2VzIGhlcmUuLi4nKTtcbiAqXG4gKiBAcmV0dXJuIHtPYmplY3R9IHdpdGggbWVzc2FnZSBhbmQgZGF0YSBwcm9wZXJ0aWVzLCBhbmQgbG9ncyB0aGUgd2FybmluZyB0byB0aGUgY29uc29sZS5cbiAqXG4gKi9cbmZ1bmN0aW9uIHdhcm4obWVzc2FnZSwgZGF0YSl7XG5cdGNvbnNvbGUud2FybihkYXRhKTtcblx0cmV0dXJuIHtcblx0XHR3YXJuaW5nOiBtZXNzYWdlLFxuXHRcdGRhdGE6IGRhdGFcblx0fTtcbn07XG5cbi8qKlxuICogRXJyb3IgYmxvY2sgSlMgZXJyb3Igb2JqZWN0LCBjb250YWlucyBhIGNvZGUgYW5kIG1lc3NhZ2UgZm9yIHRoZSBlcnJvci5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gY29kZSAtIHRoZSBlcnJvciBjb2RlXG4gKiBAcGFyYW0ge3N0cmluZ30gbWVzc2FnZSAtIHRoZSBlcnJvciBtZXNzYWdlXG4gKlxuICogQGV4YW1wbGVcbiAqIHZhciBzdWNjZXNzID0gdXRpbC5lcnJvcignRXJyb3IwMDEnLCdFcnJvciBtZXNzYWdlIGdvZXMgaGVyZS4uLicpO1xuICpcbiAqIEByZXR1cm4ge09iamVjdH0gd2l0aCBhIGNvZGUgYW5kIG1lc3NhZ2UgcHJvcGVydGllcy5cbiAqXG4gKi9cbmZ1bmN0aW9uIGVycm9yKGNvZGUsIG1lc3NhZ2Upe1xuXHR2YXIgZXJyID0gbmV3IEVycm9yKCcnKTtcblx0ZXJyLm5hbWUgPSBjb2RlO1xuXHRlcnIubWVzc2FnZSA9IG1lc3NhZ2U7XG5cdHJldHVybiBlcnI7XG59O1xuXG4vKipcbiAqIEEgbG9vcCB3aGljaCBjYW4gbG9vcCBYIGFtb3VudCBvZiB0aW1lcywgd2hpY2ggY2FycmllcyBvdXRcbiAqIGFzeW5jaHJvbm91cyBjb2RlLCBidXQgd2FpdHMgZm9yIHRoYXQgY29kZSB0byBjb21wbGV0ZSBiZWZvcmUgbG9vcGluZy5cbiAqXG4gKiBAcGFyYW0ge251bWJlcn0gaXRlcmF0aW9ucyAtIHRoZSBudW1iZXIgb2YgaXRlcmF0aW9ucyB0byBjYXJyeSBvdXRcbiAqIEBwYXJhbSB7ZnVuY3Rpb259IHByb2Nlc3MgLSB0aGUgY29kZS9mdW5jdGlvbiB3ZSdyZSBydW5uaW5nIGZvciBldmVyeVxuICogaXRlcmF0aW9uXG4gKiBAcGFyYW0ge2Z1bmN0aW9ufSBleGl0IC0gYW4gb3B0aW9uYWwgY2FsbGJhY2sgdG8gY2Fycnkgb3V0IG9uY2UgdGhlIGxvb3BcbiAqIGhhcyBjb21wbGV0ZWRcbiAqXG4gKiBAZXhhbXBsZVxuICogdXRpbC5zeW5jTG9vcCg1LCBmdW5jdGlvbihsb29wKXtcbiAqIFx0dmFyIGNvdW50ZXIgPSBsb29wLml0ZXJhdGlvbigpO1xuICogXHQvLyBBZGQgYXN5bmMgY2FsbHMgaGVyZS4uXG4gKlxuICogfSwgZnVuY3Rpb24oKXtcbiAqIFx0Ly8gT24gY29tcGxldGUgcGVyZm9ybSBhY3Rpb25zIGhlcmUuLi5cbiAqXG4gKiB9KTtcbiAqXG4gKiBAcmV0dXJuIHtPYmplY3R9IHRoZSBsb29wIGNvbnRyb2wgb2JqZWN0LlxuICpcbiAqL1xuZnVuY3Rpb24gc3luY0xvb3AoaXRlcmF0aW9ucywgcHJvY2VzcywgZXhpdCl7XG4gICAgdmFyIGluZGV4ID0gMCxcbiAgICAgICAgZG9uZSA9IGZhbHNlLFxuICAgICAgICBzaG91bGRFeGl0ID0gZmFsc2U7XG4gICAgdmFyIGxvb3AgPSB7XG4gICAgICAgIG5leHQ6ZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIGlmKGRvbmUpe1xuICAgICAgICAgICAgICAgIGlmKHNob3VsZEV4aXQgJiYgZXhpdCl7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBleGl0KCk7IC8vIEV4aXQgaWYgd2UncmUgZG9uZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIElmIHdlJ3JlIG5vdCBmaW5pc2hlZFxuICAgICAgICAgICAgaWYoaW5kZXggPCBpdGVyYXRpb25zKXtcbiAgICAgICAgICAgICAgICBpbmRleCsrOyAvLyBJbmNyZW1lbnQgb3VyIGluZGV4XG4gICAgICAgICAgICAgICAgcHJvY2Vzcyhsb29wKTsgLy8gUnVuIG91ciBwcm9jZXNzLCBwYXNzIGluIHRoZSBsb29wXG4gICAgICAgICAgICAvLyBPdGhlcndpc2Ugd2UncmUgZG9uZVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBkb25lID0gdHJ1ZTsgLy8gTWFrZSBzdXJlIHdlIHNheSB3ZSdyZSBkb25lXG4gICAgICAgICAgICAgICAgaWYoZXhpdCkgZXhpdCgpOyAvLyBDYWxsIHRoZSBjYWxsYmFjayBvbiBleGl0XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGl0ZXJhdGlvbjpmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIGluZGV4IC0gMTsgLy8gUmV0dXJuIHRoZSBsb29wIG51bWJlciB3ZSdyZSBvblxuICAgICAgICB9LFxuICAgICAgICBicmVhazpmdW5jdGlvbihlbmQpe1xuICAgICAgICAgICAgZG9uZSA9IHRydWU7IC8vIEVuZCB0aGUgbG9vcFxuICAgICAgICAgICAgc2hvdWxkRXhpdCA9IGVuZDsgLy8gUGFzc2luZyBlbmQgYXMgdHJ1ZSBtZWFucyB3ZSBzdGlsbCBjYWxsIHRoZSBleGl0IGNhbGxiYWNrXG4gICAgICAgIH1cbiAgICB9O1xuICAgIGxvb3AubmV4dCgpO1xuICAgIHJldHVybiBsb29wO1xufTtcblxuZnVuY3Rpb24gY29tcGFyZShzdWJqZWN0LCBvcGVyYXRvciwgdmFsdWUpIHtcbiAgXHRzd2l0Y2ggKG9wZXJhdG9yKSB7XG4gIFx0XHRjYXNlICdncmVhdGVyVGhhbic6XG5cdFx0XHRyZXR1cm4gc3ViamVjdCA+IHZhbHVlO1xuXHRcdGNhc2UgJ2xlc3NUaGFuJzpcblx0XHRcdHJldHVybiBzdWJqZWN0IDwgdmFsdWU7XG5cdFx0Y2FzZSAnZ3JlYXRlclRoYW5FcXVhbCc6XG5cdFx0XHRyZXR1cm4gc3ViamVjdCA+PSB2YWx1ZTtcblx0XHRjYXNlICdsZXNzVGhhbkVxdWFsJzpcblx0XHRcdHJldHVybiBzdWJqZWN0IDw9IHZhbHVlO1xuXHRcdGNhc2UgJ2VxdWFsVG8nOlxuXHRcdFx0cmV0dXJuIHN1YmplY3QgPT09IHZhbHVlO1xuXHRcdGNhc2UgJ25vdEVxdWFsVG8nOlxuXHRcdFx0cmV0dXJuIHN1YmplY3QgIT09IHZhbHVlO1xuICBcdH1cbn07XG5cbmZ1bmN0aW9uIGdldE5hbWUoYXJyLCBsYW5nKXtcblx0aWYgKGFyciAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBhcnIubGVuZ3RoIDsgaSsrKSB7XG5cdFx0XHRpZiAoYXJyW2ldLmkxOG4uX2xhbmcgPT09IGxhbmcpIHtcblx0XHRcdFx0cmV0dXJuIGFycltpXS5pMThuLnZhbHVlO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcblxuIFx0c3VjY2Vzczogc3VjY2VzcyxcbiBcdHdhcm46IHdhcm4sXG4gXHRlcnJvcjogZXJyb3IsXG4gXHRzeW5jTG9vcDogc3luY0xvb3AsXG4gXHRjb21wYXJlOiBjb21wYXJlLFxuXHRnZXROYW1lOiBnZXROYW1lXG5cbiB9XG4iXX0=
