(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.Workflow = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";function Workflow(e,s,r,i){var t=this;if(""==s||void 0==s)throw util.error("ParamRequired","A community id is required.");if("string"!=typeof s)throw new Error("The community id must be a javascript string.");if(t.communityId=s||"",""==e||void 0==e)throw util.error("ParamRequired","A profile id is required.");if("string"!=typeof e)throw new Error("The profile id must be a javascript string.");if(t.profile=e||"",""==r||void 0==r)throw util.error("ParamRequired","An app id is required.");if("string"!=typeof r)throw new Error("The app id must be a javascript string.");if(t.app=r||"",""==i||void 0==i)throw util.error("ParamRequired","A workflow configuration is required.");"object"!=typeof i?t.config=JSON.parse(i):t.config=i,t.instance,t.subprocesses=[],t.indicators=[],t.history=[]}var Process=require("./lib/process"),util=require("utility"),userInterface=require("./lib/interface");Workflow.prototype.getProfile=function(){return this.profile},Workflow.prototype.getApp=function(){return this.app},Workflow.prototype.getConfig=function(){return this.config},Workflow.prototype.getInstance=function(){return this.instance},Workflow.prototype.setInstance=function(e){this.instance=e},Workflow.prototype.getSubProcesses=function(){return this.subprocesses},Workflow.prototype.setSubProcesses=function(e){this.subprocesses=e},Workflow.prototype.getIndicators=function(){return this.indicators},Workflow.prototype.setIndicators=function(e){this.indicators=e},Workflow.prototype.create=function(){var e=this;return new Promise(function(s,r){try{if(void 0!==e.instance){var i=util.warn("Instance already exists.",e);s(i)}else{var t={_id:"",version:"",type:"workflowInstance",processes:[],channels:["community_"+app.SCOPE.communityId,"profile_"+app.SCOPE.profileId,"application_"+app.SCOPE.applicationId,"community_"+app.SCOPE.communityId+"_application_"+app.SCOPE.applicationId]};t._id=e.profile+":processes",t.version=e.config.version,e.instance=t;var o=util.success("Workflow processes instance created successfully.",e);s(o)}}catch(e){r(e)}})},Workflow.prototype.initialise=function(e,s){var r=this;return new Promise(function(i,t){try{var o=[];if(""!==e&&void 0!==e){if(o=r.config.processes.filter(function(s){if(s._id==e)return s}),void 0==o[0]._id){var n=util.error("WFConfigError","No valid process definition found with process id: "+e);t(n)}}else o.push(r.config.processes[0]),e=r.config.processes[0]._id;var c=[];r.instance.processes.filter(function(s){s.id==e&&c.push(s)});var u=c.length+1,a={id:"",seq:"",subProcesses:[]};a.id=e,a.seq=u,r.instance.processes.push(a);var p=o[0].subProcesses[0]._id,f=1;r.instance.processes.filter(function(s){s.id==e&&s.seq==u&&(f=s.subProcesses.length+1)}),Process.subProcess(e,u,p,f,s,r).then(function(o){var n=r.profile+":"+r.app+":"+e+":"+u+":"+p+":"+f,c=s.label,l={id:p,seq:f,uuid:n,label:c};a.subProcesses.push(l);for(var d=0;d<r.instance.processes.length;d++){var h=r.instance.processes[d];h.id==e&&h.seq==u&&r.instance.processes.splice(d,1,a)}var w=o.data.indicators,v=o.data.step;Process.indicatorDocs(e,w,v,r).then(function(e){var s=util.success("Process: "+r.config.processes[0]._id+" initialized successfully.",r);i(s)},function(e){t(e)})},function(s){r.instance.processes=r.instance.processes.filter(function(s){return!(s.id==e&&s.seq==u)}),console.log(s),t(s)})}catch(e){t(e)}})},Workflow.prototype.transition=function(e,s,r,i,t,o,n){var c=this;return new Promise(function(u,a){try{Process.transition(e,s,r,i,t,o,n,c).then(function(t){var o=function(o){c.instance.processes.filter(function(n){n.id==e&&n.seq==s&&n.subProcesses.filter(function(e){e.id==r&&e.seq==i&&c.subprocesses.filter(function(s){if(s._id==e.uuid)if("step"==o){s.step=t.data;var r=util.success(t.message,s);u(r)}else if("stepComplete"==o){s.step=t.data.step,s.complete=!0;var r=util.success(t.message,s);u(r)}})})})};o(t.data.subProcessComplete?"stepComplete":"step")},function(e){a(e)})}catch(e){a(e)}})},Workflow.prototype.assignUser=function(e,s,r,i,t){var o=this;return new Promise(function(n,c){try{Process.assignUser(e,s,r,i,t,o).then(function(e){n(e)},function(e){c(e)})}catch(e){c(e)}})},Workflow.prototype.ui=function(){var e=this;return{getProcess:function(s,r){return new Promise(function(i,t){try{userInterface.getProcess(s,r,e).then(function(e){i(e)},function(e){t(e)})}catch(e){t(e)}})}}},module.exports=Workflow;

},{"./lib/interface":4,"./lib/process":6,"utility":7}],2:[function(require,module,exports){
"use strict";var util=require("utility"),nodeValue=require("./nodeValue"),community=function(){return{createCommunity:function(e,i,t){return new Promise(function(e,i){var n=worker.getWorkerWrapper();n._id=generateUUID(),n.communityId=app.SCOPE.communityId,n.applicationId=app.SCOPE.applicationId,n.createdDateTime=(new Date).toString(),n.senderUserId=LOCAL_SETTINGS.SUBSCRIPTIONS.userId;var o=JSON.xpath("/indicators[category/term eq 'Community']/_id",t,{})[0],r={createCommunity:{newCommunityId:t.profile,indicatorUUID:{Community:o}}};n.action=r,worker.send(n).then(function(i){var t=util.success("Worker processed successfully.",i);e(t)},function(e){i(e)})})},userJoinCommunity:function(e,i,t){return new Promise(function(e,i){})},releaseAdoptedApplication:function(e,i,t){return new Promise(function(e,i){var n=worker.getWorkerWrapper();n._id=generateUUID(),n.communityId=app.SCOPE.communityId,n.applicationId=app.SCOPE.applicationId,n.createdDateTime=(new Date).toString(),n.senderUserId=LOCAL_SETTINGS.SUBSCRIPTIONS.userId;var o=JSON.xpath("/indicators[category/term eq 'adoptedApplication']/_id",t,{})[0],r={releaseAdoptedApplication:{communityId:t.profile,indicatorUUID:{adoptedApplication:o}}};n.action=r,worker.send(n).then(function(i){var t=util.success("Worker processes successfully.",i);e(t)},function(e){i(e)})})}}}(),application=function(){return{createAppDefinition:function(e,i,t){return new Promise(function(e,i){var n=worker.getWorkerWrapper();n._id=generateUUID(),n.communityId=app.SCOPE.communityId,n.applicationId=app.SCOPE.applicationId,n.createdDateTime=(new Date).toString(),n.senderUserId=LOCAL_SETTINGS.SUBSCRIPTIONS.userId;var o=JSON.xpath("/indicators[category/term eq 'Application']/_id",t,{})[0],r={createApplication:{newApplicationId:t.profile,indicatorUUID:{Application:o}}};n.action=r,worker.send(n).then(function(i){var t=util.success("Worker processes successfully.",i);e(t)},function(e){i(e)})})},buildApplication:function(e,i,t){return new Promise(function(e,n){var o=worker.getWorkerWrapper();o._id=generateUUID(),o.communityId=app.SCOPE.communityId,o.applicationId=app.SCOPE.applicationId,o.createdDateTime=(new Date).toString(),o.senderUserId=LOCAL_SETTINGS.SUBSCRIPTIONS.userId;var r=JSON.xpath("/subprocesses[_id eq '"+i+"']/indicators[id eq 'PublishApplication']/instances[1]/uuid",app.SCOPE.workflow,{})[0],a=JSON.xpath("/indicators[category/term eq 'ApplicationDefinition']/_id",t,{})[0],c=JSON.xpath("/indicators[category/term eq 'Roles']/_id",t,{})[0],p=JSON.xpath("/indicators[category/term eq 'Application']/_id",t,{})[0],s={buildApplication:{applicationId:t.profile,indicatorUUID:{PublishApplication:r,ApplicationDefinition:a,Roles:c,Application:p}}};o.action=s,worker.send(o).then(function(i){var t=util.success("Worker processes successfully.",i);e(t)},function(e){n(e)})})},applicationAdoption:function(e,i,t){return new Promise(function(e,n){var o=worker.getWorkerWrapper();o._id=generateUUID(),o.communityId=app.SCOPE.communityId,o.applicationId=app.SCOPE.applicationId,o.createdDateTime=(new Date).toString(),o.senderUserId=LOCAL_SETTINGS.SUBSCRIPTIONS.userId;var r=JSON.xpath("/subprocesses[_id eq '"+i+"']/indicators[id eq 'Adoption']/instances[1]/uuid",app.SCOPE.workflow,{})[0],a=JSON.xpath("/indicators[category/term eq 'PublishApplication']/_id",t,{})[0],c=JSON.xpath("/indicators[category/term eq 'Application']/_id",t,{})[0],p={adoptApplication:{applicationId:t.profile,indicatorUUID:{Adoption:r,PublishApplication:a,Application:c}}};o.action=p,worker.send(o).then(function(i){var t=util.success("Worker processes successfully.",i);e(t)},function(e){n(e)})})}}}(),worker=function(){return{getWorkerWrapper:function(){var e={source:"remote",type:"workerObject",_id:"",channels:[],communityId:"",applicationId:"",message:"",messageType:"info",createdDateTime:"",senderUserId:"",notification:{},action:{}};return e},send:function(e){return new Promise(function(i,t){console.log("Submitting Worker Object to server"),console.log(e),dao.save(e).done(function(e){i(e)}).fail(function(e){console.log("Error submitting worker response !!"+e),t(e)})})}}}();module.exports={community:community,application:application,worker:worker};

},{"./nodeValue":5,"utility":7}],3:[function(require,module,exports){
"use strict";function create(args){var processId=args[0]||"",subProcess=args[1]||{},step=args[2]||{},action=args[3]||{},_WFInstance=args[6]||{},data=args[6]||{},indicators=subProcess.indicators||[],result=[],indicatorType=action._type,processSeq=args[4]||"",subProcessSeq=args[5]||"",createType=args[7]||"",subProcessId=subProcess._id,uuid=args[8]||"",baseUUID=args[9]||"",profile=_WFInstance.profile,inputData=args[10]||{};return new Promise(function(resolve,reject){for(var toProcess=indicators.length,formCreateFn=function(id,indicatorType,indicatorId,validDate,instantiateSource){gatekeeper.instantiate(id,indicatorType,indicatorId,_WFInstance.profile,validDate).then(function(docArray){for(var i=0;i<docArray.length;i++){var object=docArray[i];if(!object.model._id.endsWith(":approved")&&!object.model._id.endsWith(":rejected")){var workflowObj={id:_WFInstance.config._id,instance:_WFInstance.instance._id,processes:[{id:processId,subProcessId:subProcess._id,subProcessUUID:uuid,step:{id:step.id,seq:step.seq,startDate:"",status:step.status,message:step.message,assignedTo:{userId:step.assignedTo.userId,name:step.assignedTo.name},comment:step.comment,complete:!1,endDate:""}}]};void 0!=action.setWorkflowLabelInTitle&&""!=action.setWorkflowLabelInTitle&&1==action.setWorkflowLabelInTitle&&(object.model.title=inputData.label),void 0!=action.setDraft&&""!=action.setDraft&&1==action.setDraft&&(object.model.control.draft=!0),object.model.workflows.push(workflowObj);var mainId=object.model._id;gatekeeper.persist(docArray).then(function(savedArray){dao.get(mainId).done(function(data){var indicatorModel=ko.mapping.fromJS({defaultModel:{setId:indicatorId}});gatekeeper.instantiateData(mainId,instantiateSource,indicatorModel,data.model.pending.seq).then(function(data){if("200"==data[0].status){if(void 0!=action.setWorkflowLabelInField&&""!=action.setWorkflowLabelInField&&mainId==profile){console.log(data[0]);var path="data[0].model.model.pending.data."+action.setWorkflowLabelInField+"='"+inputData.label+"'";eval(path)}gatekeeper.persist(data).then(function(e){dao.get(mainId).done(function(e){if(0==_WFInstance.indicators.length){if(_WFInstance.indicators.push(e),toProcess--,0==toProcess){var s=util.success("Form created successfully.",_WFInstance.indicators);resolve(s)}}else{for(var i=!1,t=0;t<_WFInstance.indicators.length;t++){var a=_WFInstance.indicators[t];if(a._id==e._id&&(i=!0,_WFInstance.indicators.splice(t,1),_WFInstance.indicators.push(e),toProcess--,0==toProcess)){var s=util.success("Form created successfully.",_WFInstance.indicators);resolve(s)}}if(0==i&&(_WFInstance.indicators.push(e),toProcess--,0==toProcess)){var s=util.success("Form created successfully.",_WFInstance.indicators);resolve(s)}}}).fail(function(e){console.error(e);var s=util.success("1 Gatekeeper initialisation failed with initialiseData message "+e[0].message,{});reject(s)})},function(e){console.error(e);var s=util.success("2 Gatekeeper initialisation failed with initialiseData message "+e[0].message,{});reject(s)})}else{var failure=util.success("3 Gatekeeper initialisation failed with initialiseData message "+err[0].message,{});reject(failure)}},function(e){var s=util.success("4 Gatekeeper initialisation failed with initialiseData message "+e[0].message,{});reject(s)})}).fail(function(e){console.error(e);var s=util.success("5 Gatekeeper initialisation failed with initialiseData message "+e[0].message,{});reject(s)})},function(e){console.error(e);var s=util.success("6 Gatekeeper initialisation failed with initialiseData message "+e[0].message,{});reject(s)})}}},function(e){for(var s=[],i=0;i<_WFInstance.instance.processes.length;i++)_WFInstance.instance.processes[i].subProcesses.length>0&&s.push(_WFInstance.instance.processes[i]);_WFInstance.instance.processes=[],_WFInstance.instance.processes=s;for(var t=[],i=0;i<_WFInstance.subprocesses.length;i++)_WFInstance.subprocesses[i].indicators.length>0&&t.push(_WFInstance.subprocesses[i]);_WFInstance.subprocesses=[],_WFInstance.subprocesses=t,console.error(e);var a=util.success("7 Gatekeeper initialisation failed with initialiseData message "+e[0].message,{});reject(a)})},instantiateSource="fromDefinition",counter=0;counter<indicators.length;counter++){var indicatorId=indicators[counter]._id,indicatorName=util.getName(indicators[counter].name,"en"),initType=indicators[counter]._type,id="",indicatorDoc={};if("newInstance"==initType)if(void 0!=baseUUID&&""!=baseUUID&&baseUUID.length>0){var existingUUID=JSON.xpath("/subprocesses[_id eq '"+baseUUID+"']/indicators[id eq '"+indicatorId+"']/instances[1]/uuid",_WFInstance,{})[0];id=existingUUID,initType="newSequence";var sp=JSON.xpath("/subprocesses[_id eq '"+baseUUID+"']",app.SCOPE.workflow,{})[0];sp.active=!1,instantiateSource="fromAuthorised"}else id=void 0!=subProcess.isProfile&&subProcess.isProfile&&0==counter?profile:indicatorId+"-"+generateUUID();else{var spLastUuid=JSON.xpath("/instance/processes[id eq '"+processId+"' and subProcesses/id eq '"+subProcessId+"'][1]/subProcesses/uuid",_WFInstance,{})[0],indId=JSON.xpath("/subprocesses[_id eq '"+spLastUuid+"']/indicators[id eq '"+indicatorId+"']/instances/uuid",app.SCOPE.workflow,{})[0];if(id=""==spLastUuid||void 0==spLastUuid||""==indId||void 0==indId?void 0!=subProcess.isProfile&&subProcess.isProfile&&0==counter?profile:indicatorId+"-"+generateUUID():indId,void 0!=baseUUID&&""!=baseUUID&&baseUUID.length>0){var sp=JSON.xpath("/subprocesses[_id eq '"+baseUUID+"']",app.SCOPE.workflow,{})[0];sp.active=!1,instantiateSource="fromAuthorised"}}formCreateFn(id,initType,indicatorId,"",instantiateSource)}})}function setInstanceTitle(e){var s=e[0]||{},i=e[2]||"",t=e[4]||{},a=t.label;return new Promise(function(e,t){for(var n=JSON.xpath("/subprocesses[_id eq '"+i+"']",s,{})[0],r=n.indicators,o=0;o<r.length;o++){var c=r[o].instances[0].uuid,d=JSON.xpath("/indicators[_id eq '"+c+"']",s,{})[0];d.title=r[o].id+" "+a}e("Set Title Success",r)})}function deleteProfile(e){var s=e[0]||{},i=s.profile;return new Promise(function(e,s){var t={source:"remote",type:"workerObject",_id:generateUUID(),channels:[],communityId:app.SCOPE.communityId,applicationId:app.SCOPE.applicationId,message:"",messageType:"info",createdDateTime:moment().format(),senderUserId:LOCAL_SETTINGS.SUBSCRIPTIONS.userId,notification:{},profile:{action:"deleteProfile",profileId:i}};console.log(t),dao.upsert(t).done(function(s){console.log("Worker Object submitted for profile("+i+") deletion."),console.log(s),e(s)}).fail(function(e){console.log(e),s(data)})})}function createProfile(e){var s=e[1]||{},i=s.communityId,t=s.profile;return new Promise(function(e,s){library.createProfileDocuments(i,t).done(function(s){var i=util.success("Form created successfully.",s);e(i)}).fail(function(e){console.error(e);var i=util.success("ERROR: Profile creation failed"+e[0].message,{});s(i)})})}function setDraft(e){var s=e[0]||{},i=(s.communityId,s.profile,e[2]||"");return new Promise(function(e,t){for(var a=JSON.xpath("/subprocesses[_id eq '"+i+"']",s,{})[0],n=a.indicators,r=0;r<n.length;r++){var o=n[r].instances[0].uuid,c=JSON.xpath("/indicators[_id eq '"+o+"']",s,{})[0];c.control.draft=!0}e("Set Draft Success",n)})}function setUnDraft(e){var s=e[0]||{},i=(s.communityId,s.profile,e[2]||"");return new Promise(function(e,t){for(var a=JSON.xpath("/subprocesses[_id eq '"+i+"']",s,{})[0],n=a.indicators,r=0;r<n.length;r++){var o=n[r].instances[0].uuid,c=JSON.xpath("/indicators[_id eq '"+o+"']",s,{})[0];c.control.draft=!1}e("Set Draft Success",n)})}function save(e){var s={complete:!0,data:[]};return new Promise(function(e,i){var t=util.success("Form indicator set saved successfully.",s);e(t)})}function submit(e){var s={complete:!0,data:[]};return new Promise(function(e,i){var t=util.success("Form submitted successfully.",s);e(t)})}function authorise(e){var s=e[0]||"",i=e[1]||{},t=i._id,a=e[2]||"",n=e[3]||"",r=e[4]||{};return new Promise(function(e,i){for(var o=JSON.xpath("/processes[id eq '"+s+"' and seq eq '"+a+"']/subProcesses[id eq '"+t+"' and seq eq '"+n+"']/uuid",r.instance,{})[0],c=JSON.xpath("/subprocesses[_id eq '"+o+"']/indicators/instances/uuid",r,{}),d=c.length,u=[],l=0;l<d;l++)gatekeeper.authorise(c[l]).then(function(s){gatekeeper.persist(s).then(function(s){for(var i="",t=0;t<s.length;t++)s[t].id.endsWith(":approved")||(i=s[t].id);dao.get(i).done(function(s){if(0==r.indicators.length){if(r.indicators.push(s),d--,0==d){var i=util.success("Form authorised successfully.",u);e(i)}}else{for(var t=!1,a=0;a<r.indicators.length;a++){var n=r.indicators[a];if(n._id==s._id&&(t=!0,r.indicators.splice(a,1),r.indicators.push(s),d--,0==d)){var i=util.success("Form authorised successfully.",u);e(i)}}if(0==t&&(r.indicators.push(s),d--,0==d)){var i=util.success("Form authorised successfully.",u);e(i)}}}).fail(function(e){console.error(e)})},function(e){console.error(err)})},function(s){if(d--,0==d){var i=util.success("Form authorised successfully.",u);e(i)}})})}function close(e){var s={complete:!0,data:[]};return new Promise(function(e,i){var t=util.success("Form closed successfully.",s);e(t)})}var util=require("utility"),gatekeeper=new GK;module.exports={create:create,save:save,submit:submit,authorise:authorise,close:close,setDraft:setDraft,setUnDraft:setUnDraft,createProfile:createProfile,setInstanceTitle:setInstanceTitle,deleteProfile:deleteProfile};

},{"utility":7}],4:[function(require,module,exports){
"use strict";function getProcess(e,s,t){return new Promise(function(n,i){try{var c=[],r=[];t.instance.processes.filter(function(s){s.id==e&&(r=s)}),util.syncLoop(r.subProcesses.length,function(n){var o=n.iteration(),u=r.seq,f=r.subProcesses[o].id,a=r.subProcesses[o].seq;getSubProcess(e,u,f,a,s,t).then(function(e){c.push(e),n.next()},function(e){n.break(),i(e)})},function(){n(c)})}catch(e){i(e)}})}function getSubProcess(e,s,t,n,i,c){return new Promise(function(r,o){try{var u={id:"",seq:"",name:"",help:"",dates:"",step:""},f=[],a=[];c.instance.processes.filter(function(i){if(i.id==e&&i.seq==s){i.subProcesses.length;i.subProcesses.filter(function(e){e.id==t&&e.seq==n&&0==e.complete&&(f=e)})}}),c.config.processes.filter(function(s){s._id==e&&s.subProcesses.filter(function(e){e._id==t&&(a=e)})}),u.id=a._id,u.seq=f.seq,u.name=util.getName(a.name,i),u.help=util.getName(a.help,i),u.dates=f.dates,u.step=f.step,r(u)}catch(e){o(e)}})}function prepareNotificationScreen(){""}var util=require("utility");module.exports={getProcess:getProcess};

},{"utility":7}],5:[function(require,module,exports){
"use strict";function get(){return new Promise(function(e,t){})}module.exports={get:get};

},{}],6:[function(require,module,exports){
"use strict";function count(e){return void 0!==e?e.length:0}function preRequisites(e,t){return new Promise(function(s,i){var n=[];try{util.syncLoop(e.length,function(s){var o=s.iteration();preRequisite(e[o],t).then(function(e){n.push(!0),s.next()},function(e){n.push(!1),s.break(),i(e)})},function(){if(n.every(Boolean)){var e=util.success("Pre-requisites completed successfully.",{});s(e)}else{var t=util.error("WFPreRequisiteError","Not all pre-requisites passed.");i(t)}})}catch(e){i(e)}})}function preRequisite(e,t){return new Promise(function(s,i){switch(e._type){case"processInstances":try{var n=e._parameter,o=e._filter,a="";if(void 0!=o){var r=o._operator,c="";switch(r){case"greaterThan":c="gt";break;case"lessThan":c="lt";break;case"greaterThanEqual":c="ge";break;case"lessThanEqual":c="le";break;case"equalTo":c="eq";break;case"notEqualTo":c="ne"}var u=o._element,u=u.split(".").join("/"),l=o._value,d="/"+u+"[. eq '"+l+"']",p="count(/subprocesses[id eq '"+n+"']"+d+")";a=JSON.xpath(p,t,{})[0]}else a=JSON.xpath("count(/subprocesses[id eq '"+n+"'])",t,{})[0];var f=util.compare(a,e._operator,parseInt(e._value));if(f){var m=util.success("Pre-requisites passed.",{});s(m)}else{var v="";e.message.i18n.filter(function(e){if("en"==e._lang){v=e.value;var t=util.error("WFPreRequisiteError",v);i(t)}})}}catch(e){i(e)}default:var h=util.error("WFPreRequisiteError","Pre-requisite type: "+e._type+" not defined.");i(h)}})}function preActions(e,t){return new Promise(function(s,i){var n=[];try{util.syncLoop(e.length,function(s){var o=s.iteration();action(e[o],t).then(function(e){n.push(!0),s.next()},function(e){n.push(!1),s.break(),i(e)})},function(){if(n.every(Boolean)){var e=util.success("Pre-actions completed successfully.",{});s(e)}else{var t=util.error("WFPreRequisiteError","Not all pre-actions passed.");i(t)}})}catch(e){i(e)}})}function getSubProcess(e,t){return void 0==t.subprocesses?[]:void t.subprocesses.filter(function(t){if(t.id==e)return t})}function subProcess(e,t,s,i,n,o){var a=[],r=[],c=[];o.instance.processes.filter(function(n){if(n.id==e&&n.seq==t){n.subProcesses.length;n.subProcesses.filter(function(e){if(e.id==s&&e.seq==i){var t=e.uuid;o.subprocesses.filter(function(e){e._id==t&&(a=e)})}})}}),o.config.processes.filter(function(t){t._id==e&&(r=t,t.subProcesses.filter(function(e){e._id==s&&(c=e)}))});var u="",l=n.baseUUID;if(void 0!=l&&""!=l&&l.length>0){var d=JSON.xpath("/subprocesses[_id eq '"+l+"']",o,{})[0];u=d.groupKey}else u=generateUUID();var p=o.profile+":"+o.app+":"+e+":"+t+":"+s+":"+i,f={_id:p,id:s,type:"workflowInstanceSubProcess",seq:i,initiated:!1,dates:{created:"",valid:"",due:"",closed:""},complete:!1,indicators:[],step:{},active:!0,groupKey:u,channels:["community_"+app.SCOPE.communityId,"profile_"+app.SCOPE.profileId,"application_"+app.SCOPE.applicationId,"community_"+app.SCOPE.communityId+"_application_"+app.SCOPE.applicationId]};return o.subprocesses.push(f),new Promise(function(u,l){try{var d=r.preActions;preActions(d,o).then(function(d){var m=r.prerequisites;preRequisites(m,o).then(function(d){var m=c.initiate;initiate(m,a,n).then(function(a){f.initiated=a.data.initiated,f.dates=a.data.dates;var d=c.steps[0]._id,p=c.steps[0].transitions[0]._id,m=1;step(e,t,s,i,d,m,n,o).then(function(a){f.step=a.data,indicators(c.indicators,o,f._id).then(function(a){f.indicators=a.data,transition(e,t,s,i,d,p,n,o).then(function(e){var t=e;f.step=e.data;var s=r.postActions;postActions(s,o).then(function(e){var s=util.success(t.message,f);u(s)},function(e){l(e)})},function(e){l(e)})},function(e){l(e)})},function(e){l(e)})},function(e){o.subprocesses=o.subprocesses.filter(function(e){return!(e._id==p)}),l(e)})},function(e){o.subprocesses=o.subprocesses.filter(function(e){return!(e._id==p)}),l(e)})},function(e){o.subprocesses=o.subprocesses.filter(function(e){return!(e._id==p)}),l(e)})}catch(e){l(e)}})}function initiate(e,t,s){var i={initiated:!1,dates:{created:"",valid:"",due:"",closed:""}};return new Promise(function(n,o){var a=function(){switch(e._type){case"user":i.dates.created=s.createdDate,"userSelected"!=e.dates.valid._type&&"autoSelected"!=e.dates.valid._type||(void 0!==s.validDate?i.dates.valid=s.validDate:util.warn("WFInitiateError","No valid date passed in - {data.validDate}")),"userSelected"!=e.dates.due._type&&"autoSelected"!=e.dates.valid._type||(void 0!==s.dueDate?i.dates.due=s.dueDate:util.warn("WFInitiateError","No due date passed in - {data.dueDate}")),i.initiated=!0;var t=util.success("Sub-Process initiate completed successfully.",i);n(t);break;case"auto":i.dates.created=s.createdDate,"userSelected"!=e.dates.valid._type&&"autoSelected"!=e.dates.valid._type||(void 0!==s.validDate?i.dates.valid=s.validDate:util.warn("WFInitiateError","No valid date passed in - {data.validDate}")),"userSelected"!=e.dates.due._type&&"autoSelected"!=e.dates.due._type||(void 0!==s.dueDate?i.dates.due=s.dueDate:util.warn("WFInitiateError","No due date passed in - {data.dueDate}")),i.initiated=!0;var t=util.success("Sub-Process initiate completed successfully.",i);n(t);break;default:var a=util.error("WFInitiateError","Initiate type: "+e._type+" not defined.");o(a)}};if(void 0==t.complete)a();else if(!t.complete)if(e.parallelInstances)a();else{var r=util.error("WFInitiateError","Sub-process: "+t.id+" still active and parallel instances are not allowed.");o(r)}})}function step(e,t,s,i,n,o,a,r){var c,u={id:"",seq:"",status:"",message:"",assignedTo:{userId:"",name:""},assignment:{},comment:""},l={},d="",p={};return new Promise(function(f,m){try{r.instance.processes.filter(function(n){n.id==e&&n.seq==t&&n.subProcesses.filter(function(e){e.id==s&&e.seq==i&&(d=e.uuid)})}),r.subprocesses.filter(function(e){e._id==d&&(c=e)}),r.config.processes.filter(function(t){t._id==e&&t.subProcesses.filter(function(e){e._id==s&&(l=e,e.steps.filter(function(e){e._id==n&&(p=e)}))})}),u.id=n,u.seq=o,u.status=p._setInstanceStatusTo,u.message=p._setStatusMsgTo,u.comment=void 0!==a.comment?a.comment:"";var v=void 0!==c?c.indicators:[];indicatorDocs(e,v,u,r).then(function(n){var o=r.profile+":"+r.app+":"+e+":"+t+":"+s+":"+i;d=o,void 0!==p.actions[0]?actions(p.actions,e,t,s,i,l,u,r,a,d).then(function(e){var t=util.success("Actions completed successfully.",u);f(t)},function(e){m(e)}):void 0!==p.task&&task(e,t,p.task,o,u).then(function(e){console.log("Task complete.");var t=util.success("Task awaiting user action.",u);f(t)},function(e){m(e)})},function(e){m(e)})}catch(e){m(e)}})}function indicators(e,t,s){var i=[];return new Promise(function(e,n){try{for(var o=JSON.xpath("indicators[fn:count(./workflows/processes[subProcessUUID eq '"+s+"']) gt 0]",t,{}),a=0;a<o.length;a++){var r=o[a],c={id:"",instances:[]},u={uuid:"",title:"",key:"",seq:1};c.id=r.category.term,u.uuid=r._id,u.title=r.title,u.key="",u.seq=r.model.pending.seq,c.instances.push(u),i.push(c)}var l=util.success("Process indicator model updated.",i);e(l)}catch(e){n(e)}})}function assignUser(e,t,s,i,n,o){return new Promise(function(a,r){try{var c="";o.instance.processes.filter(function(n){n.id==e&&n.seq==t&&n.subProcesses.filter(function(e){e.id==s&&e.seq==i&&(c=e.uuid)})}),o.subprocesses.filter(function(t){if(t._id==c){t.step.assignedTo.userId=n.id,t.step.assignedTo.name=n.name;for(var s=t.indicators,i=0;i<s.length;i++)for(var r=s[i],u=0;u<r.instances.length;u++)for(var l=r.instances[u],d=0;d<o.indicators.length;d++){var p=o.indicators[d];l.uuid==p._id&&p.workflows.filter(function(t){t.id==o.config._id&&t.processes.filter(function(t){t.id==e&&(t.step.assignedTo.userId=n.id,t.step.assignedTo.name=n.name)})})}var f=util.success('User assigned successfully. UserId: "'+n.id+'", Name: "'+n.name+'"',t);a(f)}})}catch(e){r(e)}})}function indicatorDocs(e,t,s,i){return new Promise(function(n,o){try{if(void 0==t){util.error("WFIndicatorsUpdate","Indicators parameter is required. - Value: "+t);o(err)}else{for(var a=0;a<t.length;a++)for(var r=t[a],c=0;c<r.instances.length;c++)for(var u=r.instances[c],l=0;l<i.indicators.length;l++){var d=i.indicators[l];u.uuid==d._id&&d.workflows.filter(function(t){t.id==i.config._id&&t.processes.filter(function(t){t.id==e&&(t.step.id=s.id,t.step.seq=s.seq,t.step.status=s.status,t.step.message=s.message,t.step.assignedTo.userId=s.assignedTo.userId,t.step.assignedTo.name=s.assignedTo.name,t.step.comment=void 0!==s.comment?s.comment:"")})})}var p=util.success("Indicator documents workflow process model updated.",i);n(p)}}catch(e){o(e)}})}function actions(e,t,s,i,n,o,a,r,c,u){var l=[];return new Promise(function(d,p){util.syncLoop(e.length,function(d){var f=d.iteration();action(e[f],t,s,i,n,o,a,r,c,u).then(function(t){var s={id:e[f]._id,seq:f,data:t};l.push(s),d.next()},function(e){d.break(),p(e)})},function(){var e=util.success("Actions completed successfully.",l);d(e)})})}function action(e,t,s,i,n,o,a,r,c,u){return new Promise(function(l,d){if(void 0!=e.method){var p=["form","indicator","profile","subProcessInstance","step","community","application","user","sdo"];switch(propertyExists(e.method,p)){case"form":break;case"indicator":break;case"profile":break;case"subProcessInstance":break;case"step":break;case"community":var f=["createCommunity","releaseAdoptedApplication","userJoinCommunity"];switch(propertyExists(e.method.community,f)){case"createCommunity":return actionsModule.community.createCommunity(e.method.community.createCommunity,u,r).then(function(e){l(e.data)},function(e){d(e)});case"releaseAdoptedApplication":return actionsModule.community.releaseAdoptedApplication(e.method.community.releaseAdoptedApplication,u,r).then(function(e){l(e.data)},function(e){d(e)});case"userJoinCommunity":return actionsModule.community.userJoinCommunity(e.method.community.userJoinCommunity,u,r).then(function(e){l(e.data)},function(e){d(e)});default:d("No method found from implemented list.")}break;case"application":var m=["createAppDefinition","buildApplication","applicationAdoption"];switch(propertyExists(e.method.application,m)){case"createAppDefinition":return actionsModule.application.createAppDefinition(e.method.application.createAppDefinition,u,r).then(function(e){l(e.data)},function(e){d(e)});case"buildApplication":return actionsModule.application.buildApplication(e.method.application.buildApplication,u,r).then(function(e){l(e.data)},function(e){d(e)});case"applicationAdoption":return actionsModule.application.applicationAdoption(e.method.application.applicationAdoption,u,r).then(function(e){l(e.data)},function(e){d(e)});default:d("No method found from implemented list.")}break;case"user":break;case"sdo":break;default:d("No method found from implemented list.")}}else{var v=[],h="global",g="";void 0!==e._id&&(h=e._id.split(".")[0]),void 0!==e._id&&(g=e._id.split(".")[1]),v.length=0;for(var _=0;_<e._args.length;_++){var y=e._args[_];switch(y){case"processId":v.push(t);break;case"processSeq":v.push(s);break;case"subProcessId":v.push(i);break;case"subProcessSeq":v.push(n);break;case"subProcess":v.push(o);break;case"step":v.push(a);break;case"action":v.push(e);break;default:v=[]}}if(v.push(r),v.push(c.createType),v.push(u),v.push(c.baseUUID),v.push(c),"form.create"==e._id)form.create(v).then(function(e){l(e.data)},function(e){d(e)});else if("form.authorise"==e._id)form.authorise(v).then(function(e){l(e.data)},function(e){d(e)});else if("form.close"==e._id)form.close(v).then(function(e){l(e.data)},function(e){d(e)});else if("form.setDraft"==e._id)form.setDraft(v).then(function(e){l(e.data)},function(e){d(e)});else if("form.setUnDraft"==e._id)form.setUnDraft(v).then(function(e){l(e.data)},function(e){d(e)});else if("form.createProfile"==e._id)form.createProfile(v).then(function(e){l(e.data)},function(e){d(e)});else if("form.setInstanceTitle"==e._id)form.setInstanceTitle(v).then(function(e){l(e.data)},function(e){d(e)});else if("profile.delete"==e._id)form.deleteProfile(v).then(function(e){l(e.data)},function(e){d(e)});else{var b=util.error("WFActionError","Method: "+action_id+" not defined.");d(b)}}})}function task(e,t,s,i,n){return new Promise(function(o,a){if(void 0!=s.assign.profileRole){var r=app.SCOPE.workflow.profile,c="";"current"==s.assign.profileRole.profile?c=app.SCOPE.workflow.profile:"community"==s.assign.profileRole.profile&&(c=app.SCOPE.communityId);var u=s.assign.profileRole.role;library.getUsersListByRole(c,u).then(function(a){if(void 0!=a)if(a.length>1){var l=JSON.xpath("/subprocesses[_id eq '"+i+"']",app.SCOPE.workflow,{})[0],d=JSON.xpath("/subprocesses[_id eq '"+i+"']/channels",app.SCOPE.workflow,{}),p=processWorkflowMessage(NOTIFICATION_USER_MSG_ACCEPT,i),f=l.id,m=l.seq,v=i,h=l.dates.valid,g=JSON.xpath("/config/processes[_id eq '"+e+"']",app.SCOPE.workflow,{})[0],_=JSON.xpath("/subProcesses[_id eq '"+f+"']",g,{})[0],y=l.step.seq+0,b=JSON.xpath("/steps[_seq eq '"+y+"']/name/i18n[1]/value",_,{})[0],P=_.name.i18n[0].value,I={source:"remote",type:"notificationRequest",_id:i+":notificationRequest",channels:d,communityId:app.SCOPE.communityId,applicationId:app.SCOPE.applicationId,message:p,messageType:"info",createdDateTime:moment().format(),senderUserId:LOCAL_SETTINGS.SUBSCRIPTIONS.userId,actions:[{label:"View",function:"app.openSubprocess",params:[r,f,m,P,e,t,v,h,b]}],receiver:{value:[{type:"role",name:u,profileId:c}]}};dao.upsert(I).done(function(e){console.log(e)}).fail(function(e){console.log(e)});var S="";if(void 0!=s.assign.assignment){var S=n.assignment,q={show:s.assign.assignment.accept.show,label:_getName(s.assign.assignment.accept.label.i18n,"en")};S.accept=q,S.message=_getName(s.assign.assignment.message.i18n,"en");var w={show:s.assign.assignment.reject.show,label:_getName(s.assign.assignment.reject.label.i18n,"en")};S.reject=w;var E={profileId:r,roleId:u,type:"role"};S.value=E,S.profileRoleId=c}o("Notifications request submitted for acceptance.")}else if(1==a.length){var k=a[0].id,A=a[0].name,T=n.assignedTo;T.name=A+"",T.userId=k+"",o("Assigned to the only user in role.")}else if(void 0!=s.assign.default){var k=s.assign.default.userId,A=s.assign.default.userName,T=n.assignedTo;T.name=A+"",T.userId=k+"",o("Assigned to default user")}else console.log("Error in assignment. Default user not specified."),w("Error in assignment. Default user not specified.");else console.log("Error in getUsersListByRole undefined"),w(err)},function(e){console.log("Error in getUsersListByRole"),a(e)})}else void 0!=s.assign.swimlane&&(o("swimlane"),console.log("Swimlane implementation !!"))})}function transition(e,t,s,i,n,o,a,r){return new Promise(function(c,u){try{for(var l=0,d="",p=0,f=[],m=r.config.processes.filter(function(t){if(t._id==e)return t}),v=m[0].subProcesses.filter(function(e){if(e._id==s)return e}),h=v[0].steps.filter(function(e){if(e._id==n)return e}),g=h[0].transitions.filter(function(e){if(e._id==o)return e}),_=0;_<v[0].steps.length;_++)v[0].steps[_]._id==n&&(l=parseInt(v[0].steps[_]._seq));v[0].steps.filter(function(e){p=l+1,parseInt(e._seq)==p&&(d=e._id)}),r.instance.processes.filter(function(n){n.id==e&&n.seq==t&&n.subProcesses.filter(function(e){if(e.id==s&&e.seq==i){var t=e.uuid;r.subprocesses.filter(function(e){e._id==t&&(f=e)})}})});var y=v[0].steps.length;switch(g[0]._type){case"auto":"nextStep"==g[0].goTo._type&&step(e,t,s,i,d,p,a,r).then(function(e){if(p==y){var t=util.success("All Step transitions have completed successfully.",{subProcessComplete:!0,step:e.data});c(t)}else{var t=util.success("Step transition completed successfully.",e.data);c(t)}},function(e){u(e)});break;case"user":if("nextStep"==g[0].goTo._type)step(e,t,s,i,d,p,a,r).then(function(e){if(p==y){var t=util.success("All Step transitions have completed successfully.",{subProcessComplete:!0,step:e.data});c(t)}else{var t=util.success("Step transition completed successfully.",e.data);c(t)}},function(e){u(e)});else if("stepId"==g[0].goTo._type){var b=g[0].goTo._stepId,P=1;v[0].steps.filter(function(e){e._id==b&&(P=parseInt(e._seq))}),step(e,t,s,i,b,P,a,r).then(function(e){if(P==y){var t=util.success("All Step transitions have completed successfully.",{subProcessComplete:!0,step:e.data});c(t)}else{var t=util.success("Step transition completed successfully.",e.data);c(t)}},function(e){u(e)})}break;default:var I=util.error("WFTransitionError","Transition type: "+g[0]._type+" not defined.");u(I)}}catch(e){u(e)}})}function postActions(e,t){return new Promise(function(s,i){var n=[];try{util.syncLoop(e.length,function(s){var o=s.iteration();action(e[o],t).then(function(e){n.push(!0),s.next()},function(e){n.push(!1),s.break(),i(e)})},function(){if(n.every(Boolean)){var e=util.success("Post-actions completed successfully.",{});s(e)}else{var t=util.error("WFPreActionsError","Not all post-actions passed.");i(t)}})}catch(e){i(e)}})}function processWorkflowMessage(e,t){var s=e;if(s.indexOf("#INSTANCE_LABEL")!==-1){var i=JSON.xpath("/instance/processes/subProcesses[uuid eq '"+t+"']/label",app.SCOPE.workflow,{})[0];s=s.replace("#INSTANCE_LABEL",i)}if(s.indexOf("#USER_NAME")!==-1){var i=JSON.xpath("/subprocesses[_id eq '"+t+"']/step/assignedTo/name",app.SCOPE.workflow,{})[0];s=s.replace("#USER_NAME",i)}if(s.indexOf("#PROFILE_TITLE")!==-1){var i=app.profile.title;s=s.replace("#PROFILE_TITLE",i)}if(s.indexOf("#PROFILE_TYPE")!==-1){var i=app.SCOPE.APP_CONFIG.name;s=s.replace("#PROFILE_TYPE",i)}if(s.indexOf("#VAR_SPUUID")!==-1){var i=t;s=s.replace("#VAR_SPUUID",i)}return s}function _getName(e,t){if(void 0!==e)for(var s=0;s<e.length;s++)if(e[s]._lang===t)return e[s].value}var util=require("utility"),actionsModule=require("./actions"),form=require("./form");module.exports={preRequisites:preRequisites,preActions:preActions,subProcess:subProcess,indicatorDocs:indicatorDocs,task:task,transition:transition,assignUser:assignUser};

},{"./actions":2,"./form":3,"utility":7}],7:[function(require,module,exports){
"use strict";function success(r,e){return{message:r,data:e}}function warn(r,e){return console.warn(e),{warning:r,data:e}}function error(r,e){var n=new Error("");return n.name=r,n.message=e,n}function syncLoop(r,e,n){var a=0,t=!1,o=!1,u={next:function(){return t&&o&&n?n():void(a<r?(a++,e(u)):(t=!0,n&&n()))},iteration:function(){return a-1},break:function(r){t=!0,o=r}};return u.next(),u}function compare(r,e,n){switch(e){case"greaterThan":return r>n;case"lessThan":return r<n;case"greaterThanEqual":return r>=n;case"lessThanEqual":return r<=n;case"equalTo":return r===n;case"notEqualTo":return r!==n}}function getName(r,e){if(void 0!==r)for(var n=0;n<r.length;n++)if(r[n].i18n._lang===e)return r[n].i18n.value}module.exports={success:success,warn:warn,error:error,syncLoop:syncLoop,compare:compare,getName:getName};

},{}]},{},[1])(1)
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL1VzZXJzL0hhc2FuL0FwcERhdGEvUm9hbWluZy9ucG0vbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsImluZGV4LmpzIiwibGliXFxhY3Rpb25zLmpzIiwibGliXFxmb3JtLmpzIiwibGliXFxpbnRlcmZhY2UuanMiLCJsaWJcXG5vZGVWYWx1ZS5qcyIsImxpYlxccHJvY2Vzcy5qcyIsIm5vZGVfbW9kdWxlc1xcdXRpbGl0eVxcaW5kZXguanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQSxZQTBDQSxTQUFTLFVBQVMsRUFBUyxFQUFhLEVBQUssR0FDNUMsR0FBSSxHQUFRLElBR1osSUFBbUIsSUFBZixHQUFvQyxRQUFmLEVBQ2xCLEtBQU0sTUFBSyxNQUFNLGdCQUFpQiw4QkFDL0IsSUFBNEIsZ0JBQWxCLEdBQ2hCLEtBQU0sSUFBSSxPQUFNLGdEQU1wQixJQUpJLEVBQU0sWUFBYyxHQUFlLEdBSXhCLElBQVgsR0FBNEIsUUFBWCxFQUNkLEtBQU0sTUFBSyxNQUFNLGdCQUFpQiw0QkFDL0IsSUFBd0IsZ0JBQWQsR0FDaEIsS0FBTSxJQUFJLE9BQU0sOENBS3BCLElBSEksRUFBTSxRQUFVLEdBQVcsR0FHcEIsSUFBUCxHQUFvQixRQUFQLEVBQ1YsS0FBTSxNQUFLLE1BQU0sZ0JBQWlCLHlCQUMvQixJQUFvQixnQkFBVixHQUNoQixLQUFNLElBQUksT0FBTSwwQ0FLakIsSUFIQyxFQUFNLElBQU0sR0FBTyxHQUdOLElBQVYsR0FBMEIsUUFBVixFQUNuQixLQUFNLE1BQUssTUFBTSxnQkFBaUIsd0NBQ0wsaUJBQWIsR0FDYixFQUFNLE9BQVMsS0FBSyxNQUFNLEdBRTdCLEVBQU0sT0FBUyxFQUdmLEVBQU0sU0FFVCxFQUFNLGdCQUVOLEVBQU0sY0FFTixFQUFNLFdBbkZSLEdBQUksU0FBVSxRQUFRLGlCQUNsQixLQUFPLFFBQVEsV0FDZixjQUFnQixRQUFRLGtC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R0FJdEIsUUFBUyxTQUFRLEVBQUssR0FDckIsR0FBWSxTQUFSLEVBQ0gsSUFBSyxHQUFJLEdBQUksRUFBRyxFQUFJLEVBQUksT0FBUyxJQUNoQyxHQUFJLEVBQUksR0FBRyxLQUFLLFFBQVUsRUFDekIsTUFBTyxHQUFJLEdBQUcsS0FBSyxNQU12QixPQUFPLFNBRUwsUUFBUyxRQUNULEtBQU0sS0FDTixNQUFPLE1BQ1AsU0FBVSxTQUNWLFFBQVMsUUFDVixRQUFTIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIid1c2Ugc3RyaWN0JztcclxuXHJcbnZhciBQcm9jZXNzID0gcmVxdWlyZSgnLi9saWIvcHJvY2VzcycpO1xyXG52YXIgdXRpbCA9IHJlcXVpcmUoJ3V0aWxpdHknKTtcclxudmFyIHVzZXJJbnRlcmZhY2UgPSByZXF1aXJlKCcuL2xpYi9pbnRlcmZhY2UnKTtcclxuXHJcbi8qZ2xvYmFscyAqL1xyXG5cclxuLyoqXHJcbiAqIEEgbmV3IFdvcmtmbG93IGNvbnN0cnVjdG9yIGluc3RhbmNlIGNvbnRhaW5zIHRoZSByZWZlcmVuY2UgdG8gdGhlIGFwcGxpY2F0aW9uXHJcbiAqIGFuZCBhc3NvY2lhdGVkIHByb2ZpbGUgd2hpY2ggaXQgcmVxdWlyZXMgYXMgdGhlIGZpcnN0IHR3byBwYXJhbWV0ZXJzLiBJdCBhbHNvXHJcbiAqIHJlcXVpcmVzIGEgd29ya2Zsb3cgY29uZmlndXJhdGlvbiwgYXMgdGhlIHRoaXJkIHBhcmFtZXRlciwgd2hpY2ggaXMgdXNlZCB0b1xyXG4gKiBkZXNjaWJlIHRoZSB3b3JrZmxvdyBwcm9jZXNzZXMuIElmIGEgd29ya2Zsb3cgaW5zdGFuY2UgZXhpc3RzIHlvdSBjYW4gcGFzcyBpdFxyXG4gKiBpbiBhcyB0aGUgZm91cnRoIHBhcmFtZXRlciB3aGljaCBpdCB3aWxsIHRoZW4gdXNlLCBlbHNlIGNyZWF0ZSBhIG5ldyBvbmUuXHJcbiAqXHJcbiAqIEBjb25zdHJ1Y3RvclxyXG4gKlxyXG4gKiBAcGFyYW0ge3N0cmluZ30gcHJvZmlsZSAtIFRoZSBjdXJyZW50IHByb2ZpbGUgaWRcclxuICogQHBhcmFtIHtzdHJpbmd9IGFwcCAtIFRoZSBhc3NvY2lhdGVkIGFwcGxpY2F0aW9uIGlkXHJcbiAqIEBwYXJhbSB7T2JqZWN0fSBjb25maWcgLSBUaGUgYXBwbGljYXRpb24gd29ya2Zsb3cgY29uZmlndXJhdGlvbiAvIGRlZmluaXRpb25cclxuICogQHBhcmFtIHtPYmplY3R9IFtpbnN0YW5jZV0gLSBBbiBleGlzdGluZyBhcHBsaWNhdGlvbiBwcm9maWxlIHdvcmtmbG93IGluc3RhbmNlIGJhc2VkXHJcbiAqIG9uIHRoZSBkZWZpbml0aW9uXHJcbiAqXHJcbiAqIEBhdXRob3IgQnJlbnQgR29yZG9uXHJcbiAqIEB2ZXJzaW9uIDAuMS4wXHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqIHZhciBjb25maWcgPSB7ICdfaWQnOiAnYWJjMTIzJyB9O1xyXG4gKiB2YXIgaW5zdGFuY2UgPSB7ICdfaWQnOiAnaW5zdGFuY2VfYWJjMTIzJyB9O1xyXG4gKiAvLyBJZiB0aGVyZSBpc24ndCBhbiBleGlzdGluZyBpbnN0YW5jZVxyXG4gKiB2YXIgd29ya2Zsb3cgPSBuZXcgV29ya2Zsb3coJzEyMzQnLCAnNTY3OCcsIGNvbmZpZyk7XHJcbiAqIC8vIElmIHRoZXJlIGlzIGFuIGV4aXN0aW5nIGluc3RhbmNlXHJcbiAqIHZhciB3b3JrZmxvdyA9IG5ldyBXb3JrZmxvdygnMTIzNCcsICc1Njc4JywgY29uZmlnLCBpbnN0YW5jZSk7XHJcbiAqXHJcbiAqIEByZXR1cm4ge09iamVjdH0gbmV3IFdvcmtmbG93IG9iamVjdFxyXG4gKlxyXG4gKiBAdGhyb3dzIEVycm9yOiBBIHByb2ZpbGUgaWQgaXMgcmVxdWlyZWRcclxuICogQHRocm93cyBFcnJvcjogQW4gYXBwIGlkIGlzIHJlcXVpcmVkXHJcbiAqIEB0aHJvd3MgRXJyb3I6IEEgd29ya2Zsb3cgY29uZmlndXJhdGlvbiBpcyByZXF1aXJlZFxyXG4gKlxyXG4gKi9cclxuXHJcbmZ1bmN0aW9uIFdvcmtmbG93KHByb2ZpbGUsIGNvbW11bml0eUlkLCBhcHAsIGNvbmZpZyl7XHJcblx0dmFyIF90aGlzID0gdGhpcztcclxuXHRcclxuXHQvLyBDb21tdW5pdHkgSUQgdmFsaWRhdGlvbiBjaGVja3NcclxuXHRpZiAoY29tbXVuaXR5SWQgPT0gJycgfHwgY29tbXVuaXR5SWQgPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgdGhyb3cgdXRpbC5lcnJvcignUGFyYW1SZXF1aXJlZCcsICdBIGNvbW11bml0eSBpZCBpcyByZXF1aXJlZC4nKTtcclxuICAgIH0gZWxzZSBpZiAodHlwZW9mKGNvbW11bml0eUlkKSAhPT0gJ3N0cmluZycpIHtcclxuICAgIFx0dGhyb3cgbmV3IEVycm9yKCdUaGUgY29tbXVuaXR5IGlkIG11c3QgYmUgYSBqYXZhc2NyaXB0IHN0cmluZy4nKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICBcdF90aGlzLmNvbW11bml0eUlkID0gY29tbXVuaXR5SWQgfHwgJyc7XHJcbiAgICB9XHJcblxyXG5cdC8vIFByb2ZpbGUgSUQgdmFsaWRhdGlvbiBjaGVja3NcclxuXHRpZiAocHJvZmlsZSA9PSAnJyB8fCBwcm9maWxlID09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIHRocm93IHV0aWwuZXJyb3IoJ1BhcmFtUmVxdWlyZWQnLCAnQSBwcm9maWxlIGlkIGlzIHJlcXVpcmVkLicpO1xyXG4gICAgfSBlbHNlIGlmICh0eXBlb2YocHJvZmlsZSkgIT09ICdzdHJpbmcnKSB7XHJcbiAgICBcdHRocm93IG5ldyBFcnJvcignVGhlIHByb2ZpbGUgaWQgbXVzdCBiZSBhIGphdmFzY3JpcHQgc3RyaW5nLicpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgIFx0X3RoaXMucHJvZmlsZSA9IHByb2ZpbGUgfHwgJyc7XHJcbiAgICB9XHJcbiAgICAvLyBBcHAgSUQgdmFsaWRhdGlvbiBjaGVja3NcclxuXHRpZiAoYXBwID09ICcnIHx8IGFwcCA9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICB0aHJvdyB1dGlsLmVycm9yKCdQYXJhbVJlcXVpcmVkJywgJ0FuIGFwcCBpZCBpcyByZXF1aXJlZC4nKTtcclxuICAgIH0gZWxzZSBpZiAodHlwZW9mKGFwcCkgIT09ICdzdHJpbmcnKSB7XHJcbiAgICBcdHRocm93IG5ldyBFcnJvcignVGhlIGFwcCBpZCBtdXN0IGJlIGEgamF2YXNjcmlwdCBzdHJpbmcuJyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgXHRfdGhpcy5hcHAgPSBhcHAgfHwgJyc7XHJcbiAgICB9XHJcbiAgICAvLyBXb3JrZmxvdyBjb25maWd1cmF0aW9uIHZhbGlkYXRpb24gY2hlY2tzXHJcbiAgICBpZiAoY29uZmlnID09ICcnIHx8IGNvbmZpZyA9PSB1bmRlZmluZWQpIHtcclxuICAgIFx0dGhyb3cgdXRpbC5lcnJvcignUGFyYW1SZXF1aXJlZCcsICdBIHdvcmtmbG93IGNvbmZpZ3VyYXRpb24gaXMgcmVxdWlyZWQuJyk7XHJcbiAgICB9IGVsc2UgaWYgKHR5cGVvZihjb25maWcpICE9PSAnb2JqZWN0Jykge1xyXG4gICAgICAgIF90aGlzLmNvbmZpZyA9IEpTT04ucGFyc2UoY29uZmlnKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICBcdF90aGlzLmNvbmZpZyA9IGNvbmZpZztcclxuICAgIH1cclxuXHQgICAgLy8gV29ya2Zsb3cgaW5zdGFuY2UgdmFsaWRhdGlvbiBjaGVja3NcclxuXHQgICAgX3RoaXMuaW5zdGFuY2U7XHJcblx0XHQvLyBXb3JrZmxvdyBzdWItcHJvY2Vzc2VzIHZhbGlkYXRpb24gY2hlY2tzXHJcblx0XHRfdGhpcy5zdWJwcm9jZXNzZXMgPSBbXTtcclxuXHRcdC8vIFdvcmtmbG93IGluZGljYXRvcnMgcGxhY2UgaG9sZGVyXHJcblx0XHRfdGhpcy5pbmRpY2F0b3JzID0gW107XHJcblx0XHQvLyBXb3JrZmxvdyBzdWItcHJvY2VzcyBzdGVwIGhpc3RvcnkgcGxhY2UgaG9sZGVyXHJcblx0XHRfdGhpcy5oaXN0b3J5ID0gW107XHJcblxyXG59XHJcblxyXG4vKipcclxuICogV29ya2Zsb3cgZ2V0IHByb2ZpbGUgaWQuXHJcbiAqXHJcbiAqIEBleGFtcGxlIFwiXCJcclxuICpcclxuICogQHJldHVybiBcIlwiXHJcbiAqXHJcbiAqL1xyXG5Xb3JrZmxvdy5wcm90b3R5cGUuZ2V0UHJvZmlsZSA9IGZ1bmN0aW9uKCl7XHJcblx0cmV0dXJuIHRoaXMucHJvZmlsZTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBXb3JrZmxvdyBnZXQgYXBwIGlkLlxyXG4gKlxyXG4gKiBAZXhhbXBsZSBcIlwiXHJcbiAqXHJcbiAqIEByZXR1cm4gXCJcIlxyXG4gKlxyXG4gKi9cclxuV29ya2Zsb3cucHJvdG90eXBlLmdldEFwcCA9IGZ1bmN0aW9uKCl7XHJcblx0cmV0dXJuIHRoaXMuYXBwO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFdvcmtmbG93IGdldCBjb25maWcuXHJcbiAqXHJcbiAqIEBleGFtcGxlIFwiXCJcclxuICpcclxuICogQHJldHVybiBcIlwiXHJcbiAqXHJcbiAqL1xyXG5Xb3JrZmxvdy5wcm90b3R5cGUuZ2V0Q29uZmlnID0gZnVuY3Rpb24oKXtcclxuXHRyZXR1cm4gdGhpcy5jb25maWc7XHJcbn07XHJcblxyXG4vKipcclxuICogV29ya2Zsb3cgZ2V0IGluc3RhbmNlLlxyXG4gKlxyXG4gKiBAZXhhbXBsZSBcIlwiXHJcbiAqXHJcbiAqIEByZXR1cm4gXCJcIlxyXG4gKlxyXG4gKi9cclxuV29ya2Zsb3cucHJvdG90eXBlLmdldEluc3RhbmNlID0gZnVuY3Rpb24oKXtcclxuXHRyZXR1cm4gdGhpcy5pbnN0YW5jZTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBXb3JrZmxvdyBzZXQgdGhlIGluc3RhbmNlIGRhdGEuXHJcbiAqXHJcbiAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhIC0gdGhlIHdvcmtmbG93IHByb2Nlc3MgaW5zdGFuY2UgZGF0YVxyXG4gKlxyXG4gKiBAZXhhbXBsZSBcIlwiXHJcbiAqXHJcbiAqIEByZXR1cm4gXCJcIlxyXG4gKlxyXG4gKi9cclxuV29ya2Zsb3cucHJvdG90eXBlLnNldEluc3RhbmNlID0gZnVuY3Rpb24oZGF0YSl7XHJcblx0dGhpcy5pbnN0YW5jZSA9IGRhdGE7XHJcbn07XHJcblxyXG4vKipcclxuICogV29ya2Zsb3cgZ2V0IHN1Yi1wcm9jZXNzZXMgZGF0YS5cclxuICpcclxuICogQGV4YW1wbGUgXCJcIlxyXG4gKlxyXG4gKiBAcmV0dXJuIFwiXCJcclxuICpcclxuICovXHJcbldvcmtmbG93LnByb3RvdHlwZS5nZXRTdWJQcm9jZXNzZXMgPSBmdW5jdGlvbigpe1xyXG5cdHJldHVybiB0aGlzLnN1YnByb2Nlc3NlcztcclxufTtcclxuXHJcbi8qKlxyXG4gKiBXb3JrZmxvdyBzZXQgdGhlIHN1Yi1wcm9jZXNzZXMgZGF0YS5cclxuICpcclxuICogQHBhcmFtIHtPYmplY3R9IGRhdGEgLSB0aGUgd29ya2Zsb3cgcHJvY2VzcyBpbnN0YW5jZSBkYXRhXHJcbiAqXHJcbiAqIEBleGFtcGxlIFwiXCJcclxuICpcclxuICogQHJldHVybiBcIlwiXHJcbiAqXHJcbiAqL1xyXG5Xb3JrZmxvdy5wcm90b3R5cGUuc2V0U3ViUHJvY2Vzc2VzID0gZnVuY3Rpb24oZGF0YSl7XHJcblx0dGhpcy5zdWJwcm9jZXNzZXMgPSBkYXRhO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFdvcmtmbG93IGdldCBpbmRpY2F0b3Igc2V0IGRhdGEuXHJcbiAqXHJcbiAqIEBleGFtcGxlIFwiXCJcclxuICpcclxuICogQHJldHVybiBcIlwiXHJcbiAqXHJcbiAqL1xyXG5Xb3JrZmxvdy5wcm90b3R5cGUuZ2V0SW5kaWNhdG9ycyA9IGZ1bmN0aW9uKCl7XHJcblx0cmV0dXJuIHRoaXMuaW5kaWNhdG9ycztcclxufTtcclxuXHJcbi8qKlxyXG4gKiBXb3JrZmxvdyBzZXQgdGhlIGluZGljYXRvciBzZXQgZGF0YS5cclxuICpcclxuICogQHBhcmFtIHtPYmplY3R9IGRhdGEgLSB0aGUgd29ya2Zsb3cgcHJvY2VzcyBpbnN0YW5jZSBkYXRhXHJcbiAqXHJcbiAqIEBleGFtcGxlIFwiXCJcclxuICpcclxuICogQHJldHVybiBcIlwiXHJcbiAqXHJcbiAqL1xyXG5Xb3JrZmxvdy5wcm90b3R5cGUuc2V0SW5kaWNhdG9ycyA9IGZ1bmN0aW9uKGRhdGEpe1xyXG5cdHRoaXMuaW5kaWNhdG9ycyA9IGRhdGE7XHJcbn07XHJcblxyXG4vKipcclxuICogU2V0IHRoZSB2YXJpYWJsZSB2YWx1ZS5cclxuICpcclxuICogQHBhcmFtIHtzdHJpbmd9IHByb2Nlc3NJZCAtIHRoZSBXb3JrZmxvdyBjb25maWcgLyBkZWZpbml0aW9uIHByb2Nlc3MgaWRcclxuICogQHBhcmFtIHtudW1iZXJ9IHByb2Nlc3NTZXEgLSB0aGUgV29ya2Zsb3cgaW5zdGFuY2UgcHJvY2VzcyBzZXFcclxuICogQHBhcmFtIHtzdHJpbmd9IHN1YlByb2Nlc3NJZCAtIHRoZSBXb3JrZmxvdyBjb25maWcgLyBkZWZpbml0aW9uIHN1Yi1wcm9jZXNzIGlkXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBzdWJQcm9jZXNzU2VxIC0gdGhlIFdvcmtmbG93IGluc3RhbmNlIHN1Yi1wcm9jZXNzIHNlcVxyXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RlcElkIC0gdGhlIFdvcmtmbG93IGNvbmZpZyAvIGRlZmluaXRpb24gc3RlcCBpZFxyXG4gKiBAcGFyYW0ge09iamVjdH0gdmFyaWFibGUgLSB0aGUgV29ya2Zsb3cgdmFyaWFibGUgb2JqZWN0XHJcbiAqXHJcbiAqIEBleGFtcGxlICcnXHJcbiAqXHJcbiAqIEByZXR1cm4gJydcclxuICpcclxuICovXHJcbi8vIFdvcmtmbG93LnByb3RvdHlwZS5zZXRWYXJpYWJsZSA9IGZ1bmN0aW9uKHByb2Nlc3NJZCwgcHJvY2Vzc1NlcSwgc3ViUHJvY2Vzc0lkLCBzdWJQcm9jZXNzU2VxLCBzdGVwSWQsIHZhcmlhYmxlKXtcclxuLy8gXHR2YXIgX3RoaXMgPSB0aGlzO1xyXG4vLyBcdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuLy8gXHRcdHRyeSB7XHJcbi8vIFx0XHRcdFByb2Nlc3MuZ2V0VmFyaWFibGUocHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIHN0ZXBJZCwgdmFyaWFibGUpLnRoZW4oZnVuY2lvbihyZXN1bHQpe1xyXG4vLyBcdFx0XHRcdHJlc29sdmUocmVzdWx0LmRhdGEpO1xyXG4vLyBcdFx0XHR9LCBmdW5jdGlvbihlcnIpe1xyXG4vLyBcdFx0XHRcdHJlamVjdChlcnIpO1xyXG4vLyBcdFx0XHR9KVxyXG4vLyBcdFx0fSBjYXRjaCAoZXJyKSB7XHJcbi8vIFx0XHRcdHJlamVjdChlcnIpO1xyXG4vLyBcdFx0fVxyXG4vLyBcdH0pO1xyXG4vLyB9O1xyXG5cclxuLyoqXHJcbiAqIEdldCB0aGUgdmFyaWFibGUgdmFsdWUuXHJcbiAqXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBwcm9jZXNzSWQgLSB0aGUgV29ya2Zsb3cgY29uZmlnIC8gZGVmaW5pdGlvbiBwcm9jZXNzIGlkXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBwcm9jZXNzU2VxIC0gdGhlIFdvcmtmbG93IGluc3RhbmNlIHByb2Nlc3Mgc2VxXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdWJQcm9jZXNzSWQgLSB0aGUgV29ya2Zsb3cgY29uZmlnIC8gZGVmaW5pdGlvbiBzdWItcHJvY2VzcyBpZFxyXG4gKiBAcGFyYW0ge251bWJlcn0gc3ViUHJvY2Vzc1NlcSAtIHRoZSBXb3JrZmxvdyBpbnN0YW5jZSBzdWItcHJvY2VzcyBzZXFcclxuICogQHBhcmFtIHtzdHJpbmd9IHN0ZXBJZCAtIHRoZSBXb3JrZmxvdyBjb25maWcgLyBkZWZpbml0aW9uIHN0ZXAgaWRcclxuICogQHBhcmFtIHtzdHJpbmd9IGtleSAtIHRoZSBXb3JrZmxvdyB2YXJpYWJsZSBpZFxyXG4gKlxyXG4gKiBAZXhhbXBsZSAnJ1xyXG4gKlxyXG4gKiBAcmV0dXJuICcnXHJcbiAqXHJcbiAqL1xyXG4vLyBXb3JrZmxvdy5wcm90b3R5cGUuZ2V0VmFyaWFibGUgPSBmdW5jdGlvbihwcm9jZXNzSWQsIHByb2Nlc3NTZXEsIHN1YlByb2Nlc3NJZCwgc3ViUHJvY2Vzc1NlcSwgc3RlcElkLCBrZXkpe1xyXG4vLyBcdHZhciBfdGhpcyA9IHRoaXM7XHJcbi8vIFx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4vLyBcdFx0dHJ5IHtcclxuLy8gXHRcdFx0UHJvY2Vzcy5zZXRWYXJpYWJsZShwcm9jZXNzSWQsIHByb2Nlc3NTZXEsIHN1YlByb2Nlc3NJZCwgc3ViUHJvY2Vzc1NlcSwgc3RlcElkLCBrZXkpLnRoZW4oZnVuY2lvbihyZXN1bHQpe1xyXG4vLyBcdFx0XHRcdHJlc29sdmUocmVzdWx0LmRhdGEpO1xyXG4vLyBcdFx0XHR9LCBmdW5jdGlvbihlcnIpe1xyXG4vLyBcdFx0XHRcdHJlamVjdChlcnIpO1xyXG4vLyBcdFx0XHR9KVxyXG4vLyBcdFx0fSBjYXRjaCAoZXJyKSB7XHJcbi8vIFx0XHRcdHJlamVjdChlcnIpO1xyXG4vLyBcdFx0fVxyXG4vLyBcdH0pO1xyXG4vLyB9O1xyXG5cclxuLyoqXHJcbiAqIFRoaXMgbWV0aG9kIGNyZWF0ZXMgYSBuZXcgd29ya2Zsb3cgcHJvY2VzcyBpLmUuIGl0IGNyZWF0ZXMgYSB3b3JrZmxvdyBwcm9jZXNzZXMgaW5zdGFuY2VcclxuICogb2JqZWN0IHdpdGggdGhlIG1pbmltdW0gcmVxdWlyZWQgZGF0YS4gVGhpcyBpbnN0YW5jZSBjYW4gYmUgcmVmZXJlbmNlZCBpbiB0aGUgZm9sbG93aW5nXHJcbiAqIHdheSwgc2VlIGV4YW1wbGUgYmVsb3cuXHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqIHZhciBjb25maWcgPSB7ICdfaWQnOiAnYWJjMTIzJyB9O1xyXG4gKiB2YXIgd29ya2Zsb3cgPSBuZXcgV29ya2Zsb3coJzEyMzQnLCAnNTY3OCcsIGNvbmZpZyk7XHJcbiAqIHdvcmtmbG93LmNyZWF0ZSgpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KXtcclxuICpcdGNvbnNvbGUubG9nKHJlc3VsdC5tZXNzYWdlKTtcclxuICpcdC8vIFRoZSBmb2xsb3dpbmcgcHJvcGVydGllcyBjYW4gbm93IGJlIGFjY2Vzc2VkXHJcbiAqIFx0dmFyIHByb2ZpbGUgPSB3b3JrZmxvdy5wcm9maWxlO1xyXG4gKiBcdHZhciBhcHAgPSB3b3JrZmxvdy5hcHA7XHJcbiAqIFx0dmFyIGNvbmZpZyA9IHdvcmtmbG93LmNvbmZpZztcclxuICpcdC8vIE9uIHN1Y2Nlc3MgeW91IGNhbiBhY2Nlc3MgdGhlIGluc3RhbmNlIHRoZSBmb2xsb3dpbmcgd2F5XHJcbiAqXHR2YXIgaW5zdGFuY2UgPSB3b3JrZmxvdy5pbnN0YW5jZTtcclxuICogfSwgZnVuY3Rpb24oZXJyb3Ipe1xyXG4gKlx0Y29uc29sZS5sb2coZXJyb3IpO1xyXG4gKiB9KTtcclxuICpcclxuICogQHJldHVybiB7T2JqZWN0fSBuZXcgV29ya2Zsb3cgaW5zdGFuY2Ugd2l0aCB1cGRhdGVkIGluc3RhbmNlIGRhdGEuXHJcbiAqXHJcbiAqL1xyXG5Xb3JrZmxvdy5wcm90b3R5cGUuY3JlYXRlID0gZnVuY3Rpb24oKXtcclxuXHR2YXIgX3RoaXMgPSB0aGlzO1xyXG5cdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuXHRcdHRyeSB7XHJcblx0XHRcdGlmIChfdGhpcy5pbnN0YW5jZSAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRcdFx0dmFyIHdhcm4gPSB1dGlsLndhcm4oJ0luc3RhbmNlIGFscmVhZHkgZXhpc3RzLicsIF90aGlzKVxyXG5cdFx0XHRcdHJlc29sdmUod2Fybik7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0Ly8gQ3JlYXRlIHRoZSB3b3JrZmxvdyBwcm9jZXNzZXMgaW5zdGFuY2Ugb2JqZWN0XHJcblx0XHRcdFx0dmFyIG1vZGVsID0ge1xyXG5cdFx0XHRcdCAgICBfaWQ6ICcnLFxyXG5cdFx0XHRcdCAgICB2ZXJzaW9uOiAnJyxcclxuXHRcdFx0XHQgICAgdHlwZTogJ3dvcmtmbG93SW5zdGFuY2UnLFxyXG5cdFx0XHRcdCAgICBwcm9jZXNzZXM6IFtdLFxyXG5cdFx0XHRcdCAgICBjaGFubmVsczpbXHJcblx0XHRcdFx0ICAgIFx0XCJjb21tdW5pdHlfXCIrYXBwLlNDT1BFLmNvbW11bml0eUlkICxcclxuXHRcdFx0XHQgICAgXHRcInByb2ZpbGVfXCIrIGFwcC5TQ09QRS5wcm9maWxlSWQgLFxyXG5cdFx0XHRcdCAgICBcdFwiYXBwbGljYXRpb25fXCIrYXBwLlNDT1BFLmFwcGxpY2F0aW9uSWQsXHJcblx0XHRcdFx0ICAgIFx0XCJjb21tdW5pdHlfXCIrYXBwLlNDT1BFLmNvbW11bml0eUlkK1wiX2FwcGxpY2F0aW9uX1wiK2FwcC5TQ09QRS5hcHBsaWNhdGlvbklkXHJcblx0XHRcdFx0ICAgIF1cclxuXHRcdFx0XHR9O1xyXG5cdFx0XHRcdG1vZGVsLl9pZCA9IF90aGlzLnByb2ZpbGUgKyAnOnByb2Nlc3Nlcyc7XHJcblx0XHRcdFx0bW9kZWwudmVyc2lvbiA9IF90aGlzLmNvbmZpZy52ZXJzaW9uO1xyXG5cdFx0XHRcdF90aGlzLmluc3RhbmNlID0gbW9kZWw7XHJcblx0XHRcdFx0dmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ1dvcmtmbG93IHByb2Nlc3NlcyBpbnN0YW5jZSBjcmVhdGVkIHN1Y2Nlc3NmdWxseS4nLCBfdGhpcyk7XHJcblx0XHRcdFx0cmVzb2x2ZShzdWNjZXNzKTtcclxuXHJcblx0XHRcdH1cclxuXHRcdH0gY2F0Y2ggKGVycikge1xyXG5cdFx0XHRyZWplY3QoZXJyKTtcclxuXHRcdH1cclxuXHR9KTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBXb3JrZmxvdyBpbml0aWFsaXNlLCB0aGlzIGZ1bmN0aW9uIGV4ZWN1dGVzIGEgcHJvY2VzcyB3aXRoaW4gYSB3b3JrZmxvd1xyXG4gKiBjb25maWd1cmF0aW9uLlxyXG4gKlxyXG4gKiBAcGFyYW0ge3N0cmluZ30gcHJvY2Vzc0lkIC0gdGhlIHByb2Nlc3MgaWQgdG8gcHJvY2Vzc1xyXG4gKiBAcGFyYW0ge29iamVjdH0gW2RhdGFdIC0gdGhlIGlucHV0IGRhdGEgdG8gcHJvY2Vzc1xyXG4gKlxyXG4gKiBAZXhhbXBsZVxyXG4gKiBXb3JrZmxvdy5pbml0aWFsaXNlKCdwcm9jZXNzSWQnLCB7IHZhbGlkRGF0ZTogJ2RhdGUnIH0pO1xyXG4gKlxyXG4gKiBAcmV0dXJuIFwiXCJcclxuICpcclxuICovXHJcbldvcmtmbG93LnByb3RvdHlwZS5pbml0aWFsaXNlID0gZnVuY3Rpb24ocHJvY2Vzc0lkLCBkYXRhKXtcclxuXHR2YXIgX3RoaXMgPSB0aGlzO1xyXG5cdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuXHRcdHRyeSB7XHJcblx0XHRcdHZhciBjb25maWdQcm9jZXNzID0gW107XHJcblx0XHRcdC8vIENoZWNrIHRoZSBwYXNzZWQgaW4gcGFyYW1ldGVyc1xyXG5cdFx0XHRpZiAocHJvY2Vzc0lkICE9PSAnJyAmJiBwcm9jZXNzSWQgIT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRcdC8vIEdldCB0aGUgY3VycmVudCBwcm9jZXNzIGNvbmZpZ1xyXG5cdFx0XHRcdGNvbmZpZ1Byb2Nlc3MgPSBfdGhpcy5jb25maWcucHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihvYmpQcm9jZXNzKXtcclxuXHRcdFx0XHRcdGlmIChvYmpQcm9jZXNzLl9pZCA9PSBwcm9jZXNzSWQpIHtcclxuXHRcdFx0XHRcdFx0cmV0dXJuIG9ialByb2Nlc3M7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdFx0aWYgKGNvbmZpZ1Byb2Nlc3NbMF0uX2lkID09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRcdFx0dmFyIGVycm9yID0gdXRpbC5lcnJvcignV0ZDb25maWdFcnJvcicsICdObyB2YWxpZCBwcm9jZXNzIGRlZmluaXRpb24gZm91bmQgd2l0aCBwcm9jZXNzIGlkOiAnICsgcHJvY2Vzc0lkKTtcclxuXHRcdFx0XHRcdHJlamVjdChlcnJvcik7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdGNvbmZpZ1Byb2Nlc3MucHVzaChfdGhpcy5jb25maWcucHJvY2Vzc2VzWzBdKTtcclxuXHRcdFx0XHRwcm9jZXNzSWQgPSBfdGhpcy5jb25maWcucHJvY2Vzc2VzWzBdLl9pZDtcclxuXHRcdFx0fVxyXG5cdFx0XHQvLyBHZXQgdGhlIGN1cnJlbnQgbGlzdCBvZiBwcm9jZXNzIGluc3RhbmNlc1xyXG5cdFx0XHQvLyB2YXIgcHJvY2Vzc1NlcSA9IDE7XHJcblx0XHRcdHZhciBjdXJyZW50UHJvY2VzcyA9IFtdO1xyXG5cdFx0XHRfdGhpcy5pbnN0YW5jZS5wcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKHByb2Nlc3NJdGVtKXtcclxuXHRcdFx0XHRpZiAocHJvY2Vzc0l0ZW0uaWQgPT0gcHJvY2Vzc0lkKSB7XHJcblx0XHRcdFx0XHRjdXJyZW50UHJvY2Vzcy5wdXNoKHByb2Nlc3NJdGVtKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0pO1xyXG5cdFx0XHR2YXIgcHJvY2Vzc1NlcSA9IGN1cnJlbnRQcm9jZXNzLmxlbmd0aCArIDE7XHJcblx0XHRcdC8vIHZhciBuZXh0U2VxID0gcHJvY2Vzc1NlcSArIDE7XHJcblx0XHRcdC8vIFB1c2ggdGhlIHByb2Nlc3Mgb2JqZWN0IGludG8gdGhlIGFycmF5XHJcblx0XHRcdHZhciBwcm9jZXNzTW9kZWwgPSB7XHJcblx0XHRcdFx0aWQ6ICcnLFxyXG5cdFx0XHRcdHNlcTogJycsXHJcblx0XHRcdFx0c3ViUHJvY2Vzc2VzOiBbXSxcclxuXHRcdFx0fVxyXG5cdFx0XHQvLyAxLiBVcGRhdGUgdGhlIHByb2Nlc3MgaWQgYW5kIHNlcVxyXG5cdFx0XHRwcm9jZXNzTW9kZWwuaWQgPSBwcm9jZXNzSWQ7XHJcblx0XHRcdHByb2Nlc3NNb2RlbC5zZXEgPSBwcm9jZXNzU2VxO1xyXG5cdFx0XHRfdGhpcy5pbnN0YW5jZS5wcm9jZXNzZXMucHVzaChwcm9jZXNzTW9kZWwpO1xyXG5cdFx0XHQvLyBQYXJhbWV0ZXJzXHJcblx0XHRcdHZhciBzdWJQcm9jZXNzSWQgPSBjb25maWdQcm9jZXNzWzBdLnN1YlByb2Nlc3Nlc1swXS5faWQ7XHJcblx0XHRcdHZhciBzdWJQcm9jZXNzU2VxID0gMTtcclxuXHRcdFx0X3RoaXMuaW5zdGFuY2UucHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihwcm9jZXNzSXRlbSl7XHJcblx0XHRcdFx0aWYgKHByb2Nlc3NJdGVtLmlkID09IHByb2Nlc3NJZCAmJiBwcm9jZXNzSXRlbS5zZXEgPT0gcHJvY2Vzc1NlcSkge1xyXG5cdFx0XHRcdFx0c3ViUHJvY2Vzc1NlcSA9IHByb2Nlc3NJdGVtLnN1YlByb2Nlc3Nlcy5sZW5ndGggKyAxXHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9KVxyXG5cdFx0XHQvLyBDYWxsIHRoZSBzdWJwcm9jZXNzIG1ldGhvZFxyXG5cdFx0XHRcclxuXHRcdFx0XHJcblxyXG5cdFx0XHRQcm9jZXNzLnN1YlByb2Nlc3MocHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIGRhdGEsIF90aGlzKS50aGVuKGZ1bmN0aW9uKHN1YlByb2Nlc3Mpe1xyXG5cdFx0XHRcdC8vIEdlbmVyYXRlIHRoZSB1dWlkXHJcblx0XHRcdFx0XHJcblxyXG5cdFx0XHRcdHZhciB1dWlkID0gX3RoaXMucHJvZmlsZSArICc6JyArIF90aGlzLmFwcCArICc6JyArIHByb2Nlc3NJZCArICc6JyArIHByb2Nlc3NTZXEgKyAnOicgKyBzdWJQcm9jZXNzSWQgKyAnOicgKyBzdWJQcm9jZXNzU2VxO1xyXG5cdFx0XHRcdHZhciBsYWJlbCA9IGRhdGEubGFiZWw7XHJcblx0XHRcdFx0Ly8gQnVpbGQgdGhlIHN1Yi1wcm9jZXNzIHJlZmVyZW5jZSBvYmplY3RcclxuXHJcblx0XHRcdFx0Ly9UT0RPOiBDaGFuZ2UgcmVxdWlyZWQgdG8gbW92ZSBpc0FjdGl2ZSB0byBzdWJQcm9jZXNzIGZpbGUuUmVtb3ZlIGZyb20gaGVyZVxyXG5cclxuXHJcblx0XHRcdFx0dmFyIHN1YlByb2Nlc3NSZWYgPSB7XHJcblx0XHRcdFx0XHRpZDogc3ViUHJvY2Vzc0lkLFxyXG5cdFx0XHRcdFx0c2VxOiBzdWJQcm9jZXNzU2VxLFxyXG5cdFx0XHRcdFx0dXVpZDogdXVpZCxcclxuXHRcdFx0XHRcdGxhYmVsOmxhYmVsXHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdC8vIEFkZCB0aGUgcmVmZXJlbmNlIHRvIHRoZSBwcm9jZXNzIG1vZGVsXHJcblx0XHRcdFx0cHJvY2Vzc01vZGVsLnN1YlByb2Nlc3Nlcy5wdXNoKHN1YlByb2Nlc3NSZWYpO1xyXG5cdFx0XHRcdC8vIEFkZCB0aGUgc3ViUHJvY2VzcyBtb2RlbCB0byB0aGUgc3VicHJvY2Vzc2VzIGFycmF5XHJcblx0XHRcdFx0Ly9fdGhpcy5zdWJwcm9jZXNzZXMucHVzaChzdWJQcm9jZXNzLmRhdGEpO1xyXG5cdFx0XHRcdC8vIF90aGlzLmluc3RhbmNlLnByb2Nlc3Nlcy5wdXNoKHByb2Nlc3NNb2RlbCk7XHJcblx0XHRcdFx0Zm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IF90aGlzLmluc3RhbmNlLnByb2Nlc3Nlcy5sZW5ndGg7IGluZGV4Kyspe1xyXG5cdFx0XHRcdFx0dmFyIHByb2Nlc3NJdGVtID0gX3RoaXMuaW5zdGFuY2UucHJvY2Vzc2VzW2luZGV4XTtcclxuXHRcdFx0XHRcdGlmIChwcm9jZXNzSXRlbS5pZCA9PSBwcm9jZXNzSWQgJiYgcHJvY2Vzc0l0ZW0uc2VxID09IHByb2Nlc3NTZXEpIHtcclxuXHRcdFx0XHRcdFx0Ly8gUmVtb3ZlIHRoZSBjdXJyZW50IHByb2Nlc3MgZnJvbSB0aGUgYXJyYXkgYW5kIGFkZCB0aGUgdXBkYXRlZCBwcm9jZXNzTW9kZWxcclxuXHRcdFx0XHRcdFx0X3RoaXMuaW5zdGFuY2UucHJvY2Vzc2VzLnNwbGljZShpbmRleCwgMSwgcHJvY2Vzc01vZGVsKVxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cdFxyXG5cdFx0XHRcdC8vIFByb2Nlc3MgdGhlIGluZGljYXRvciBkb2N1bWVudHMgd29ya2Zsb3cgcHJvY2Vzc2VzIHVwZGF0ZXNcclxuXHRcdFx0XHR2YXIgaW5kaWNhdG9ycyA9IHN1YlByb2Nlc3MuZGF0YS5pbmRpY2F0b3JzO1xyXG5cdFx0XHRcdHZhciBzdGVwID0gc3ViUHJvY2Vzcy5kYXRhLnN0ZXA7XHJcblx0XHRcdFx0UHJvY2Vzcy5pbmRpY2F0b3JEb2NzKHByb2Nlc3NJZCwgaW5kaWNhdG9ycywgc3RlcCwgX3RoaXMpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KXtcclxuXHRcdFx0XHRcdHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdQcm9jZXNzOiAnICsgX3RoaXMuY29uZmlnLnByb2Nlc3Nlc1swXS5faWQgKyAnIGluaXRpYWxpemVkIHN1Y2Nlc3NmdWxseS4nLCBfdGhpcyk7XHJcblx0XHRcdFx0XHRyZXNvbHZlKHN1Y2Nlc3MpO1xyXG5cdFx0XHRcdH0sIGZ1bmN0aW9uKGVycil7XHJcblx0XHRcdFx0XHRyZWplY3QoZXJyKTtcclxuXHRcdFx0XHR9KVxyXG5cclxuXHJcblx0XHRcdFx0XHJcblxyXG5cclxuXHJcblxyXG5cdFx0XHR9LCBmdW5jdGlvbihlcnIpe1xyXG5cdFx0XHRcdF90aGlzLmluc3RhbmNlLnByb2Nlc3NlcyA9IF90aGlzLmluc3RhbmNlLnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24oIG9iaiApIHtcclxuXHRcdFx0XHRcdHJldHVybiAhKG9iai5pZCA9PSBwcm9jZXNzSWQgJiYgb2JqLnNlcSA9PSBwcm9jZXNzU2VxKTtcclxuXHRcdFx0XHR9KTtcclxuXHRcdFx0XHRjb25zb2xlLmxvZyhlcnIpO1xyXG5cdFx0XHRcdHJlamVjdChlcnIpO1xyXG5cdFx0XHR9KTtcclxuXHRcdH0gY2F0Y2goZXJyKSB7XHJcblx0XHRcdHJlamVjdChlcnIpO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFdvcmtmbG93IHRyYW5zaXRpb24gdG8gdGhlIG5leHQgc3RlcC4gVGhpcyBtb3ZlcyB0aGUgd29ya2Zsb3cgZnJvbSB0aGUgY3VycmVudCBwcm9jZXNzLFxyXG4gKiBzdWItcHJvY2VzcyBzdGVwIHRvIHRoZSBuZXh0IG9uZSBhcyBzcGVjaWZpZWQuXHJcbiAqXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBwcm9jZXNzSWQgLSB0aGUgV29ya2Zsb3cgY29uZmlnIC8gZGVmaW5pdGlvbiBwcm9jZXNzIGlkXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBwcm9jZXNzU2VxIC0gdGhlIFdvcmtmbG93IGluc3RhbmNlIHByb2Nlc3Mgc2VxXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdWJQcm9jZXNzSWQgLSB0aGUgV29ya2Zsb3cgY29uZmlnIC8gZGVmaW5pdGlvbiBzdWItcHJvY2VzcyBpZFxyXG4gKiBAcGFyYW0ge251bWJlcn0gc3ViUHJvY2Vzc1NlcSAtIHRoZSBXb3JrZmxvdyBpbnN0YW5jZSBzdWItcHJvY2VzcyBzZXFcclxuICogQHBhcmFtIHtzdHJpbmd9IHN0ZXBJZCAtIHRoZSBXb3JrZmxvdyBjb25maWcgLyBkZWZpbml0aW9uIHN0ZXAgaWRcclxuICogQHBhcmFtIHtzdHJpbmd9IHRyYW5zaXRpb25JZCAtIHRoZSBXb3JrZmxvdyBjb25maWcgLyBkZWZpbml0aW9uIHRyYW5zaXRpb24gaWRcclxuICogQHBhcmFtIHtvYmplY3R9IGRhdGEgLSBhbnkgYWRkaXRpb25hbCBkYXRhIHBhc3NlZCBpbiBhcyBrZXkgdmFsdWUgcGFpcnNcclxuICpcclxuICogQGV4YW1wbGVcclxuICogV29ya2Zsb3cudHJhbnNpdGlvbigncHJvY2Vzc0lkJywgMSwgJ3N1YlByb2Nlc3NJZCcsIDEsICdzdGVwSWQnLCAndHJhbnNpdGlvbklkJywgeyBrZXk6ICcnLCB2YWx1ZTogJycgfSk7XHJcbiAqXHJcbiAqIEByZXR1cm4gXCJcIlxyXG4gKlxyXG4gKi9cclxuV29ya2Zsb3cucHJvdG90eXBlLnRyYW5zaXRpb24gPSBmdW5jdGlvbihwcm9jZXNzSWQsIHByb2Nlc3NTZXEsIHN1YlByb2Nlc3NJZCwgc3ViUHJvY2Vzc1NlcSwgc3RlcElkLCB0cmFuc2l0aW9uSWQsIGRhdGEpe1xyXG5cdC8vIFJlLWFzc2lnbiB0aGlzXHJcblx0dmFyIF90aGlzID0gdGhpcztcclxuXHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcblx0XHR0cnkge1xyXG5cdFx0XHRQcm9jZXNzLnRyYW5zaXRpb24ocHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIHN0ZXBJZCwgdHJhbnNpdGlvbklkLCBkYXRhLCBfdGhpcykudGhlbihmdW5jdGlvbihyZXN1bHQpe1xyXG5cclxuXHRcdFx0XHRcclxuXHRcdFx0XHQvLyBVcGRhdGUgdGhlIGN1cnJlbnQgc3ViLXByb2Nlc3Mgc3RlcCBkYXRhXHJcblx0XHRcdFx0dmFyIHVwZGF0ZSA9IGZ1bmN0aW9uKHR5cGUpe1xyXG5cdFx0XHRcdFx0X3RoaXMuaW5zdGFuY2UucHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihwcm9jZXNzSXRlbSl7XHJcblx0XHRcdFx0XHRcdGlmIChwcm9jZXNzSXRlbS5pZCA9PSBwcm9jZXNzSWQgJiYgcHJvY2Vzc0l0ZW0uc2VxID09IHByb2Nlc3NTZXEpIHtcclxuXHJcblx0XHRcdFx0XHRcdFx0XHJcblx0XHRcdFx0XHRcdFx0cHJvY2Vzc0l0ZW0uc3ViUHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihzdWJQcm9jZXNzSXRlbSl7XHJcblx0XHRcdFx0XHRcdFx0XHRpZiAoc3ViUHJvY2Vzc0l0ZW0uaWQgPT0gc3ViUHJvY2Vzc0lkICYmIHN1YlByb2Nlc3NJdGVtLnNlcSA9PSBzdWJQcm9jZXNzU2VxKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFxyXG5cclxuXHRcdFx0XHRcdFx0XHRcdFx0X3RoaXMuc3VicHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihzdWJQcm9jZXNzT2JqKXtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAoc3ViUHJvY2Vzc09iai5faWQgPT0gc3ViUHJvY2Vzc0l0ZW0udXVpZCkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRpZiAodHlwZSA9PSAnc3RlcCcpIHtcclxuXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdHN1YlByb2Nlc3NPYmouc3RlcCA9IHJlc3VsdC5kYXRhO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHR2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcyhyZXN1bHQubWVzc2FnZSwgc3ViUHJvY2Vzc09iaik7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFxyXG5cclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0cmVzb2x2ZShzdWNjZXNzKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAodHlwZSA9PSAnc3RlcENvbXBsZXRlJykge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRzdWJQcm9jZXNzT2JqLnN0ZXAgPSByZXN1bHQuZGF0YS5zdGVwO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRzdWJQcm9jZXNzT2JqLmNvbXBsZXRlID0gdHJ1ZVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHR2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcyhyZXN1bHQubWVzc2FnZSwgc3ViUHJvY2Vzc09iaik7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRyZXNvbHZlKHN1Y2Nlc3MpO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdFx0fSlcclxuXHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHR9KVxyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9KVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRpZiAocmVzdWx0LmRhdGEuc3ViUHJvY2Vzc0NvbXBsZXRlKSB7XHJcblx0XHRcdFx0XHRcclxuXHRcdFx0XHRcdHVwZGF0ZSgnc3RlcENvbXBsZXRlJyk7XHJcblx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0dXBkYXRlKCdzdGVwJyk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9LCBmdW5jdGlvbihlcnIpe1xyXG5cdFx0XHRcdFxyXG5cdFx0XHRcdHJlamVjdChlcnIpO1xyXG5cdFx0XHR9KTtcclxuXHRcdH0gY2F0Y2goZXJyKSB7XHJcblx0XHRcdFxyXG5cdFx0XHRyZWplY3QoZXJyKTtcclxuXHRcdH1cclxuXHR9KTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBXb3JrZmxvdyBhc3NpZ24gdXNlci5cclxuICpcclxuICogQHBhcmFtIHtzdHJpbmd9IHByb2Nlc3NJZCAtIHRoZSBXb3JrZmxvdyBjb25maWcgLyBkZWZpbml0aW9uIHByb2Nlc3MgaWRcclxuICogQHBhcmFtIHtudW1iZXJ9IHByb2Nlc3NTZXEgLSB0aGUgV29ya2Zsb3cgaW5zdGFuY2UgcHJvY2VzcyBzZXFcclxuICogQHBhcmFtIHtzdHJpbmd9IHN1YlByb2Nlc3NJZCAtIHRoZSBXb3JrZmxvdyBjb25maWcgLyBkZWZpbml0aW9uIHN1Yi1wcm9jZXNzIGlkXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBzdWJQcm9jZXNzU2VxIC0gdGhlIFdvcmtmbG93IGluc3RhbmNlIHN1Yi1wcm9jZXNzIHNlcVxyXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RlcElkIC0gdGhlIFdvcmtmbG93IGNvbmZpZyAvIGRlZmluaXRpb24gc3RlcCBpZFxyXG4gKiBAcGFyYW0ge29iamVjdH0gdXNlciAtIHRoZSB1c2VyIGlkIGFuZCBuYW1lIGRhdGFcclxuICpcclxuICogQGV4YW1wbGUgXCJcIlxyXG4gKlxyXG4gKiBAcmV0dXJuIFwiXCJcclxuICpcclxuICovXHJcbldvcmtmbG93LnByb3RvdHlwZS5hc3NpZ25Vc2VyID0gZnVuY3Rpb24ocHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIHVzZXIpe1xyXG5cdC8vIFJlLWFzc2lnbiB0aGUgV29ya2Zsb3cgY29uc3RydWN0b3IgaW5zdGFuY2UgYXMgX3RoaXNcclxuXHR2YXIgX3RoaXMgPSB0aGlzO1xyXG5cdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuXHRcdHRyeSB7XHJcblx0XHRcdFByb2Nlc3MuYXNzaWduVXNlcihwcm9jZXNzSWQsIHByb2Nlc3NTZXEsIHN1YlByb2Nlc3NJZCwgc3ViUHJvY2Vzc1NlcSwgdXNlciwgX3RoaXMpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KXtcclxuXHRcdFx0XHRyZXNvbHZlKHJlc3VsdCk7XHJcblx0XHRcdH0sIGZ1bmN0aW9uKGVycil7XHJcblx0XHRcdFx0cmVqZWN0KGVycik7XHJcblx0XHRcdH0pXHJcblx0XHR9IGNhdGNoKGVycikge1xyXG5cdFx0XHRyZWplY3QoZXJyKTtcclxuXHRcdH1cclxuXHR9KVxyXG59O1xyXG5cclxuLyoqXHJcbiAqIFdvcmtmbG93IHRhc2ssIHRoaXMgbWV0aG9kIGV4ZWN1dGVzIGEgc3BlY2lmaWMgdGFzay5cclxuICpcclxuICogQHBhcmFtIHtzdHJpbmd9IHByb2Nlc3NJZCAtIHRoZSBwcm9jZXNzIGlkIHRvIHByb2Nlc3NcclxuICogQHBhcmFtIHtvYmplY3R9IGlucHV0RGF0YSAtIHRoZSBpbnB1dCBkYXRhIHRvIHByb2Nlc3NcclxuICpcclxuICogQGV4YW1wbGVcclxuICogV29ya2Zsb3cuaW5pdGlhbGl6ZSgncHJvY2Vzc0lkJywgeyB2YWxpZERhdGU6ICdkYXRlJyB9KTtcclxuICpcclxuICogQHJldHVybiBcIlwiXHJcbiAqXHJcbiAqL1xyXG5Xb3JrZmxvdy5wcm90b3R5cGUudWkgPSBmdW5jdGlvbigpe1xyXG5cdC8vIFJlLWFzc2lnbiB0aGUgV29ya2Zsb3cgY29uc3RydWN0b3IgaW5zdGFuY2UgYXMgX3RoaXNcclxuXHR2YXIgX3RoaXMgPSB0aGlzO1xyXG5cdHJldHVybiB7XHJcblx0XHRnZXRQcm9jZXNzOiBmdW5jdGlvbihwcm9jZXNzSWQsIGxhbmcpe1xyXG5cdFx0XHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcblx0XHRcdFx0dHJ5IHtcclxuXHRcdFx0XHRcdHVzZXJJbnRlcmZhY2UuZ2V0UHJvY2Vzcyhwcm9jZXNzSWQsIGxhbmcsIF90aGlzKS50aGVuKGZ1bmN0aW9uKG1vZGVsKXtcclxuXHRcdFx0XHRcdFx0cmVzb2x2ZShtb2RlbCk7XHJcblx0XHRcdFx0XHR9LCBmdW5jdGlvbihlcnIpe1xyXG5cdFx0XHRcdFx0XHRyZWplY3QoZXJyKTtcclxuXHRcdFx0XHRcdH0pXHJcblx0XHRcdFx0fSBjYXRjaChlcnIpIHtcclxuXHRcdFx0XHRcdHJlamVjdChlcnIpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSlcclxuXHRcdH1cclxuXHR9XHJcbn07XHJcblxyXG5cclxuXHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IFdvcmtmbG93O1xyXG4iLCIndXNlIHN0cmljdCc7XHJcblxyXG52YXIgdXRpbCA9IHJlcXVpcmUoJ3V0aWxpdHknKTtcclxudmFyIG5vZGVWYWx1ZSA9IHJlcXVpcmUoJy4vbm9kZVZhbHVlJyk7XHJcblxyXG4vKipcclxuICogQWN0aW9ucyBNb2R1bGVcclxuICpcclxuICogQG1vZHVsZSBsaWIvYWN0aW9uc1xyXG4gKiBAYXV0aG9yIEhhc2FuIEFiYmFzXHJcbiAqIEB2ZXJzaW9uIDIuMC4wXHJcbiAqIEBkZXNjcmlwdGlvbiB0ZXN0IGRlc2NyaXB0aW9uXHJcbiAqIEBjb3B5cmlnaHQgS3dhbnR1IEx0ZCBSU0EgMjAwOS0yMDE1LlxyXG4gKlxyXG4gKi9cclxuXHJcblxyXG52YXIgY29tbXVuaXR5ID0gKGZ1bmN0aW9uKCkge1xyXG5cclxuICAgIHJldHVybiB7XHJcblxyXG4gICAgICAgIGNyZWF0ZUNvbW11bml0eTogZnVuY3Rpb24oX2RlZiwgdXVpZCwgX1dGSW5zdGFuY2UpIHtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgd29ya2VyT2JqZWN0ID0gd29ya2VyLmdldFdvcmtlcldyYXBwZXIoKTtcclxuXHJcbiAgICAgICAgICAgICAgICB3b3JrZXJPYmplY3QuX2lkID0gZ2VuZXJhdGVVVUlEKCk7XHJcbiAgICAgICAgICAgICAgICB3b3JrZXJPYmplY3QuY29tbXVuaXR5SWQgPSBhcHAuU0NPUEUuY29tbXVuaXR5SWQ7XHJcbiAgICAgICAgICAgICAgICB3b3JrZXJPYmplY3QuYXBwbGljYXRpb25JZCA9IGFwcC5TQ09QRS5hcHBsaWNhdGlvbklkO1xyXG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0LmNyZWF0ZWREYXRlVGltZSA9IG5ldyBEYXRlKCkudG9TdHJpbmcoKTtcclxuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5zZW5kZXJVc2VySWQgPSBMT0NBTF9TRVRUSU5HUy5TVUJTQ1JJUFRJT05TLnVzZXJJZDtcclxuICAgICAgICAgICAgICAgIHZhciB1dWlkID0gSlNPTi54cGF0aChcIi9pbmRpY2F0b3JzW2NhdGVnb3J5L3Rlcm0gZXEgJ0NvbW11bml0eSddL19pZFwiLCBfV0ZJbnN0YW5jZSwge30pWzBdO1xyXG4gICAgICAgICAgICAgICAgdmFyIGFjdGlvbiA9IHtcclxuICAgICAgICAgICAgICAgICAgICBcImNyZWF0ZUNvbW11bml0eVwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwibmV3Q29tbXVuaXR5SWRcIjogX1dGSW5zdGFuY2UucHJvZmlsZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJpbmRpY2F0b3JVVUlEXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiQ29tbXVuaXR5XCI6IHV1aWRcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB3b3JrZXJPYmplY3QuYWN0aW9uID0gYWN0aW9uO1xyXG4gICAgICAgICAgICAgICAgd29ya2VyLnNlbmQod29ya2VyT2JqZWN0KS50aGVuKGZ1bmN0aW9uKHdvcmtlclN1Y2Nlc3MpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ1dvcmtlciBwcm9jZXNzZWQgc3VjY2Vzc2Z1bGx5LicsIHdvcmtlclN1Y2Nlc3MpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24od29ya2VyRmFpbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdCh3b3JrZXJGYWlsKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHVzZXJKb2luQ29tbXVuaXR5OiBmdW5jdGlvbihfZGVmLCB1dWlkLCBfV0ZJbnN0YW5jZSkge1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgcmVsZWFzZUFkb3B0ZWRBcHBsaWNhdGlvbjogZnVuY3Rpb24oX2RlZiwgdXVpZCwgX1dGSW5zdGFuY2UpIHtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgd29ya2VyT2JqZWN0ID0gd29ya2VyLmdldFdvcmtlcldyYXBwZXIoKTtcclxuXHJcbiAgICAgICAgICAgICAgICB3b3JrZXJPYmplY3QuX2lkID0gZ2VuZXJhdGVVVUlEKCk7XHJcbiAgICAgICAgICAgICAgICB3b3JrZXJPYmplY3QuY29tbXVuaXR5SWQgPSBhcHAuU0NPUEUuY29tbXVuaXR5SWQ7XHJcbiAgICAgICAgICAgICAgICB3b3JrZXJPYmplY3QuYXBwbGljYXRpb25JZCA9IGFwcC5TQ09QRS5hcHBsaWNhdGlvbklkO1xyXG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0LmNyZWF0ZWREYXRlVGltZSA9IG5ldyBEYXRlKCkudG9TdHJpbmcoKTtcclxuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5zZW5kZXJVc2VySWQgPSBMT0NBTF9TRVRUSU5HUy5TVUJTQ1JJUFRJT05TLnVzZXJJZDtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgdXVpZFJlbGVhc2VBZG9wdGVkQXBwbGljYXRpb24gPSBKU09OLnhwYXRoKFwiL2luZGljYXRvcnNbY2F0ZWdvcnkvdGVybSBlcSAnYWRvcHRlZEFwcGxpY2F0aW9uJ10vX2lkXCIsIF9XRkluc3RhbmNlLCB7fSlbMF07XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGFjdGlvbiA9IHtcclxuICAgICAgICAgICAgICAgICAgICBcInJlbGVhc2VBZG9wdGVkQXBwbGljYXRpb25cIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImNvbW11bml0eUlkXCI6IF9XRkluc3RhbmNlLnByb2ZpbGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiaW5kaWNhdG9yVVVJRFwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImFkb3B0ZWRBcHBsaWNhdGlvblwiOiB1dWlkUmVsZWFzZUFkb3B0ZWRBcHBsaWNhdGlvblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5hY3Rpb24gPSBhY3Rpb247XHJcbiAgICAgICAgICAgICAgICB3b3JrZXIuc2VuZCh3b3JrZXJPYmplY3QpLnRoZW4oZnVuY3Rpb24od29ya2VyU3VjY2Vzcykge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnV29ya2VyIHByb2Nlc3NlcyBzdWNjZXNzZnVsbHkuJywgd29ya2VyU3VjY2Vzcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcclxuXHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbih3b3JrZXJGYWlsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHdvcmtlckZhaWwpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG59KSgpO1xyXG5cclxudmFyIGFwcGxpY2F0aW9uID0gKGZ1bmN0aW9uKCkge1xyXG5cclxuICAgIHJldHVybiB7XHJcblxyXG4gICAgICAgIGNyZWF0ZUFwcERlZmluaXRpb246IGZ1bmN0aW9uKF9kZWYsIHV1aWQsIF9XRkluc3RhbmNlKSB7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHdvcmtlck9iamVjdCA9IHdvcmtlci5nZXRXb3JrZXJXcmFwcGVyKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0Ll9pZCA9IGdlbmVyYXRlVVVJRCgpO1xyXG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0LmNvbW11bml0eUlkID0gYXBwLlNDT1BFLmNvbW11bml0eUlkO1xyXG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0LmFwcGxpY2F0aW9uSWQgPSBhcHAuU0NPUEUuYXBwbGljYXRpb25JZDtcclxuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5jcmVhdGVkRGF0ZVRpbWUgPSBuZXcgRGF0ZSgpLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgICAgICAgICB3b3JrZXJPYmplY3Quc2VuZGVyVXNlcklkID0gTE9DQUxfU0VUVElOR1MuU1VCU0NSSVBUSU9OUy51c2VySWQ7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHV1aWQgPSBKU09OLnhwYXRoKFwiL2luZGljYXRvcnNbY2F0ZWdvcnkvdGVybSBlcSAnQXBwbGljYXRpb24nXS9faWRcIiwgX1dGSW5zdGFuY2UsIHt9KVswXTtcclxuICAgICAgICAgICAgICAgIHZhciBhY3Rpb24gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgXCJjcmVhdGVBcHBsaWNhdGlvblwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwibmV3QXBwbGljYXRpb25JZFwiOiBfV0ZJbnN0YW5jZS5wcm9maWxlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImluZGljYXRvclVVSURcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJBcHBsaWNhdGlvblwiOiB1dWlkXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0LmFjdGlvbiA9IGFjdGlvbjtcclxuICAgICAgICAgICAgICAgIHdvcmtlci5zZW5kKHdvcmtlck9iamVjdCkudGhlbihmdW5jdGlvbih3b3JrZXJTdWNjZXNzKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdXb3JrZXIgcHJvY2Vzc2VzIHN1Y2Nlc3NmdWxseS4nLCB3b3JrZXJTdWNjZXNzKTtcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xyXG5cclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKHdvcmtlckZhaWwpIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3Qod29ya2VyRmFpbCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIGJ1aWxkQXBwbGljYXRpb246IGZ1bmN0aW9uKF9kZWYsIHV1aWQsIF9XRkluc3RhbmNlKSB7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHdvcmtlck9iamVjdCA9IHdvcmtlci5nZXRXb3JrZXJXcmFwcGVyKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0Ll9pZCA9IGdlbmVyYXRlVVVJRCgpO1xyXG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0LmNvbW11bml0eUlkID0gYXBwLlNDT1BFLmNvbW11bml0eUlkO1xyXG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0LmFwcGxpY2F0aW9uSWQgPSBhcHAuU0NPUEUuYXBwbGljYXRpb25JZDtcclxuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5jcmVhdGVkRGF0ZVRpbWUgPSBuZXcgRGF0ZSgpLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgICAgICAgICB3b3JrZXJPYmplY3Quc2VuZGVyVXNlcklkID0gTE9DQUxfU0VUVElOR1MuU1VCU0NSSVBUSU9OUy51c2VySWQ7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHV1aWRQdWJsaXNoQXBwbGljYXRpb24gPSBKU09OLnhwYXRoKFwiL3N1YnByb2Nlc3Nlc1tfaWQgZXEgJ1wiICsgdXVpZCArIFwiJ10vaW5kaWNhdG9yc1tpZCBlcSAnUHVibGlzaEFwcGxpY2F0aW9uJ10vaW5zdGFuY2VzWzFdL3V1aWRcIiwgYXBwLlNDT1BFLndvcmtmbG93LCB7fSlbMF07XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHV1aWRBcHBsaWNhdGlvbkRlZmluaXRpb24gPSBKU09OLnhwYXRoKFwiL2luZGljYXRvcnNbY2F0ZWdvcnkvdGVybSBlcSAnQXBwbGljYXRpb25EZWZpbml0aW9uJ10vX2lkXCIsIF9XRkluc3RhbmNlLCB7fSlbMF07XHJcbiAgICAgICAgICAgICAgICB2YXIgdXVpZFJvbGVzID0gSlNPTi54cGF0aChcIi9pbmRpY2F0b3JzW2NhdGVnb3J5L3Rlcm0gZXEgJ1JvbGVzJ10vX2lkXCIsIF9XRkluc3RhbmNlLCB7fSlbMF07XHJcbiAgICAgICAgICAgICAgICB2YXIgdXVpZEFwcGxpY2F0aW9uID0gSlNPTi54cGF0aChcIi9pbmRpY2F0b3JzW2NhdGVnb3J5L3Rlcm0gZXEgJ0FwcGxpY2F0aW9uJ10vX2lkXCIsIF9XRkluc3RhbmNlLCB7fSlbMF07XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGFjdGlvbiA9IHtcclxuICAgICAgICAgICAgICAgICAgICBcImJ1aWxkQXBwbGljYXRpb25cIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImFwcGxpY2F0aW9uSWRcIjogX1dGSW5zdGFuY2UucHJvZmlsZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJpbmRpY2F0b3JVVUlEXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiUHVibGlzaEFwcGxpY2F0aW9uXCI6IHV1aWRQdWJsaXNoQXBwbGljYXRpb24sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIkFwcGxpY2F0aW9uRGVmaW5pdGlvblwiOiB1dWlkQXBwbGljYXRpb25EZWZpbml0aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJSb2xlc1wiOiB1dWlkUm9sZXMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIkFwcGxpY2F0aW9uXCI6IHV1aWRBcHBsaWNhdGlvblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5hY3Rpb24gPSBhY3Rpb247XHJcbiAgICAgICAgICAgICAgICB3b3JrZXIuc2VuZCh3b3JrZXJPYmplY3QpLnRoZW4oZnVuY3Rpb24od29ya2VyU3VjY2Vzcykge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnV29ya2VyIHByb2Nlc3NlcyBzdWNjZXNzZnVsbHkuJywgd29ya2VyU3VjY2Vzcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcclxuXHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbih3b3JrZXJGYWlsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHdvcmtlckZhaWwpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBhcHBsaWNhdGlvbkFkb3B0aW9uOiBmdW5jdGlvbihfZGVmLCB1dWlkLCBfV0ZJbnN0YW5jZSkge1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciB3b3JrZXJPYmplY3QgPSB3b3JrZXIuZ2V0V29ya2VyV3JhcHBlcigpO1xyXG5cclxuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5faWQgPSBnZW5lcmF0ZVVVSUQoKTtcclxuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5jb21tdW5pdHlJZCA9IGFwcC5TQ09QRS5jb21tdW5pdHlJZDtcclxuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5hcHBsaWNhdGlvbklkID0gYXBwLlNDT1BFLmFwcGxpY2F0aW9uSWQ7XHJcbiAgICAgICAgICAgICAgICB3b3JrZXJPYmplY3QuY3JlYXRlZERhdGVUaW1lID0gbmV3IERhdGUoKS50b1N0cmluZygpO1xyXG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0LnNlbmRlclVzZXJJZCA9IExPQ0FMX1NFVFRJTkdTLlNVQlNDUklQVElPTlMudXNlcklkO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciB1dWlkQWRvcHRpb24gPSBKU09OLnhwYXRoKFwiL3N1YnByb2Nlc3Nlc1tfaWQgZXEgJ1wiICsgdXVpZCArIFwiJ10vaW5kaWNhdG9yc1tpZCBlcSAnQWRvcHRpb24nXS9pbnN0YW5jZXNbMV0vdXVpZFwiLCBhcHAuU0NPUEUud29ya2Zsb3csIHt9KVswXTtcclxuXHJcblxyXG5cclxuICAgICAgICAgICAgICAgIHZhciB1dWlkUHVibGlzaEFwcGxpY2F0aW9uID0gSlNPTi54cGF0aChcIi9pbmRpY2F0b3JzW2NhdGVnb3J5L3Rlcm0gZXEgJ1B1Ymxpc2hBcHBsaWNhdGlvbiddL19pZFwiLCBfV0ZJbnN0YW5jZSwge30pWzBdO1xyXG4gICAgICAgICAgICAgICAgdmFyIHV1aWRBcHBsaWNhdGlvbiA9IEpTT04ueHBhdGgoXCIvaW5kaWNhdG9yc1tjYXRlZ29yeS90ZXJtIGVxICdBcHBsaWNhdGlvbiddL19pZFwiLCBfV0ZJbnN0YW5jZSwge30pWzBdO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBhY3Rpb24gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgXCJhZG9wdEFwcGxpY2F0aW9uXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJhcHBsaWNhdGlvbklkXCI6IF9XRkluc3RhbmNlLnByb2ZpbGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiaW5kaWNhdG9yVVVJRFwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIkFkb3B0aW9uXCI6IHV1aWRBZG9wdGlvbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiUHVibGlzaEFwcGxpY2F0aW9uXCI6IHV1aWRQdWJsaXNoQXBwbGljYXRpb24sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIkFwcGxpY2F0aW9uXCI6IHV1aWRBcHBsaWNhdGlvblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5hY3Rpb24gPSBhY3Rpb247XHJcbiAgICAgICAgICAgICAgICB3b3JrZXIuc2VuZCh3b3JrZXJPYmplY3QpLnRoZW4oZnVuY3Rpb24od29ya2VyU3VjY2Vzcykge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnV29ya2VyIHByb2Nlc3NlcyBzdWNjZXNzZnVsbHkuJywgd29ya2VyU3VjY2Vzcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcclxuXHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbih3b3JrZXJGYWlsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHdvcmtlckZhaWwpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG59KSgpO1xyXG5cclxuXHJcbnZhciB3b3JrZXIgPSAoZnVuY3Rpb24oKSB7XHJcblxyXG5cclxuICAgIHJldHVybiB7XHJcblxyXG4gICAgICAgIGdldFdvcmtlcldyYXBwZXI6IGZ1bmN0aW9uKCkge1xyXG5cclxuICAgICAgICAgICAgdmFyIHdyYXBwZXIgPSB7XHJcbiAgICAgICAgICAgICAgICBcInNvdXJjZVwiOiBcInJlbW90ZVwiLFxyXG4gICAgICAgICAgICAgICAgXCJ0eXBlXCI6IFwid29ya2VyT2JqZWN0XCIsXHJcbiAgICAgICAgICAgICAgICBcIl9pZFwiOiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgXCJjaGFubmVsc1wiOiBbXSxcclxuICAgICAgICAgICAgICAgIFwiY29tbXVuaXR5SWRcIjogXCJcIixcclxuICAgICAgICAgICAgICAgIFwiYXBwbGljYXRpb25JZFwiOiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgXCJtZXNzYWdlXCI6IFwiXCIsXHJcbiAgICAgICAgICAgICAgICBcIm1lc3NhZ2VUeXBlXCI6IFwiaW5mb1wiLFxyXG4gICAgICAgICAgICAgICAgXCJjcmVhdGVkRGF0ZVRpbWVcIjogXCJcIixcclxuICAgICAgICAgICAgICAgIFwic2VuZGVyVXNlcklkXCI6IFwiXCIsXHJcbiAgICAgICAgICAgICAgICBcIm5vdGlmaWNhdGlvblwiOiB7XHJcblxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIFwiYWN0aW9uXCI6IHtcclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gd3JhcHBlcjtcclxuXHJcbiAgICAgICAgfSxcclxuICAgICAgICBzZW5kOiBmdW5jdGlvbih3b3JrZXJPYmplY3QpIHtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnU3VibWl0dGluZyBXb3JrZXIgT2JqZWN0IHRvIHNlcnZlcicpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cod29ya2VyT2JqZWN0KTtcclxuICAgICAgICAgICAgICAgIGRhby5zYXZlKHdvcmtlck9iamVjdCkuZG9uZShmdW5jdGlvbih3b3JrZXJSZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUod29ya2VyUmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRXJyb3Igc3VibWl0dGluZyB3b3JrZXIgcmVzcG9uc2UgISEnICsgZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcblxyXG5cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbn0pKCk7XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHtcclxuXHJcbiAgICBjb21tdW5pdHk6IGNvbW11bml0eSxcclxuICAgIGFwcGxpY2F0aW9uOiBhcHBsaWNhdGlvbixcclxuICAgIHdvcmtlcjogd29ya2VyXHJcblxyXG59IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuLy92YXIgZ2F0ZWtlZXBlciA9IHJlcXVpcmUoJy4uL2Jvd2VyX2NvbXBvbmVudHMvZ2F0ZWtlZXBlcicpO1xyXG52YXIgdXRpbCA9IHJlcXVpcmUoJ3V0aWxpdHknKTtcclxuXHJcbi8vIHZhciB1dWlkID0gcmVxdWlyZSgnbm9kZS11dWlkJyk7XHJcblxyXG52YXIgZ2F0ZWtlZXBlciA9IG5ldyBHSygpO1xyXG5cclxuLyoqXHJcbiAqIEZvcm0gTW9kdWxlXHJcbiAqXHJcbiAqIEBtb2R1bGUgbGliL2Zvcm1cclxuICogQGF1dGhvciBCcmVudCBHb3Jkb25cclxuICogQHZlcnNpb24gMi4wLjBcclxuICogQGRlc2NyaXB0aW9uIHRlc3QgZGVzY3JpcHRpb25cclxuICogQGNvcHlyaWdodCBLd2FudHUgTHRkIFJTQSAyMDA5LTIwMTUuXHJcbiAqXHJcbiAqL1xyXG5cclxuZnVuY3Rpb24gY3JlYXRlKGFyZ3MpIHtcclxuXHJcbiAgICB2YXIgcHJvY2Vzc0lkID0gYXJnc1swXSB8fCAnJztcclxuXHJcbiAgICB2YXIgc3ViUHJvY2VzcyA9IGFyZ3NbMV0gfHwge307XHJcblxyXG4gICAgdmFyIHN0ZXAgPSBhcmdzWzJdIHx8IHt9O1xyXG5cclxuICAgIHZhciBhY3Rpb24gPSBhcmdzWzNdIHx8IHt9O1xyXG5cclxuICAgIHZhciBfV0ZJbnN0YW5jZSA9IGFyZ3NbNl0gfHwge307XHJcblxyXG4gICAgdmFyIGRhdGEgPSBhcmdzWzZdIHx8IHt9O1xyXG5cclxuICAgIHZhciBpbmRpY2F0b3JzID0gc3ViUHJvY2Vzcy5pbmRpY2F0b3JzIHx8IFtdO1xyXG5cclxuICAgIHZhciByZXN1bHQgPSBbXTtcclxuXHJcbiAgICB2YXIgaW5kaWNhdG9yVHlwZSA9IGFjdGlvbi5fdHlwZTtcclxuXHJcbiAgICB2YXIgcHJvY2Vzc1NlcSA9IGFyZ3NbNF0gfHwgJyc7XHJcblxyXG4gICAgdmFyIHN1YlByb2Nlc3NTZXEgPSBhcmdzWzVdIHx8ICcnO1xyXG5cclxuICAgIHZhciBjcmVhdGVUeXBlID0gYXJnc1s3XSB8fCAnJztcclxuXHJcbiAgICB2YXIgc3ViUHJvY2Vzc0lkID0gc3ViUHJvY2Vzcy5faWQ7XHJcblxyXG4gICAgdmFyIHV1aWQgPSBhcmdzWzhdIHx8ICcnO1xyXG5cclxuICAgIHZhciBiYXNlVVVJRCA9IGFyZ3NbOV0gfHwgJyc7XHJcblxyXG4gICAgdmFyIHByb2ZpbGUgPSBfV0ZJbnN0YW5jZS5wcm9maWxlO1xyXG5cclxuXHJcblxyXG4gICAgdmFyIGlucHV0RGF0YSA9IGFyZ3NbMTBdIHx8IHt9O1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICB2YXIgdG9Qcm9jZXNzID0gaW5kaWNhdG9ycy5sZW5ndGg7XHJcblxyXG4gICAgICAgIHZhciBmb3JtQ3JlYXRlRm4gPSBmdW5jdGlvbihpZCwgaW5kaWNhdG9yVHlwZSwgaW5kaWNhdG9ySWQsIHZhbGlkRGF0ZSwgaW5zdGFudGlhdGVTb3VyY2UpIHtcclxuXHJcbiAgICAgICAgICAgIGdhdGVrZWVwZXIuaW5zdGFudGlhdGUoaWQsIGluZGljYXRvclR5cGUsIGluZGljYXRvcklkLCBfV0ZJbnN0YW5jZS5wcm9maWxlLCB2YWxpZERhdGUpLnRoZW4oZnVuY3Rpb24oZG9jQXJyYXkpIHtcclxuICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgaW5kaWNhdG9yIHdvcmtmbG93IHByb2Nlc3NlcyBzZWN0aW9uXHJcblxyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkb2NBcnJheS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBvYmplY3QgPSBkb2NBcnJheVtpXTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIW9iamVjdC5tb2RlbC5faWQuZW5kc1dpdGgoJzphcHByb3ZlZCcpICYmICFvYmplY3QubW9kZWwuX2lkLmVuZHNXaXRoKCc6cmVqZWN0ZWQnKSkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHdvcmtmbG93T2JqID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJpZFwiOiBfV0ZJbnN0YW5jZS5jb25maWcuX2lkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJpbnN0YW5jZVwiOiBfV0ZJbnN0YW5jZS5pbnN0YW5jZS5faWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInByb2Nlc3Nlc1wiOiBbe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiaWRcIjogcHJvY2Vzc0lkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3ViUHJvY2Vzc0lkXCI6IHN1YlByb2Nlc3MuX2lkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3ViUHJvY2Vzc1VVSURcIjogdXVpZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInN0ZXBcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImlkXCI6IHN0ZXAuaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic2VxXCI6IHN0ZXAuc2VxLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInN0YXJ0RGF0ZVwiOiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInN0YXR1c1wiOiBzdGVwLnN0YXR1cyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJtZXNzYWdlXCI6IHN0ZXAubWVzc2FnZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJhc3NpZ25lZFRvXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidXNlcklkXCI6IHN0ZXAuYXNzaWduZWRUby51c2VySWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogc3RlcC5hc3NpZ25lZFRvLm5hbWVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJjb21tZW50XCI6IHN0ZXAuY29tbWVudCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJjb21wbGV0ZVwiOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJlbmREYXRlXCI6IFwiXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWN0aW9uLnNldFdvcmtmbG93TGFiZWxJblRpdGxlICE9IHVuZGVmaW5lZCAmJiBhY3Rpb24uc2V0V29ya2Zsb3dMYWJlbEluVGl0bGUgIT0gJycgJiYgYWN0aW9uLnNldFdvcmtmbG93TGFiZWxJblRpdGxlID09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC5tb2RlbC50aXRsZSA9IGlucHV0RGF0YS5sYWJlbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFjdGlvbi5zZXREcmFmdCAhPSB1bmRlZmluZWQgJiYgYWN0aW9uLnNldERyYWZ0ICE9ICcnICYmIGFjdGlvbi5zZXREcmFmdCA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QubW9kZWwuY29udHJvbC5kcmFmdCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcblxyXG5cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QubW9kZWwud29ya2Zsb3dzLnB1c2god29ya2Zsb3dPYmopO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWFpbklkID0gb2JqZWN0Lm1vZGVsLl9pZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gcGVyc2lzdCB2aWEgZ2sgc28gdGhhdCBpdCBpcyBzYXZlIGluIGNvdWNoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdhdGVrZWVwZXIucGVyc2lzdChkb2NBcnJheSkudGhlbihmdW5jdGlvbihzYXZlZEFycmF5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3VzaW5nIHNhbWUgaWQgY2FsbCBpbml0aWFsaXNlRGF0YVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9jYWxsIGNvZGUgdG8gc2V0IHRvIHNldEluc3RhbmNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYW8uZ2V0KG1haW5JZCkuZG9uZShmdW5jdGlvbihkYXRhKSB7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5kaWNhdG9yTW9kZWwgPSBrby5tYXBwaW5nLmZyb21KUyh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiZGVmYXVsdE1vZGVsXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic2V0SWRcIjogaW5kaWNhdG9ySWRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYXRla2VlcGVyLmluc3RhbnRpYXRlRGF0YShtYWluSWQsIGluc3RhbnRpYXRlU291cmNlLCBpbmRpY2F0b3JNb2RlbCwgZGF0YS5tb2RlbC5wZW5kaW5nLnNlcSkudGhlbihmdW5jdGlvbihkYXRhKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YVswXS5zdGF0dXMgPT0gXCIyMDBcIikge1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWN0aW9uLnNldFdvcmtmbG93TGFiZWxJbkZpZWxkICE9IHVuZGVmaW5lZCAmJiBhY3Rpb24uc2V0V29ya2Zsb3dMYWJlbEluRmllbGQgIT0gJycgJiYgbWFpbklkID09IHByb2ZpbGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhWzBdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGF0aCA9IFwiZGF0YVswXS5tb2RlbC5tb2RlbC5wZW5kaW5nLmRhdGEuXCIgKyBhY3Rpb24uc2V0V29ya2Zsb3dMYWJlbEluRmllbGQgKyBcIj0nXCIgKyBpbnB1dERhdGEubGFiZWwgKyBcIidcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmFsKHBhdGgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhdGVrZWVwZXIucGVyc2lzdChkYXRhKS50aGVuKGZ1bmN0aW9uKHNhdmVkQXJyYXkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYW8uZ2V0KG1haW5JZCkuZG9uZShmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfV0ZJbnN0YW5jZS5pbmRpY2F0b3JzLmxlbmd0aCA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfV0ZJbnN0YW5jZS5pbmRpY2F0b3JzLnB1c2goZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1Byb2Nlc3MtLTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0b1Byb2Nlc3MgPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdGb3JtIGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5LicsIF9XRkluc3RhbmNlLmluZGljYXRvcnMpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZvdW5kID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgX1dGSW5zdGFuY2UuaW5kaWNhdG9ycy5sZW5ndGg7IGluZGV4KyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5kaWNhdG9yID0gX1dGSW5zdGFuY2UuaW5kaWNhdG9yc1tpbmRleF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZGljYXRvci5faWQgPT0gZGF0YS5faWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm91bmQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgdGhlIGN1cnJlbnQgaXRlbSBmcm9tIHRoZSBhcnJheSBhbmQgYWRkIHRoZSB1cGRhdGVkIHByb2Nlc3NNb2RlbFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfV0ZJbnN0YW5jZS5pbmRpY2F0b3JzLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9XRkluc3RhbmNlLmluZGljYXRvcnMucHVzaChkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9Qcm9jZXNzLS07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0b1Byb2Nlc3MgPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ0Zvcm0gY3JlYXRlZCBzdWNjZXNzZnVsbHkuJywgX1dGSW5zdGFuY2UuaW5kaWNhdG9ycyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZvdW5kID09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX1dGSW5zdGFuY2UuaW5kaWNhdG9ycy5wdXNoKGRhdGEpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1Byb2Nlc3MtLTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodG9Qcm9jZXNzID09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ0Zvcm0gY3JlYXRlZCBzdWNjZXNzZnVsbHkuJywgX1dGSW5zdGFuY2UuaW5kaWNhdG9ycyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmFpbHVyZSA9IHV0aWwuc3VjY2VzcygnMSBHYXRla2VlcGVyIGluaXRpYWxpc2F0aW9uIGZhaWxlZCB3aXRoIGluaXRpYWxpc2VEYXRhIG1lc3NhZ2UgJyArIGVyclswXS5tZXNzYWdlLCB7fSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChmYWlsdXJlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmYWlsdXJlID0gdXRpbC5zdWNjZXNzKCcyIEdhdGVrZWVwZXIgaW5pdGlhbGlzYXRpb24gZmFpbGVkIHdpdGggaW5pdGlhbGlzZURhdGEgbWVzc2FnZSAnICsgZXJyWzBdLm1lc3NhZ2UsIHt9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZmFpbHVyZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcblxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmYWlsdXJlID0gdXRpbC5zdWNjZXNzKCczIEdhdGVrZWVwZXIgaW5pdGlhbGlzYXRpb24gZmFpbGVkIHdpdGggaW5pdGlhbGlzZURhdGEgbWVzc2FnZSAnICsgZXJyWzBdLm1lc3NhZ2UsIHt9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChmYWlsdXJlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmYWlsdXJlID0gdXRpbC5zdWNjZXNzKCc0IEdhdGVrZWVwZXIgaW5pdGlhbGlzYXRpb24gZmFpbGVkIHdpdGggaW5pdGlhbGlzZURhdGEgbWVzc2FnZSAnICsgZXJyWzBdLm1lc3NhZ2UsIHt9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGZhaWx1cmUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZhaWx1cmUgPSB1dGlsLnN1Y2Nlc3MoJzUgR2F0ZWtlZXBlciBpbml0aWFsaXNhdGlvbiBmYWlsZWQgd2l0aCBpbml0aWFsaXNlRGF0YSBtZXNzYWdlICcgKyBlcnJbMF0ubWVzc2FnZSwge30pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChmYWlsdXJlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZhaWx1cmUgPSB1dGlsLnN1Y2Nlc3MoJzYgR2F0ZWtlZXBlciBpbml0aWFsaXNhdGlvbiBmYWlsZWQgd2l0aCBpbml0aWFsaXNlRGF0YSBtZXNzYWdlICcgKyBlcnJbMF0ubWVzc2FnZSwge30pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGZhaWx1cmUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvL3BlcnNpc3QgLSBzYXZlXHJcbiAgICAgICAgICAgICAgICAvL2xvb3Agb24gd29ya2Zsb3cgYXJyYXkgYW5kIGNoZWNrIGZvciA0IGNvbmRpdGlvbnMgYW5kIHNwbGljZSBhbmQgdXBkYXRlXHJcbiAgICAgICAgICAgICAgICAvLyBHb3QgdG8gdGhlIG5leHQgcHJvY2VzcyBpdGVtXHJcblxyXG4gICAgICAgICAgICAgICAgLyp2YXIgd29ya2Zsb3dzID0gZG9jLndvcmtmbG93cztcclxuICAgICAgICAgICAgICAgIHdvcmtmbG93cy5pZCA9IF9XRkluc3RhbmNlLmNvbmZpZy5faWQ7XHJcbiAgICAgICAgICAgICAgICB3b3JrZmxvd3MuaW5zdGFuY2UgPSBfV0ZJbnN0YW5jZS5pbnN0YW5jZS5faWQ7XHJcbiAgICAgICAgICAgICAgICBfV0ZJbnN0YW5jZS5pbmRpY2F0b3JzLnB1c2goZG9jKTtcclxuICAgICAgICAgICAgICAgIGxvb3AubmV4dCgpOyovXHJcblxyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuXHJcblxyXG5cclxuICAgICAgICAgICAgICAgIHZhciB0b0FkZFByb2Nlc3MgPSBbXTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgX1dGSW5zdGFuY2UuaW5zdGFuY2UucHJvY2Vzc2VzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKF9XRkluc3RhbmNlLmluc3RhbmNlLnByb2Nlc3Nlc1tpXS5zdWJQcm9jZXNzZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0b0FkZFByb2Nlc3MucHVzaChfV0ZJbnN0YW5jZS5pbnN0YW5jZS5wcm9jZXNzZXNbaV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIF9XRkluc3RhbmNlLmluc3RhbmNlLnByb2Nlc3NlcyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgX1dGSW5zdGFuY2UuaW5zdGFuY2UucHJvY2Vzc2VzID0gdG9BZGRQcm9jZXNzO1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgdG9BZGRTdWJQcm9jZXNzID0gW107XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IF9XRkluc3RhbmNlLnN1YnByb2Nlc3Nlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChfV0ZJbnN0YW5jZS5zdWJwcm9jZXNzZXNbaV0uaW5kaWNhdG9ycy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvQWRkU3ViUHJvY2Vzcy5wdXNoKF9XRkluc3RhbmNlLnN1YnByb2Nlc3Nlc1tpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgX1dGSW5zdGFuY2Uuc3VicHJvY2Vzc2VzID0gW107XHJcbiAgICAgICAgICAgICAgICBfV0ZJbnN0YW5jZS5zdWJwcm9jZXNzZXMgPSB0b0FkZFN1YlByb2Nlc3M7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcclxuICAgICAgICAgICAgICAgIHZhciBmYWlsdXJlID0gdXRpbC5zdWNjZXNzKCc3IEdhdGVrZWVwZXIgaW5pdGlhbGlzYXRpb24gZmFpbGVkIHdpdGggaW5pdGlhbGlzZURhdGEgbWVzc2FnZSAnICsgZXJyWzBdLm1lc3NhZ2UsIHt9KTtcclxuICAgICAgICAgICAgICAgIHJlamVjdChmYWlsdXJlKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBpbnN0YW50aWF0ZVNvdXJjZSA9ICdmcm9tRGVmaW5pdGlvbic7XHJcbiAgICAgICAgZm9yICh2YXIgY291bnRlciA9IDA7IGNvdW50ZXIgPCBpbmRpY2F0b3JzLmxlbmd0aDsgY291bnRlcisrKSB7XHJcbiAgICAgICAgICAgIHZhciBpbmRpY2F0b3JJZCA9IGluZGljYXRvcnNbY291bnRlcl0uX2lkO1xyXG4gICAgICAgICAgICB2YXIgaW5kaWNhdG9yTmFtZSA9IHV0aWwuZ2V0TmFtZShpbmRpY2F0b3JzW2NvdW50ZXJdLm5hbWUsICdlbicpO1xyXG4gICAgICAgICAgICB2YXIgaW5pdFR5cGUgPSBpbmRpY2F0b3JzW2NvdW50ZXJdLl90eXBlO1xyXG5cclxuICAgICAgICAgICAgdmFyIGlkID0gJyc7XHJcbiAgICAgICAgICAgIHZhciBpbmRpY2F0b3JEb2MgPSB7fTtcclxuXHJcbiAgICAgICAgICAgIGlmIChpbml0VHlwZSA9PSAnbmV3SW5zdGFuY2UnKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGJhc2VVVUlEICE9IHVuZGVmaW5lZCAmJiBiYXNlVVVJRCAhPSAnJyAmJiBiYXNlVVVJRC5sZW5ndGggPiAwKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBleGlzdGluZ1VVSUQgPSBKU09OLnhwYXRoKFwiL3N1YnByb2Nlc3Nlc1tfaWQgZXEgJ1wiICsgYmFzZVVVSUQgKyBcIiddL2luZGljYXRvcnNbaWQgZXEgJ1wiICsgaW5kaWNhdG9ySWQgKyBcIiddL2luc3RhbmNlc1sxXS91dWlkXCIsIF9XRkluc3RhbmNlLCB7fSlbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgaWQgPSBleGlzdGluZ1VVSUQ7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5pdFR5cGUgPSAnbmV3U2VxdWVuY2UnO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyB1cGRhdGUgcHJvY2Vzc2VzIGJsb2NrIHRvIG5vdCBkaXNwbGF5IHRoZSBvbGRlciBpbnN0YW5jZSBiYXNlZCBvbiBiYXNlVVVJRFxyXG5cclxuICAgICAgICAgICAgICAgICAgICAvL1RPRE86IENoYW5nZSByZXF1aXJlZCB0byBtb3ZlIGlzQWN0aXZlIHRvIHN1YlByb2Nlc3MgZmlsZS5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3AgPSBKU09OLnhwYXRoKFwiL3N1YnByb2Nlc3Nlc1tfaWQgZXEgJ1wiICsgYmFzZVVVSUQgKyBcIiddXCIsIGFwcC5TQ09QRS53b3JrZmxvdywge30pWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgIHNwLmFjdGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGluc3RhbnRpYXRlIG5ldyBzZXEgd2l0aCBwcmV2aW91cyBhdXRob3Jpc2VkIGRhdGFcclxuICAgICAgICAgICAgICAgICAgICBpbnN0YW50aWF0ZVNvdXJjZSA9ICdmcm9tQXV0aG9yaXNlZCc7XHJcblxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHN1YlByb2Nlc3MuaXNQcm9maWxlICE9IHVuZGVmaW5lZCAmJiBzdWJQcm9jZXNzLmlzUHJvZmlsZSAmJiBjb3VudGVyID09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWQgPSBwcm9maWxlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkID0gaW5kaWNhdG9ySWQgKyAnLScgKyBnZW5lcmF0ZVVVSUQoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgc3BMYXN0VXVpZCA9IEpTT04ueHBhdGgoXCIvaW5zdGFuY2UvcHJvY2Vzc2VzW2lkIGVxICdcIiArIHByb2Nlc3NJZCArIFwiJyBhbmQgc3ViUHJvY2Vzc2VzL2lkIGVxICdcIiArIHN1YlByb2Nlc3NJZCArIFwiJ11bMV0vc3ViUHJvY2Vzc2VzL3V1aWRcIiwgX1dGSW5zdGFuY2UsIHt9KVswXTtcclxuICAgICAgICAgICAgICAgIHZhciBpbmRJZCA9IEpTT04ueHBhdGgoXCIvc3VicHJvY2Vzc2VzW19pZCBlcSAnXCIgKyBzcExhc3RVdWlkICsgXCInXS9pbmRpY2F0b3JzW2lkIGVxICdcIiArIGluZGljYXRvcklkICsgXCInXS9pbnN0YW5jZXMvdXVpZFwiLCBhcHAuU0NPUEUud29ya2Zsb3csIHt9KVswXTtcclxuICAgICAgICAgICAgICAgIGlmIChzcExhc3RVdWlkID09ICcnIHx8IHNwTGFzdFV1aWQgPT0gdW5kZWZpbmVkIHx8IGluZElkID09ICcnIHx8IGluZElkID09IHVuZGVmaW5lZCkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoc3ViUHJvY2Vzcy5pc1Byb2ZpbGUgIT0gdW5kZWZpbmVkICYmIHN1YlByb2Nlc3MuaXNQcm9maWxlICYmIGNvdW50ZXIgPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZCA9IHByb2ZpbGU7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWQgPSBpbmRpY2F0b3JJZCArICctJyArIGdlbmVyYXRlVVVJRCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZCA9IGluZElkO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChiYXNlVVVJRCAhPSB1bmRlZmluZWQgJiYgYmFzZVVVSUQgIT0gJycgJiYgYmFzZVVVSUQubGVuZ3RoID4gMCkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvL1RPRE86IENoYW5nZSByZXF1aXJlZCB0byBtb3ZlIGlzQWN0aXZlIHRvIHN1YlByb2Nlc3MgZmlsZS5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNwID0gSlNPTi54cGF0aChcIi9zdWJwcm9jZXNzZXNbX2lkIGVxICdcIiArIGJhc2VVVUlEICsgXCInXVwiLCBhcHAuU0NPUEUud29ya2Zsb3csIHt9KVswXTtcclxuICAgICAgICAgICAgICAgICAgICBzcC5hY3RpdmUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICBpbnN0YW50aWF0ZVNvdXJjZSA9ICdmcm9tQXV0aG9yaXNlZCc7XHJcblxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIFRPRE86IFJlcGxhY2Ugd2l0aCB0aGUgZ2F0ZWtlZXBlciBwcm9taXNlIGNhbGwsIHJldHVybiB0aGUgb2JqZWN0LCB1cGRhdGUgdGhlIGluZGljYXRvclxyXG4gICAgICAgICAgICAvLyBkb2N1bWVudCB3b3JrZmxvdyBwcm9jZXNzZXMgZGF0YSBhbmQgdXBkYXRlIHRoZSB3b3JrZmxvdyBjbGFzcyBpbmRpY2F0b3JzIGFycmF5LlxyXG4gICAgICAgICAgICBmb3JtQ3JlYXRlRm4oaWQsIGluaXRUeXBlLCBpbmRpY2F0b3JJZCwgJycsIGluc3RhbnRpYXRlU291cmNlKTtcclxuXHJcblxyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIC8vIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdGb3JtIGluZGljYXRvciBzZXQgc2F2ZWQgc3VjY2Vzc2Z1bGx5LicsIHJlc3VsdCk7XHJcbiAgICAgICAgLy8gcmVzb2x2ZShzdWNjZXNzKTtcclxuICAgIH0pO1xyXG59O1xyXG5cclxuZnVuY3Rpb24gc2V0SW5zdGFuY2VUaXRsZShhcmdzKSB7XHJcblxyXG4gICAgdmFyIF9XRkluc3RhbmNlID0gYXJnc1swXSB8fCB7fTtcclxuICAgIHZhciB1dWlkID0gYXJnc1syXSB8fCAnJztcclxuICAgIHZhciBkYXRhID0gYXJnc1s0XSB8fCB7fTtcclxuICAgIHZhciB0aXRsZSA9IGRhdGEubGFiZWw7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuICAgICAgICB2YXIgc3ViUHJvY2Vzc0luc3RhbmNlID0gSlNPTi54cGF0aChcIi9zdWJwcm9jZXNzZXNbX2lkIGVxICdcIiArIHV1aWQgKyBcIiddXCIsIF9XRkluc3RhbmNlLCB7fSlbMF07XHJcbiAgICAgICAgdmFyIGluZGljYXRvckluc3RhbmNlcyA9IHN1YlByb2Nlc3NJbnN0YW5jZS5pbmRpY2F0b3JzO1xyXG5cclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGluZGljYXRvckluc3RhbmNlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICB2YXIgaW5kaWNhdG9yVVVJRCA9IGluZGljYXRvckluc3RhbmNlc1tpXS5pbnN0YW5jZXNbMF0udXVpZDtcclxuICAgICAgICAgICAgdmFyIGluZGljYXRvckluc3RhbmNlID0gSlNPTi54cGF0aChcIi9pbmRpY2F0b3JzW19pZCBlcSAnXCIgKyBpbmRpY2F0b3JVVUlEICsgXCInXVwiLCBfV0ZJbnN0YW5jZSwge30pWzBdO1xyXG4gICAgICAgICAgICBpbmRpY2F0b3JJbnN0YW5jZS50aXRsZSA9IGluZGljYXRvckluc3RhbmNlc1tpXS5pZCArJyAnK3RpdGxlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJlc29sdmUoXCJTZXQgVGl0bGUgU3VjY2Vzc1wiLCBpbmRpY2F0b3JJbnN0YW5jZXMpO1xyXG5cclxuICAgIH0pO1xyXG5cclxufTtcclxuXHJcbmZ1bmN0aW9uIGRlbGV0ZVByb2ZpbGUoYXJncykge1xyXG5cclxuICAgIHZhciBfV0ZJbnN0YW5jZSA9IGFyZ3NbMF0gfHwge307XHJcbiAgICB2YXIgcHJvZmlsZUlkID0gX1dGSW5zdGFuY2UucHJvZmlsZTtcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcblxyXG4gICAgICAgIHZhciB3b3JrZXJPYmplY3QgPSB7XHJcbiAgICAgICAgICAgIFwic291cmNlXCI6IFwicmVtb3RlXCIsXHJcbiAgICAgICAgICAgIFwidHlwZVwiOiBcIndvcmtlck9iamVjdFwiLFxyXG4gICAgICAgICAgICBcIl9pZFwiOiBnZW5lcmF0ZVVVSUQoKSxcclxuICAgICAgICAgICAgXCJjaGFubmVsc1wiOiBbXSxcclxuICAgICAgICAgICAgXCJjb21tdW5pdHlJZFwiOiBhcHAuU0NPUEUuY29tbXVuaXR5SWQsXHJcbiAgICAgICAgICAgIFwiYXBwbGljYXRpb25JZFwiOiBhcHAuU0NPUEUuYXBwbGljYXRpb25JZCxcclxuICAgICAgICAgICAgXCJtZXNzYWdlXCI6IFwiXCIsXHJcbiAgICAgICAgICAgIFwibWVzc2FnZVR5cGVcIjogXCJpbmZvXCIsXHJcbiAgICAgICAgICAgIFwiY3JlYXRlZERhdGVUaW1lXCI6IG1vbWVudCgpLmZvcm1hdCgpLFxyXG4gICAgICAgICAgICBcInNlbmRlclVzZXJJZFwiOiBMT0NBTF9TRVRUSU5HUy5TVUJTQ1JJUFRJT05TLnVzZXJJZCxcclxuICAgICAgICAgICAgXCJub3RpZmljYXRpb25cIjoge1xyXG5cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgXCJwcm9maWxlXCI6IHtcclxuICAgICAgICAgICAgICAgIFwiYWN0aW9uXCI6IFwiZGVsZXRlUHJvZmlsZVwiLFxyXG4gICAgICAgICAgICAgICAgXCJwcm9maWxlSWRcIjogcHJvZmlsZUlkXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc29sZS5sb2cod29ya2VyT2JqZWN0KTtcclxuICAgICAgICBkYW8udXBzZXJ0KHdvcmtlck9iamVjdCkuZG9uZShmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiV29ya2VyIE9iamVjdCBzdWJtaXR0ZWQgZm9yIHByb2ZpbGUoXCIgKyBwcm9maWxlSWQgKyBcIikgZGVsZXRpb24uXCIpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcclxuICAgICAgICAgICAgcmVzb2x2ZShkYXRhKTtcclxuICAgICAgICB9KS5mYWlsKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xyXG4gICAgICAgICAgICByZWplY3QoZGF0YSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG5cclxuICAgIH0pO1xyXG5cclxuXHJcbn07XHJcblxyXG5cclxuZnVuY3Rpb24gY3JlYXRlUHJvZmlsZShhcmdzKSB7XHJcblxyXG5cclxuXHJcbiAgICB2YXIgX1dGSW5zdGFuY2UgPSBhcmdzWzFdIHx8IHt9O1xyXG5cclxuICAgIHZhciBjb21tdW5pdHlJZCA9IF9XRkluc3RhbmNlLmNvbW11bml0eUlkO1xyXG4gICAgdmFyIHByb2ZpbGVJZCA9IF9XRkluc3RhbmNlLnByb2ZpbGU7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuICAgICAgICBsaWJyYXJ5LmNyZWF0ZVByb2ZpbGVEb2N1bWVudHMoY29tbXVuaXR5SWQsIHByb2ZpbGVJZCkuZG9uZShmdW5jdGlvbihkYXRhKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnRm9ybSBjcmVhdGVkIHN1Y2Nlc3NmdWxseS4nLCBkYXRhKTtcclxuICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcclxuXHJcbiAgICAgICAgfSkuZmFpbChmdW5jdGlvbihlcnIpIHtcclxuXHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcclxuICAgICAgICAgICAgdmFyIGZhaWx1cmUgPSB1dGlsLnN1Y2Nlc3MoJ0VSUk9SOiBQcm9maWxlIGNyZWF0aW9uIGZhaWxlZCcgKyBlcnJbMF0ubWVzc2FnZSwge30pO1xyXG4gICAgICAgICAgICByZWplY3QoZmFpbHVyZSk7XHJcblxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIH0pO1xyXG59O1xyXG5cclxuZnVuY3Rpb24gc2V0RHJhZnQoYXJncykge1xyXG5cclxuXHJcblxyXG4gICAgdmFyIF9XRkluc3RhbmNlID0gYXJnc1swXSB8fCB7fTtcclxuICAgIHZhciBjb21tdW5pdHlJZCA9IF9XRkluc3RhbmNlLmNvbW11bml0eUlkO1xyXG4gICAgdmFyIHByb2ZpbGVJZCA9IF9XRkluc3RhbmNlLnByb2ZpbGU7XHJcbiAgICB2YXIgdXVpZCA9IGFyZ3NbMl0gfHwgJyc7XHJcblxyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuXHJcbiAgICAgICAgdmFyIHN1YlByb2Nlc3NJbnN0YW5jZSA9IEpTT04ueHBhdGgoXCIvc3VicHJvY2Vzc2VzW19pZCBlcSAnXCIgKyB1dWlkICsgXCInXVwiLCBfV0ZJbnN0YW5jZSwge30pWzBdO1xyXG4gICAgICAgIHZhciBpbmRpY2F0b3JJbnN0YW5jZXMgPSBzdWJQcm9jZXNzSW5zdGFuY2UuaW5kaWNhdG9ycztcclxuXHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpbmRpY2F0b3JJbnN0YW5jZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgdmFyIGluZGljYXRvclVVSUQgPSBpbmRpY2F0b3JJbnN0YW5jZXNbaV0uaW5zdGFuY2VzWzBdLnV1aWQ7XHJcbiAgICAgICAgICAgIHZhciBpbmRpY2F0b3JJbnN0YW5jZSA9IEpTT04ueHBhdGgoXCIvaW5kaWNhdG9yc1tfaWQgZXEgJ1wiICsgaW5kaWNhdG9yVVVJRCArIFwiJ11cIiwgX1dGSW5zdGFuY2UsIHt9KVswXTtcclxuICAgICAgICAgICAgaW5kaWNhdG9ySW5zdGFuY2UuY29udHJvbC5kcmFmdCA9IHRydWU7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmVzb2x2ZShcIlNldCBEcmFmdCBTdWNjZXNzXCIsIGluZGljYXRvckluc3RhbmNlcyk7XHJcblxyXG4gICAgfSk7XHJcbn07XHJcblxyXG5mdW5jdGlvbiBzZXRVbkRyYWZ0KGFyZ3MpIHtcclxuXHJcbiAgICB2YXIgX1dGSW5zdGFuY2UgPSBhcmdzWzBdIHx8IHt9O1xyXG4gICAgdmFyIGNvbW11bml0eUlkID0gX1dGSW5zdGFuY2UuY29tbXVuaXR5SWQ7XHJcbiAgICB2YXIgcHJvZmlsZUlkID0gX1dGSW5zdGFuY2UucHJvZmlsZTtcclxuICAgIHZhciB1dWlkID0gYXJnc1syXSB8fCAnJztcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcblxyXG4gICAgICAgIHZhciBzdWJQcm9jZXNzSW5zdGFuY2UgPSBKU09OLnhwYXRoKFwiL3N1YnByb2Nlc3Nlc1tfaWQgZXEgJ1wiICsgdXVpZCArIFwiJ11cIiwgX1dGSW5zdGFuY2UsIHt9KVswXTtcclxuICAgICAgICB2YXIgaW5kaWNhdG9ySW5zdGFuY2VzID0gc3ViUHJvY2Vzc0luc3RhbmNlLmluZGljYXRvcnM7XHJcblxyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaW5kaWNhdG9ySW5zdGFuY2VzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHZhciBpbmRpY2F0b3JVVUlEID0gaW5kaWNhdG9ySW5zdGFuY2VzW2ldLmluc3RhbmNlc1swXS51dWlkO1xyXG4gICAgICAgICAgICB2YXIgaW5kaWNhdG9ySW5zdGFuY2UgPSBKU09OLnhwYXRoKFwiL2luZGljYXRvcnNbX2lkIGVxICdcIiArIGluZGljYXRvclVVSUQgKyBcIiddXCIsIF9XRkluc3RhbmNlLCB7fSlbMF07XHJcbiAgICAgICAgICAgIGluZGljYXRvckluc3RhbmNlLmNvbnRyb2wuZHJhZnQgPSBmYWxzZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXNvbHZlKFwiU2V0IERyYWZ0IFN1Y2Nlc3NcIiwgaW5kaWNhdG9ySW5zdGFuY2VzKTtcclxuXHJcbiAgICB9KTtcclxufTtcclxuXHJcblxyXG5cclxuZnVuY3Rpb24gc2F2ZShpbmRpY2F0b3IpIHtcclxuICAgIHZhciBjb21wbGV0ZWQgPSBbXTtcclxuICAgIHZhciByZXN1bHQgPSB7XHJcbiAgICAgICAgY29tcGxldGU6IHRydWUsXHJcbiAgICAgICAgZGF0YTogW11cclxuICAgIH07XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ0Zvcm0gaW5kaWNhdG9yIHNldCBzYXZlZCBzdWNjZXNzZnVsbHkuJywgcmVzdWx0KTtcclxuICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xyXG4gICAgfSk7XHJcbn07XHJcblxyXG5mdW5jdGlvbiBzdWJtaXQoZm9ybSkge1xyXG4gICAgdmFyIGNvbXBsZXRlZCA9IFtdO1xyXG4gICAgdmFyIHJlc3VsdCA9IHtcclxuICAgICAgICBjb21wbGV0ZTogdHJ1ZSxcclxuICAgICAgICBkYXRhOiBbXVxyXG4gICAgfTtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnRm9ybSBzdWJtaXR0ZWQgc3VjY2Vzc2Z1bGx5LicsIHJlc3VsdCk7XHJcbiAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcclxuICAgIH0pO1xyXG59O1xyXG5cclxuZnVuY3Rpb24gYXV0aG9yaXNlKGZvcm0pIHtcclxuICAgIHZhciBjb21wbGV0ZWQgPSBbXTtcclxuICAgIHZhciByZXN1bHQgPSB7XHJcbiAgICAgICAgY29tcGxldGU6IHRydWUsXHJcbiAgICAgICAgZGF0YTogW11cclxuICAgIH07XHJcblxyXG4gICAgdmFyIHByb2Nlc3NJZCA9IGZvcm1bMF0gfHwgJyc7XHJcblxyXG4gICAgdmFyIHN1YlByb2Nlc3MgPSBmb3JtWzFdIHx8IHt9O1xyXG5cclxuICAgIHZhciBzdWJQcm9jZXNzSWQgPSBzdWJQcm9jZXNzLl9pZDtcclxuXHJcbiAgICB2YXIgcHJvY2Vzc1NlcSA9IGZvcm1bMl0gfHwgJyc7XHJcblxyXG4gICAgdmFyIHN1YlByb2Nlc3NTZXEgPSBmb3JtWzNdIHx8ICcnO1xyXG5cclxuICAgIHZhciBfV0ZJbnN0YW5jZSA9IGZvcm1bNF0gfHwge307XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuICAgICAgICB2YXIgc3ViUHJvY2Vzc1VVSUQgPSBKU09OLnhwYXRoKFwiL3Byb2Nlc3Nlc1tpZCBlcSAnXCIgKyBwcm9jZXNzSWQgKyBcIicgYW5kIHNlcSBlcSAnXCIgKyBwcm9jZXNzU2VxICsgXCInXS9zdWJQcm9jZXNzZXNbaWQgZXEgJ1wiICsgc3ViUHJvY2Vzc0lkICsgXCInIGFuZCBzZXEgZXEgJ1wiICsgc3ViUHJvY2Vzc1NlcSArIFwiJ10vdXVpZFwiLCBfV0ZJbnN0YW5jZS5pbnN0YW5jZSwge30pWzBdO1xyXG4gICAgICAgIHZhciBzcEluZGljYXRvcnMgPSBKU09OLnhwYXRoKFwiL3N1YnByb2Nlc3Nlc1tfaWQgZXEgJ1wiICsgc3ViUHJvY2Vzc1VVSUQgKyBcIiddL2luZGljYXRvcnMvaW5zdGFuY2VzL3V1aWRcIiwgX1dGSW5zdGFuY2UsIHt9KTtcclxuICAgICAgICB2YXIgaXRlbXNUb1Byb2Nlc3MgPSBzcEluZGljYXRvcnMubGVuZ3RoO1xyXG4gICAgICAgIHZhciB1cGRhdGVkT2JqZWN0c0FycmF5ID0gW107XHJcblxyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaXRlbXNUb1Byb2Nlc3M7IGkrKykge1xyXG5cclxuXHJcblxyXG4gICAgICAgICAgICBnYXRla2VlcGVyLmF1dGhvcmlzZShzcEluZGljYXRvcnNbaV0pLnRoZW4oZnVuY3Rpb24oYXV0aG9yaXNlZFJldHVybikge1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICBnYXRla2VlcGVyLnBlcnNpc3QoYXV0aG9yaXNlZFJldHVybikudGhlbihmdW5jdGlvbihzYXZlZEFycmF5KSB7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgdXVpZFNhdmVkSW5kaWNhdG9yID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgYyA9IDA7IGMgPCBzYXZlZEFycmF5Lmxlbmd0aDsgYysrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghc2F2ZWRBcnJheVtjXS5pZC5lbmRzV2l0aCgnOmFwcHJvdmVkJykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV1aWRTYXZlZEluZGljYXRvciA9IHNhdmVkQXJyYXlbY10uaWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZGFvLmdldCh1dWlkU2F2ZWRJbmRpY2F0b3IpLmRvbmUoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoX1dGSW5zdGFuY2UuaW5kaWNhdG9ycy5sZW5ndGggPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX1dGSW5zdGFuY2UuaW5kaWNhdG9ycy5wdXNoKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXNUb1Byb2Nlc3MtLTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtc1RvUHJvY2VzcyA9PSAwKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdGb3JtIGF1dGhvcmlzZWQgc3VjY2Vzc2Z1bGx5LicsIHVwZGF0ZWRPYmplY3RzQXJyYXkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZm91bmQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGluZGV4ID0gMDsgaW5kZXggPCBfV0ZJbnN0YW5jZS5pbmRpY2F0b3JzLmxlbmd0aDsgaW5kZXgrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbmRpY2F0b3IgPSBfV0ZJbnN0YW5jZS5pbmRpY2F0b3JzW2luZGV4XTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5kaWNhdG9yLl9pZCA9PSBkYXRhLl9pZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZSB0aGUgY3VycmVudCBpdGVtIGZyb20gdGhlIGFycmF5IGFuZCBhZGQgdGhlIHVwZGF0ZWQgcHJvY2Vzc01vZGVsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9XRkluc3RhbmNlLmluZGljYXRvcnMuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX1dGSW5zdGFuY2UuaW5kaWNhdG9ycy5wdXNoKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtc1RvUHJvY2Vzcy0tO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbXNUb1Byb2Nlc3MgPT0gMCkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdGb3JtIGF1dGhvcmlzZWQgc3VjY2Vzc2Z1bGx5LicsIHVwZGF0ZWRPYmplY3RzQXJyYXkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmb3VuZCA9PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9XRkluc3RhbmNlLmluZGljYXRvcnMucHVzaChkYXRhKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXNUb1Byb2Nlc3MtLTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbXNUb1Byb2Nlc3MgPT0gMCkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ0Zvcm0gYXV0aG9yaXNlZCBzdWNjZXNzZnVsbHkuJywgdXBkYXRlZE9iamVjdHNBcnJheSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pLmZhaWwoZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuXHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBpdGVtc1RvUHJvY2Vzcy0tO1xyXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW1zVG9Qcm9jZXNzID09IDApIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ0Zvcm0gYXV0aG9yaXNlZCBzdWNjZXNzZnVsbHkuJywgdXBkYXRlZE9iamVjdHNBcnJheSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG5cclxuICAgICAgICB9XHJcblxyXG5cclxuICAgIH0pO1xyXG59O1xyXG5cclxuZnVuY3Rpb24gY2xvc2UoZm9ybSkge1xyXG4gICAgdmFyIGNvbXBsZXRlZCA9IFtdO1xyXG4gICAgdmFyIHJlc3VsdCA9IHtcclxuICAgICAgICBjb21wbGV0ZTogdHJ1ZSxcclxuICAgICAgICBkYXRhOiBbXVxyXG4gICAgfTtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnRm9ybSBjbG9zZWQgc3VjY2Vzc2Z1bGx5LicsIHJlc3VsdCk7XHJcbiAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcclxuICAgIH0pO1xyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSB7XHJcblxyXG4gICAgY3JlYXRlOiBjcmVhdGUsXHJcbiAgICBzYXZlOiBzYXZlLFxyXG4gICAgc3VibWl0OiBzdWJtaXQsXHJcbiAgICBhdXRob3Jpc2U6IGF1dGhvcmlzZSxcclxuICAgIGNsb3NlOiBjbG9zZSxcclxuICAgIHNldERyYWZ0OiBzZXREcmFmdCxcclxuICAgIHNldFVuRHJhZnQ6IHNldFVuRHJhZnQsXHJcbiAgICBjcmVhdGVQcm9maWxlOiBjcmVhdGVQcm9maWxlLFxyXG4gICAgc2V0SW5zdGFuY2VUaXRsZTogc2V0SW5zdGFuY2VUaXRsZSxcclxuICAgIGRlbGV0ZVByb2ZpbGU6IGRlbGV0ZVByb2ZpbGVcclxuXHJcbn0iLCIndXNlIHN0cmljdCc7XHJcblxyXG52YXIgdXRpbCA9IHJlcXVpcmUoJ3V0aWxpdHknKTtcclxuXHJcbi8qKlxyXG4gKiBVc2VyIEludGVyZmFjZSBNb2R1bGVcclxuICpcclxuICogQG1vZHVsZSBsaWIvdWlcclxuICogQGF1dGhvciBCcmVudCBHb3Jkb25cclxuICogQHZlcnNpb24gMC4xLjBcclxuICogQGRlc2NyaXB0aW9uIHRlc3QgZGVzY3JpcHRpb25cclxuICpcclxuICovXHJcblxyXG4gLyoqXHJcbiAgKiBHZXQgYWxsIHByb2Nlc3Mgc3ViLXByb2Nlc3NlcyB1c2VyIGludGVyZmFjZSBkYXRhXHJcbiAgKlxyXG4gICogQHBhcmFtIHtzdHJpbmd9IHByb2Nlc3NJZCAtIHRoZSBXb3JrZmxvdyBjb25maWcgLyBkZWZpbml0aW9uIHByb2Nlc3MgaWRcclxuICAqIEBwYXJhbSB7c3RyaW5nfSBsYW5nIC0gdGhlIHVzZXIgcHJlZmZlcmVkIGxhbmdhdWdlXHJcbiAgKiBAcGFyYW0ge29iamVjdH0gX1dGSW5zdGFuY2UgLSB0aGUgY3VycmVudCB3b3JrZmxvdyBjb25zdHJ1Y3RvciBpbnN0YW5jZVxyXG4gICpcclxuICAqIEBleGFtcGxlICcnXHJcbiAgKlxyXG4gICogQHJldHVybiAnJ1xyXG4gICpcclxuICAqL1xyXG4gZnVuY3Rpb24gZ2V0UHJvY2Vzcyhwcm9jZXNzSWQsIGxhbmcsIF9XRkluc3RhbmNlKXtcclxuICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICB0cnkge1xyXG4gICAgICB2YXIgcHJvY2Vzc01vZGVsID0gW107XHJcbiAgICAgIHZhciBwcm9jZXNzSW5zdGFuY2UgPSBbXTtcclxuICAgIFx0X1dGSW5zdGFuY2UuaW5zdGFuY2UucHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihwcm9jZXNzSXRlbSl7XHJcbiAgICBcdFx0aWYgKHByb2Nlc3NJdGVtLmlkID09IHByb2Nlc3NJZCkge1xyXG4gICAgXHRcdFx0cHJvY2Vzc0luc3RhbmNlID0gcHJvY2Vzc0l0ZW07XHJcbiAgICBcdFx0fVxyXG4gICAgXHR9KVxyXG4gICAgICAvLyBjb25zb2xlLmxvZyhwcm9jZXNzSW5zdGFuY2Uuc3ViUHJvY2Vzc2VzLmxlbmd0aCk7XHJcbiAgICAgIHV0aWwuc3luY0xvb3AocHJvY2Vzc0luc3RhbmNlLnN1YlByb2Nlc3Nlcy5sZW5ndGgsIGZ1bmN0aW9uKGxvb3Ape1xyXG4gIFx0XHRcdHZhciBjb3VudGVyID0gbG9vcC5pdGVyYXRpb24oKTtcclxuICAgICAgICB2YXIgcHJvY2Vzc1NlcSA9IHByb2Nlc3NJbnN0YW5jZS5zZXE7XHJcbiAgICAgICAgdmFyIHN1YlByb2Nlc3NJZCA9IHByb2Nlc3NJbnN0YW5jZS5zdWJQcm9jZXNzZXNbY291bnRlcl0uaWQ7XHJcbiAgICAgICAgdmFyIHN1YlByb2Nlc3NTZXEgPSBwcm9jZXNzSW5zdGFuY2Uuc3ViUHJvY2Vzc2VzW2NvdW50ZXJdLnNlcTtcclxuICAgICAgICBnZXRTdWJQcm9jZXNzKHByb2Nlc3NJZCwgcHJvY2Vzc1NlcSwgc3ViUHJvY2Vzc0lkLCBzdWJQcm9jZXNzU2VxLCBsYW5nLCBfV0ZJbnN0YW5jZSkudGhlbihmdW5jdGlvbihtb2RlbCl7XHJcbiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhtb2RlbCk7XHJcbiAgICAgICAgICBwcm9jZXNzTW9kZWwucHVzaChtb2RlbCk7XHJcbiAgICAgICAgICBsb29wLm5leHQoKTtcclxuICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHByb2Nlc3NNb2RlbCk7XHJcbiAgXHRcdFx0fSwgZnVuY3Rpb24oZXJyKXtcclxuICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHByb2Nlc3NNb2RlbCk7XHJcbiAgXHRcdFx0XHRsb29wLmJyZWFrKCk7XHJcbiAgXHRcdFx0XHRyZWplY3QoZXJyKTtcclxuICBcdFx0XHR9KTtcclxuICBcdFx0fSwgZnVuY3Rpb24oKXtcclxuICAgICAgICAvLyBjb25zb2xlLmxvZyhwcm9jZXNzTW9kZWwpO1xyXG4gIFx0XHRcdHJlc29sdmUocHJvY2Vzc01vZGVsKTtcclxuICBcdFx0fSk7XHJcbiAgICB9IGNhdGNoKGVycil7XHJcbiAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgfVxyXG4gIH0pXHJcbn07XHJcblxyXG4gLyoqXHJcbiAgKiBHZXQgU3ViUHJvY2VzcyB1c2VyIGludGVyZmFjZSBkYXRhXHJcbiAgKlxyXG4gICogQHBhcmFtIHtzdHJpbmd9IHByb2Nlc3NJZCAtIHRoZSBXb3JrZmxvdyBjb25maWcgLyBkZWZpbml0aW9uIHByb2Nlc3MgaWRcclxuICAqIEBwYXJhbSB7bnVtYmVyfSBwcm9jZXNzU2VxIC0gdGhlIFdvcmtmbG93IGluc3RhbmNlIHByb2Nlc3Mgc2VxXHJcbiAgKiBAcGFyYW0ge3N0cmluZ30gc3ViUHJvY2Vzc0lkIC0gdGhlIFdvcmtmbG93IGNvbmZpZyAvIGRlZmluaXRpb24gc3ViLXByb2Nlc3MgaWRcclxuICAqIEBwYXJhbSB7bnVtYmVyfSBzdWJQcm9jZXNzU2VxIC0gdGhlIFdvcmtmbG93IGluc3RhbmNlIHN1Yi1wcm9jZXNzIHNlcVxyXG4gICogQHBhcmFtIHtvYmplY3R9IF9XRkluc3RhbmNlIC0gdGhlIGN1cnJlbnQgd29ya2Zsb3cgY29uc3RydWN0b3IgaW5zdGFuY2VcclxuICAqXHJcbiAgKiBAZXhhbXBsZSAnJ1xyXG4gICpcclxuICAqIEByZXR1cm4gJydcclxuICAqXHJcbiAgKi9cclxuZnVuY3Rpb24gZ2V0U3ViUHJvY2Vzcyhwcm9jZXNzSWQsIHByb2Nlc3NTZXEsIHN1YlByb2Nlc3NJZCwgc3ViUHJvY2Vzc1NlcSwgbGFuZywgX1dGSW5zdGFuY2Upe1xyXG4gIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIHZhciBtb2RlbCA9IHtcclxuICAgICAgICBpZDogJycsXHJcbiAgICAgICAgc2VxOiAnJyxcclxuICAgICAgICBuYW1lOiAnJyxcclxuICAgICAgICBoZWxwOiAnJyxcclxuICAgICAgICBkYXRlczogJycsXHJcbiAgICAgICAgc3RlcDogJydcclxuICAgICAgfTtcclxuICAgICAgdmFyIHN1YlByb2Nlc3MgPSBbXTtcclxuICAgIFx0dmFyIHN1YlByb2Nlc3NDb25mID0gW107XHJcbiAgICBcdF9XRkluc3RhbmNlLmluc3RhbmNlLnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24ocHJvY2Vzc0l0ZW0pe1xyXG4gICAgXHRcdGlmIChwcm9jZXNzSXRlbS5pZCA9PSBwcm9jZXNzSWQgJiYgcHJvY2Vzc0l0ZW0uc2VxID09IHByb2Nlc3NTZXEpIHtcclxuICAgIFx0XHRcdHZhciBzcExlbmd0aCA9IHByb2Nlc3NJdGVtLnN1YlByb2Nlc3Nlcy5sZW5ndGg7XHJcbiAgICBcdFx0XHRwcm9jZXNzSXRlbS5zdWJQcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKHN1YlByb2Nlc3NJdGVtKXtcclxuICAgIFx0XHRcdFx0aWYgKHN1YlByb2Nlc3NJdGVtLmlkID09IHN1YlByb2Nlc3NJZCAmJiBzdWJQcm9jZXNzSXRlbS5zZXEgPT0gc3ViUHJvY2Vzc1NlcSAmJiBzdWJQcm9jZXNzSXRlbS5jb21wbGV0ZSA9PSBmYWxzZSkge1xyXG4gICAgXHRcdFx0XHRcdHN1YlByb2Nlc3MgPSBzdWJQcm9jZXNzSXRlbTtcclxuICAgIFx0XHRcdFx0fVxyXG4gICAgXHRcdFx0fSlcclxuICAgIFx0XHR9XHJcbiAgICBcdH0pXHJcbiAgICBcdC8vIEdldCB0aGUgY3VycmVudCBzdWJQcm9jZXNzIGNvbmZpZ3VyYXRpb25cclxuICAgIFx0X1dGSW5zdGFuY2UuY29uZmlnLnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24ocHJvY2Vzc0NvbmZpZyl7XHJcbiAgICBcdFx0aWYgKHByb2Nlc3NDb25maWcuX2lkID09IHByb2Nlc3NJZCkge1xyXG4gICAgXHRcdFx0cHJvY2Vzc0NvbmZpZy5zdWJQcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKHN1YlByb2Nlc3NDb25maWcpe1xyXG4gICAgXHRcdFx0XHRpZiAoc3ViUHJvY2Vzc0NvbmZpZy5faWQgPT0gc3ViUHJvY2Vzc0lkKSB7XHJcbiAgICBcdFx0XHRcdFx0c3ViUHJvY2Vzc0NvbmYgPSBzdWJQcm9jZXNzQ29uZmlnO1xyXG4gICAgXHRcdFx0XHR9XHJcbiAgICBcdFx0XHR9KVxyXG4gICAgXHRcdH1cclxuICAgIFx0fSlcclxuICAgICAgLy8gVXBkYXRlIHRoZSBtb2RlbFxyXG4gICAgICBtb2RlbC5pZCA9IHN1YlByb2Nlc3NDb25mLl9pZDtcclxuICAgICAgbW9kZWwuc2VxID0gc3ViUHJvY2Vzcy5zZXE7XHJcbiAgICAgIG1vZGVsLm5hbWUgPSB1dGlsLmdldE5hbWUoc3ViUHJvY2Vzc0NvbmYubmFtZSwgbGFuZyk7XHJcbiAgICAgIG1vZGVsLmhlbHAgPSB1dGlsLmdldE5hbWUoc3ViUHJvY2Vzc0NvbmYuaGVscCwgbGFuZyk7XHJcbiAgICAgIG1vZGVsLmRhdGVzID0gc3ViUHJvY2Vzcy5kYXRlcztcclxuICAgICAgbW9kZWwuc3RlcCA9IHN1YlByb2Nlc3Muc3RlcDtcclxuICAgICAgcmVzb2x2ZShtb2RlbCk7XHJcbiAgICB9IGNhdGNoKGVycikge1xyXG4gICAgICByZWplY3QoZXJyKTtcclxuICAgIH1cclxuICB9KVxyXG59O1xyXG5cclxuXHJcblxyXG5cclxuZnVuY3Rpb24gcHJlcGFyZU5vdGlmaWNhdGlvblNjcmVlbigpe1xyXG5cclxuICBcIlwiXHJcbn07XHJcblxyXG4gbW9kdWxlLmV4cG9ydHMgPSB7XHJcblxyXG4gIGdldFByb2Nlc3M6IGdldFByb2Nlc3NcclxuXHJcbiB9XHJcbiIsIid1c2Ugc3RyaWN0JztcclxuXHJcblxyXG5mdW5jdGlvbiBnZXQoKSB7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuICAgIH0pO1xyXG5cclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0ge1xyXG5cclxuICAgIGdldDogZ2V0XHJcblxyXG59IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxudmFyIHV0aWwgPSByZXF1aXJlKCd1dGlsaXR5Jyk7XHJcbnZhciBhY3Rpb25zTW9kdWxlID0gcmVxdWlyZSgnLi9hY3Rpb25zJyk7XHJcbnZhciBmb3JtID0gcmVxdWlyZSgnLi9mb3JtJyk7XHJcblxyXG5cclxuLyoqXHJcbiAqIFByb2Nlc3MgTW9kdWxlXHJcbiAqXHJcbiAqIEBtb2R1bGUgbGliL3Byb2Nlc3NcclxuICogQGF1dGhvciBCcmVudCBHb3Jkb25cclxuICogQHZlcnNpb24gMC4xLjBcclxuICogQGRlc2NyaXB0aW9uIHRlc3QgZGVzY3JpcHRpb25cclxuICpcclxuICovXHJcblxyXG4vKipcclxuICogQ291bnQgYW4gYXJyYXkgb2YgaXRlbXNcclxuICpcclxuICogQHBhcmFtIHtBcnJheX0gYXJyIC0gdGhlIGFycmF5IGRhdGFcclxuICpcclxuICogQGV4YW1wbGUgJydcclxuICpcclxuICogQHJldHVybiAnJ1xyXG4gKlxyXG4gKi9cclxuZnVuY3Rpb24gY291bnQoYXJyKSB7XHJcbiAgICBpZiAoYXJyICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICByZXR1cm4gYXJyLmxlbmd0aDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIDA7XHJcbiAgICB9XHJcblxyXG59O1xyXG5cclxuLyoqXHJcbiAqIFByb2Nlc3MgcHJlLXJlcXVpc2l0ZXNcclxuICpcclxuICogQHBhcmFtIHtvYmplY3R9IHByZXJlcXVpc2l0ZXMgLSB0aGUgcHJlLXJlcXVpc2l0ZXMgY29uZmlnIGRhdGFcclxuICpcclxuICogQGV4YW1wbGUgJydcclxuICpcclxuICogQHJldHVybiAnJ1xyXG4gKlxyXG4gKi9cclxuZnVuY3Rpb24gcHJlUmVxdWlzaXRlcyhwcmVyZXF1aXNpdGVzLCBfV0ZJbnN0YW5jZSkge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIC8vIFVuY29tbWVudCBiZWxvdyBzZWN0aW9uIHdoZW4gcmVhZHkgdG8gaW1wbGVtZW50XHJcbiAgICAgICAgdmFyIGNvbXBsZXRlZCA9IFtdO1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIHV0aWwuc3luY0xvb3AocHJlcmVxdWlzaXRlcy5sZW5ndGgsIGZ1bmN0aW9uKGxvb3ApIHtcclxuICAgICAgICAgICAgICAgIHZhciBjb3VudGVyID0gbG9vcC5pdGVyYXRpb24oKTtcclxuICAgICAgICAgICAgICAgIHByZVJlcXVpc2l0ZShwcmVyZXF1aXNpdGVzW2NvdW50ZXJdLCBfV0ZJbnN0YW5jZSkudGhlbihmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgYWxsIHByZS1yZXF1aXNpdGVzIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkuXHJcbiAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkLnB1c2godHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9vcC5uZXh0KCk7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWQucHVzaChmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9vcC5icmVhaygpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGNvbXBsZXRlZC5ldmVyeShCb29sZWFuKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdQcmUtcmVxdWlzaXRlcyBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5LicsIHt9KTtcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3IgPSB1dGlsLmVycm9yKCdXRlByZVJlcXVpc2l0ZUVycm9yJywgJ05vdCBhbGwgcHJlLXJlcXVpc2l0ZXMgcGFzc2VkLicpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnJvcik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBQcm9jZXNzIHByZS1yZXF1aXNpdGUsIGV4ZWN1dGUgdGhlIHByZS1yZXF1aXNpdGUgY29uZGl0aW9uLlxyXG4gKlxyXG4gKiBAcGFyYW0ge29iamVjdH0gcHJlcmVxdWlzaXRlIC0gdGhlIHByZS1yZXF1aXNpdGUgY29uZmlnIGRhdGFcclxuICogQHBhcmFtIHtvYmplY3R9IF9XRkluc3RhbmNlIC0gdGhlIHdvcmtmbG93IGNvbnN0cnVjdG9yIGluc3RhbmNlXHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqIFByb2Nlc3MucHJlUmVxdWlzaXRlKGNvbmZpZywgY291bnRlciwgaW5zdGFuY2UsIGRvYyk7XHJcbiAqXHJcbiAqIEByZXR1cm4gJydcclxuICpcclxuICovXHJcbmZ1bmN0aW9uIHByZVJlcXVpc2l0ZShwcmVyZXF1aXNpdGUsIF9XRkluc3RhbmNlKSB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgc3dpdGNoIChwcmVyZXF1aXNpdGUuX3R5cGUpIHtcclxuICAgICAgICAgICAgLy8gVE9ETzogQWRkIHRoZSBjYWxsIHRvIHRoZSByZWxldmFudCBtZXRob2RzIGJhc2VkIG9uIHRoZSBfdHlwZSBhdHRyaWJ1dGUuIFNob3VsZCBjYWxsIHRoZSBnZW5lcmljIGFjdGlvbigpIG1ldGhvZC5cclxuICAgICAgICAgICAgY2FzZSAncHJvY2Vzc0luc3RhbmNlcyc6XHJcbiAgICAgICAgICAgICAgICB0cnkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgaWQgPSBwcmVyZXF1aXNpdGUuX3BhcmFtZXRlcjtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgX2ZpbHRlciA9IHByZXJlcXVpc2l0ZS5fZmlsdGVyO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdWJqZWN0Q291bnQgPSAnJztcclxuICAgICAgICAgICAgICAgICAgICBpZiAoX2ZpbHRlciAhPSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9maWx0ZXJPcGVyYXRvciA9IF9maWx0ZXIuX29wZXJhdG9yO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgeHBhdGhPcGVyYXRvciA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9maWx0ZXJPcGVyYXRvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnZ3JlYXRlclRoYW4nOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhwYXRoT3BlcmF0b3IgPSAnZ3QnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnbGVzc1RoYW4nOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhwYXRoT3BlcmF0b3IgPSAnbHQnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnZ3JlYXRlclRoYW5FcXVhbCc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeHBhdGhPcGVyYXRvciA9ICdnZSc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdsZXNzVGhhbkVxdWFsJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4cGF0aE9wZXJhdG9yID0gJ2xlJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2VxdWFsVG8nOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhwYXRoT3BlcmF0b3IgPSAnZXEnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnbm90RXF1YWxUbyc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeHBhdGhPcGVyYXRvciA9ICduZSc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9maWx0ZXJFbGVtZW50ID0gX2ZpbHRlci5fZWxlbWVudDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9maWx0ZXJFbGVtZW50ID0gX2ZpbHRlckVsZW1lbnQuc3BsaXQoJy4nKS5qb2luKCcvJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfZmlsdGVyVmFsdWUgPSBfZmlsdGVyLl92YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlubmVyWHBhdGggPSBcIi9cIiArIF9maWx0ZXJFbGVtZW50ICsgXCJbLiBlcSAnXCIgKyBfZmlsdGVyVmFsdWUgKyBcIiddXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmdWxsUGF0aCA9IFwiY291bnQoL3N1YnByb2Nlc3Nlc1tpZCBlcSAnXCIgKyBpZCArIFwiJ11cIiArIGlubmVyWHBhdGggKyBcIilcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3ViamVjdENvdW50ID0gSlNPTi54cGF0aChmdWxsUGF0aCwgX1dGSW5zdGFuY2UsIHt9KVswXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3ViamVjdENvdW50ID0gSlNPTi54cGF0aChcImNvdW50KC9zdWJwcm9jZXNzZXNbaWQgZXEgJ1wiICsgaWQgKyBcIiddKVwiLCBfV0ZJbnN0YW5jZSwge30pWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB2YXIgY29tcGFyZSA9IHV0aWwuY29tcGFyZShzdWJqZWN0Q291bnQsIHByZXJlcXVpc2l0ZS5fb3BlcmF0b3IsIHBhcnNlSW50KHByZXJlcXVpc2l0ZS5fdmFsdWUpKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY29tcGFyZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnUHJlLXJlcXVpc2l0ZXMgcGFzc2VkLicsIHt9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZSA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcmVyZXF1aXNpdGUubWVzc2FnZS5pMThuLmZpbHRlcihmdW5jdGlvbihpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5fbGFuZyA9PSAnZW4nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSA9IGl0ZW0udmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yID0gdXRpbC5lcnJvcignV0ZQcmVSZXF1aXNpdGVFcnJvcicsIG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnJvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgdmFyIGVycm9yID0gdXRpbC5lcnJvcignV0ZQcmVSZXF1aXNpdGVFcnJvcicsICdQcmUtcmVxdWlzaXRlIHR5cGU6ICcgKyBwcmVyZXF1aXNpdGUuX3R5cGUgKyAnIG5vdCBkZWZpbmVkLicpO1xyXG4gICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBQcm9jZXNzIHByZS1hY3Rpb25zc1xyXG4gKlxyXG4gKiBAcGFyYW0ge29iamVjdH0gcHJlQWN0aW9ucyAtIHRoZSBwcmUtYWN0aW9ucyBjb25maWcgZGF0YVxyXG4gKiBAcGFyYW0ge29iamVjdH0gX1dGSW5zdGFuY2UgLSB0aGUgY3VycmVudCB3b3JrZmxvdyBjb25zdHJ1Y3RvciBpbnN0YW5jZVxyXG4gKlxyXG4gKiBAZXhhbXBsZSAnJ1xyXG4gKlxyXG4gKiBAcmV0dXJuICcnXHJcbiAqXHJcbiAqL1xyXG5mdW5jdGlvbiBwcmVBY3Rpb25zKHByZUFjdGlvbnMsIF9XRkluc3RhbmNlKSB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgdmFyIGNvbXBsZXRlZCA9IFtdO1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIHV0aWwuc3luY0xvb3AocHJlQWN0aW9ucy5sZW5ndGgsIGZ1bmN0aW9uKGxvb3ApIHtcclxuICAgICAgICAgICAgICAgIHZhciBjb3VudGVyID0gbG9vcC5pdGVyYXRpb24oKTtcclxuICAgICAgICAgICAgICAgIGFjdGlvbihwcmVBY3Rpb25zW2NvdW50ZXJdLCBfV0ZJbnN0YW5jZSkudGhlbihmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgYWxsIHByZS1yZXF1aXNpdGVzIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkuXHJcbiAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkLnB1c2godHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9vcC5uZXh0KCk7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWQucHVzaChmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9vcC5icmVhaygpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGNvbXBsZXRlZC5ldmVyeShCb29sZWFuKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdQcmUtYWN0aW9ucyBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5LicsIHt9KTtcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3IgPSB1dGlsLmVycm9yKCdXRlByZVJlcXVpc2l0ZUVycm9yJywgJ05vdCBhbGwgcHJlLWFjdGlvbnMgcGFzc2VkLicpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnJvcik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBXb3JrZmxvdyBnZXQgc3ViLXByb2Nlc3MgZGF0YS5cclxuICpcclxuICogQHBhcmFtIHtzdHJpbmd9IGlkIC0gdGhlIHN1YlByb2Nlc3MgY29uZmlnIGlkXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBfV0ZJbnN0YW5jZSAtIHRoZSBjdXJyZW50IHdvcmtmbG93IGNvbnN0cnVjdG9yIGluc3RhbmNlXHJcbiAqXHJcbiAqIEBleGFtcGxlIFwiXCJcclxuICpcclxuICogQHJldHVybiBcIlwiXHJcbiAqXHJcbiAqL1xyXG5mdW5jdGlvbiBnZXRTdWJQcm9jZXNzKGlkLCBfV0ZJbnN0YW5jZSkge1xyXG4gICAgaWYgKF9XRkluc3RhbmNlLnN1YnByb2Nlc3NlcyA9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICByZXR1cm4gW107XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIF9XRkluc3RhbmNlLnN1YnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24oc3ViUHJvY2Vzcykge1xyXG4gICAgICAgICAgICBpZiAoc3ViUHJvY2Vzcy5pZCA9PSBpZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHN1YlByb2Nlc3M7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbn07XHJcblxyXG4vKipcclxuICogUHJvY2VzcyBzdWItcHJvY2Vzc1xyXG4gKlxyXG4gKiBAcGFyYW0ge29iamVjdH0gcHJvY2VzcyAtIHRoZSBjdXJyZW50IHByb2Nlc3MgaWQgYW5kIHNlcVxyXG4gKiBAcGFyYW0ge29iamVjdH0gc3ViUHJvY2VzcyAtIHRoZSBzdWItcHJvY2VzcyBpZCBhbmQgc2VxXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBkYXRhIC0gdGhlIHVzZXIgaW5wdXQgZGF0YVxyXG4gKiBAcGFyYW0ge29iamVjdH0gX1dGSW5zdGFuY2UgLSB0aGUgY3VycmVudCB3b3JrZmxvdyBjb25zdHJ1Y3RvciBpbnN0YW5jZVxyXG4gKlxyXG4gKiBAZXhhbXBsZSAnJ1xyXG4gKlxyXG4gKiBAcmV0dXJuICcnXHJcbiAqXHJcbiAqL1xyXG5mdW5jdGlvbiBzdWJQcm9jZXNzKHByb2Nlc3NJZCwgcHJvY2Vzc1NlcSwgc3ViUHJvY2Vzc0lkLCBzdWJQcm9jZXNzU2VxLCBkYXRhLCBfV0ZJbnN0YW5jZSkge1xyXG4gICAgLy8gR2V0IHRoZSBjdXJyZW50IHByb2Nlc3Mgc3ViUHJvY2VzcyBpbnN0YW5jZVxyXG4gICAgLy8gdmFyIHN1YlByb2Nlc3NTZXEgPSAxO1xyXG4gICAgdmFyIHN1YlByb2Nlc3MgPSBbXTtcclxuICAgIHZhciBwcm9jZXNzQ29uZiA9IFtdO1xyXG4gICAgdmFyIHN1YlByb2Nlc3NDb25mID0gW107XHJcbiAgICBfV0ZJbnN0YW5jZS5pbnN0YW5jZS5wcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKG9ialByb2Nlc3MpIHtcclxuICAgICAgICAgICAgaWYgKG9ialByb2Nlc3MuaWQgPT0gcHJvY2Vzc0lkICYmIG9ialByb2Nlc3Muc2VxID09IHByb2Nlc3NTZXEpIHtcclxuICAgICAgICAgICAgICAgIHZhciBzcExlbmd0aCA9IG9ialByb2Nlc3Muc3ViUHJvY2Vzc2VzLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgIG9ialByb2Nlc3Muc3ViUHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihvYmpTdWJQcm9jZXNzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9ialN1YlByb2Nlc3MuaWQgPT0gc3ViUHJvY2Vzc0lkICYmIG9ialN1YlByb2Nlc3Muc2VxID09IHN1YlByb2Nlc3NTZXEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHV1aWQgPSBvYmpTdWJQcm9jZXNzLnV1aWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9XRkluc3RhbmNlLnN1YnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24oc3ViUHJvY2Vzc0l0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdWJQcm9jZXNzSXRlbS5faWQgPT0gdXVpZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1YlByb2Nlc3MgPSBzdWJQcm9jZXNzSXRlbTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgICAgICAvLyBHZXQgdGhlIGN1cnJlbnQgc3ViUHJvY2VzcyBjb25maWd1cmF0aW9uXHJcbiAgICBfV0ZJbnN0YW5jZS5jb25maWcucHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihwcm9jZXNzQ29uZmlnKSB7XHJcbiAgICAgICAgICAgIGlmIChwcm9jZXNzQ29uZmlnLl9pZCA9PSBwcm9jZXNzSWQpIHtcclxuICAgICAgICAgICAgICAgIHByb2Nlc3NDb25mID0gcHJvY2Vzc0NvbmZpZztcclxuICAgICAgICAgICAgICAgIHByb2Nlc3NDb25maWcuc3ViUHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihzdWJQcm9jZXNzQ29uZmlnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHN1YlByb2Nlc3NDb25maWcuX2lkID09IHN1YlByb2Nlc3NJZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdWJQcm9jZXNzQ29uZiA9IHN1YlByb2Nlc3NDb25maWc7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLy8gaWYgKHN1YlByb2Nlc3MubGVuZ3RoICE9PSAwKSB7XHJcbiAgICAgICAgLy8gXHRzdWJQcm9jZXNzU2VxID0gc3ViUHJvY2Vzcy5sZW5ndGggKyAxO1xyXG4gICAgICAgIC8vIH1cclxuICAgICAgICAvLyBUaGUgZGVmYXVsdCBzdWJQcm9jZXNzIG1vZGVsXHJcblxyXG4gICAgLy9UT0RPOiBDaGFuZ2UgcmVxdWlyZWQgdG8gbW92ZSBpc0FjdGl2ZSB0byBzdWJQcm9jZXNzIGZpbGUuSGVyZVxyXG5cclxuICAgIHZhciBncm91cEtleSA9ICcnO1xyXG4gICAgdmFyIGJhc2VVVUlEID0gZGF0YS5iYXNlVVVJRDtcclxuICAgIGlmIChiYXNlVVVJRCAhPSB1bmRlZmluZWQgJiYgYmFzZVVVSUQgIT0gJycgJiYgYmFzZVVVSUQubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIHZhciBwcmV2aW91c09iamVjdCA9IEpTT04ueHBhdGgoXCIvc3VicHJvY2Vzc2VzW19pZCBlcSAnXCIgKyBiYXNlVVVJRCArIFwiJ11cIiwgX1dGSW5zdGFuY2UsIHt9KVswXTtcclxuICAgICAgICBncm91cEtleSA9IHByZXZpb3VzT2JqZWN0Lmdyb3VwS2V5O1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBncm91cEtleSA9IGdlbmVyYXRlVVVJRCgpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICB2YXIgc3ViUHJvY2Vzc09iamVjdElkID0gX1dGSW5zdGFuY2UucHJvZmlsZSArICc6JyArIF9XRkluc3RhbmNlLmFwcCArICc6JyArIHByb2Nlc3NJZCArICc6JyArIHByb2Nlc3NTZXEgKyAnOicgKyBzdWJQcm9jZXNzSWQgKyAnOicgKyBzdWJQcm9jZXNzU2VxO1xyXG4gICAgdmFyIG1vZGVsID0ge1xyXG4gICAgICAgIF9pZDogc3ViUHJvY2Vzc09iamVjdElkLFxyXG4gICAgICAgIGlkOiBzdWJQcm9jZXNzSWQsXHJcbiAgICAgICAgdHlwZTogJ3dvcmtmbG93SW5zdGFuY2VTdWJQcm9jZXNzJyxcclxuICAgICAgICBzZXE6IHN1YlByb2Nlc3NTZXEsXHJcbiAgICAgICAgaW5pdGlhdGVkOiBmYWxzZSxcclxuICAgICAgICBkYXRlczoge1xyXG4gICAgICAgICAgICBjcmVhdGVkOiAnJyxcclxuICAgICAgICAgICAgdmFsaWQ6ICcnLFxyXG4gICAgICAgICAgICBkdWU6ICcnLFxyXG4gICAgICAgICAgICBjbG9zZWQ6ICcnXHJcbiAgICAgICAgfSxcclxuICAgICAgICBjb21wbGV0ZTogZmFsc2UsXHJcbiAgICAgICAgaW5kaWNhdG9yczogW10sXHJcbiAgICAgICAgc3RlcDoge30sXHJcbiAgICAgICAgYWN0aXZlOiB0cnVlLFxyXG4gICAgICAgIGdyb3VwS2V5OiBncm91cEtleSxcclxuICAgICAgICBjaGFubmVsczogW1xyXG4gICAgICAgICAgICBcImNvbW11bml0eV9cIiArIGFwcC5TQ09QRS5jb21tdW5pdHlJZCxcclxuICAgICAgICAgICAgXCJwcm9maWxlX1wiICsgYXBwLlNDT1BFLnByb2ZpbGVJZCxcclxuICAgICAgICAgICAgXCJhcHBsaWNhdGlvbl9cIiArIGFwcC5TQ09QRS5hcHBsaWNhdGlvbklkLFxyXG4gICAgICAgICAgICBcImNvbW11bml0eV9cIiArIGFwcC5TQ09QRS5jb21tdW5pdHlJZCArIFwiX2FwcGxpY2F0aW9uX1wiICsgYXBwLlNDT1BFLmFwcGxpY2F0aW9uSWRcclxuICAgICAgICBdXHJcbiAgICB9O1xyXG4gICAgX1dGSW5zdGFuY2Uuc3VicHJvY2Vzc2VzLnB1c2gobW9kZWwpO1xyXG4gICAgLy8gUmV0dXJuIGEgcHJvbWlzZVxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIC8vIENhdGNoIGFsbCB1bmNhdWdodCBlcnJvcnNcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAvLyAxLiBQcm9jZXNzIHRoZSBwcmUtYWN0aW9uc1xyXG4gICAgICAgICAgICB2YXIgcHJlQWN0aW9uc0NvbmYgPSBwcm9jZXNzQ29uZi5wcmVBY3Rpb25zO1xyXG4gICAgICAgICAgICBwcmVBY3Rpb25zKHByZUFjdGlvbnNDb25mLCBfV0ZJbnN0YW5jZSkudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgIC8vIDIuIFByb2Nlc3MgdGhlIHByZS1yZXF1aXNpdGVzXHJcbiAgICAgICAgICAgICAgICB2YXIgcHJlcmVxdWlzaXRlQ29uZiA9IHByb2Nlc3NDb25mLnByZXJlcXVpc2l0ZXM7XHJcbiAgICAgICAgICAgICAgICBwcmVSZXF1aXNpdGVzKHByZXJlcXVpc2l0ZUNvbmYsIF9XRkluc3RhbmNlKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIDMuIEluaXRpYXRlIHRoZSBzdWJQcm9jZXNzXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGluaXRpYXRlQ29uZiA9IHN1YlByb2Nlc3NDb25mLmluaXRpYXRlO1xyXG4gICAgICAgICAgICAgICAgICAgIGluaXRpYXRlKGluaXRpYXRlQ29uZiwgc3ViUHJvY2VzcywgZGF0YSkudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9VcGRhdGUgdGhlIHN1YlByb2Nlc3MgbW9kZWxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWwuaW5pdGlhdGVkID0gcmVzdWx0LmRhdGEuaW5pdGlhdGVkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtb2RlbC5kYXRlcyA9IHJlc3VsdC5kYXRhLmRhdGVzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBFeGVjdXRlIHRoZSBmaXJzdCBzdGVwXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdGVwSWQgPSBzdWJQcm9jZXNzQ29uZi5zdGVwc1swXS5faWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0cmFuc2l0aW9uSWQgPSBzdWJQcm9jZXNzQ29uZi5zdGVwc1swXS50cmFuc2l0aW9uc1swXS5faWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdGVwU2VxID0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3RlcChwcm9jZXNzSWQsIHByb2Nlc3NTZXEsIHN1YlByb2Nlc3NJZCwgc3ViUHJvY2Vzc1NlcSwgc3RlcElkLCBzdGVwU2VxLCBkYXRhLCBfV0ZJbnN0YW5jZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsLnN0ZXAgPSByZXN1bHQuZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgdGhlIGluZGljYXRvciBzZWN0aW9ucyBvZiB0aGUgc3ViUHJvY2Vzc1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRpY2F0b3JzKHN1YlByb2Nlc3NDb25mLmluZGljYXRvcnMsIF9XRkluc3RhbmNlLCBtb2RlbC5faWQpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlbC5pbmRpY2F0b3JzID0gcmVzdWx0LmRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEV4ZWN1dGUgdGhlIHRyYW5zaXRpb25zLCBpZiBhdXRvXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zaXRpb24ocHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIHN0ZXBJZCwgdHJhbnNpdGlvbklkLCBkYXRhLCBfV0ZJbnN0YW5jZSkudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgc3ViUHJvY2VzcyBzdGVwIGRhdGFcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0cmFuc1Jlc3VsdCA9IHJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsLnN0ZXAgPSByZXN1bHQuZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIDQuIFByb2Nlc3MgdGhlIHBvc3QtYWN0aW9uc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBvc3RBY3Rpb25zQ29uZiA9IHByb2Nlc3NDb25mLnBvc3RBY3Rpb25zO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdEFjdGlvbnMocG9zdEFjdGlvbnNDb25mLCBfV0ZJbnN0YW5jZSkudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2Vzcyh0cmFuc1Jlc3VsdC5tZXNzYWdlLCBtb2RlbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9XRkluc3RhbmNlLnN1YnByb2Nlc3NlcyA9IF9XRkluc3RhbmNlLnN1YnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24ob2JqKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIShvYmouX2lkID09IHN1YlByb2Nlc3NPYmplY3RJZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgX1dGSW5zdGFuY2Uuc3VicHJvY2Vzc2VzID0gX1dGSW5zdGFuY2Uuc3VicHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihvYmopIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICEob2JqLl9pZCA9PSBzdWJQcm9jZXNzT2JqZWN0SWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBfV0ZJbnN0YW5jZS5zdWJwcm9jZXNzZXMgPSBfV0ZJbnN0YW5jZS5zdWJwcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKG9iaikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAhKG9iai5faWQgPT0gc3ViUHJvY2Vzc09iamVjdElkKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFByb2Nlc3MgaW5pdGlhdGVcclxuICpcclxuICogQHBhcmFtIHtvYmplY3R9IGluaXRpYXRlIC0gdGhlIGluaXRpYXRlIGNvbmZpZyBkYXRhXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBkYXRhIC0gdGhlIHVzZXIgaW5wdXQgZGF0YVxyXG4gKlxyXG4gKiBAZXhhbXBsZSAnJ1xyXG4gKlxyXG4gKiBAcmV0dXJuICcnXHJcbiAqXHJcbiAqL1xyXG5mdW5jdGlvbiBpbml0aWF0ZShpbml0aWF0ZSwgc3ViUHJvY2VzcywgZGF0YSkge1xyXG4gICAgdmFyIGNvbXBsZXRlZCA9IFtdO1xyXG4gICAgdmFyIHJlc3VsdCA9IHtcclxuICAgICAgICBpbml0aWF0ZWQ6IGZhbHNlLFxyXG4gICAgICAgIGRhdGVzOiB7XHJcbiAgICAgICAgICAgIGNyZWF0ZWQ6ICcnLFxyXG4gICAgICAgICAgICB2YWxpZDogJycsXHJcbiAgICAgICAgICAgIGR1ZTogJycsXHJcbiAgICAgICAgICAgIGNsb3NlZDogJydcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKGluaXRpYXRlLl90eXBlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICd1c2VyJzpcclxuICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGUgc3ViUHJvY2VzcyBpbml0aWF0aW9uIGlzIHVzZXIgZGVmaW5lZCB0aGVuXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmRhdGVzLmNyZWF0ZWQgPSBkYXRhLmNyZWF0ZWREYXRlO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpbml0aWF0ZS5kYXRlcy52YWxpZC5fdHlwZSA9PSAndXNlclNlbGVjdGVkJyB8fCBpbml0aWF0ZS5kYXRlcy52YWxpZC5fdHlwZSA9PSAnYXV0b1NlbGVjdGVkJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS52YWxpZERhdGUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmRhdGVzLnZhbGlkID0gZGF0YS52YWxpZERhdGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dGlsLndhcm4oJ1dGSW5pdGlhdGVFcnJvcicsICdObyB2YWxpZCBkYXRlIHBhc3NlZCBpbiAtIHtkYXRhLnZhbGlkRGF0ZX0nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoaW5pdGlhdGUuZGF0ZXMuZHVlLl90eXBlID09ICd1c2VyU2VsZWN0ZWQnIHx8IGluaXRpYXRlLmRhdGVzLnZhbGlkLl90eXBlID09ICdhdXRvU2VsZWN0ZWQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLmR1ZURhdGUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmRhdGVzLmR1ZSA9IGRhdGEuZHVlRGF0ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0aWwud2FybignV0ZJbml0aWF0ZUVycm9yJywgJ05vIGR1ZSBkYXRlIHBhc3NlZCBpbiAtIHtkYXRhLmR1ZURhdGV9Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmluaXRpYXRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ1N1Yi1Qcm9jZXNzIGluaXRpYXRlIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkuJywgcmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnYXV0byc6XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIHN1YlByb2Nlc3MgaW5pdGlhdGlvbiBpcyB1c2VyIGRlZmluZWQgdGhlblxyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5kYXRlcy5jcmVhdGVkID0gZGF0YS5jcmVhdGVkRGF0ZTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaW5pdGlhdGUuZGF0ZXMudmFsaWQuX3R5cGUgPT0gJ3VzZXJTZWxlY3RlZCcgfHwgaW5pdGlhdGUuZGF0ZXMudmFsaWQuX3R5cGUgPT0gJ2F1dG9TZWxlY3RlZCcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEudmFsaWREYXRlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5kYXRlcy52YWxpZCA9IGRhdGEudmFsaWREYXRlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXRpbC53YXJuKCdXRkluaXRpYXRlRXJyb3InLCAnTm8gdmFsaWQgZGF0ZSBwYXNzZWQgaW4gLSB7ZGF0YS52YWxpZERhdGV9Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGluaXRpYXRlLmRhdGVzLmR1ZS5fdHlwZSA9PSAndXNlclNlbGVjdGVkJyB8fCBpbml0aWF0ZS5kYXRlcy5kdWUuX3R5cGUgPT0gJ2F1dG9TZWxlY3RlZCcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuZHVlRGF0ZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuZGF0ZXMuZHVlID0gZGF0YS5kdWVEYXRlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXRpbC53YXJuKCdXRkluaXRpYXRlRXJyb3InLCAnTm8gZHVlIGRhdGUgcGFzc2VkIGluIC0ge2RhdGEuZHVlRGF0ZX0nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICByZXN1bHQuaW5pdGlhdGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnU3ViLVByb2Nlc3MgaW5pdGlhdGUgY29tcGxldGVkIHN1Y2Nlc3NmdWxseS4nLCByZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvciA9IHV0aWwuZXJyb3IoJ1dGSW5pdGlhdGVFcnJvcicsICdJbml0aWF0ZSB0eXBlOiAnICsgaW5pdGlhdGUuX3R5cGUgKyAnIG5vdCBkZWZpbmVkLicpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnJvcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHN1YlByb2Nlc3MuY29tcGxldGUgPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIGluaXQoKTtcclxuICAgICAgICB9IGVsc2UgaWYgKCFzdWJQcm9jZXNzLmNvbXBsZXRlKSB7XHJcbiAgICAgICAgICAgIGlmIChpbml0aWF0ZS5wYXJhbGxlbEluc3RhbmNlcykge1xyXG4gICAgICAgICAgICAgICAgaW5pdCgpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdmFyIGVycm9yID0gdXRpbC5lcnJvcignV0ZJbml0aWF0ZUVycm9yJywgJ1N1Yi1wcm9jZXNzOiAnICsgc3ViUHJvY2Vzcy5pZCArICcgc3RpbGwgYWN0aXZlIGFuZCBwYXJhbGxlbCBpbnN0YW5jZXMgYXJlIG5vdCBhbGxvd2VkLicpO1xyXG4gICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICB9KTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBQcm9jZXNzIHN0ZXBcclxuICpcclxuICogQHBhcmFtIHtzdHJpbmd9IHByb2Nlc3NJZCAtIHRoZSBjdXJyZW50IHByb2Nlc3MgaWRcclxuICogQHBhcmFtIHtzdHJpbmd9IHN1YlByb2Nlc3NJZCAtIHRoZSBjdXJyZW50IHN1Yi1wcm9jZXNzIGlkXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdGVwSWQgLSB0aGUgY3VycmVudCBzdWItcHJvY2VzcyBzdGVwIGlkXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBzdGVwU2VxIC0gdGhlIGN1cnJlbnQgc3ViLXByb2Nlc3Mgc3RlcCBpbnN0YW5jZSBjb3VudGVyIC8gc2VxdWVuY2VcclxuICogQHBhcmFtIHtvYmplY3R9IGRhdGEgLSB0aGUgdXNlciBpbnB1dCBkYXRhXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBfV0ZJbnN0YW5jZSAtIHRoZSBjdXJyZW50IF9XRkluc3RhbmNlIGNvbnN0cnVjdG9yIGluc3RhbmNlXHJcbiAqXHJcbiAqIEBleGFtcGxlICcnXHJcbiAqXHJcbiAqIEByZXR1cm4gJydcclxuICpcclxuICovXHJcbmZ1bmN0aW9uIHN0ZXAocHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIHN0ZXBJZCwgc3RlcFNlcSwgZGF0YSwgX1dGSW5zdGFuY2UpIHtcclxuXHJcblxyXG4gICAgLy8gRGVmYXVsdCBzdGVwIG1vZGVsXHJcbiAgICB2YXIgbW9kZWwgPSB7XHJcbiAgICAgICAgaWQ6ICcnLFxyXG4gICAgICAgIHNlcTogJycsXHJcbiAgICAgICAgc3RhdHVzOiAnJyxcclxuICAgICAgICBtZXNzYWdlOiAnJyxcclxuICAgICAgICBhc3NpZ25lZFRvOiB7XHJcbiAgICAgICAgICAgIHVzZXJJZDogJycsXHJcbiAgICAgICAgICAgIG5hbWU6ICcnXHJcbiAgICAgICAgfSxcclxuICAgICAgICBhc3NpZ25tZW50OiB7fSxcclxuICAgICAgICBjb21tZW50OiAnJ1xyXG4gICAgfTtcclxuICAgIHZhciBzdWJQcm9jZXNzID0ge307XHJcbiAgICB2YXIgdXVpZCA9ICcnO1xyXG4gICAgdmFyIGluc3RTdWJQcm9jZXNzO1xyXG4gICAgdmFyIHN0ZXAgPSB7fTtcclxuICAgIHZhciB0cmFuc2l0aW9uSWQgPSAnJztcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAvL0dldCB0aGUgY3VycmVudCBzdWJQcm9jZXNzIGluc3RhbmNlIGRhdGFcclxuXHJcblxyXG5cclxuICAgICAgICAgICAgX1dGSW5zdGFuY2UuaW5zdGFuY2UucHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihvYmpQcm9jZXNzKSB7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChvYmpQcm9jZXNzLmlkID09IHByb2Nlc3NJZCAmJiBvYmpQcm9jZXNzLnNlcSA9PSBwcm9jZXNzU2VxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqUHJvY2Vzcy5zdWJQcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKG9ialN1YlByb2Nlc3MpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmpTdWJQcm9jZXNzLmlkID09IHN1YlByb2Nlc3NJZCAmJiBvYmpTdWJQcm9jZXNzLnNlcSA9PSBzdWJQcm9jZXNzU2VxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dWlkID0gb2JqU3ViUHJvY2Vzcy51dWlkO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIF9XRkluc3RhbmNlLnN1YnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24oc3ViUHJvY2Vzc0l0ZW0pIHtcclxuICAgICAgICAgICAgICAgIGlmIChzdWJQcm9jZXNzSXRlbS5faWQgPT0gdXVpZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGluc3RTdWJQcm9jZXNzID0gc3ViUHJvY2Vzc0l0ZW07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIF9XRkluc3RhbmNlLmNvbmZpZy5wcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKG9ialByb2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgIGlmIChvYmpQcm9jZXNzLl9pZCA9PSBwcm9jZXNzSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmpQcm9jZXNzLnN1YlByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24ob2JqU3ViUHJvY2Vzcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqU3ViUHJvY2Vzcy5faWQgPT0gc3ViUHJvY2Vzc0lkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJQcm9jZXNzID0gb2JqU3ViUHJvY2VzcztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ialN1YlByb2Nlc3Muc3RlcHMuZmlsdGVyKGZ1bmN0aW9uKG9ialN0ZXApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqU3RlcC5faWQgPT0gc3RlcElkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ZXAgPSBvYmpTdGVwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSBzdWItcHJvY2VzcyBzdGVwIGRhdGFcclxuICAgICAgICAgICAgbW9kZWwuaWQgPSBzdGVwSWQ7XHJcbiAgICAgICAgICAgIG1vZGVsLnNlcSA9IHN0ZXBTZXE7XHJcbiAgICAgICAgICAgIG1vZGVsLnN0YXR1cyA9IHN0ZXAuX3NldEluc3RhbmNlU3RhdHVzVG87XHJcbiAgICAgICAgICAgIG1vZGVsLm1lc3NhZ2UgPSBzdGVwLl9zZXRTdGF0dXNNc2dUbztcclxuICAgICAgICAgICAgLy9tb2RlbC5hc3NpZ25lZFRvLnVzZXJJZCA9IGRhdGEudXNlcklkICE9PSB1bmRlZmluZWQgPyBkYXRhLnVzZXJJZCA6ICcnO1xyXG4gICAgICAgICAgICAvL21vZGVsLmFzc2lnbmVkVG8ubmFtZSA9IGRhdGEubmFtZSAhPT0gdW5kZWZpbmVkID8gZGF0YS5uYW1lIDogJyc7XHJcbiAgICAgICAgICAgIG1vZGVsLmNvbW1lbnQgPSBkYXRhLmNvbW1lbnQgIT09IHVuZGVmaW5lZCA/IGRhdGEuY29tbWVudCA6ICcnO1xyXG4gICAgICAgICAgICAvLyBVcGRhdGUgdGhlIGluZGljYXRvciBkb2N1bWVudHMgcHJvY2VzcyBzdGVwIGRhdGFcclxuICAgICAgICAgICAgLy9jb21zby5sb2coJ2luc3RTdWJQcm9jZXNzPT09Jyk7XHJcbiAgICAgICAgICAgIC8vY29tc28ubG9nKGluc3RTdWJQcm9jZXNzKTtcclxuICAgICAgICAgICAgdmFyIGluZGljYXRvcnMgPSBpbnN0U3ViUHJvY2VzcyAhPT0gdW5kZWZpbmVkID8gaW5zdFN1YlByb2Nlc3MuaW5kaWNhdG9ycyA6IFtdO1xyXG4gICAgICAgICAgICBpbmRpY2F0b3JEb2NzKHByb2Nlc3NJZCwgaW5kaWNhdG9ycywgbW9kZWwsIF9XRkluc3RhbmNlKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgLy8gSWYgYWN0aW9ucyBhcmUgc3BlY2lmaWVkLCBleGVjdXRlIHRoZW1cclxuICAgICAgICAgICAgICAgIHZhciBjcmVhdGVkSUQgPSBfV0ZJbnN0YW5jZS5wcm9maWxlICsgJzonICsgX1dGSW5zdGFuY2UuYXBwICsgJzonICsgcHJvY2Vzc0lkICsgJzonICsgcHJvY2Vzc1NlcSArICc6JyArIHN1YlByb2Nlc3NJZCArICc6JyArIHN1YlByb2Nlc3NTZXE7XHJcbiAgICAgICAgICAgICAgICB1dWlkID0gY3JlYXRlZElEO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChzdGVwLmFjdGlvbnNbMF0gIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbnMoc3RlcC5hY3Rpb25zLCBwcm9jZXNzSWQsIHByb2Nlc3NTZXEsIHN1YlByb2Nlc3NJZCwgc3ViUHJvY2Vzc1NlcSwgc3ViUHJvY2VzcywgbW9kZWwsIF9XRkluc3RhbmNlLCBkYXRhLCB1dWlkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEV4ZWN1dGUgdGhlIHRyYW5zaXRpb25zLCBpZiBhdXRvXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ0FjdGlvbnMgY29tcGxldGVkIHN1Y2Nlc3NmdWxseS4nLCBtb2RlbCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gRWxzZSB0YXNrcyBhcmUgc3ByZWNpZmllZCwgZXhlY3V0ZSB0aGVtXHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHN0ZXAudGFzayAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gTWFrZSBhc3NpZ25tZW50c1xyXG4gICAgICAgICAgICAgICAgICAgIHRhc2socHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdGVwLnRhc2ssIGNyZWF0ZWRJRCwgbW9kZWwpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRvIHRhc2sgc3VjY2VzcyBoYW5kbGluZ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnVGFzayBjb21wbGV0ZS4nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ1Rhc2sgYXdhaXRpbmcgdXNlciBhY3Rpb24uJywgbW9kZWwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBQcm9jZXNzIGluZGljYXRvciB1cGRhdGVzXHJcbiAqXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBhY3Rpb25zIC0gdGhlIGFjdGlvbnMgY29uZmlnIGRhdGFcclxuICogQHBhcmFtIHtvYmplY3R9IHN1YlByb2Nlc3MgLSB0aGUgY3VycmVudCBzdWItcHJvY2VzcyBmb3JtIGNvbmZpZyBkYXRhXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBfV0ZJbnN0YW5jZSAtIHRoZSBjdXJyZW50IHdvcmtmbG93IGNvbnN0cnVjdG9yIGluc3RhbmNlXHJcbiAqXHJcbiAqIEBleGFtcGxlICcnXHJcbiAqXHJcbiAqIEByZXR1cm4gJydcclxuICpcclxuICovXHJcbmZ1bmN0aW9uIGluZGljYXRvcnMoaW5kaWNhdG9ycywgX1dGSW5zdGFuY2UsIHNwdXVpZCkge1xyXG4gICAgdmFyIG1vZGVsID0gW107XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSBpbmRpY2F0b3Igc2VjdGlvbnMgb2YgdGhlIHN1YlByb2Nlc3NcclxuXHJcbiAgICAgICAgICAgIHZhciBhcnJheSA9IEpTT04ueHBhdGgoXCJpbmRpY2F0b3JzW2ZuOmNvdW50KC4vd29ya2Zsb3dzL3Byb2Nlc3Nlc1tzdWJQcm9jZXNzVVVJRCBlcSAnXCIgKyBzcHV1aWQgKyBcIiddKSBndCAwXVwiLCBfV0ZJbnN0YW5jZSwge30pO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGFycmF5Lmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaW5kaWNhdG9yID0gYXJyYXlbal07XHJcbiAgICAgICAgICAgICAgICB2YXIgaW5kaWNhdG9yTW9kZWwgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWQ6ICcnLFxyXG4gICAgICAgICAgICAgICAgICAgIGluc3RhbmNlczogW11cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHZhciBpbnN0YW5jZU1vZGVsID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHV1aWQ6ICcnLFxyXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnJyxcclxuICAgICAgICAgICAgICAgICAgICBrZXk6ICcnLFxyXG4gICAgICAgICAgICAgICAgICAgIHNlcTogMVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaW5kaWNhdG9yTW9kZWwuaWQgPSBpbmRpY2F0b3IuY2F0ZWdvcnkudGVybTtcclxuICAgICAgICAgICAgICAgIGluc3RhbmNlTW9kZWwudXVpZCA9IGluZGljYXRvci5faWQ7XHJcbiAgICAgICAgICAgICAgICBpbnN0YW5jZU1vZGVsLnRpdGxlID0gaW5kaWNhdG9yLnRpdGxlO1xyXG4gICAgICAgICAgICAgICAgaW5zdGFuY2VNb2RlbC5rZXkgPSAnJztcclxuICAgICAgICAgICAgICAgIGluc3RhbmNlTW9kZWwuc2VxID0gaW5kaWNhdG9yLm1vZGVsLnBlbmRpbmcuc2VxOyAvLyBpbmRpY2F0b3Igc2VxIG51bWJlciBoZXJlIHdoaWNoIGlzIGdldHRpbmcgdXBkYXRlZC5cclxuICAgICAgICAgICAgICAgIGluZGljYXRvck1vZGVsLmluc3RhbmNlcy5wdXNoKGluc3RhbmNlTW9kZWwpO1xyXG4gICAgICAgICAgICAgICAgbW9kZWwucHVzaChpbmRpY2F0b3JNb2RlbCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnUHJvY2VzcyBpbmRpY2F0b3IgbW9kZWwgdXBkYXRlZC4nLCBtb2RlbCk7XHJcbiAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgIH1cclxuICAgIH0pXHJcbn07XHJcblxyXG4vKipcclxuICogUHJvY2VzcyBhc3NpZ24gdXNlclxyXG4gKlxyXG4gKiBAcGFyYW0ge3N0cmluZ30gcHJvY2Vzc0lkIC0gdGhlIFdvcmtmbG93IGNvbmZpZyAvIGRlZmluaXRpb24gcHJvY2VzcyBpZFxyXG4gKiBAcGFyYW0ge251bWJlcn0gcHJvY2Vzc1NlcSAtIHRoZSBXb3JrZmxvdyBpbnN0YW5jZSBwcm9jZXNzIHNlcVxyXG4gKiBAcGFyYW0ge3N0cmluZ30gc3ViUHJvY2Vzc0lkIC0gdGhlIFdvcmtmbG93IGNvbmZpZyAvIGRlZmluaXRpb24gc3ViLXByb2Nlc3MgaWRcclxuICogQHBhcmFtIHtudW1iZXJ9IHN1YlByb2Nlc3NTZXEgLSB0aGUgV29ya2Zsb3cgaW5zdGFuY2Ugc3ViLXByb2Nlc3Mgc2VxXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdGVwSWQgLSB0aGUgV29ya2Zsb3cgY29uZmlnIC8gZGVmaW5pdGlvbiBzdGVwIGlkXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSB0cmFuc2l0aW9uSWQgLSB0aGUgV29ya2Zsb3cgY29uZmlnIC8gZGVmaW5pdGlvbiB0cmFuc2l0aW9uIGlkXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSB1c2VyIC0gdGhlIHVzZXIgdG8gYXNzaWduIHRvXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBfV0ZJbnN0YW5jZSAtIHRoZSBjdXJyZW50IHdvcmtmbG93IGNvbnN0cnVjdG9yIGluc3RhbmNlXHJcbiAqXHJcbiAqIEBleGFtcGxlICcnXHJcbiAqXHJcbiAqIEByZXR1cm4gJydcclxuICpcclxuICovXHJcbmZ1bmN0aW9uIGFzc2lnblVzZXIocHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIHVzZXIsIF9XRkluc3RhbmNlKSB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgdmFyIHV1aWQgPSAnJztcclxuICAgICAgICAgICAgLy8gR2V0IHRoZSBjdXJyZW50IHN1YlByb2Nlc3MgaW5zdGFuY2UgZGF0YVxyXG4gICAgICAgICAgICBfV0ZJbnN0YW5jZS5pbnN0YW5jZS5wcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKG9ialByb2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgIGlmIChvYmpQcm9jZXNzLmlkID09IHByb2Nlc3NJZCAmJiBvYmpQcm9jZXNzLnNlcSA9PSBwcm9jZXNzU2VxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqUHJvY2Vzcy5zdWJQcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKG9ialN1YlByb2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9ialN1YlByb2Nlc3MuaWQgPT0gc3ViUHJvY2Vzc0lkICYmIG9ialN1YlByb2Nlc3Muc2VxID09IHN1YlByb2Nlc3NTZXEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV1aWQgPSBvYmpTdWJQcm9jZXNzLnV1aWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICBfV0ZJbnN0YW5jZS5zdWJwcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKHN1YlByb2Nlc3NJdGVtKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoc3ViUHJvY2Vzc0l0ZW0uX2lkID09IHV1aWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIHVzZXIgZGV0YWlsc1xyXG4gICAgICAgICAgICAgICAgICAgIHN1YlByb2Nlc3NJdGVtLnN0ZXAuYXNzaWduZWRUby51c2VySWQgPSB1c2VyLmlkO1xyXG4gICAgICAgICAgICAgICAgICAgIHN1YlByb2Nlc3NJdGVtLnN0ZXAuYXNzaWduZWRUby5uYW1lID0gdXNlci5uYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgaW5kaWNhdG9ycyB1c2VyIGRldGFpbHNcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaW5kaWNhdG9ycyA9IHN1YlByb2Nlc3NJdGVtLmluZGljYXRvcnM7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpbmRpY2F0b3JzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbmRpY2F0b3IgPSBpbmRpY2F0b3JzW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGluZGljYXRvci5pbnN0YW5jZXMubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbnN0YW5jZSA9IGluZGljYXRvci5pbnN0YW5jZXNbal07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBrID0gMDsgayA8IF9XRkluc3RhbmNlLmluZGljYXRvcnMubGVuZ3RoOyBrKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZG9jID0gX1dGSW5zdGFuY2UuaW5kaWNhdG9yc1trXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5zdGFuY2UudXVpZCA9PSBkb2MuX2lkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvYy53b3JrZmxvd3MuZmlsdGVyKGZ1bmN0aW9uKHdvcmtmbG93KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAod29ya2Zsb3cuaWQgPT0gX1dGSW5zdGFuY2UuY29uZmlnLl9pZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdvcmtmbG93LnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24ocHJvY2Vzc0l0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHByb2Nlc3NJdGVtLmlkID09IHByb2Nlc3NJZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSB1c2VyIGlkIGFuZCBuYW1lIGluIHRoZSBkb2N1bWVudFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc0l0ZW0uc3RlcC5hc3NpZ25lZFRvLnVzZXJJZCA9IHVzZXIuaWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzSXRlbS5zdGVwLmFzc2lnbmVkVG8ubmFtZSA9IHVzZXIubmFtZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdVc2VyIGFzc2lnbmVkIHN1Y2Nlc3NmdWxseS4gVXNlcklkOiBcIicgKyB1c2VyLmlkICsgJ1wiLCBOYW1lOiBcIicgKyB1c2VyLm5hbWUgKyAnXCInLCBzdWJQcm9jZXNzSXRlbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn07XHJcbi8qKlxyXG4gKiBQcm9jZXNzIGluZGljYXRvciBkb2N1bWVudCB1cGRhdGVzXHJcbiAqXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBhY3Rpb25zIC0gdGhlIGFjdGlvbnMgY29uZmlnIGRhdGFcclxuICogQHBhcmFtIHtvYmplY3R9IHN1YlByb2Nlc3MgLSB0aGUgY3VycmVudCBzdWItcHJvY2VzcyBmb3JtIGNvbmZpZyBkYXRhXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBfV0ZJbnN0YW5jZSAtIHRoZSBjdXJyZW50IHdvcmtmbG93IGNvbnN0cnVjdG9yIGluc3RhbmNlXHJcbiAqXHJcbiAqIEBleGFtcGxlICcnXHJcbiAqXHJcbiAqIEByZXR1cm4gJydcclxuICpcclxuICovXHJcbmZ1bmN0aW9uIGluZGljYXRvckRvY3MocHJvY2Vzc0lkLCBpbmRpY2F0b3JzLCBzdGVwLCBfV0ZJbnN0YW5jZSkge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgaW5kaWNhdG9yIHNlY3Rpb25zIG9mIHRoZSBzdWJQcm9jZXNzXHJcbiAgICAgICAgICAgIGlmIChpbmRpY2F0b3JzID09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGVycm9yID0gdXRpbC5lcnJvcignV0ZJbmRpY2F0b3JzVXBkYXRlJywgJ0luZGljYXRvcnMgcGFyYW1ldGVyIGlzIHJlcXVpcmVkLiAtIFZhbHVlOiAnICsgaW5kaWNhdG9ycylcclxuICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpbmRpY2F0b3JzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9jb21zby5sb2coJy0tPj4+Pj4+IEZpcnN0IElmIGNvbnNpdGlvbicpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpbmRpY2F0b3IgPSBpbmRpY2F0b3JzW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgaW5kaWNhdG9yLmluc3RhbmNlcy5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2NvbXNvLmxvZygnLS0+Pj4+Pj4gU2Vjb25kIElmIGNvbnNpdGlvbicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5zdGFuY2UgPSBpbmRpY2F0b3IuaW5zdGFuY2VzW2pdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBrID0gMDsgayA8IF9XRkluc3RhbmNlLmluZGljYXRvcnMubGVuZ3RoOyBrKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vY29tc28ubG9nKCctLT4+Pj4+PiBUaGlyZCBJZiBjb25zaXRpb24nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkb2MgPSBfV0ZJbnN0YW5jZS5pbmRpY2F0b3JzW2tdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluc3RhbmNlLnV1aWQgPT0gZG9jLl9pZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vY29tc28ubG9nKCctLT4+Pj4+PiBGb3VydGggSWYgY29uc2l0aW9uJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jLndvcmtmbG93cy5maWx0ZXIoZnVuY3Rpb24od29ya2Zsb3cpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdvcmtmbG93LmlkID09IF9XRkluc3RhbmNlLmNvbmZpZy5faWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vY29tc28ubG9nKCctLT4+Pj4+PiBGaWZ0aCBJZiBjb25zaXRpb24nKTtcclxuXHJcblxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdvcmtmbG93LnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24ocHJvY2Vzc0l0ZW0pIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHByb2Nlc3NJdGVtLmlkID09IHByb2Nlc3NJZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzSXRlbS5zdGVwLmlkID0gc3RlcC5pZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc0l0ZW0uc3RlcC5zZXEgPSBzdGVwLnNlcTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc0l0ZW0uc3RlcC5zdGF0dXMgPSBzdGVwLnN0YXR1cztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc0l0ZW0uc3RlcC5tZXNzYWdlID0gc3RlcC5tZXNzYWdlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzSXRlbS5zdGVwLmFzc2lnbmVkVG8udXNlcklkID0gc3RlcC5hc3NpZ25lZFRvLnVzZXJJZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc0l0ZW0uc3RlcC5hc3NpZ25lZFRvLm5hbWUgPSBzdGVwLmFzc2lnbmVkVG8ubmFtZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc0l0ZW0uc3RlcC5jb21tZW50ID0gc3RlcC5jb21tZW50ICE9PSB1bmRlZmluZWQgPyBzdGVwLmNvbW1lbnQgOiAnJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdJbmRpY2F0b3IgZG9jdW1lbnRzIHdvcmtmbG93IHByb2Nlc3MgbW9kZWwgdXBkYXRlZC4nLCBfV0ZJbnN0YW5jZSk7XHJcbiAgICAgICAgICAgICAgICAvL2NvbXNvLmxvZygnaW5kaWNhdG9yRG9jcyBmdW5jdGlvbiBFTkRTLS0tLS0tLS0tLS0tLS0nKTtcclxuICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgfVxyXG4gICAgfSlcclxufTtcclxuXHJcbi8qKlxyXG4gKiBQcm9jZXNzIGFjdGlvbnNcclxuICpcclxuICogQHBhcmFtIHtvYmplY3R9IGFjdGlvbnMgLSB0aGUgYWN0aW9ucyBjb25maWcgZGF0YVxyXG4gKiBAcGFyYW0ge29iamVjdH0gc3ViUHJvY2VzcyAtIHRoZSBjdXJyZW50IHN1Yi1wcm9jZXNzIGZvcm0gY29uZmlnIGRhdGFcclxuICogQHBhcmFtIHtvYmplY3R9IF9XRkluc3RhbmNlIC0gdGhlIGN1cnJlbnQgd29ya2Zsb3cgY29uc3RydWN0b3IgaW5zdGFuY2VcclxuICpcclxuICogQGV4YW1wbGUgJydcclxuICpcclxuICogQHJldHVybiAnJ1xyXG4gKlxyXG4gKi9cclxuZnVuY3Rpb24gYWN0aW9ucyhhY3Rpb25zLCBwcm9jZXNzSWQsIHByb2Nlc3NTZXEsIHN1YlByb2Nlc3NJZCwgc3ViUHJvY2Vzc1NlcSwgc3ViUHJvY2Vzcywgc3RlcCwgX1dGSW5zdGFuY2UsIGRhdGEsIHV1aWQpIHtcclxuICAgIHZhciBhcnJBY3Rpb25zID0gW107XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgdXRpbC5zeW5jTG9vcChhY3Rpb25zLmxlbmd0aCwgZnVuY3Rpb24obG9vcCkge1xyXG4gICAgICAgICAgICB2YXIgY291bnRlciA9IGxvb3AuaXRlcmF0aW9uKCk7XHJcbiAgICAgICAgICAgIGFjdGlvbihhY3Rpb25zW2NvdW50ZXJdLCBwcm9jZXNzSWQsIHByb2Nlc3NTZXEsIHN1YlByb2Nlc3NJZCwgc3ViUHJvY2Vzc1NlcSwgc3ViUHJvY2Vzcywgc3RlcCwgX1dGSW5zdGFuY2UsIGRhdGEsIHV1aWQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmV0QWN0aW9uID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogYWN0aW9uc1tjb3VudGVyXS5faWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlcTogY291bnRlcixcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogcmVzdWx0XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICBhcnJBY3Rpb25zLnB1c2gocmV0QWN0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICBsb29wLm5leHQoKTtcclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIGxvb3AuYnJlYWsoKTtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0sIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAvLyBPbiBjb21wbGV0aW9uIG9mIHRoZSBsb29wXHJcblxyXG4gICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnQWN0aW9ucyBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5LicsIGFyckFjdGlvbnMpO1xyXG5cclxuICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFByb2Nlc3MgYWN0aW9uXHJcbiAqXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBhY3Rpb24gLSB0aGUgYWN0aW9uIGNvbmZpZyBkYXRhXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBzdWJQcm9jZXNzIC0gdGhlIGN1cnJlbnQgc3ViLXByb2Nlc3MgZm9ybSBjb25maWcgZGF0YVxyXG4gKiBAcGFyYW0ge29iamVjdH0gX1dGSW5zdGFuY2UgLSB0aGUgY3VycmVudCB3b3JrZmxvdyBjb25zdHJ1Y3RvciBpbnN0YW5jZVxyXG4gKlxyXG4gKiBAZXhhbXBsZSAnJ1xyXG4gKlxyXG4gKiBAcmV0dXJuICcnXHJcbiAqXHJcbiAqL1xyXG5mdW5jdGlvbiBhY3Rpb24oYWN0aW9uLCBwcm9jZXNzSWQsIHByb2Nlc3NTZXEsIHN1YlByb2Nlc3NJZCwgc3ViUHJvY2Vzc1NlcSwgc3ViUHJvY2Vzcywgc3RlcCwgX1dGSW5zdGFuY2UsIGRhdGEsIHV1aWQpIHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuXHJcbiAgICAgICAgaWYgKGFjdGlvbi5tZXRob2QgIT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHZhciBtZXRob2RQb3NzaWJsZUl0ZW1zID0gW1wiZm9ybVwiLCBcImluZGljYXRvclwiLCBcInByb2ZpbGVcIiwgXCJzdWJQcm9jZXNzSW5zdGFuY2VcIiwgXCJzdGVwXCIsIFwiY29tbXVuaXR5XCIsIFwiYXBwbGljYXRpb25cIiwgXCJ1c2VyXCIsIFwic2RvXCJdO1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHByb3BlcnR5RXhpc3RzKGFjdGlvbi5tZXRob2QsIG1ldGhvZFBvc3NpYmxlSXRlbXMpKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdmb3JtJzpcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ2luZGljYXRvcic6XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdwcm9maWxlJzpcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ3N1YlByb2Nlc3NJbnN0YW5jZSc6XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdzdGVwJzpcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ2NvbW11bml0eSc6XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbW11bml0eVBvc3NpYmxlSXRlbXMgPSBbXCJjcmVhdGVDb21tdW5pdHlcIiwgXCJyZWxlYXNlQWRvcHRlZEFwcGxpY2F0aW9uXCIsIFwidXNlckpvaW5Db21tdW5pdHlcIl07XHJcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChwcm9wZXJ0eUV4aXN0cyhhY3Rpb24ubWV0aG9kLmNvbW11bml0eSwgY29tbXVuaXR5UG9zc2libGVJdGVtcykpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2NyZWF0ZUNvbW11bml0eSc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYWN0aW9uc01vZHVsZS5jb21tdW5pdHkuY3JlYXRlQ29tbXVuaXR5KGFjdGlvbi5tZXRob2QuY29tbXVuaXR5LmNyZWF0ZUNvbW11bml0eSwgdXVpZCwgX1dGSW5zdGFuY2UpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAncmVsZWFzZUFkb3B0ZWRBcHBsaWNhdGlvbic6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYWN0aW9uc01vZHVsZS5jb21tdW5pdHkucmVsZWFzZUFkb3B0ZWRBcHBsaWNhdGlvbihhY3Rpb24ubWV0aG9kLmNvbW11bml0eS5yZWxlYXNlQWRvcHRlZEFwcGxpY2F0aW9uLCB1dWlkLCBfV0ZJbnN0YW5jZSkudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdC5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICd1c2VySm9pbkNvbW11bml0eSc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYWN0aW9uc01vZHVsZS5jb21tdW5pdHkudXNlckpvaW5Db21tdW5pdHkoYWN0aW9uLm1ldGhvZC5jb21tdW5pdHkudXNlckpvaW5Db21tdW5pdHksIHV1aWQsIF9XRkluc3RhbmNlKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0LmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoXCJObyBtZXRob2QgZm91bmQgZnJvbSBpbXBsZW1lbnRlZCBsaXN0LlwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ2FwcGxpY2F0aW9uJzpcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYXBwbGljYXRpb25Qb3NzaWJsZUl0ZW1zID0gW1wiY3JlYXRlQXBwRGVmaW5pdGlvblwiLCBcImJ1aWxkQXBwbGljYXRpb25cIiwgXCJhcHBsaWNhdGlvbkFkb3B0aW9uXCJdO1xyXG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAocHJvcGVydHlFeGlzdHMoYWN0aW9uLm1ldGhvZC5hcHBsaWNhdGlvbiwgYXBwbGljYXRpb25Qb3NzaWJsZUl0ZW1zKSkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnY3JlYXRlQXBwRGVmaW5pdGlvbic6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYWN0aW9uc01vZHVsZS5hcHBsaWNhdGlvbi5jcmVhdGVBcHBEZWZpbml0aW9uKGFjdGlvbi5tZXRob2QuYXBwbGljYXRpb24uY3JlYXRlQXBwRGVmaW5pdGlvbiwgdXVpZCwgX1dGSW5zdGFuY2UpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnYnVpbGRBcHBsaWNhdGlvbic6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYWN0aW9uc01vZHVsZS5hcHBsaWNhdGlvbi5idWlsZEFwcGxpY2F0aW9uKGFjdGlvbi5tZXRob2QuYXBwbGljYXRpb24uYnVpbGRBcHBsaWNhdGlvbiwgdXVpZCwgX1dGSW5zdGFuY2UpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnYXBwbGljYXRpb25BZG9wdGlvbic6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYWN0aW9uc01vZHVsZS5hcHBsaWNhdGlvbi5hcHBsaWNhdGlvbkFkb3B0aW9uKGFjdGlvbi5tZXRob2QuYXBwbGljYXRpb24uYXBwbGljYXRpb25BZG9wdGlvbiwgdXVpZCwgX1dGSW5zdGFuY2UpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChcIk5vIG1ldGhvZCBmb3VuZCBmcm9tIGltcGxlbWVudGVkIGxpc3QuXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgJ3VzZXInOlxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnc2RvJzpcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KFwiTm8gbWV0aG9kIGZvdW5kIGZyb20gaW1wbGVtZW50ZWQgbGlzdC5cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG5cclxuICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgICAgdmFyIGFyZ3MgPSBbXTtcclxuICAgICAgICAgICAgdmFyIGNvbnRleHQgPSAnZ2xvYmFsJztcclxuICAgICAgICAgICAgdmFyIG1ldGhvZCA9ICcnO1xyXG4gICAgICAgICAgICBpZiAoYWN0aW9uLl9pZCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICBjb250ZXh0ID0gYWN0aW9uLl9pZC5zcGxpdChcIi5cIilbMF07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGFjdGlvbi5faWQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kID0gYWN0aW9uLl9pZC5zcGxpdChcIi5cIilbMV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYXJncy5sZW5ndGggPSAwO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFjdGlvbi5fYXJncy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGFyZyA9IGFjdGlvbi5fYXJnc1tpXTtcclxuICAgICAgICAgICAgICAgIHN3aXRjaCAoYXJnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAncHJvY2Vzc0lkJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKHByb2Nlc3NJZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3Byb2Nlc3NTZXEnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2gocHJvY2Vzc1NlcSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3N1YlByb2Nlc3NJZCc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaChzdWJQcm9jZXNzSWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdzdWJQcm9jZXNzU2VxJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKHN1YlByb2Nlc3NTZXEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdzdWJQcm9jZXNzJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKHN1YlByb2Nlc3MpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdzdGVwJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKHN0ZXApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdhY3Rpb24nOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2goYWN0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFkZCB0aGUgcmVxdWlyZWQgcGFyYW1ldGVycyB0byB0aGUgYXJncyBhcnJheVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzID0gW107XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYXJncy5wdXNoKF9XRkluc3RhbmNlKTtcclxuICAgICAgICAgICAgYXJncy5wdXNoKGRhdGEuY3JlYXRlVHlwZSk7XHJcbiAgICAgICAgICAgIGFyZ3MucHVzaCh1dWlkKTtcclxuICAgICAgICAgICAgYXJncy5wdXNoKGRhdGEuYmFzZVVVSUQpO1xyXG4gICAgICAgICAgICBhcmdzLnB1c2goZGF0YSk7XHJcblxyXG5cclxuICAgICAgICAgICAgaWYgKGFjdGlvbi5faWQgPT0gJ2Zvcm0uY3JlYXRlJykge1xyXG4gICAgICAgICAgICAgICAgZm9ybS5jcmVhdGUoYXJncykudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGFjdGlvbi5faWQgPT0gJ2Zvcm0uYXV0aG9yaXNlJykge1xyXG4gICAgICAgICAgICAgICAgZm9ybS5hdXRob3Jpc2UoYXJncykudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdC5kYXRhKTtcclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoYWN0aW9uLl9pZCA9PSAnZm9ybS5jbG9zZScpIHtcclxuICAgICAgICAgICAgICAgIGZvcm0uY2xvc2UoYXJncykudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdC5kYXRhKTtcclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoYWN0aW9uLl9pZCA9PSAnZm9ybS5zZXREcmFmdCcpIHtcclxuICAgICAgICAgICAgICAgIGZvcm0uc2V0RHJhZnQoYXJncykudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdC5kYXRhKTtcclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoYWN0aW9uLl9pZCA9PSAnZm9ybS5zZXRVbkRyYWZ0Jykge1xyXG4gICAgICAgICAgICAgICAgZm9ybS5zZXRVbkRyYWZ0KGFyZ3MpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGFjdGlvbi5faWQgPT0gJ2Zvcm0uY3JlYXRlUHJvZmlsZScpIHtcclxuICAgICAgICAgICAgICAgIGZvcm0uY3JlYXRlUHJvZmlsZShhcmdzKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0LmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChhY3Rpb24uX2lkID09ICdmb3JtLnNldEluc3RhbmNlVGl0bGUnKSB7XHJcbiAgICAgICAgICAgICAgICBmb3JtLnNldEluc3RhbmNlVGl0bGUoYXJncykudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdC5kYXRhKTtcclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoYWN0aW9uLl9pZCA9PSAncHJvZmlsZS5kZWxldGUnKSB7XHJcbiAgICAgICAgICAgICAgICBmb3JtLmRlbGV0ZVByb2ZpbGUoYXJncykudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdC5kYXRhKTtcclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3IgPSB1dGlsLmVycm9yKCdXRkFjdGlvbkVycm9yJywgJ01ldGhvZDogJyArIGFjdGlvbl9pZCArICcgbm90IGRlZmluZWQuJyk7XHJcbiAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIGlmIChjb250ZXh0ID09ICdmb3JtJykge1xyXG4gICAgICAgICAgICAvLyBcdGZvcm1bbWV0aG9kXShhcmdzKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCl7XHJcbiAgICAgICAgICAgIC8vIFx0XHRyZXNvbHZlKHJlc3VsdC5kYXRhKTtcclxuICAgICAgICAgICAgLy8gXHR9LCBmdW5jdGlvbihlcnIpe1xyXG4gICAgICAgICAgICAvLyBcdFx0cmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgIC8vIFx0fSk7XHJcbiAgICAgICAgICAgIC8vIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIFx0dmFyIGVycm9yID0gdXRpbC5lcnJvcignV0ZBY3Rpb25FcnJvcicsICdNb2R1bGU6ICcgKyBjb250ZXh0ICsgJyBub3QgZGVmaW5lZC4nKTtcclxuICAgICAgICAgICAgLy8gXHRyZWplY3QoZXJyb3IpO1xyXG4gICAgICAgICAgICAvLyB9XHJcblxyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFByb2Nlc3MgdGFza3NcclxuICpcclxuICogQHBhcmFtIHtvYmplY3R9IHRhc2sgLSB0aGUgdGFzayBjb25maWcgZGF0YVxyXG4gKiBAcGFyYW0ge29iamVjdH0gaW5wdXREYXRhIC0gdGhlIHVzZXIgaW5wdXQgZGF0YVxyXG4gKlxyXG4gKiBAZXhhbXBsZSAnJ1xyXG4gKlxyXG4gKiBAcmV0dXJuICcnXHJcbiAqXHJcbiAqL1xyXG5mdW5jdGlvbiB0YXNrKHN1YnByb2Nlc3NJRCwgc3VicHJvY2Vzc1NFUSwgdGFzaywgc3B1dWlkLCBtb2RlbCkge1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICB2YXIgbGlzdCA9IFtdO1xyXG4gICAgICAgIGlmICh0YXNrLmFzc2lnbi5wcm9maWxlUm9sZSAhPSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgdmFyIGFzc2lnblR5cGUgPSAncHJvZmlsZVJvbGUnO1xyXG4gICAgICAgICAgICB2YXIgcHJvZmlsZUlkID0gYXBwLlNDT1BFLndvcmtmbG93LnByb2ZpbGU7XHJcbiAgICAgICAgICAgIHZhciBpZCA9ICcnO1xyXG4gICAgICAgICAgICBpZiAodGFzay5hc3NpZ24ucHJvZmlsZVJvbGUucHJvZmlsZSA9PSAnY3VycmVudCcpIHtcclxuICAgICAgICAgICAgICAgIGlkID0gYXBwLlNDT1BFLndvcmtmbG93LnByb2ZpbGU7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGFzay5hc3NpZ24ucHJvZmlsZVJvbGUucHJvZmlsZSA9PSAnY29tbXVuaXR5Jykge1xyXG4gICAgICAgICAgICAgICAgaWQgPSBhcHAuU0NPUEUuY29tbXVuaXR5SWQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIHJvbGUgPSB0YXNrLmFzc2lnbi5wcm9maWxlUm9sZS5yb2xlO1xyXG5cclxuICAgICAgICAgICAgbGlicmFyeS5nZXRVc2Vyc0xpc3RCeVJvbGUoaWQsIHJvbGUpLnRoZW4oZnVuY3Rpb24obGlzdCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGxpc3QgIT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGxpc3QubGVuZ3RoID4gMSkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gYXNzaWduIHRvIHVzZXJzIHNlbmQgbm90aWZpY2F0aW9uc1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy92YXIgcHJPYmplY3QgPSBKU09OLnhwYXRoKFwiL2luc3RhbmNlL3Byb2Nlc3Nlc1tzdWJQcm9jZXNzZXMvdXVpZCBlcSAnXCIrIHNwdXVpZCArXCInXVwiLGFwcC5TQ09QRS53b3JrZmxvdyx7fSlbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzcE9iamVjdCA9IEpTT04ueHBhdGgoXCIvc3VicHJvY2Vzc2VzW19pZCBlcSAnXCIgKyBzcHV1aWQgKyBcIiddXCIsIGFwcC5TQ09QRS53b3JrZmxvdywge30pWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2hhbm5lbHMgPSBKU09OLnhwYXRoKFwiL3N1YnByb2Nlc3Nlc1tfaWQgZXEgJ1wiICsgc3B1dWlkICsgXCInXS9jaGFubmVsc1wiLCBhcHAuU0NPUEUud29ya2Zsb3csIHt9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZpbmFsTXNnID0gcHJvY2Vzc1dvcmtmbG93TWVzc2FnZShOT1RJRklDQVRJT05fVVNFUl9NU0dfQUNDRVBULCBzcHV1aWQpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHByb2Nlc3NJZCA9IHNwT2JqZWN0LmlkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcHJvY2Vzc1NlcSA9IHNwT2JqZWN0LnNlcTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy92YXIgc3VicHJvY2Vzc0lEID0gcHJPYmplY3QuaWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vdmFyIHN1YnByb2Nlc3NTRVEgPSBwck9iamVjdC5zZXE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdWJwcm9jZXNzVVVJRCA9IHNwdXVpZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHByb2Nlc3NfVmFsaWREYXRlID0gc3BPYmplY3QuZGF0ZXMudmFsaWQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29uZmlnUHJvY2VzcyA9IEpTT04ueHBhdGgoXCIvY29uZmlnL3Byb2Nlc3Nlc1tfaWQgZXEgJ1wiICsgc3VicHJvY2Vzc0lEICsgXCInXVwiLCBhcHAuU0NPUEUud29ya2Zsb3csIHt9KVswXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbmZpZ1N1YlByb2Nlc3MgPSBKU09OLnhwYXRoKFwiL3N1YlByb2Nlc3Nlc1tfaWQgZXEgJ1wiICsgcHJvY2Vzc0lkICsgXCInXVwiLCBjb25maWdQcm9jZXNzLCB7fSlbMF07XHJcblxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN0ZXBTZXEgPSBzcE9iamVjdC5zdGVwLnNlcSArIDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwcm9jZXNzX0N1cnJlbnRTdGVwTmFtZSA9IEpTT04ueHBhdGgoXCIvc3RlcHNbX3NlcSBlcSAnXCIgKyBzdGVwU2VxICsgXCInXS9uYW1lL2kxOG5bMV0vdmFsdWVcIiwgY29uZmlnU3ViUHJvY2Vzcywge30pWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcHJvY2Vzc05hbWUgPSBjb25maWdTdWJQcm9jZXNzLm5hbWUuaTE4blswXS52YWx1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBub3RmaWNhdGlvblJlcXVlc3QgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInNvdXJjZVwiOiBcInJlbW90ZVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ0eXBlXCI6IFwibm90aWZpY2F0aW9uUmVxdWVzdFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJfaWRcIjogc3B1dWlkICsgXCI6bm90aWZpY2F0aW9uUmVxdWVzdFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJjaGFubmVsc1wiOiBjaGFubmVscyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiY29tbXVuaXR5SWRcIjogYXBwLlNDT1BFLmNvbW11bml0eUlkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJhcHBsaWNhdGlvbklkXCI6IGFwcC5TQ09QRS5hcHBsaWNhdGlvbklkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJtZXNzYWdlXCI6IGZpbmFsTXNnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJtZXNzYWdlVHlwZVwiOiBcImluZm9cIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiY3JlYXRlZERhdGVUaW1lXCI6IG1vbWVudCgpLmZvcm1hdCgpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJzZW5kZXJVc2VySWRcIjogTE9DQUxfU0VUVElOR1MuU1VCU0NSSVBUSU9OUy51c2VySWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImFjdGlvbnNcIjogW3tcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImxhYmVsXCI6IFwiVmlld1wiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiZnVuY3Rpb25cIjogXCJhcHAub3BlblN1YnByb2Nlc3NcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInBhcmFtc1wiOiBbcHJvZmlsZUlkLCBwcm9jZXNzSWQsIHByb2Nlc3NTZXEsIHByb2Nlc3NOYW1lLCBzdWJwcm9jZXNzSUQsIHN1YnByb2Nlc3NTRVEsIHN1YnByb2Nlc3NVVUlELCBwcm9jZXNzX1ZhbGlkRGF0ZSwgcHJvY2Vzc19DdXJyZW50U3RlcE5hbWVdXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwicmVjZWl2ZXJcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidmFsdWVcIjogW3tcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ0eXBlXCI6IFwicm9sZVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogcm9sZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJwcm9maWxlSWRcIjogaWRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYW8udXBzZXJ0KG5vdGZpY2F0aW9uUmVxdWVzdCkuZG9uZShmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy92YXIgc3BPYmplY3QgPSBKU09OLnhwYXRoKFwiL3N1YnByb2Nlc3Nlc1tfaWQgZXEgJ1wiKyBzcHV1aWQgK1wiJ11cIixhcHAuU0NPUEUud29ya2Zsb3csIHt9KVswXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFzc2lnbm1lbnQgPSAnJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhc2suYXNzaWduLmFzc2lnbm1lbnQgIT0gdW5kZWZpbmVkKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFzc2lnbm1lbnQgPSBtb2RlbC5hc3NpZ25tZW50OyAvL0pTT04ueHBhdGgoXCIvc3RlcC9hc3NpZ25tZW50XCIsc3BPYmplY3Qse30pWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFjY2VwdCA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInNob3dcIjogdGFzay5hc3NpZ24uYXNzaWdubWVudC5hY2NlcHQuc2hvdyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImxhYmVsXCI6IF9nZXROYW1lKHRhc2suYXNzaWduLmFzc2lnbm1lbnQuYWNjZXB0LmxhYmVsLmkxOG4sICdlbicpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNzaWdubWVudC5hY2NlcHQgPSBhY2NlcHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc3NpZ25tZW50Lm1lc3NhZ2UgPSBfZ2V0TmFtZSh0YXNrLmFzc2lnbi5hc3NpZ25tZW50Lm1lc3NhZ2UuaTE4biwgJ2VuJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVqZWN0ID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic2hvd1wiOiB0YXNrLmFzc2lnbi5hc3NpZ25tZW50LnJlamVjdC5zaG93LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibGFiZWxcIjogX2dldE5hbWUodGFzay5hc3NpZ24uYXNzaWdubWVudC5yZWplY3QubGFiZWwuaTE4biwgJ2VuJylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc3NpZ25tZW50LnJlamVjdCA9IHJlamVjdDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInByb2ZpbGVJZFwiOiBwcm9maWxlSWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJyb2xlSWRcIjogcm9sZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInR5cGVcIjogXCJyb2xlXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNzaWdubWVudC52YWx1ZSA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNzaWdubWVudC5wcm9maWxlUm9sZUlkID0gaWQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoJ05vdGlmaWNhdGlvbnMgcmVxdWVzdCBzdWJtaXR0ZWQgZm9yIGFjY2VwdGFuY2UuJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobGlzdC5sZW5ndGggPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2F1dG8gYXNzaWduXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1c2VySWQgPSBsaXN0WzBdLmlkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdXNlcm5hbWUgPSBsaXN0WzBdLm5hbWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL3ZhciBzcE9iamVjdCA9IEpTT04ueHBhdGgoXCIvc3VicHJvY2Vzc2VzW19pZCBlcSAnXCIrIHNwdXVpZCArXCInXVwiLGFwcC5TQ09QRS53b3JrZmxvdywge30pWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXNzaWduZWUgPSBtb2RlbC5hc3NpZ25lZFRvOyAvL0pTT04ueHBhdGgoXCIvc3RlcC9hc3NpZ25lZFRvXCIsc3BPYmplY3Qse30pWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhc3NpZ25lZS5uYW1lID0gdXNlcm5hbWUgKyBcIlwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhc3NpZ25lZS51c2VySWQgPSB1c2VySWQgKyBcIlwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCdBc3NpZ25lZCB0byB0aGUgb25seSB1c2VyIGluIHJvbGUuJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHVzZSBkZWZhdWx0IHVzZXJcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0YXNrLmFzc2lnbi5kZWZhdWx0ICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHVzZXJJZCA9IHRhc2suYXNzaWduLmRlZmF1bHQudXNlcklkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHVzZXJuYW1lID0gdGFzay5hc3NpZ24uZGVmYXVsdC51c2VyTmFtZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3ZhciBzcE9iamVjdCA9IEpTT04ueHBhdGgoXCIvc3VicHJvY2Vzc2VzW19pZCBlcSAnXCIrIHNwdXVpZCArXCInXVwiLGFwcC5TQ09QRS53b3JrZmxvdywge30pWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFzc2lnbmVlID0gbW9kZWwuYXNzaWduZWRUbzsgLy8gSlNPTi54cGF0aChcIi9zdGVwL2Fzc2lnbmVkVG9cIixzcE9iamVjdCx7fSlbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc3NpZ25lZS5uYW1lID0gdXNlcm5hbWUgKyBcIlwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNzaWduZWUudXNlcklkID0gdXNlcklkICsgXCJcIjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCdBc3NpZ25lZCB0byBkZWZhdWx0IHVzZXInKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0Vycm9yIGluIGFzc2lnbm1lbnQuIERlZmF1bHQgdXNlciBub3Qgc3BlY2lmaWVkLicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KCdFcnJvciBpbiBhc3NpZ25tZW50LiBEZWZhdWx0IHVzZXIgbm90IHNwZWNpZmllZC4nKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdFcnJvciBpbiBnZXRVc2Vyc0xpc3RCeVJvbGUgdW5kZWZpbmVkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0Vycm9yIGluIGdldFVzZXJzTGlzdEJ5Um9sZScpO1xyXG4gICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodGFzay5hc3NpZ24uc3dpbWxhbmUgIT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHJlc29sdmUoJ3N3aW1sYW5lJyk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdTd2ltbGFuZSBpbXBsZW1lbnRhdGlvbiAhIScpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9KTtcclxuXHJcblxyXG59O1xyXG5cclxuXHJcblxyXG5cclxuLyoqXHJcbiAqIFByb2Nlc3MgdHJhbnNpdGlvblxyXG4gKlxyXG4gKiBAcGFyYW0ge3N0cmluZ30gcHJvY2Vzc0lkIC0gdGhlIFdvcmtmbG93IGNvbmZpZyAvIGRlZmluaXRpb24gcHJvY2VzcyBpZFxyXG4gKiBAcGFyYW0ge251bWJlcn0gcHJvY2Vzc1NlcSAtIHRoZSBXb3JrZmxvdyBpbnN0YW5jZSBwcm9jZXNzIHNlcVxyXG4gKiBAcGFyYW0ge3N0cmluZ30gc3ViUHJvY2Vzc0lkIC0gdGhlIFdvcmtmbG93IGNvbmZpZyAvIGRlZmluaXRpb24gc3ViLXByb2Nlc3MgaWRcclxuICogQHBhcmFtIHtudW1iZXJ9IHN1YlByb2Nlc3NTZXEgLSB0aGUgV29ya2Zsb3cgaW5zdGFuY2Ugc3ViLXByb2Nlc3Mgc2VxXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdGVwSWQgLSB0aGUgV29ya2Zsb3cgY29uZmlnIC8gZGVmaW5pdGlvbiBzdGVwIGlkXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSB0cmFuc2l0aW9uSWQgLSB0aGUgV29ya2Zsb3cgY29uZmlnIC8gZGVmaW5pdGlvbiB0cmFuc2l0aW9uIGlkXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBkYXRhIC0gYW55IGFkZGl0aW9uYWwgZGF0YSBwYXNzZWQgaW4gYXMga2V5IHZhbHVlIHBhaXJzXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBfV0ZJbnN0YW5jZSAtIHRoZSBjdXJyZW50IHdvcmtmbG93IGNvbnN0cnVjdG9yIGluc3RhbmNlXHJcbiAqXHJcbiAqIEBleGFtcGxlICcnXHJcbiAqXHJcbiAqIEByZXR1cm4gJydcclxuICpcclxuICovXHJcbmZ1bmN0aW9uIHRyYW5zaXRpb24ocHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIHN0ZXBJZCwgdHJhbnNpdGlvbklkLCBkYXRhLCBfV0ZJbnN0YW5jZSkge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIHZhciBzdGVwU2VxID0gMDtcclxuICAgICAgICAgICAgdmFyIG5leHRTdGVwSWQgPSAnJztcclxuICAgICAgICAgICAgdmFyIG5leHRTdGVwU2VxID0gMDtcclxuICAgICAgICAgICAgdmFyIHN1YlByb2Nlc3MgPSBbXTtcclxuICAgICAgICAgICAgdmFyIGN1cnJlbnRQcm9jZXNzID0gX1dGSW5zdGFuY2UuY29uZmlnLnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24ob2JqUHJvY2Vzcykge1xyXG4gICAgICAgICAgICAgICAgaWYgKG9ialByb2Nlc3MuX2lkID09IHByb2Nlc3NJZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvYmpQcm9jZXNzO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdmFyIGN1cnJlbnRTdWJQcm9jZXNzID0gY3VycmVudFByb2Nlc3NbMF0uc3ViUHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihvYmpTdWJQcm9jZXNzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAob2JqU3ViUHJvY2Vzcy5faWQgPT0gc3ViUHJvY2Vzc0lkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9ialN1YlByb2Nlc3M7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB2YXIgY3VycmVudFN0ZXAgPSBjdXJyZW50U3ViUHJvY2Vzc1swXS5zdGVwcy5maWx0ZXIoZnVuY3Rpb24ob2JqU3RlcCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKG9ialN0ZXAuX2lkID09IHN0ZXBJZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvYmpTdGVwO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdmFyIHRyYW5zaXRpb24gPSBjdXJyZW50U3RlcFswXS50cmFuc2l0aW9ucy5maWx0ZXIoZnVuY3Rpb24ob2JqVHJhbnNpdGlvbikge1xyXG4gICAgICAgICAgICAgICAgaWYgKG9ialRyYW5zaXRpb24uX2lkID09IHRyYW5zaXRpb25JZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvYmpUcmFuc2l0aW9uO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjdXJyZW50U3ViUHJvY2Vzc1swXS5zdGVwcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRTdWJQcm9jZXNzWzBdLnN0ZXBzW2ldLl9pZCA9PSBzdGVwSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBzdGVwU2VxID0gcGFyc2VJbnQoY3VycmVudFN1YlByb2Nlc3NbMF0uc3RlcHNbaV0uX3NlcSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY3VycmVudFN1YlByb2Nlc3NbMF0uc3RlcHMuZmlsdGVyKGZ1bmN0aW9uKHN0ZXBJdGVtKSB7XHJcbiAgICAgICAgICAgICAgICBuZXh0U3RlcFNlcSA9IHN0ZXBTZXEgKyAxO1xyXG4gICAgICAgICAgICAgICAgaWYgKHBhcnNlSW50KHN0ZXBJdGVtLl9zZXEpID09IG5leHRTdGVwU2VxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV4dFN0ZXBJZCA9IHN0ZXBJdGVtLl9pZDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgX1dGSW5zdGFuY2UuaW5zdGFuY2UucHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihvYmpQcm9jZXNzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAob2JqUHJvY2Vzcy5pZCA9PSBwcm9jZXNzSWQgJiYgb2JqUHJvY2Vzcy5zZXEgPT0gcHJvY2Vzc1NlcSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9ialByb2Nlc3Muc3ViUHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihvYmpTdWJQcm9jZXNzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmpTdWJQcm9jZXNzLmlkID09IHN1YlByb2Nlc3NJZCAmJiBvYmpTdWJQcm9jZXNzLnNlcSA9PSBzdWJQcm9jZXNzU2VxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdXVpZCA9IG9ialN1YlByb2Nlc3MudXVpZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN1YlByb2Nlc3MgPSBvYmpTdWJQcm9jZXNzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX1dGSW5zdGFuY2Uuc3VicHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihzdWJQcm9jZXNzSXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdWJQcm9jZXNzSXRlbS5faWQgPT0gdXVpZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJQcm9jZXNzID0gc3ViUHJvY2Vzc0l0ZW07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB2YXIgbWF4U3RlcHMgPSBjdXJyZW50U3ViUHJvY2Vzc1swXS5zdGVwcy5sZW5ndGg7XHJcbiAgICAgICAgICAgIHN3aXRjaCAodHJhbnNpdGlvblswXS5fdHlwZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnYXV0byc6XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRyYW5zaXRpb25bMF0uZ29Uby5fdHlwZSA9PSAnbmV4dFN0ZXAnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0ZXAocHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIG5leHRTdGVwSWQsIG5leHRTdGVwU2VxLCBkYXRhLCBfV0ZJbnN0YW5jZSkudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXh0U3RlcFNlcSA9PSBtYXhTdGVwcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdBbGwgU3RlcCB0cmFuc2l0aW9ucyBoYXZlIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkuJywge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJQcm9jZXNzQ29tcGxldGU6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ZXA6IHJlc3VsdC5kYXRhXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ1N0ZXAgdHJhbnNpdGlvbiBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5LicsIHJlc3VsdC5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAndXNlcic6XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRyYW5zaXRpb25bMF0uZ29Uby5fdHlwZSA9PSAnbmV4dFN0ZXAnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0ZXAocHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIG5leHRTdGVwSWQsIG5leHRTdGVwU2VxLCBkYXRhLCBfV0ZJbnN0YW5jZSkudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXh0U3RlcFNlcSA9PSBtYXhTdGVwcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdBbGwgU3RlcCB0cmFuc2l0aW9ucyBoYXZlIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkuJywge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJQcm9jZXNzQ29tcGxldGU6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ZXA6IHJlc3VsdC5kYXRhXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ1N0ZXAgdHJhbnNpdGlvbiBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5LicsIHJlc3VsdC5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0cmFuc2l0aW9uWzBdLmdvVG8uX3R5cGUgPT0gJ3N0ZXBJZCcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGdvVG9TdGVwSWQgPSB0cmFuc2l0aW9uWzBdLmdvVG8uX3N0ZXBJZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGdvVG9TdGVwU2VxID0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFN1YlByb2Nlc3NbMF0uc3RlcHMuZmlsdGVyKGZ1bmN0aW9uKHN0ZXBJdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RlcEl0ZW0uX2lkID09IGdvVG9TdGVwSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnb1RvU3RlcFNlcSA9IHBhcnNlSW50KHN0ZXBJdGVtLl9zZXEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGVwKHByb2Nlc3NJZCwgcHJvY2Vzc1NlcSwgc3ViUHJvY2Vzc0lkLCBzdWJQcm9jZXNzU2VxLCBnb1RvU3RlcElkLCBnb1RvU3RlcFNlcSwgZGF0YSwgX1dGSW5zdGFuY2UpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZ29Ub1N0ZXBTZXEgPT0gbWF4U3RlcHMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnQWxsIFN0ZXAgdHJhbnNpdGlvbnMgaGF2ZSBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5LicsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ViUHJvY2Vzc0NvbXBsZXRlOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGVwOiByZXN1bHQuZGF0YVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdTdGVwIHRyYW5zaXRpb24gY29tcGxldGVkIHN1Y2Nlc3NmdWxseS4nLCByZXN1bHQuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yID0gdXRpbC5lcnJvcignV0ZUcmFuc2l0aW9uRXJyb3InLCAnVHJhbnNpdGlvbiB0eXBlOiAnICsgdHJhbnNpdGlvblswXS5fdHlwZSArICcgbm90IGRlZmluZWQuJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBQcm9jZXNzIHBvc3RBY3Rpb25zXHJcbiAqXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBwb3N0QWN0aW9ucyAtIHRoZSBwb3N0QWN0aW9ucyBjb25maWcgZGF0YVxyXG4gKlxyXG4gKiBAZXhhbXBsZSAnJ1xyXG4gKlxyXG4gKiBAcmV0dXJuICcnXHJcbiAqXHJcbiAqL1xyXG5mdW5jdGlvbiBwb3N0QWN0aW9ucyhwb3N0QWN0aW9ucywgX1dGSW5zdGFuY2UpIHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICB2YXIgY29tcGxldGVkID0gW107XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgdXRpbC5zeW5jTG9vcChwb3N0QWN0aW9ucy5sZW5ndGgsIGZ1bmN0aW9uKGxvb3ApIHtcclxuICAgICAgICAgICAgICAgIHZhciBjb3VudGVyID0gbG9vcC5pdGVyYXRpb24oKTtcclxuICAgICAgICAgICAgICAgIGFjdGlvbihwb3N0QWN0aW9uc1tjb3VudGVyXSwgX1dGSW5zdGFuY2UpLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIGFsbCBwcmUtcmVxdWlzaXRlcyBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5LlxyXG4gICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZC5wdXNoKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxvb3AubmV4dCgpO1xyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkLnB1c2goZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxvb3AuYnJlYWsoKTtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIGlmIChjb21wbGV0ZWQuZXZlcnkoQm9vbGVhbikpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnUG9zdC1hY3Rpb25zIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkuJywge30pO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvciA9IHV0aWwuZXJyb3IoJ1dGUHJlQWN0aW9uc0Vycm9yJywgJ05vdCBhbGwgcG9zdC1hY3Rpb25zIHBhc3NlZC4nKTtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn07XHJcblxyXG5cclxuXHJcbi8qXHJcbmZ1bmN0aW9uIHNlbmROb3RpZmljYXRpb25zKHVzZXJzTGlzdCwgc3B1dWlkKXtcclxuXHJcbiAgLy8gZ2V0IHVzZXJzIGxpc3QgXHJcbiAgLy8gc2VuIG5vdGlmaWNhdGlvbnMgdG8gdXNlcnMgeSBhZGRpbmcgY2hhbm5lbHMgdG8gdGhlbVxyXG4gXHJcbiAgdmFyIGNoYW5uZWxBcnJheSA9IFtdO1xyXG5cclxuICBmb3IoaT0wO2k8dXNlcnNMaXN0Lmxlbmd0aDsgaSsrKXtcclxuICAgIGNoYW5uZWxBcnJheS5wdXNoKFwidXNlcl9cIit1c2Vyc0xpc3RbaV0uaWQpO1xyXG4gIH1cclxuXHJcbiAgXHJcbiAgYXNzaWduVG9Vc2Vycyhwcm9jZXNzV29ya2Zsb3dNZXNzYWdlKE5PVElGSUNBVElPTl9VU0VSX01TR19BQ0NFUFQsIHNwdXVpZCksIGNoYW5uZWxBcnJheSk7XHJcblxyXG5cclxuXHJcbn07Ki9cclxuXHJcbi8qZnVuY3Rpb24gYXNzaWduVG9Vc2VycyhtZXNzYWdlLCBjaGFubmVsQXJyYXkpe1xyXG5cclxuICAgICB2YXIgY2hhbm5lbHMgPSBjaGFubmVsQXJyYXk7XHJcbiAgICAgXHJcbiAgICAgdmFyIG5vdGlmaWNhdGlvbiA9ICB7IFxyXG4gICAgICAgICAgXCJfaWRcIjogZ2VuZXJhdGVVVUlEKCksXHJcbiAgICAgICAgICBcImNoYW5uZWxzXCI6Y2hhbm5lbHMsXHJcbiAgICAgICAgICBcIm1lc3NhZ2VcIjogbWVzc2FnZSxcclxuICAgICAgICAgIFwibWVzc2FnZVR5cGVcIjogXCJpbmZvXCIsXHJcbiAgICAgICAgICBcImNyZWF0ZWREYXRlVGltZVwiOiBtb21lbnQoKS5mb3JtYXQoKSxcclxuICAgICAgICAgIFwicmVhZFwiOiBmYWxzZSxcclxuICAgICAgICAgIFwicmVhZERhdGVUaW1lXCI6IFwiXCIsXHJcbiAgICAgICAgICBcInR5cGVcIjogXCJub3RpZmljYXRpb25cIixcclxuICAgICAgICAgIFwic2VuZGVyVXNlcklkXCI6IExPQ0FMX1NFVFRJTkdTLlNVQlNDUklQVElPTlMudXNlcklkXHJcbiAgICAgICB9O1xyXG4gICAgICAgY29uc29sZS5sb2cobm90aWZpY2F0aW9uKTtcclxuICAgICAgIGRhby51cHNlcnQobm90aWZpY2F0aW9uKTtcclxuXHJcbiAgfTsqL1xyXG5cclxuZnVuY3Rpb24gcHJvY2Vzc1dvcmtmbG93TWVzc2FnZShtZXNzYWdlLCBzcHV1aWQpIHtcclxuXHJcbiAgICB2YXIgcmVwbGFjZWRNc2cgPSBtZXNzYWdlO1xyXG5cclxuICAgIGlmIChyZXBsYWNlZE1zZy5pbmRleE9mKCcjSU5TVEFOQ0VfTEFCRUwnKSAhPT0gLTEpIHtcclxuICAgICAgICB2YXIgdmFsID0gSlNPTi54cGF0aChcIi9pbnN0YW5jZS9wcm9jZXNzZXMvc3ViUHJvY2Vzc2VzW3V1aWQgZXEgJ1wiICsgc3B1dWlkICsgXCInXS9sYWJlbFwiLCBhcHAuU0NPUEUud29ya2Zsb3csIHt9KVswXTtcclxuICAgICAgICByZXBsYWNlZE1zZyA9IHJlcGxhY2VkTXNnLnJlcGxhY2UoJyNJTlNUQU5DRV9MQUJFTCcsIHZhbCk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIGlmIChyZXBsYWNlZE1zZy5pbmRleE9mKCcjVVNFUl9OQU1FJykgIT09IC0xKSB7XHJcbiAgICAgICAgdmFyIHZhbCA9IEpTT04ueHBhdGgoXCIvc3VicHJvY2Vzc2VzW19pZCBlcSAnXCIgKyBzcHV1aWQgKyBcIiddL3N0ZXAvYXNzaWduZWRUby9uYW1lXCIsIGFwcC5TQ09QRS53b3JrZmxvdywge30pWzBdO1xyXG4gICAgICAgIHJlcGxhY2VkTXNnID0gcmVwbGFjZWRNc2cucmVwbGFjZSgnI1VTRVJfTkFNRScsIHZhbCk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIGlmIChyZXBsYWNlZE1zZy5pbmRleE9mKCcjUFJPRklMRV9USVRMRScpICE9PSAtMSkge1xyXG4gICAgICAgIHZhciB2YWwgPSBhcHAucHJvZmlsZS50aXRsZTtcclxuICAgICAgICByZXBsYWNlZE1zZyA9IHJlcGxhY2VkTXNnLnJlcGxhY2UoJyNQUk9GSUxFX1RJVExFJywgdmFsKTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHJlcGxhY2VkTXNnLmluZGV4T2YoJyNQUk9GSUxFX1RZUEUnKSAhPT0gLTEpIHtcclxuICAgICAgICB2YXIgdmFsID0gYXBwLlNDT1BFLkFQUF9DT05GSUcubmFtZTtcclxuICAgICAgICByZXBsYWNlZE1zZyA9IHJlcGxhY2VkTXNnLnJlcGxhY2UoJyNQUk9GSUxFX1RZUEUnLCB2YWwpO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBpZiAocmVwbGFjZWRNc2cuaW5kZXhPZignI1ZBUl9TUFVVSUQnKSAhPT0gLTEpIHtcclxuICAgICAgICB2YXIgdmFsID0gc3B1dWlkO1xyXG4gICAgICAgIHJlcGxhY2VkTXNnID0gcmVwbGFjZWRNc2cucmVwbGFjZSgnI1ZBUl9TUFVVSUQnLCB2YWwpO1xyXG5cclxuICAgIH1cclxuXHJcblxyXG4gICAgcmV0dXJuIHJlcGxhY2VkTXNnO1xyXG59O1xyXG5cclxuZnVuY3Rpb24gX2dldE5hbWUoYXJyLCBsYW5nKSB7XHJcbiAgICBpZiAoYXJyICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBpZiAoYXJyW2ldLl9sYW5nID09PSBsYW5nKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYXJyW2ldLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59O1xyXG5cclxuXHJcblxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSB7XHJcblxyXG4gICAgcHJlUmVxdWlzaXRlczogcHJlUmVxdWlzaXRlcyxcclxuICAgIHByZUFjdGlvbnM6IHByZUFjdGlvbnMsXHJcbiAgICBzdWJQcm9jZXNzOiBzdWJQcm9jZXNzLFxyXG4gICAgaW5kaWNhdG9yRG9jczogaW5kaWNhdG9yRG9jcyxcclxuICAgIHRhc2s6IHRhc2ssXHJcbiAgICB0cmFuc2l0aW9uOiB0cmFuc2l0aW9uLFxyXG4gICAgYXNzaWduVXNlcjogYXNzaWduVXNlclxyXG5cclxufSIsIid1c2Ugc3RyaWN0JztcclxuXHJcbi8qKlxyXG4gKiBVdGlsaXR5IE1vZHVsZVxyXG4gKlxyXG4gKiBAbW9kdWxlIGxpYi91dGlsXHJcbiAqXHJcbiAqIEBhdXRob3IgQnJlbnQgR29yZG9uXHJcbiAqIEB2ZXJzaW9uIDAuMS4wXHJcbiAqXHJcbiAqIEBkZXNjcmlwdGlvblxyXG4gKiBXb3JrZmxvdyB1dGlsaXR5IG1vZHVsZSB1c2VkIHRvIGZvcm1hdCB0aGUgcmV0dXJuIGFuZCBlcnJvciBvYmplY3RzLCBhbmRcclxuICogY29udGFpbnMgc29tZSBvdGhlciB1dGlsaXR5IGZ1bmN0aW9ucyBzdWNoIGFzIGEgc3luYyBsb29wIGFuZCBjb21wYXJlLlxyXG4gKlxyXG4gKi9cclxuXHJcbi8qKlxyXG4gKiBTdWNjZXNzIGJsb2NrIHJldHVybiBvYmplY3QsIGNvbnRhaW5zIGEgbWVzc2FnZSBhbmQgb3B0aW9uYWwgZGF0YSBvYmplY3QuXHJcbiAqXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBtZXNzYWdlIC0gdGhlIHN1Y2Nlc3MgbWVzc2FnZVxyXG4gKiBAcGFyYW0ge3N0cmluZ3xPYmplY3R9IFtkYXRhXSAtIHRoZSBzdWNjZXNzIHJldHVybmVkIGRhdGFcclxuICpcclxuICogQGV4YW1wbGVcclxuICogLy8gUmV0dXJuIHN1Y2Nlc3Mgd2l0aG91dCBhIGRhdGEgYmxvY2tcclxuICogdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ1N1Y2Nlc3MgbWVzc2FnZSBnb2VzIGhlcmUuLi4nKTtcclxuICpcclxuICogQHJldHVybiB7T2JqZWN0fSAtIHdpdGggbWVzc2FnZSBhbmQgZGF0YSBwcm9wZXJ0aWVzXHJcbiAqXHJcbiAqL1xyXG5mdW5jdGlvbiBzdWNjZXNzKG1lc3NhZ2UsIGRhdGEpe1xyXG5cdHJldHVybiB7XHJcblx0XHRtZXNzYWdlOiBtZXNzYWdlLFxyXG5cdFx0ZGF0YTogZGF0YVxyXG5cdH07XHJcbn07XHJcblxyXG4vKipcclxuICogV2FybmluZyBibG9jayByZXR1cm4gb2JqZWN0LCBjb250YWlucyBhIG1lc3NhZ2UgYW5kIG9wdGlvbmFsIGRhdGEgb2JqZWN0LlxyXG4gKlxyXG4gKiBAcGFyYW0ge3N0cmluZ30gbWVzc2FnZSAtIHRoZSB3YXJuaW5nIG1lc3NhZ2VcclxuICogQHBhcmFtIHtzdHJpbmd8T2JqZWN0fSBbZGF0YV0gLSB0aGUgcmV0dXJuZWQgZGF0YVxyXG4gKlxyXG4gKiBAZXhhbXBsZVxyXG4gKiAvLyBSZXR1cm4gc3VjY2VzcyB3aXRob3V0IGEgZGF0YSBibG9ja1xyXG4gKiB2YXIgc3VjY2VzcyA9IHV0aWwud2FybignV2FybmluZyBtZXNzYWdlIGdvZXMgaGVyZS4uLicpO1xyXG4gKlxyXG4gKiBAcmV0dXJuIHtPYmplY3R9IHdpdGggbWVzc2FnZSBhbmQgZGF0YSBwcm9wZXJ0aWVzLCBhbmQgbG9ncyB0aGUgd2FybmluZyB0byB0aGUgY29uc29sZS5cclxuICpcclxuICovXHJcbmZ1bmN0aW9uIHdhcm4obWVzc2FnZSwgZGF0YSl7XHJcblx0Y29uc29sZS53YXJuKGRhdGEpO1xyXG5cdHJldHVybiB7XHJcblx0XHR3YXJuaW5nOiBtZXNzYWdlLFxyXG5cdFx0ZGF0YTogZGF0YVxyXG5cdH07XHJcbn07XHJcblxyXG4vKipcclxuICogRXJyb3IgYmxvY2sgSlMgZXJyb3Igb2JqZWN0LCBjb250YWlucyBhIGNvZGUgYW5kIG1lc3NhZ2UgZm9yIHRoZSBlcnJvci5cclxuICpcclxuICogQHBhcmFtIHtzdHJpbmd9IGNvZGUgLSB0aGUgZXJyb3IgY29kZVxyXG4gKiBAcGFyYW0ge3N0cmluZ30gbWVzc2FnZSAtIHRoZSBlcnJvciBtZXNzYWdlXHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqIHZhciBzdWNjZXNzID0gdXRpbC5lcnJvcignRXJyb3IwMDEnLCdFcnJvciBtZXNzYWdlIGdvZXMgaGVyZS4uLicpO1xyXG4gKlxyXG4gKiBAcmV0dXJuIHtPYmplY3R9IHdpdGggYSBjb2RlIGFuZCBtZXNzYWdlIHByb3BlcnRpZXMuXHJcbiAqXHJcbiAqL1xyXG5mdW5jdGlvbiBlcnJvcihjb2RlLCBtZXNzYWdlKXtcclxuXHR2YXIgZXJyID0gbmV3IEVycm9yKCcnKTtcclxuXHRlcnIubmFtZSA9IGNvZGU7XHJcblx0ZXJyLm1lc3NhZ2UgPSBtZXNzYWdlO1xyXG5cdHJldHVybiBlcnI7XHJcbn07XHJcblxyXG4vKipcclxuICogQSBsb29wIHdoaWNoIGNhbiBsb29wIFggYW1vdW50IG9mIHRpbWVzLCB3aGljaCBjYXJyaWVzIG91dFxyXG4gKiBhc3luY2hyb25vdXMgY29kZSwgYnV0IHdhaXRzIGZvciB0aGF0IGNvZGUgdG8gY29tcGxldGUgYmVmb3JlIGxvb3BpbmcuXHJcbiAqXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBpdGVyYXRpb25zIC0gdGhlIG51bWJlciBvZiBpdGVyYXRpb25zIHRvIGNhcnJ5IG91dFxyXG4gKiBAcGFyYW0ge2Z1bmN0aW9ufSBwcm9jZXNzIC0gdGhlIGNvZGUvZnVuY3Rpb24gd2UncmUgcnVubmluZyBmb3IgZXZlcnlcclxuICogaXRlcmF0aW9uXHJcbiAqIEBwYXJhbSB7ZnVuY3Rpb259IGV4aXQgLSBhbiBvcHRpb25hbCBjYWxsYmFjayB0byBjYXJyeSBvdXQgb25jZSB0aGUgbG9vcFxyXG4gKiBoYXMgY29tcGxldGVkXHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqIHV0aWwuc3luY0xvb3AoNSwgZnVuY3Rpb24obG9vcCl7XHJcbiAqIFx0dmFyIGNvdW50ZXIgPSBsb29wLml0ZXJhdGlvbigpO1xyXG4gKiBcdC8vIEFkZCBhc3luYyBjYWxscyBoZXJlLi5cclxuICpcclxuICogfSwgZnVuY3Rpb24oKXtcclxuICogXHQvLyBPbiBjb21wbGV0ZSBwZXJmb3JtIGFjdGlvbnMgaGVyZS4uLlxyXG4gKlxyXG4gKiB9KTtcclxuICpcclxuICogQHJldHVybiB7T2JqZWN0fSB0aGUgbG9vcCBjb250cm9sIG9iamVjdC5cclxuICpcclxuICovXHJcbmZ1bmN0aW9uIHN5bmNMb29wKGl0ZXJhdGlvbnMsIHByb2Nlc3MsIGV4aXQpe1xyXG4gICAgdmFyIGluZGV4ID0gMCxcclxuICAgICAgICBkb25lID0gZmFsc2UsXHJcbiAgICAgICAgc2hvdWxkRXhpdCA9IGZhbHNlO1xyXG4gICAgdmFyIGxvb3AgPSB7XHJcbiAgICAgICAgbmV4dDpmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICBpZihkb25lKXtcclxuICAgICAgICAgICAgICAgIGlmKHNob3VsZEV4aXQgJiYgZXhpdCl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGV4aXQoKTsgLy8gRXhpdCBpZiB3ZSdyZSBkb25lXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gSWYgd2UncmUgbm90IGZpbmlzaGVkXHJcbiAgICAgICAgICAgIGlmKGluZGV4IDwgaXRlcmF0aW9ucyl7XHJcbiAgICAgICAgICAgICAgICBpbmRleCsrOyAvLyBJbmNyZW1lbnQgb3VyIGluZGV4XHJcbiAgICAgICAgICAgICAgICBwcm9jZXNzKGxvb3ApOyAvLyBSdW4gb3VyIHByb2Nlc3MsIHBhc3MgaW4gdGhlIGxvb3BcclxuICAgICAgICAgICAgLy8gT3RoZXJ3aXNlIHdlJ3JlIGRvbmVcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGRvbmUgPSB0cnVlOyAvLyBNYWtlIHN1cmUgd2Ugc2F5IHdlJ3JlIGRvbmVcclxuICAgICAgICAgICAgICAgIGlmKGV4aXQpIGV4aXQoKTsgLy8gQ2FsbCB0aGUgY2FsbGJhY2sgb24gZXhpdFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICBpdGVyYXRpb246ZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgcmV0dXJuIGluZGV4IC0gMTsgLy8gUmV0dXJuIHRoZSBsb29wIG51bWJlciB3ZSdyZSBvblxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgYnJlYWs6ZnVuY3Rpb24oZW5kKXtcclxuICAgICAgICAgICAgZG9uZSA9IHRydWU7IC8vIEVuZCB0aGUgbG9vcFxyXG4gICAgICAgICAgICBzaG91bGRFeGl0ID0gZW5kOyAvLyBQYXNzaW5nIGVuZCBhcyB0cnVlIG1lYW5zIHdlIHN0aWxsIGNhbGwgdGhlIGV4aXQgY2FsbGJhY2tcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgbG9vcC5uZXh0KCk7XHJcbiAgICByZXR1cm4gbG9vcDtcclxufTtcclxuXHJcbmZ1bmN0aW9uIGNvbXBhcmUoc3ViamVjdCwgb3BlcmF0b3IsIHZhbHVlKSB7XHJcbiAgXHRzd2l0Y2ggKG9wZXJhdG9yKSB7XHJcbiAgXHRcdGNhc2UgJ2dyZWF0ZXJUaGFuJzpcclxuXHRcdFx0cmV0dXJuIHN1YmplY3QgPiB2YWx1ZTtcclxuXHRcdGNhc2UgJ2xlc3NUaGFuJzpcclxuXHRcdFx0cmV0dXJuIHN1YmplY3QgPCB2YWx1ZTtcclxuXHRcdGNhc2UgJ2dyZWF0ZXJUaGFuRXF1YWwnOlxyXG5cdFx0XHRyZXR1cm4gc3ViamVjdCA+PSB2YWx1ZTtcclxuXHRcdGNhc2UgJ2xlc3NUaGFuRXF1YWwnOlxyXG5cdFx0XHRyZXR1cm4gc3ViamVjdCA8PSB2YWx1ZTtcclxuXHRcdGNhc2UgJ2VxdWFsVG8nOlxyXG5cdFx0XHRyZXR1cm4gc3ViamVjdCA9PT0gdmFsdWU7XHJcblx0XHRjYXNlICdub3RFcXVhbFRvJzpcclxuXHRcdFx0cmV0dXJuIHN1YmplY3QgIT09IHZhbHVlO1xyXG4gIFx0fVxyXG59O1xyXG5cclxuZnVuY3Rpb24gZ2V0TmFtZShhcnIsIGxhbmcpe1xyXG5cdGlmIChhcnIgIT09IHVuZGVmaW5lZCkge1xyXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBhcnIubGVuZ3RoIDsgaSsrKSB7XHJcblx0XHRcdGlmIChhcnJbaV0uaTE4bi5fbGFuZyA9PT0gbGFuZykge1xyXG5cdFx0XHRcdHJldHVybiBhcnJbaV0uaTE4bi52YWx1ZTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSB7XHJcblxyXG4gXHRzdWNjZXNzOiBzdWNjZXNzLFxyXG4gXHR3YXJuOiB3YXJuLFxyXG4gXHRlcnJvcjogZXJyb3IsXHJcbiBcdHN5bmNMb29wOiBzeW5jTG9vcCxcclxuIFx0Y29tcGFyZTogY29tcGFyZSxcclxuXHRnZXROYW1lOiBnZXROYW1lXHJcblxyXG4gfVxyXG4iXX0=
