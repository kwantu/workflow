(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.Workflow = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";function Workflow(e,s,r,i){var t=this;if(""==s||void 0==s)throw util.error("ParamRequired","A community id is required.");if("string"!=typeof s)throw new Error("The community id must be a javascript string.");if(t.communityId=s||"",""==e||void 0==e)throw util.error("ParamRequired","A profile id is required.");if("string"!=typeof e)throw new Error("The profile id must be a javascript string.");if(t.profile=e||"",""==r||void 0==r)throw util.error("ParamRequired","An app id is required.");if("string"!=typeof r)throw new Error("The app id must be a javascript string.");if(t.app=r||"",""==i||void 0==i)throw util.error("ParamRequired","A workflow configuration is required.");"object"!=typeof i?t.config=JSON.parse(i):t.config=i,t.instance,t.subprocesses=[],t.indicators=[],t.history=[]}var Process=require("./lib/process"),util=require("utility"),userInterface=require("./lib/interface");Workflow.prototype.getProfile=function(){return this.profile},Workflow.prototype.getApp=function(){return this.app},Workflow.prototype.getConfig=function(){return this.config},Workflow.prototype.getInstance=function(){return this.instance},Workflow.prototype.setInstance=function(e){this.instance=e},Workflow.prototype.getSubProcesses=function(){return this.subprocesses},Workflow.prototype.setSubProcesses=function(e){this.subprocesses=e},Workflow.prototype.getIndicators=function(){return this.indicators},Workflow.prototype.setIndicators=function(e){this.indicators=e},Workflow.prototype.create=function(){var e=this;return new Promise(function(s,r){try{if(void 0!==e.instance){var i=util.warn("Instance already exists.",e);s(i)}else{var t={_id:"",version:"",type:"workflowInstance",processes:[],channels:["community_"+app.SCOPE.communityId,"profile_"+app.SCOPE.profileId,"application_"+app.SCOPE.applicationId,"community_"+app.SCOPE.communityId+"_application_"+app.SCOPE.applicationId]};t._id=e.profile+":processes",t.version=e.config.version,e.instance=t;var o=util.success("Workflow processes instance created successfully.",e);s(o)}}catch(e){r(e)}})},Workflow.prototype.initialise=function(e,s){var r=this;return new Promise(function(i,t){try{var o=[];if(""!==e&&void 0!==e){if(o=r.config.processes.filter(function(s){if(s._id==e)return s}),void 0==o[0]._id){var n=util.error("WFConfigError","No valid process definition found with process id: "+e);t(n)}}else o.push(r.config.processes[0]),e=r.config.processes[0]._id;var c=[];r.instance.processes.filter(function(s){s.id==e&&c.push(s)});var u=c.length+1,a={id:"",seq:"",subProcesses:[]};a.id=e,a.seq=u,r.instance.processes.push(a);var p=o[0].subProcesses[0]._id,f=1;r.instance.processes.filter(function(s){s.id==e&&s.seq==u&&(f=s.subProcesses.length+1)}),Process.subProcess(e,u,p,f,s,r).then(function(o){var n=r.profile+":"+r.app+":"+e+":"+u+":"+p+":"+f,c=s.label,l={id:p,seq:f,uuid:n,label:c};a.subProcesses.push(l);for(var d=0;d<r.instance.processes.length;d++){var h=r.instance.processes[d];h.id==e&&h.seq==u&&r.instance.processes.splice(d,1,a)}var w=o.data.indicators,v=o.data.step;Process.indicatorDocs(e,w,v,r).then(function(e){var s=util.success("Process: "+r.config.processes[0]._id+" initialized successfully.",r);i(s)},function(e){t(e)})},function(s){r.instance.processes=r.instance.processes.filter(function(s){return!(s.id==e&&s.seq==u)}),console.log(s),t(s)})}catch(e){t(e)}})},Workflow.prototype.transition=function(e,s,r,i,t,o,n){var c=this;return new Promise(function(u,a){try{Process.transition(e,s,r,i,t,o,n,c).then(function(t){var o=function(o){c.instance.processes.filter(function(n){n.id==e&&n.seq==s&&n.subProcesses.filter(function(e){e.id==r&&e.seq==i&&c.subprocesses.filter(function(s){if(s._id==e.uuid)if("step"==o){s.step=t.data;var r=util.success(t.message,s);u(r)}else if("stepComplete"==o){s.step=t.data.step,s.complete=!0;var r=util.success(t.message,s);u(r)}})})})};o(t.data.subProcessComplete?"stepComplete":"step")},function(e){a(e)})}catch(e){a(e)}})},Workflow.prototype.assignUser=function(e,s,r,i,t){var o=this;return new Promise(function(n,c){try{Process.assignUser(e,s,r,i,t,o).then(function(e){n(e)},function(e){c(e)})}catch(e){c(e)}})},Workflow.prototype.ui=function(){var e=this;return{getProcess:function(s,r){return new Promise(function(i,t){try{userInterface.getProcess(s,r,e).then(function(e){i(e)},function(e){t(e)})}catch(e){t(e)}})}}},module.exports=Workflow;

},{"./lib/interface":4,"./lib/process":5,"utility":6}],2:[function(require,module,exports){
"use strict";var util=require("utility"),community=function(){return{createCommunity:function(e){return new Promise(function(n,r){var t=worker.getWorkerWrapper();t._id=generateUUID(),t.communityId=app.SCOPE.communityId,t.applicationId=app.SCOPE.applicationId,t.createdDateTime=(new Date).toString(),t.senderUserId=LOCAL_SETTINGS.SUBSCRIPTIONS.userId;var o=JSON.xpath("/indicators[category/term eq 'Community']/_id",app.SCOPE.workflow,{})[0],i={createCommunity:{newCommunityId:e.profile,indicatorUUID:{Community:o}}};t.action=i,worker.send(t).then(function(e){var r=util.success("Form created successfully.",e);n(r)},function(e){r(e)})})},setVariable:function(e){return new Promise(function(e,n){})},userJoinCommunity:function(e){return new Promise(function(e,n){})}}}(),worker=function(){return{getWorkerWrapper:function(){var e={source:"remote",type:"workerObject",_id:"",channels:[],communityId:"",applicationId:"",message:"",messageType:"info",createdDateTime:"",senderUserId:"",notification:{},action:{}};return e},send:function(e){return new Promise(function(n,r){console.log("Submitting Worker Object to server"),console.log(e),dao.save(e).done(function(e){n(e)}).fail(function(e){console.log("Error submitting worker response !!"+e),r(e)})})}}}();module.exports={community:community,worker:worker};

},{"utility":6}],3:[function(require,module,exports){
"use strict";function create(args){var processId=args[0]||"",subProcess=args[1]||{},step=args[2]||{},action=args[3]||{},_WFInstance=args[6]||{},data=args[6]||{},indicators=subProcess.indicators||[],result=[],indicatorType=action._type,processSeq=args[4]||"",subProcessSeq=args[5]||"",createType=args[7]||"",subProcessId=subProcess._id,uuid=args[8]||"",baseUUID=args[9]||"",profile=_WFInstance.profile,inputData=args[10]||{};return new Promise(function(resolve,reject){for(var toProcess=indicators.length,formCreateFn=function(id,indicatorType,indicatorId,validDate,instantiateSource){gatekeeper.instantiate(id,indicatorType,indicatorId,_WFInstance.profile,validDate).then(function(docArray){for(var i=0;i<docArray.length;i++){var object=docArray[i];if(!object.model._id.endsWith(":approved")&&!object.model._id.endsWith(":rejected")){var workflowObj={id:_WFInstance.config._id,instance:_WFInstance.instance._id,processes:[{id:processId,subProcessId:subProcess._id,subProcessUUID:uuid,step:{id:step.id,seq:step.seq,startDate:"",status:step.status,message:step.message,assignedTo:{userId:step.assignedTo.userId,name:step.assignedTo.name},comment:step.comment,complete:!1,endDate:""}}]};void 0!=action.setWorkflowLabelInTitle&&""!=action.setWorkflowLabelInTitle&&1==action.setWorkflowLabelInTitle&&(object.model.title=inputData.label),void 0!=action.setDraft&&""!=action.setDraft&&1==action.setDraft&&(object.model.control.draft=!0),object.model.workflows.push(workflowObj);var mainId=object.model._id;gatekeeper.persist(docArray).then(function(savedArray){dao.get(mainId).done(function(data){var indicatorModel=ko.mapping.fromJS({defaultModel:{setId:indicatorId}});gatekeeper.instantiateData(mainId,instantiateSource,indicatorModel,data.model.pending.seq).then(function(data){if("200"==data[0].status){if(void 0!=action.setWorkflowLabelInField&&""!=action.setWorkflowLabelInField&&mainId==profile){console.log(data[0]);var path="data[0].model.model.pending.data."+action.setWorkflowLabelInField+"='"+inputData.label+"'";eval(path)}gatekeeper.persist(data).then(function(e){dao.get(mainId).done(function(e){if(0==_WFInstance.indicators.length){if(_WFInstance.indicators.push(e),toProcess--,0==toProcess){var s=util.success("Form created successfully.",_WFInstance.indicators);resolve(s)}}else{for(var i=!1,t=0;t<_WFInstance.indicators.length;t++){var a=_WFInstance.indicators[t];if(a._id==e._id&&(i=!0,_WFInstance.indicators.splice(t,1),_WFInstance.indicators.push(e),toProcess--,0==toProcess)){var s=util.success("Form created successfully.",_WFInstance.indicators);resolve(s)}}if(0==i&&(_WFInstance.indicators.push(e),toProcess--,0==toProcess)){var s=util.success("Form created successfully.",_WFInstance.indicators);resolve(s)}}}).fail(function(e){console.error(e);var s=util.success("1 Gatekeeper initialisation failed with initialiseData message "+e[0].message,{});reject(s)})},function(e){console.error(e);var s=util.success("2 Gatekeeper initialisation failed with initialiseData message "+e[0].message,{});reject(s)})}else{var failure=util.success("3 Gatekeeper initialisation failed with initialiseData message "+err[0].message,{});reject(failure)}},function(e){var s=util.success("4 Gatekeeper initialisation failed with initialiseData message "+e[0].message,{});reject(s)})}).fail(function(e){console.error(e);var s=util.success("5 Gatekeeper initialisation failed with initialiseData message "+e[0].message,{});reject(s)})},function(e){console.error(e);var s=util.success("6 Gatekeeper initialisation failed with initialiseData message "+e[0].message,{});reject(s)})}}},function(e){for(var s=[],i=0;i<_WFInstance.instance.processes.length;i++)_WFInstance.instance.processes[i].subProcesses.length>0&&s.push(_WFInstance.instance.processes[i]);_WFInstance.instance.processes=[],_WFInstance.instance.processes=s;for(var t=[],i=0;i<_WFInstance.subprocesses.length;i++)_WFInstance.subprocesses[i].indicators.length>0&&t.push(_WFInstance.subprocesses[i]);_WFInstance.subprocesses=[],_WFInstance.subprocesses=t,console.error(e);var a=util.success("7 Gatekeeper initialisation failed with initialiseData message "+e[0].message,{});reject(a)})},instantiateSource="fromDefinition",counter=0;counter<indicators.length;counter++){var indicatorId=indicators[counter]._id,indicatorName=util.getName(indicators[counter].name,"en"),initType=indicators[counter]._type,id="",indicatorDoc={};if("newInstance"==initType)if(void 0!=baseUUID&&""!=baseUUID&&baseUUID.length>0){var existingUUID=JSON.xpath("/subprocesses[_id eq '"+baseUUID+"']/indicators[id eq '"+indicatorId+"']/instances[1]/uuid",_WFInstance,{})[0];id=existingUUID,initType="newSequence";var sp=JSON.xpath("/subprocesses[_id eq '"+baseUUID+"']",app.SCOPE.workflow,{})[0];sp.active=!1,instantiateSource="fromAuthorised"}else id=void 0!=subProcess.isProfile&&subProcess.isProfile&&0==counter?profile:indicatorId+"-"+generateUUID();else{var spLastUuid=JSON.xpath("/instance/processes[id eq '"+processId+"' and subProcesses/id eq '"+subProcessId+"'][1]/subProcesses/uuid",_WFInstance,{})[0],indId=JSON.xpath("/subprocesses[_id eq '"+spLastUuid+"']/indicators[id eq '"+indicatorId+"']/instances/uuid",app.SCOPE.workflow,{})[0];if(id=""==spLastUuid||void 0==spLastUuid||""==indId||void 0==indId?void 0!=subProcess.isProfile&&subProcess.isProfile&&0==counter?profile:indicatorId+"-"+generateUUID():indId,void 0!=baseUUID&&""!=baseUUID&&baseUUID.length>0){var sp=JSON.xpath("/subprocesses[_id eq '"+baseUUID+"']",app.SCOPE.workflow,{})[0];sp.active=!1,instantiateSource="fromAuthorised"}}formCreateFn(id,initType,indicatorId,"",instantiateSource)}})}function setInstanceTitle(e){var s=e[0]||{},i=e[2]||"",t=e[4]||{},a=t.label;return new Promise(function(e,t){for(var n=JSON.xpath("/subprocesses[_id eq '"+i+"']",s,{})[0],r=n.indicators,o=0;o<r.length;o++){var c=r[o].instances[0].uuid,d=JSON.xpath("/indicators[_id eq '"+c+"']",s,{})[0];d.title=r[o].id+" "+a}e("Set Title Success",r)})}function deleteProfile(e){var s=e[0]||{},i=s.profile;return new Promise(function(e,s){var t={source:"remote",type:"workerObject",_id:generateUUID(),channels:[],communityId:app.SCOPE.communityId,applicationId:app.SCOPE.applicationId,message:"",messageType:"info",createdDateTime:moment().format(),senderUserId:LOCAL_SETTINGS.SUBSCRIPTIONS.userId,notification:{},profile:{action:"deleteProfile",profileId:i}};console.log(t),dao.upsert(t).done(function(s){console.log("Worker Object submitted for profile("+i+") deletion."),console.log(s),e(s)}).fail(function(e){console.log(e),s(data)})})}function createProfile(e){var s=e[1]||{},i=s.communityId,t=s.profile;return new Promise(function(e,s){library.createProfileDocuments(i,t).done(function(s){var i=util.success("Form created successfully.",s);e(i)}).fail(function(e){console.error(e);var i=util.success("ERROR: Profile creation failed"+e[0].message,{});s(i)})})}function setDraft(e){var s=e[0]||{},i=(s.communityId,s.profile,e[2]||"");return new Promise(function(e,t){for(var a=JSON.xpath("/subprocesses[_id eq '"+i+"']",s,{})[0],n=a.indicators,r=0;r<n.length;r++){var o=n[r].instances[0].uuid,c=JSON.xpath("/indicators[_id eq '"+o+"']",s,{})[0];c.control.draft=!0}e("Set Draft Success",n)})}function setUnDraft(e){var s=e[0]||{},i=(s.communityId,s.profile,e[2]||"");return new Promise(function(e,t){for(var a=JSON.xpath("/subprocesses[_id eq '"+i+"']",s,{})[0],n=a.indicators,r=0;r<n.length;r++){var o=n[r].instances[0].uuid,c=JSON.xpath("/indicators[_id eq '"+o+"']",s,{})[0];c.control.draft=!1}e("Set Draft Success",n)})}function save(e){var s={complete:!0,data:[]};return new Promise(function(e,i){var t=util.success("Form indicator set saved successfully.",s);e(t)})}function submit(e){var s={complete:!0,data:[]};return new Promise(function(e,i){var t=util.success("Form submitted successfully.",s);e(t)})}function authorise(e){var s=e[0]||"",i=e[1]||{},t=i._id,a=e[2]||"",n=e[3]||"",r=e[4]||{};return new Promise(function(e,i){for(var o=JSON.xpath("/processes[id eq '"+s+"' and seq eq '"+a+"']/subProcesses[id eq '"+t+"' and seq eq '"+n+"']/uuid",r.instance,{})[0],c=JSON.xpath("/subprocesses[_id eq '"+o+"']/indicators/instances/uuid",r,{}),d=c.length,u=[],l=0;l<d;l++)gatekeeper.authorise(c[l]).then(function(s){gatekeeper.persist(s).then(function(s){for(var i="",t=0;t<s.length;t++)s[t].id.endsWith(":approved")||(i=s[t].id);dao.get(i).done(function(s){if(0==r.indicators.length){if(r.indicators.push(s),d--,0==d){var i=util.success("Form authorised successfully.",u);e(i)}}else{for(var t=!1,a=0;a<r.indicators.length;a++){var n=r.indicators[a];if(n._id==s._id&&(t=!0,r.indicators.splice(a,1),r.indicators.push(s),d--,0==d)){var i=util.success("Form authorised successfully.",u);e(i)}}if(0==t&&(r.indicators.push(s),d--,0==d)){var i=util.success("Form authorised successfully.",u);e(i)}}}).fail(function(e){console.error(e)})},function(e){console.error(err)})},function(s){if(d--,0==d){var i=util.success("Form authorised successfully.",u);e(i)}})})}function close(e){var s={complete:!0,data:[]};return new Promise(function(e,i){var t=util.success("Form closed successfully.",s);e(t)})}var util=require("utility"),gatekeeper=new GK;module.exports={create:create,save:save,submit:submit,authorise:authorise,close:close,setDraft:setDraft,setUnDraft:setUnDraft,createProfile:createProfile,setInstanceTitle:setInstanceTitle,deleteProfile:deleteProfile};

},{"utility":6}],4:[function(require,module,exports){
"use strict";function getProcess(e,s,t){return new Promise(function(n,i){try{var c=[],r=[];t.instance.processes.filter(function(s){s.id==e&&(r=s)}),util.syncLoop(r.subProcesses.length,function(n){var o=n.iteration(),u=r.seq,f=r.subProcesses[o].id,a=r.subProcesses[o].seq;getSubProcess(e,u,f,a,s,t).then(function(e){c.push(e),n.next()},function(e){n.break(),i(e)})},function(){n(c)})}catch(e){i(e)}})}function getSubProcess(e,s,t,n,i,c){return new Promise(function(r,o){try{var u={id:"",seq:"",name:"",help:"",dates:"",step:""},f=[],a=[];c.instance.processes.filter(function(i){if(i.id==e&&i.seq==s){i.subProcesses.length;i.subProcesses.filter(function(e){e.id==t&&e.seq==n&&0==e.complete&&(f=e)})}}),c.config.processes.filter(function(s){s._id==e&&s.subProcesses.filter(function(e){e._id==t&&(a=e)})}),u.id=a._id,u.seq=f.seq,u.name=util.getName(a.name,i),u.help=util.getName(a.help,i),u.dates=f.dates,u.step=f.step,r(u)}catch(e){o(e)}})}function prepareNotificationScreen(){""}var util=require("utility");module.exports={getProcess:getProcess};

},{"utility":6}],5:[function(require,module,exports){
"use strict";function count(e){return void 0!==e?e.length:0}function preRequisites(e,s){return new Promise(function(t,i){var n=[];try{util.syncLoop(e.length,function(t){var a=t.iteration();preRequisite(e[a],s).then(function(e){n.push(!0),t.next()},function(e){n.push(!1),t.break(),i(e)})},function(){if(n.every(Boolean)){var e=util.success("Pre-requisites completed successfully.",{});t(e)}else{var s=util.error("WFPreRequisiteError","Not all pre-requisites passed.");i(s)}})}catch(e){i(e)}})}function preRequisite(e,s){return new Promise(function(t,i){switch(e._type){case"processInstances":try{var n=e._parameter,a=e._filter,r="";if(void 0!=a){var o=a._operator,c="";switch(o){case"greaterThan":c="gt";break;case"lessThan":c="lt";break;case"greaterThanEqual":c="ge";break;case"lessThanEqual":c="le";break;case"equalTo":c="eq";break;case"notEqualTo":c="ne"}var u=a._element,u=u.split(".").join("/"),l=a._value,d="/"+u+"[. eq '"+l+"']",f="count(/subprocesses[id eq '"+n+"']"+d+")";r=JSON.xpath(f,s,{})[0]}else r=JSON.xpath("count(/subprocesses[id eq '"+n+"'])",s,{})[0];var p=util.compare(r,e._operator,parseInt(e._value));if(p){var m=util.success("Pre-requisites passed.",{});t(m)}else{var v="";e.message.i18n.filter(function(e){if("en"==e._lang){v=e.value;var s=util.error("WFPreRequisiteError",v);i(s)}})}}catch(e){i(e)}default:var h=util.error("WFPreRequisiteError","Pre-requisite type: "+e._type+" not defined.");i(h)}})}function preActions(e,s){return new Promise(function(t,i){var n=[];try{util.syncLoop(e.length,function(t){var a=t.iteration();action(e[a],s).then(function(e){n.push(!0),t.next()},function(e){n.push(!1),t.break(),i(e)})},function(){if(n.every(Boolean)){var e=util.success("Pre-actions completed successfully.",{});t(e)}else{var s=util.error("WFPreRequisiteError","Not all pre-actions passed.");i(s)}})}catch(e){i(e)}})}function getSubProcess(e,s){return void 0==s.subprocesses?[]:void s.subprocesses.filter(function(s){if(s.id==e)return s})}function subProcess(e,s,t,i,n,a){var r=[],o=[],c=[];a.instance.processes.filter(function(n){if(n.id==e&&n.seq==s){n.subProcesses.length;n.subProcesses.filter(function(e){if(e.id==t&&e.seq==i){var s=e.uuid;a.subprocesses.filter(function(e){e._id==s&&(r=e)})}})}}),a.config.processes.filter(function(s){s._id==e&&(o=s,s.subProcesses.filter(function(e){e._id==t&&(c=e)}))});var u="",l=n.baseUUID;if(void 0!=l&&""!=l&&l.length>0){var d=JSON.xpath("/subprocesses[_id eq '"+l+"']",a,{})[0];u=d.groupKey}else u=generateUUID();var f=a.profile+":"+a.app+":"+e+":"+s+":"+t+":"+i,p={_id:f,id:t,type:"workflowInstanceSubProcess",seq:i,initiated:!1,dates:{created:"",valid:"",due:"",closed:""},complete:!1,indicators:[],step:{},active:!0,groupKey:u,channels:["community_"+app.SCOPE.communityId,"profile_"+app.SCOPE.profileId,"application_"+app.SCOPE.applicationId,"community_"+app.SCOPE.communityId+"_application_"+app.SCOPE.applicationId]};return a.subprocesses.push(p),new Promise(function(u,l){try{var d=o.preActions;preActions(d,a).then(function(d){var m=o.prerequisites;preRequisites(m,a).then(function(d){var m=c.initiate;initiate(m,r,n).then(function(r){p.initiated=r.data.initiated,p.dates=r.data.dates;var d=c.steps[0]._id,f=c.steps[0].transitions[0]._id,m=1;step(e,s,t,i,d,m,n,a).then(function(r){p.step=r.data,indicators(c.indicators,a,p._id).then(function(r){p.indicators=r.data,transition(e,s,t,i,d,f,n,a).then(function(e){var s=e;p.step=e.data;var t=o.postActions;postActions(t,a).then(function(e){var t=util.success(s.message,p);u(t)},function(e){l(e)})},function(e){l(e)})},function(e){l(e)})},function(e){l(e)})},function(e){a.subprocesses=a.subprocesses.filter(function(e){return!(e._id==f)}),l(e)})},function(e){a.subprocesses=a.subprocesses.filter(function(e){return!(e._id==f)}),l(e)})},function(e){a.subprocesses=a.subprocesses.filter(function(e){return!(e._id==f)}),l(e)})}catch(e){l(e)}})}function initiate(e,s,t){var i={initiated:!1,dates:{created:"",valid:"",due:"",closed:""}};return new Promise(function(n,a){var r=function(){switch(e._type){case"user":i.dates.created=t.createdDate,"userSelected"!=e.dates.valid._type&&"autoSelected"!=e.dates.valid._type||(void 0!==t.validDate?i.dates.valid=t.validDate:util.warn("WFInitiateError","No valid date passed in - {data.validDate}")),"userSelected"!=e.dates.due._type&&"autoSelected"!=e.dates.valid._type||(void 0!==t.dueDate?i.dates.due=t.dueDate:util.warn("WFInitiateError","No due date passed in - {data.dueDate}")),i.initiated=!0;var s=util.success("Sub-Process initiate completed successfully.",i);n(s);break;case"auto":i.dates.created=t.createdDate,"userSelected"!=e.dates.valid._type&&"autoSelected"!=e.dates.valid._type||(void 0!==t.validDate?i.dates.valid=t.validDate:util.warn("WFInitiateError","No valid date passed in - {data.validDate}")),"userSelected"!=e.dates.due._type&&"autoSelected"!=e.dates.due._type||(void 0!==t.dueDate?i.dates.due=t.dueDate:util.warn("WFInitiateError","No due date passed in - {data.dueDate}")),i.initiated=!0;var s=util.success("Sub-Process initiate completed successfully.",i);n(s);break;default:var r=util.error("WFInitiateError","Initiate type: "+e._type+" not defined.");a(r)}};if(void 0==s.complete)r();else if(!s.complete)if(e.parallelInstances)r();else{var o=util.error("WFInitiateError","Sub-process: "+s.id+" still active and parallel instances are not allowed.");a(o)}})}function step(e,s,t,i,n,a,r,o){var c,u={id:"",seq:"",status:"",message:"",assignedTo:{userId:"",name:""},assignment:{},comment:""},l={},d="",f={};return new Promise(function(p,m){try{o.instance.processes.filter(function(n){n.id==e&&n.seq==s&&n.subProcesses.filter(function(e){e.id==t&&e.seq==i&&(d=e.uuid)})}),o.subprocesses.filter(function(e){e._id==d&&(c=e)}),o.config.processes.filter(function(s){s._id==e&&s.subProcesses.filter(function(e){e._id==t&&(l=e,e.steps.filter(function(e){e._id==n&&(f=e)}))})}),u.id=n,u.seq=a,u.status=f._setInstanceStatusTo,u.message=f._setStatusMsgTo,u.comment=void 0!==r.comment?r.comment:"";var v=void 0!==c?c.indicators:[];indicatorDocs(e,v,u,o).then(function(n){var a=o.profile+":"+o.app+":"+e+":"+s+":"+t+":"+i;d=a,void 0!==f.actions[0]?actions(f.actions,e,s,t,i,l,u,o,r,d).then(function(e){var s=util.success("Actions completed successfully.",u);p(s)},function(e){m(e)}):void 0!==f.task&&task(e,s,f.task,a,u).then(function(e){console.log("Task complete.");var s=util.success("Task awaiting user action.",u);p(s)},function(e){m(e)})},function(e){m(e)})}catch(e){m(e)}})}function indicators(e,s,t){var i=[];return new Promise(function(e,n){try{for(var a=JSON.xpath("indicators[fn:count(./workflows/processes[subProcessUUID eq '"+t+"']) gt 0]",s,{}),r=0;r<a.length;r++){var o=a[r],c={id:"",instances:[]},u={uuid:"",title:"",key:"",seq:1};c.id=o.category.term,u.uuid=o._id,u.title=o.title,u.key="",u.seq=o.model.pending.seq,c.instances.push(u),i.push(c)}var l=util.success("Process indicator model updated.",i);e(l)}catch(e){n(e)}})}function assignUser(e,s,t,i,n,a){return new Promise(function(r,o){try{var c="";a.instance.processes.filter(function(n){n.id==e&&n.seq==s&&n.subProcesses.filter(function(e){e.id==t&&e.seq==i&&(c=e.uuid)})}),a.subprocesses.filter(function(s){if(s._id==c){s.step.assignedTo.userId=n.id,s.step.assignedTo.name=n.name;for(var t=s.indicators,i=0;i<t.length;i++)for(var o=t[i],u=0;u<o.instances.length;u++)for(var l=o.instances[u],d=0;d<a.indicators.length;d++){var f=a.indicators[d];l.uuid==f._id&&f.workflows.filter(function(s){s.id==a.config._id&&s.processes.filter(function(s){s.id==e&&(s.step.assignedTo.userId=n.id,s.step.assignedTo.name=n.name)})})}var p=util.success('User assigned successfully. UserId: "'+n.id+'", Name: "'+n.name+'"',s);r(p)}})}catch(e){o(e)}})}function indicatorDocs(e,s,t,i){return new Promise(function(n,a){try{if(void 0==s){util.error("WFIndicatorsUpdate","Indicators parameter is required. - Value: "+s);a(err)}else{for(var r=0;r<s.length;r++)for(var o=s[r],c=0;c<o.instances.length;c++)for(var u=o.instances[c],l=0;l<i.indicators.length;l++){var d=i.indicators[l];u.uuid==d._id&&d.workflows.filter(function(s){s.id==i.config._id&&s.processes.filter(function(s){s.id==e&&(s.step.id=t.id,s.step.seq=t.seq,s.step.status=t.status,s.step.message=t.message,s.step.assignedTo.userId=t.assignedTo.userId,s.step.assignedTo.name=t.assignedTo.name,s.step.comment=void 0!==t.comment?t.comment:"")})})}var f=util.success("Indicator documents workflow process model updated.",i);n(f)}}catch(e){a(e)}})}function actions(e,s,t,i,n,a,r,o,c,u){var l=[];return new Promise(function(d,f){util.syncLoop(e.length,function(d){var p=d.iteration();action(e[p],s,t,i,n,a,r,o,c,u).then(function(s){var t={id:e[p]._id,seq:p,data:s};l.push(t),d.next()},function(e){d.break(),f(e)})},function(){var e=util.success("Actions completed successfully.",l);d(e)})})}function action(e,s,t,i,n,a,r,o,c,u){return new Promise(function(l,d){if(void 0!=e.method){var f=["form","indicator","profile","subProcessInstance","step","community","applicationDefinition","applicationAdoption","user","sdo"];switch(propertyExists(e.method,f)){case"form":break;case"indicator":break;case"profile":break;case"subProcessInstance":break;case"step":break;case"community":var p=["setVariable","createCommunity","userJoinCommunity"];switch(propertyExists(e.method.community,p)){case"setVariable":break;case"createCommunity":return actionsModule.community.createCommunity(o).then(function(e){l(e.data)},function(e){d(e)});case"userJoinCommunity":break;default:d("No method found from implemented list.")}break;case"applicationDefinition":break;case"applicationAdoption":break;case"user":break;case"sdo":break;default:d("No method found from implemented list.")}}else{var m=[],v="global",h="";void 0!==e._id&&(v=e._id.split(".")[0]),void 0!==e._id&&(h=e._id.split(".")[1]),m.length=0;for(var g=0;g<e._args.length;g++){var _=e._args[g];switch(_){case"processId":m.push(s);break;case"processSeq":m.push(t);break;case"subProcessId":m.push(i);break;case"subProcessSeq":m.push(n);break;case"subProcess":m.push(a);break;case"step":m.push(r);break;case"action":m.push(e);break;default:m=[]}}if(m.push(o),m.push(c.createType),m.push(u),m.push(c.baseUUID),m.push(c),"form.create"==e._id)form.create(m).then(function(e){l(e.data)},function(e){d(e)});else if("form.authorise"==e._id)form.authorise(m).then(function(e){l(e.data)},function(e){d(e)});else if("form.close"==e._id)form.close(m).then(function(e){l(e.data)},function(e){d(e)});else if("form.setDraft"==e._id)form.setDraft(m).then(function(e){l(e.data)},function(e){d(e)});else if("form.setUnDraft"==e._id)form.setUnDraft(m).then(function(e){l(e.data)},function(e){d(e)});else if("form.createProfile"==e._id)form.createProfile(m).then(function(e){l(e.data)},function(e){d(e)});else if("form.setInstanceTitle"==e._id)form.setInstanceTitle(m).then(function(e){l(e.data)},function(e){d(e)});else if("profile.delete"==e._id)form.deleteProfile(m).then(function(e){l(e.data)},function(e){d(e)});else{var b=util.error("WFActionError","Method: "+action_id+" not defined.");d(b)}}})}function task(e,s,t,i,n){return new Promise(function(a,r){if(void 0!=t.assign.profileRole){var o=app.SCOPE.workflow.profile,c="";"current"==t.assign.profileRole.profile?c=app.SCOPE.workflow.profile:"community"==t.assign.profileRole.profile&&(c=app.SCOPE.communityId);var u=t.assign.profileRole.role;library.getUsersListByRole(c,u).then(function(r){if(void 0!=r)if(r.length>1){var l=JSON.xpath("/subprocesses[_id eq '"+i+"']",app.SCOPE.workflow,{})[0],d=JSON.xpath("/subprocesses[_id eq '"+i+"']/channels",app.SCOPE.workflow,{}),f=processWorkflowMessage(NOTIFICATION_USER_MSG_ACCEPT,i),p=l.id,m=l.seq,v=i,h=l.dates.valid,g=JSON.xpath("/config/processes[_id eq '"+e+"']",app.SCOPE.workflow,{})[0],_=JSON.xpath("/subProcesses[_id eq '"+p+"']",g,{})[0],b=l.step.seq+0,y=JSON.xpath("/steps[_seq eq '"+b+"']/name/i18n[1]/value",_,{})[0],P=_.name.i18n[0].value,I={source:"remote",type:"notificationRequest",_id:i+":notificationRequest",channels:d,communityId:app.SCOPE.communityId,applicationId:app.SCOPE.applicationId,message:f,messageType:"info",createdDateTime:moment().format(),senderUserId:LOCAL_SETTINGS.SUBSCRIPTIONS.userId,actions:[{label:"View",function:"app.openSubprocess",params:[o,p,m,P,e,s,v,h,y]}],receiver:{value:[{type:"role",name:u,profileId:c}]}};dao.upsert(I).done(function(e){console.log(e)}).fail(function(e){console.log(e)});var S="";if(void 0!=t.assign.assignment){var S=n.assignment,q={show:t.assign.assignment.accept.show,label:_getName(t.assign.assignment.accept.label.i18n,"en")};S.accept=q,S.message=_getName(t.assign.assignment.message.i18n,"en");var w={show:t.assign.assignment.reject.show,label:_getName(t.assign.assignment.reject.label.i18n,"en")};S.reject=w;var E={profileId:o,roleId:u,type:"role"};S.value=E,S.profileRoleId=c}a("Notifications request submitted for acceptance.")}else if(1==r.length){var k=r[0].id,T=r[0].name,O=n.assignedTo;O.name=T+"",O.userId=k+"",a("Assigned to the only user in role.")}else if(void 0!=t.assign.default){var k=t.assign.default.userId,T=t.assign.default.userName,O=n.assignedTo;O.name=T+"",O.userId=k+"",a("Assigned to default user")}else console.log("Error in assignment. Default user not specified."),w("Error in assignment. Default user not specified.");else console.log("Error in getUsersListByRole undefined"),w(err)},function(e){console.log("Error in getUsersListByRole"),r(e)})}else void 0!=t.assign.swimlane&&(a("swimlane"),console.log("Swimlane implementation !!"))})}function transition(e,s,t,i,n,a,r,o){return new Promise(function(c,u){try{for(var l=0,d="",f=0,p=[],m=o.config.processes.filter(function(s){if(s._id==e)return s}),v=m[0].subProcesses.filter(function(e){if(e._id==t)return e}),h=v[0].steps.filter(function(e){if(e._id==n)return e}),g=h[0].transitions.filter(function(e){if(e._id==a)return e}),_=0;_<v[0].steps.length;_++)v[0].steps[_]._id==n&&(l=parseInt(v[0].steps[_]._seq));v[0].steps.filter(function(e){f=l+1,parseInt(e._seq)==f&&(d=e._id)}),o.instance.processes.filter(function(n){n.id==e&&n.seq==s&&n.subProcesses.filter(function(e){if(e.id==t&&e.seq==i){var s=e.uuid;o.subprocesses.filter(function(e){e._id==s&&(p=e)})}})});var b=v[0].steps.length;switch(g[0]._type){case"auto":"nextStep"==g[0].goTo._type&&step(e,s,t,i,d,f,r,o).then(function(e){if(f==b){var s=util.success("All Step transitions have completed successfully.",{subProcessComplete:!0,step:e.data});c(s)}else{var s=util.success("Step transition completed successfully.",e.data);c(s)}},function(e){u(e)});break;case"user":if("nextStep"==g[0].goTo._type)step(e,s,t,i,d,f,r,o).then(function(e){if(f==b){var s=util.success("All Step transitions have completed successfully.",{subProcessComplete:!0,step:e.data});c(s)}else{var s=util.success("Step transition completed successfully.",e.data);c(s)}},function(e){u(e)});else if("stepId"==g[0].goTo._type){var y=g[0].goTo._stepId,P=1;v[0].steps.filter(function(e){e._id==y&&(P=parseInt(e._seq))}),step(e,s,t,i,y,P,r,o).then(function(e){if(P==b){var s=util.success("All Step transitions have completed successfully.",{subProcessComplete:!0,step:e.data});c(s)}else{var s=util.success("Step transition completed successfully.",e.data);c(s)}},function(e){u(e)})}break;default:var I=util.error("WFTransitionError","Transition type: "+g[0]._type+" not defined.");u(I)}}catch(e){u(e)}})}function postActions(e,s){return new Promise(function(t,i){var n=[];try{util.syncLoop(e.length,function(t){var a=t.iteration();action(e[a],s).then(function(e){n.push(!0),t.next()},function(e){n.push(!1),t.break(),i(e)})},function(){if(n.every(Boolean)){var e=util.success("Post-actions completed successfully.",{});t(e)}else{var s=util.error("WFPreActionsError","Not all post-actions passed.");i(s)}})}catch(e){i(e)}})}function processWorkflowMessage(e,s){var t=e;if(t.indexOf("#INSTANCE_LABEL")!==-1){var i=JSON.xpath("/instance/processes/subProcesses[uuid eq '"+s+"']/label",app.SCOPE.workflow,{})[0];t=t.replace("#INSTANCE_LABEL",i)}if(t.indexOf("#USER_NAME")!==-1){var i=JSON.xpath("/subprocesses[_id eq '"+s+"']/step/assignedTo/name",app.SCOPE.workflow,{})[0];t=t.replace("#USER_NAME",i)}if(t.indexOf("#PROFILE_TITLE")!==-1){var i=app.profile.title;t=t.replace("#PROFILE_TITLE",i)}if(t.indexOf("#PROFILE_TYPE")!==-1){var i=app.SCOPE.APP_CONFIG.name;t=t.replace("#PROFILE_TYPE",i)}if(t.indexOf("#VAR_SPUUID")!==-1){var i=s;t=t.replace("#VAR_SPUUID",i)}return t}function _getName(e,s){if(void 0!==e)for(var t=0;t<e.length;t++)if(e[t]._lang===s)return e[t].value}var util=require("utility"),actionsModule=require("./actions"),form=require("./form");module.exports={preRequisites:preRequisites,preActions:preActions,subProcess:subProcess,indicatorDocs:indicatorDocs,task:task,transition:transition,assignUser:assignUser};

},{"./actions":2,"./form":3,"utility":6}],6:[function(require,module,exports){
"use strict";function success(r,e){return{message:r,data:e}}function warn(r,e){return console.warn(e),{warning:r,data:e}}function error(r,e){var n=new Error("");return n.name=r,n.message=e,n}function syncLoop(r,e,n){var a=0,t=!1,o=!1,u={next:function(){return t&&o&&n?n():void(a<r?(a++,e(u)):(t=!0,n&&n()))},iteration:function(){return a-1},break:function(r){t=!0,o=r}};return u.next(),u}function compare(r,e,n){switch(e){case"greaterThan":return r>n;case"lessThan":return r<n;case"greaterThanEqual":return r>=n;case"lessThanEqual":return r<=n;case"equalTo":return r===n;case"notEqualTo":return r!==n}}function getName(r,e){if(void 0!==r)for(var n=0;n<r.length;n++)if(r[n].i18n._lang===e)return r[n].i18n.value}module.exports={success:success,warn:warn,error:error,syncLoop:syncLoop,compare:compare,getName:getName};

},{}]},{},[1])(1)
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL1VzZXJzL0hhc2FuL0FwcERhdGEvUm9hbWluZy9ucG0vbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsImluZGV4LmpzIiwibGliXFxhY3Rpb25zLmpzIiwibGliXFxmb3JtLmpzIiwibGliXFxpbnRlcmZhY2UuanMiLCJsaWJcXHByb2Nlc3MuanMiLCJub2RlX21vZHVsZXNcXHV0aWxpdHlcXGluZGV4LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUEsWUEwQ0EsU0FBUyxVQUFTLEVBQVMsRUFBYSxFQUFLLEdBQzVDLEdBQUksR0FBUSxJQUdaLElBQW1CLElBQWYsR0FBb0MsUUFBZixFQUNsQixLQUFNLE1BQUssTUFBTSxnQkFBaUIsOEJBQy9CLElBQTRCLGdCQUFsQixHQUNoQixLQUFNLElBQUksT0FBTSxnREFNcEIsSUFKSSxFQUFNLFlBQWMsR0FBZSxHQUl4QixJQUFYLEdBQTRCLFFBQVgsRUFDZCxLQUFNLE1BQUssTUFBTSxnQkFBaUIsNEJBQy9CLElBQXdCLGdCQUFkLEdBQ2hCLEtBQU0sSUFBSSxPQUFNLDhDQUtwQixJQUhJLEVBQU0sUUFBVSxHQUFXLEdBR3BCLElBQVAsR0FBb0IsUUFBUCxFQUNWLEtBQU0sTUFBSyxNQUFNLGdCQUFpQix5QkFDL0IsSUFBb0IsZ0JBQVYsR0FDaEIsS0FBTSxJQUFJLE9BQU0sMENBS2pCLElBSEMsRUFBTSxJQUFNLEdBQU8sR0FHTixJQUFWLEdBQTBCLFFBQVYsRUFDbkIsS0FBTSxNQUFLLE1BQU0sZ0JBQWlCLHdDQUNMLGlCQUFiLEdBQ2IsRUFBTSxPQUFTLEtBQUssTUFBTSxHQUU3QixFQUFNLE9BQVMsRUFHZixFQUFNLFNBRVQsRUFBTSxnQkFFTixFQUFNLGNBRU4sRUFBTSxXQW5GUixHQUFJLFNBQVUsUUFBUSxpQkFDbEIsS0FBTyxRQUFRLFdBQ2YsY0FBZ0IsUUFBUSxrQkE2RjVCLFVBQVMsVUFBVSxXQUFh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S0FBSyxtQkFDSixNQUFPLElBQVcsQ0FDbkIsS0FBSyxnQkFDSixNQUFPLElBQVcsQ0FDbkIsS0FBSyxVQUNKLE1BQU8sS0FBWSxDQUNwQixLQUFLLGFBQ0osTUFBTyxLQUFZLEdBSXRCLFFBQVMsU0FBUSxFQUFLLEdBQ3JCLEdBQVksU0FBUixFQUNILElBQUssR0FBSSxHQUFJLEVBQUcsRUFBSSxFQUFJLE9BQVMsSUFDaEMsR0FBSSxFQUFJLEdBQUcsS0FBSyxRQUFVLEVBQ3pCLE1BQU8sR0FBSSxHQUFHLEtBQUssTUFNdkIsT0FBTyxTQUVMLFFBQVMsUUFDVCxLQUFNLEtBQ04sTUFBTyxNQUNQLFNBQVUsU0FDVixRQUFTLFFBQ1YsUUFBUyIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCIndXNlIHN0cmljdCc7XHJcblxyXG52YXIgUHJvY2VzcyA9IHJlcXVpcmUoJy4vbGliL3Byb2Nlc3MnKTtcclxudmFyIHV0aWwgPSByZXF1aXJlKCd1dGlsaXR5Jyk7XHJcbnZhciB1c2VySW50ZXJmYWNlID0gcmVxdWlyZSgnLi9saWIvaW50ZXJmYWNlJyk7XHJcblxyXG4vKmdsb2JhbHMgKi9cclxuXHJcbi8qKlxyXG4gKiBBIG5ldyBXb3JrZmxvdyBjb25zdHJ1Y3RvciBpbnN0YW5jZSBjb250YWlucyB0aGUgcmVmZXJlbmNlIHRvIHRoZSBhcHBsaWNhdGlvblxyXG4gKiBhbmQgYXNzb2NpYXRlZCBwcm9maWxlIHdoaWNoIGl0IHJlcXVpcmVzIGFzIHRoZSBmaXJzdCB0d28gcGFyYW1ldGVycy4gSXQgYWxzb1xyXG4gKiByZXF1aXJlcyBhIHdvcmtmbG93IGNvbmZpZ3VyYXRpb24sIGFzIHRoZSB0aGlyZCBwYXJhbWV0ZXIsIHdoaWNoIGlzIHVzZWQgdG9cclxuICogZGVzY2liZSB0aGUgd29ya2Zsb3cgcHJvY2Vzc2VzLiBJZiBhIHdvcmtmbG93IGluc3RhbmNlIGV4aXN0cyB5b3UgY2FuIHBhc3MgaXRcclxuICogaW4gYXMgdGhlIGZvdXJ0aCBwYXJhbWV0ZXIgd2hpY2ggaXQgd2lsbCB0aGVuIHVzZSwgZWxzZSBjcmVhdGUgYSBuZXcgb25lLlxyXG4gKlxyXG4gKiBAY29uc3RydWN0b3JcclxuICpcclxuICogQHBhcmFtIHtzdHJpbmd9IHByb2ZpbGUgLSBUaGUgY3VycmVudCBwcm9maWxlIGlkXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBhcHAgLSBUaGUgYXNzb2NpYXRlZCBhcHBsaWNhdGlvbiBpZFxyXG4gKiBAcGFyYW0ge09iamVjdH0gY29uZmlnIC0gVGhlIGFwcGxpY2F0aW9uIHdvcmtmbG93IGNvbmZpZ3VyYXRpb24gLyBkZWZpbml0aW9uXHJcbiAqIEBwYXJhbSB7T2JqZWN0fSBbaW5zdGFuY2VdIC0gQW4gZXhpc3RpbmcgYXBwbGljYXRpb24gcHJvZmlsZSB3b3JrZmxvdyBpbnN0YW5jZSBiYXNlZFxyXG4gKiBvbiB0aGUgZGVmaW5pdGlvblxyXG4gKlxyXG4gKiBAYXV0aG9yIEJyZW50IEdvcmRvblxyXG4gKiBAdmVyc2lvbiAwLjEuMFxyXG4gKlxyXG4gKiBAZXhhbXBsZVxyXG4gKiB2YXIgY29uZmlnID0geyAnX2lkJzogJ2FiYzEyMycgfTtcclxuICogdmFyIGluc3RhbmNlID0geyAnX2lkJzogJ2luc3RhbmNlX2FiYzEyMycgfTtcclxuICogLy8gSWYgdGhlcmUgaXNuJ3QgYW4gZXhpc3RpbmcgaW5zdGFuY2VcclxuICogdmFyIHdvcmtmbG93ID0gbmV3IFdvcmtmbG93KCcxMjM0JywgJzU2NzgnLCBjb25maWcpO1xyXG4gKiAvLyBJZiB0aGVyZSBpcyBhbiBleGlzdGluZyBpbnN0YW5jZVxyXG4gKiB2YXIgd29ya2Zsb3cgPSBuZXcgV29ya2Zsb3coJzEyMzQnLCAnNTY3OCcsIGNvbmZpZywgaW5zdGFuY2UpO1xyXG4gKlxyXG4gKiBAcmV0dXJuIHtPYmplY3R9IG5ldyBXb3JrZmxvdyBvYmplY3RcclxuICpcclxuICogQHRocm93cyBFcnJvcjogQSBwcm9maWxlIGlkIGlzIHJlcXVpcmVkXHJcbiAqIEB0aHJvd3MgRXJyb3I6IEFuIGFwcCBpZCBpcyByZXF1aXJlZFxyXG4gKiBAdGhyb3dzIEVycm9yOiBBIHdvcmtmbG93IGNvbmZpZ3VyYXRpb24gaXMgcmVxdWlyZWRcclxuICpcclxuICovXHJcblxyXG5mdW5jdGlvbiBXb3JrZmxvdyhwcm9maWxlLCBjb21tdW5pdHlJZCwgYXBwLCBjb25maWcpe1xyXG5cdHZhciBfdGhpcyA9IHRoaXM7XHJcblx0XHJcblx0Ly8gQ29tbXVuaXR5IElEIHZhbGlkYXRpb24gY2hlY2tzXHJcblx0aWYgKGNvbW11bml0eUlkID09ICcnIHx8IGNvbW11bml0eUlkID09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIHRocm93IHV0aWwuZXJyb3IoJ1BhcmFtUmVxdWlyZWQnLCAnQSBjb21tdW5pdHkgaWQgaXMgcmVxdWlyZWQuJyk7XHJcbiAgICB9IGVsc2UgaWYgKHR5cGVvZihjb21tdW5pdHlJZCkgIT09ICdzdHJpbmcnKSB7XHJcbiAgICBcdHRocm93IG5ldyBFcnJvcignVGhlIGNvbW11bml0eSBpZCBtdXN0IGJlIGEgamF2YXNjcmlwdCBzdHJpbmcuJyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgXHRfdGhpcy5jb21tdW5pdHlJZCA9IGNvbW11bml0eUlkIHx8ICcnO1xyXG4gICAgfVxyXG5cclxuXHQvLyBQcm9maWxlIElEIHZhbGlkYXRpb24gY2hlY2tzXHJcblx0aWYgKHByb2ZpbGUgPT0gJycgfHwgcHJvZmlsZSA9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICB0aHJvdyB1dGlsLmVycm9yKCdQYXJhbVJlcXVpcmVkJywgJ0EgcHJvZmlsZSBpZCBpcyByZXF1aXJlZC4nKTtcclxuICAgIH0gZWxzZSBpZiAodHlwZW9mKHByb2ZpbGUpICE9PSAnc3RyaW5nJykge1xyXG4gICAgXHR0aHJvdyBuZXcgRXJyb3IoJ1RoZSBwcm9maWxlIGlkIG11c3QgYmUgYSBqYXZhc2NyaXB0IHN0cmluZy4nKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICBcdF90aGlzLnByb2ZpbGUgPSBwcm9maWxlIHx8ICcnO1xyXG4gICAgfVxyXG4gICAgLy8gQXBwIElEIHZhbGlkYXRpb24gY2hlY2tzXHJcblx0aWYgKGFwcCA9PSAnJyB8fCBhcHAgPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgdGhyb3cgdXRpbC5lcnJvcignUGFyYW1SZXF1aXJlZCcsICdBbiBhcHAgaWQgaXMgcmVxdWlyZWQuJyk7XHJcbiAgICB9IGVsc2UgaWYgKHR5cGVvZihhcHApICE9PSAnc3RyaW5nJykge1xyXG4gICAgXHR0aHJvdyBuZXcgRXJyb3IoJ1RoZSBhcHAgaWQgbXVzdCBiZSBhIGphdmFzY3JpcHQgc3RyaW5nLicpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgIFx0X3RoaXMuYXBwID0gYXBwIHx8ICcnO1xyXG4gICAgfVxyXG4gICAgLy8gV29ya2Zsb3cgY29uZmlndXJhdGlvbiB2YWxpZGF0aW9uIGNoZWNrc1xyXG4gICAgaWYgKGNvbmZpZyA9PSAnJyB8fCBjb25maWcgPT0gdW5kZWZpbmVkKSB7XHJcbiAgICBcdHRocm93IHV0aWwuZXJyb3IoJ1BhcmFtUmVxdWlyZWQnLCAnQSB3b3JrZmxvdyBjb25maWd1cmF0aW9uIGlzIHJlcXVpcmVkLicpO1xyXG4gICAgfSBlbHNlIGlmICh0eXBlb2YoY29uZmlnKSAhPT0gJ29iamVjdCcpIHtcclxuICAgICAgICBfdGhpcy5jb25maWcgPSBKU09OLnBhcnNlKGNvbmZpZyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgXHRfdGhpcy5jb25maWcgPSBjb25maWc7XHJcbiAgICB9XHJcblx0ICAgIC8vIFdvcmtmbG93IGluc3RhbmNlIHZhbGlkYXRpb24gY2hlY2tzXHJcblx0ICAgIF90aGlzLmluc3RhbmNlO1xyXG5cdFx0Ly8gV29ya2Zsb3cgc3ViLXByb2Nlc3NlcyB2YWxpZGF0aW9uIGNoZWNrc1xyXG5cdFx0X3RoaXMuc3VicHJvY2Vzc2VzID0gW107XHJcblx0XHQvLyBXb3JrZmxvdyBpbmRpY2F0b3JzIHBsYWNlIGhvbGRlclxyXG5cdFx0X3RoaXMuaW5kaWNhdG9ycyA9IFtdO1xyXG5cdFx0Ly8gV29ya2Zsb3cgc3ViLXByb2Nlc3Mgc3RlcCBoaXN0b3J5IHBsYWNlIGhvbGRlclxyXG5cdFx0X3RoaXMuaGlzdG9yeSA9IFtdO1xyXG5cclxufVxyXG5cclxuLyoqXHJcbiAqIFdvcmtmbG93IGdldCBwcm9maWxlIGlkLlxyXG4gKlxyXG4gKiBAZXhhbXBsZSBcIlwiXHJcbiAqXHJcbiAqIEByZXR1cm4gXCJcIlxyXG4gKlxyXG4gKi9cclxuV29ya2Zsb3cucHJvdG90eXBlLmdldFByb2ZpbGUgPSBmdW5jdGlvbigpe1xyXG5cdHJldHVybiB0aGlzLnByb2ZpbGU7XHJcbn07XHJcblxyXG4vKipcclxuICogV29ya2Zsb3cgZ2V0IGFwcCBpZC5cclxuICpcclxuICogQGV4YW1wbGUgXCJcIlxyXG4gKlxyXG4gKiBAcmV0dXJuIFwiXCJcclxuICpcclxuICovXHJcbldvcmtmbG93LnByb3RvdHlwZS5nZXRBcHAgPSBmdW5jdGlvbigpe1xyXG5cdHJldHVybiB0aGlzLmFwcDtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBXb3JrZmxvdyBnZXQgY29uZmlnLlxyXG4gKlxyXG4gKiBAZXhhbXBsZSBcIlwiXHJcbiAqXHJcbiAqIEByZXR1cm4gXCJcIlxyXG4gKlxyXG4gKi9cclxuV29ya2Zsb3cucHJvdG90eXBlLmdldENvbmZpZyA9IGZ1bmN0aW9uKCl7XHJcblx0cmV0dXJuIHRoaXMuY29uZmlnO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFdvcmtmbG93IGdldCBpbnN0YW5jZS5cclxuICpcclxuICogQGV4YW1wbGUgXCJcIlxyXG4gKlxyXG4gKiBAcmV0dXJuIFwiXCJcclxuICpcclxuICovXHJcbldvcmtmbG93LnByb3RvdHlwZS5nZXRJbnN0YW5jZSA9IGZ1bmN0aW9uKCl7XHJcblx0cmV0dXJuIHRoaXMuaW5zdGFuY2U7XHJcbn07XHJcblxyXG4vKipcclxuICogV29ya2Zsb3cgc2V0IHRoZSBpbnN0YW5jZSBkYXRhLlxyXG4gKlxyXG4gKiBAcGFyYW0ge09iamVjdH0gZGF0YSAtIHRoZSB3b3JrZmxvdyBwcm9jZXNzIGluc3RhbmNlIGRhdGFcclxuICpcclxuICogQGV4YW1wbGUgXCJcIlxyXG4gKlxyXG4gKiBAcmV0dXJuIFwiXCJcclxuICpcclxuICovXHJcbldvcmtmbG93LnByb3RvdHlwZS5zZXRJbnN0YW5jZSA9IGZ1bmN0aW9uKGRhdGEpe1xyXG5cdHRoaXMuaW5zdGFuY2UgPSBkYXRhO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFdvcmtmbG93IGdldCBzdWItcHJvY2Vzc2VzIGRhdGEuXHJcbiAqXHJcbiAqIEBleGFtcGxlIFwiXCJcclxuICpcclxuICogQHJldHVybiBcIlwiXHJcbiAqXHJcbiAqL1xyXG5Xb3JrZmxvdy5wcm90b3R5cGUuZ2V0U3ViUHJvY2Vzc2VzID0gZnVuY3Rpb24oKXtcclxuXHRyZXR1cm4gdGhpcy5zdWJwcm9jZXNzZXM7XHJcbn07XHJcblxyXG4vKipcclxuICogV29ya2Zsb3cgc2V0IHRoZSBzdWItcHJvY2Vzc2VzIGRhdGEuXHJcbiAqXHJcbiAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhIC0gdGhlIHdvcmtmbG93IHByb2Nlc3MgaW5zdGFuY2UgZGF0YVxyXG4gKlxyXG4gKiBAZXhhbXBsZSBcIlwiXHJcbiAqXHJcbiAqIEByZXR1cm4gXCJcIlxyXG4gKlxyXG4gKi9cclxuV29ya2Zsb3cucHJvdG90eXBlLnNldFN1YlByb2Nlc3NlcyA9IGZ1bmN0aW9uKGRhdGEpe1xyXG5cdHRoaXMuc3VicHJvY2Vzc2VzID0gZGF0YTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBXb3JrZmxvdyBnZXQgaW5kaWNhdG9yIHNldCBkYXRhLlxyXG4gKlxyXG4gKiBAZXhhbXBsZSBcIlwiXHJcbiAqXHJcbiAqIEByZXR1cm4gXCJcIlxyXG4gKlxyXG4gKi9cclxuV29ya2Zsb3cucHJvdG90eXBlLmdldEluZGljYXRvcnMgPSBmdW5jdGlvbigpe1xyXG5cdHJldHVybiB0aGlzLmluZGljYXRvcnM7XHJcbn07XHJcblxyXG4vKipcclxuICogV29ya2Zsb3cgc2V0IHRoZSBpbmRpY2F0b3Igc2V0IGRhdGEuXHJcbiAqXHJcbiAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhIC0gdGhlIHdvcmtmbG93IHByb2Nlc3MgaW5zdGFuY2UgZGF0YVxyXG4gKlxyXG4gKiBAZXhhbXBsZSBcIlwiXHJcbiAqXHJcbiAqIEByZXR1cm4gXCJcIlxyXG4gKlxyXG4gKi9cclxuV29ya2Zsb3cucHJvdG90eXBlLnNldEluZGljYXRvcnMgPSBmdW5jdGlvbihkYXRhKXtcclxuXHR0aGlzLmluZGljYXRvcnMgPSBkYXRhO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFNldCB0aGUgdmFyaWFibGUgdmFsdWUuXHJcbiAqXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBwcm9jZXNzSWQgLSB0aGUgV29ya2Zsb3cgY29uZmlnIC8gZGVmaW5pdGlvbiBwcm9jZXNzIGlkXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBwcm9jZXNzU2VxIC0gdGhlIFdvcmtmbG93IGluc3RhbmNlIHByb2Nlc3Mgc2VxXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdWJQcm9jZXNzSWQgLSB0aGUgV29ya2Zsb3cgY29uZmlnIC8gZGVmaW5pdGlvbiBzdWItcHJvY2VzcyBpZFxyXG4gKiBAcGFyYW0ge251bWJlcn0gc3ViUHJvY2Vzc1NlcSAtIHRoZSBXb3JrZmxvdyBpbnN0YW5jZSBzdWItcHJvY2VzcyBzZXFcclxuICogQHBhcmFtIHtzdHJpbmd9IHN0ZXBJZCAtIHRoZSBXb3JrZmxvdyBjb25maWcgLyBkZWZpbml0aW9uIHN0ZXAgaWRcclxuICogQHBhcmFtIHtPYmplY3R9IHZhcmlhYmxlIC0gdGhlIFdvcmtmbG93IHZhcmlhYmxlIG9iamVjdFxyXG4gKlxyXG4gKiBAZXhhbXBsZSAnJ1xyXG4gKlxyXG4gKiBAcmV0dXJuICcnXHJcbiAqXHJcbiAqL1xyXG4vLyBXb3JrZmxvdy5wcm90b3R5cGUuc2V0VmFyaWFibGUgPSBmdW5jdGlvbihwcm9jZXNzSWQsIHByb2Nlc3NTZXEsIHN1YlByb2Nlc3NJZCwgc3ViUHJvY2Vzc1NlcSwgc3RlcElkLCB2YXJpYWJsZSl7XHJcbi8vIFx0dmFyIF90aGlzID0gdGhpcztcclxuLy8gXHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbi8vIFx0XHR0cnkge1xyXG4vLyBcdFx0XHRQcm9jZXNzLmdldFZhcmlhYmxlKHByb2Nlc3NJZCwgcHJvY2Vzc1NlcSwgc3ViUHJvY2Vzc0lkLCBzdWJQcm9jZXNzU2VxLCBzdGVwSWQsIHZhcmlhYmxlKS50aGVuKGZ1bmNpb24ocmVzdWx0KXtcclxuLy8gXHRcdFx0XHRyZXNvbHZlKHJlc3VsdC5kYXRhKTtcclxuLy8gXHRcdFx0fSwgZnVuY3Rpb24oZXJyKXtcclxuLy8gXHRcdFx0XHRyZWplY3QoZXJyKTtcclxuLy8gXHRcdFx0fSlcclxuLy8gXHRcdH0gY2F0Y2ggKGVycikge1xyXG4vLyBcdFx0XHRyZWplY3QoZXJyKTtcclxuLy8gXHRcdH1cclxuLy8gXHR9KTtcclxuLy8gfTtcclxuXHJcbi8qKlxyXG4gKiBHZXQgdGhlIHZhcmlhYmxlIHZhbHVlLlxyXG4gKlxyXG4gKiBAcGFyYW0ge3N0cmluZ30gcHJvY2Vzc0lkIC0gdGhlIFdvcmtmbG93IGNvbmZpZyAvIGRlZmluaXRpb24gcHJvY2VzcyBpZFxyXG4gKiBAcGFyYW0ge251bWJlcn0gcHJvY2Vzc1NlcSAtIHRoZSBXb3JrZmxvdyBpbnN0YW5jZSBwcm9jZXNzIHNlcVxyXG4gKiBAcGFyYW0ge3N0cmluZ30gc3ViUHJvY2Vzc0lkIC0gdGhlIFdvcmtmbG93IGNvbmZpZyAvIGRlZmluaXRpb24gc3ViLXByb2Nlc3MgaWRcclxuICogQHBhcmFtIHtudW1iZXJ9IHN1YlByb2Nlc3NTZXEgLSB0aGUgV29ya2Zsb3cgaW5zdGFuY2Ugc3ViLXByb2Nlc3Mgc2VxXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdGVwSWQgLSB0aGUgV29ya2Zsb3cgY29uZmlnIC8gZGVmaW5pdGlvbiBzdGVwIGlkXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgLSB0aGUgV29ya2Zsb3cgdmFyaWFibGUgaWRcclxuICpcclxuICogQGV4YW1wbGUgJydcclxuICpcclxuICogQHJldHVybiAnJ1xyXG4gKlxyXG4gKi9cclxuLy8gV29ya2Zsb3cucHJvdG90eXBlLmdldFZhcmlhYmxlID0gZnVuY3Rpb24ocHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIHN0ZXBJZCwga2V5KXtcclxuLy8gXHR2YXIgX3RoaXMgPSB0aGlzO1xyXG4vLyBcdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuLy8gXHRcdHRyeSB7XHJcbi8vIFx0XHRcdFByb2Nlc3Muc2V0VmFyaWFibGUocHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIHN0ZXBJZCwga2V5KS50aGVuKGZ1bmNpb24ocmVzdWx0KXtcclxuLy8gXHRcdFx0XHRyZXNvbHZlKHJlc3VsdC5kYXRhKTtcclxuLy8gXHRcdFx0fSwgZnVuY3Rpb24oZXJyKXtcclxuLy8gXHRcdFx0XHRyZWplY3QoZXJyKTtcclxuLy8gXHRcdFx0fSlcclxuLy8gXHRcdH0gY2F0Y2ggKGVycikge1xyXG4vLyBcdFx0XHRyZWplY3QoZXJyKTtcclxuLy8gXHRcdH1cclxuLy8gXHR9KTtcclxuLy8gfTtcclxuXHJcbi8qKlxyXG4gKiBUaGlzIG1ldGhvZCBjcmVhdGVzIGEgbmV3IHdvcmtmbG93IHByb2Nlc3MgaS5lLiBpdCBjcmVhdGVzIGEgd29ya2Zsb3cgcHJvY2Vzc2VzIGluc3RhbmNlXHJcbiAqIG9iamVjdCB3aXRoIHRoZSBtaW5pbXVtIHJlcXVpcmVkIGRhdGEuIFRoaXMgaW5zdGFuY2UgY2FuIGJlIHJlZmVyZW5jZWQgaW4gdGhlIGZvbGxvd2luZ1xyXG4gKiB3YXksIHNlZSBleGFtcGxlIGJlbG93LlxyXG4gKlxyXG4gKiBAZXhhbXBsZVxyXG4gKiB2YXIgY29uZmlnID0geyAnX2lkJzogJ2FiYzEyMycgfTtcclxuICogdmFyIHdvcmtmbG93ID0gbmV3IFdvcmtmbG93KCcxMjM0JywgJzU2NzgnLCBjb25maWcpO1xyXG4gKiB3b3JrZmxvdy5jcmVhdGUoKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCl7XHJcbiAqXHRjb25zb2xlLmxvZyhyZXN1bHQubWVzc2FnZSk7XHJcbiAqXHQvLyBUaGUgZm9sbG93aW5nIHByb3BlcnRpZXMgY2FuIG5vdyBiZSBhY2Nlc3NlZFxyXG4gKiBcdHZhciBwcm9maWxlID0gd29ya2Zsb3cucHJvZmlsZTtcclxuICogXHR2YXIgYXBwID0gd29ya2Zsb3cuYXBwO1xyXG4gKiBcdHZhciBjb25maWcgPSB3b3JrZmxvdy5jb25maWc7XHJcbiAqXHQvLyBPbiBzdWNjZXNzIHlvdSBjYW4gYWNjZXNzIHRoZSBpbnN0YW5jZSB0aGUgZm9sbG93aW5nIHdheVxyXG4gKlx0dmFyIGluc3RhbmNlID0gd29ya2Zsb3cuaW5zdGFuY2U7XHJcbiAqIH0sIGZ1bmN0aW9uKGVycm9yKXtcclxuICpcdGNvbnNvbGUubG9nKGVycm9yKTtcclxuICogfSk7XHJcbiAqXHJcbiAqIEByZXR1cm4ge09iamVjdH0gbmV3IFdvcmtmbG93IGluc3RhbmNlIHdpdGggdXBkYXRlZCBpbnN0YW5jZSBkYXRhLlxyXG4gKlxyXG4gKi9cclxuV29ya2Zsb3cucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uKCl7XHJcblx0dmFyIF90aGlzID0gdGhpcztcclxuXHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcblx0XHR0cnkge1xyXG5cdFx0XHRpZiAoX3RoaXMuaW5zdGFuY2UgIT09IHVuZGVmaW5lZCkge1xyXG5cdFx0XHRcdHZhciB3YXJuID0gdXRpbC53YXJuKCdJbnN0YW5jZSBhbHJlYWR5IGV4aXN0cy4nLCBfdGhpcylcclxuXHRcdFx0XHRyZXNvbHZlKHdhcm4pO1xyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdC8vIENyZWF0ZSB0aGUgd29ya2Zsb3cgcHJvY2Vzc2VzIGluc3RhbmNlIG9iamVjdFxyXG5cdFx0XHRcdHZhciBtb2RlbCA9IHtcclxuXHRcdFx0XHQgICAgX2lkOiAnJyxcclxuXHRcdFx0XHQgICAgdmVyc2lvbjogJycsXHJcblx0XHRcdFx0ICAgIHR5cGU6ICd3b3JrZmxvd0luc3RhbmNlJyxcclxuXHRcdFx0XHQgICAgcHJvY2Vzc2VzOiBbXSxcclxuXHRcdFx0XHQgICAgY2hhbm5lbHM6W1xyXG5cdFx0XHRcdCAgICBcdFwiY29tbXVuaXR5X1wiK2FwcC5TQ09QRS5jb21tdW5pdHlJZCAsXHJcblx0XHRcdFx0ICAgIFx0XCJwcm9maWxlX1wiKyBhcHAuU0NPUEUucHJvZmlsZUlkICxcclxuXHRcdFx0XHQgICAgXHRcImFwcGxpY2F0aW9uX1wiK2FwcC5TQ09QRS5hcHBsaWNhdGlvbklkLFxyXG5cdFx0XHRcdCAgICBcdFwiY29tbXVuaXR5X1wiK2FwcC5TQ09QRS5jb21tdW5pdHlJZCtcIl9hcHBsaWNhdGlvbl9cIithcHAuU0NPUEUuYXBwbGljYXRpb25JZFxyXG5cdFx0XHRcdCAgICBdXHJcblx0XHRcdFx0fTtcclxuXHRcdFx0XHRtb2RlbC5faWQgPSBfdGhpcy5wcm9maWxlICsgJzpwcm9jZXNzZXMnO1xyXG5cdFx0XHRcdG1vZGVsLnZlcnNpb24gPSBfdGhpcy5jb25maWcudmVyc2lvbjtcclxuXHRcdFx0XHRfdGhpcy5pbnN0YW5jZSA9IG1vZGVsO1xyXG5cdFx0XHRcdHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdXb3JrZmxvdyBwcm9jZXNzZXMgaW5zdGFuY2UgY3JlYXRlZCBzdWNjZXNzZnVsbHkuJywgX3RoaXMpO1xyXG5cdFx0XHRcdHJlc29sdmUoc3VjY2Vzcyk7XHJcblxyXG5cdFx0XHR9XHJcblx0XHR9IGNhdGNoIChlcnIpIHtcclxuXHRcdFx0cmVqZWN0KGVycik7XHJcblx0XHR9XHJcblx0fSk7XHJcbn07XHJcblxyXG4vKipcclxuICogV29ya2Zsb3cgaW5pdGlhbGlzZSwgdGhpcyBmdW5jdGlvbiBleGVjdXRlcyBhIHByb2Nlc3Mgd2l0aGluIGEgd29ya2Zsb3dcclxuICogY29uZmlndXJhdGlvbi5cclxuICpcclxuICogQHBhcmFtIHtzdHJpbmd9IHByb2Nlc3NJZCAtIHRoZSBwcm9jZXNzIGlkIHRvIHByb2Nlc3NcclxuICogQHBhcmFtIHtvYmplY3R9IFtkYXRhXSAtIHRoZSBpbnB1dCBkYXRhIHRvIHByb2Nlc3NcclxuICpcclxuICogQGV4YW1wbGVcclxuICogV29ya2Zsb3cuaW5pdGlhbGlzZSgncHJvY2Vzc0lkJywgeyB2YWxpZERhdGU6ICdkYXRlJyB9KTtcclxuICpcclxuICogQHJldHVybiBcIlwiXHJcbiAqXHJcbiAqL1xyXG5Xb3JrZmxvdy5wcm90b3R5cGUuaW5pdGlhbGlzZSA9IGZ1bmN0aW9uKHByb2Nlc3NJZCwgZGF0YSl7XHJcblx0dmFyIF90aGlzID0gdGhpcztcclxuXHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcblx0XHR0cnkge1xyXG5cdFx0XHR2YXIgY29uZmlnUHJvY2VzcyA9IFtdO1xyXG5cdFx0XHQvLyBDaGVjayB0aGUgcGFzc2VkIGluIHBhcmFtZXRlcnNcclxuXHRcdFx0aWYgKHByb2Nlc3NJZCAhPT0gJycgJiYgcHJvY2Vzc0lkICE9PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0XHQvLyBHZXQgdGhlIGN1cnJlbnQgcHJvY2VzcyBjb25maWdcclxuXHRcdFx0XHRjb25maWdQcm9jZXNzID0gX3RoaXMuY29uZmlnLnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24ob2JqUHJvY2Vzcyl7XHJcblx0XHRcdFx0XHRpZiAob2JqUHJvY2Vzcy5faWQgPT0gcHJvY2Vzc0lkKSB7XHJcblx0XHRcdFx0XHRcdHJldHVybiBvYmpQcm9jZXNzO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH0pO1xyXG5cdFx0XHRcdGlmIChjb25maWdQcm9jZXNzWzBdLl9pZCA9PSB1bmRlZmluZWQpIHtcclxuXHRcdFx0XHRcdHZhciBlcnJvciA9IHV0aWwuZXJyb3IoJ1dGQ29uZmlnRXJyb3InLCAnTm8gdmFsaWQgcHJvY2VzcyBkZWZpbml0aW9uIGZvdW5kIHdpdGggcHJvY2VzcyBpZDogJyArIHByb2Nlc3NJZCk7XHJcblx0XHRcdFx0XHRyZWplY3QoZXJyb3IpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRjb25maWdQcm9jZXNzLnB1c2goX3RoaXMuY29uZmlnLnByb2Nlc3Nlc1swXSk7XHJcblx0XHRcdFx0cHJvY2Vzc0lkID0gX3RoaXMuY29uZmlnLnByb2Nlc3Nlc1swXS5faWQ7XHJcblx0XHRcdH1cclxuXHRcdFx0Ly8gR2V0IHRoZSBjdXJyZW50IGxpc3Qgb2YgcHJvY2VzcyBpbnN0YW5jZXNcclxuXHRcdFx0Ly8gdmFyIHByb2Nlc3NTZXEgPSAxO1xyXG5cdFx0XHR2YXIgY3VycmVudFByb2Nlc3MgPSBbXTtcclxuXHRcdFx0X3RoaXMuaW5zdGFuY2UucHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihwcm9jZXNzSXRlbSl7XHJcblx0XHRcdFx0aWYgKHByb2Nlc3NJdGVtLmlkID09IHByb2Nlc3NJZCkge1xyXG5cdFx0XHRcdFx0Y3VycmVudFByb2Nlc3MucHVzaChwcm9jZXNzSXRlbSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9KTtcclxuXHRcdFx0dmFyIHByb2Nlc3NTZXEgPSBjdXJyZW50UHJvY2Vzcy5sZW5ndGggKyAxO1xyXG5cdFx0XHQvLyB2YXIgbmV4dFNlcSA9IHByb2Nlc3NTZXEgKyAxO1xyXG5cdFx0XHQvLyBQdXNoIHRoZSBwcm9jZXNzIG9iamVjdCBpbnRvIHRoZSBhcnJheVxyXG5cdFx0XHR2YXIgcHJvY2Vzc01vZGVsID0ge1xyXG5cdFx0XHRcdGlkOiAnJyxcclxuXHRcdFx0XHRzZXE6ICcnLFxyXG5cdFx0XHRcdHN1YlByb2Nlc3NlczogW10sXHJcblx0XHRcdH1cclxuXHRcdFx0Ly8gMS4gVXBkYXRlIHRoZSBwcm9jZXNzIGlkIGFuZCBzZXFcclxuXHRcdFx0cHJvY2Vzc01vZGVsLmlkID0gcHJvY2Vzc0lkO1xyXG5cdFx0XHRwcm9jZXNzTW9kZWwuc2VxID0gcHJvY2Vzc1NlcTtcclxuXHRcdFx0X3RoaXMuaW5zdGFuY2UucHJvY2Vzc2VzLnB1c2gocHJvY2Vzc01vZGVsKTtcclxuXHRcdFx0Ly8gUGFyYW1ldGVyc1xyXG5cdFx0XHR2YXIgc3ViUHJvY2Vzc0lkID0gY29uZmlnUHJvY2Vzc1swXS5zdWJQcm9jZXNzZXNbMF0uX2lkO1xyXG5cdFx0XHR2YXIgc3ViUHJvY2Vzc1NlcSA9IDE7XHJcblx0XHRcdF90aGlzLmluc3RhbmNlLnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24ocHJvY2Vzc0l0ZW0pe1xyXG5cdFx0XHRcdGlmIChwcm9jZXNzSXRlbS5pZCA9PSBwcm9jZXNzSWQgJiYgcHJvY2Vzc0l0ZW0uc2VxID09IHByb2Nlc3NTZXEpIHtcclxuXHRcdFx0XHRcdHN1YlByb2Nlc3NTZXEgPSBwcm9jZXNzSXRlbS5zdWJQcm9jZXNzZXMubGVuZ3RoICsgMVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSlcclxuXHRcdFx0Ly8gQ2FsbCB0aGUgc3VicHJvY2VzcyBtZXRob2RcclxuXHRcdFx0XHJcblx0XHRcdFxyXG5cclxuXHRcdFx0UHJvY2Vzcy5zdWJQcm9jZXNzKHByb2Nlc3NJZCwgcHJvY2Vzc1NlcSwgc3ViUHJvY2Vzc0lkLCBzdWJQcm9jZXNzU2VxLCBkYXRhLCBfdGhpcykudGhlbihmdW5jdGlvbihzdWJQcm9jZXNzKXtcclxuXHRcdFx0XHQvLyBHZW5lcmF0ZSB0aGUgdXVpZFxyXG5cdFx0XHRcdFxyXG5cclxuXHRcdFx0XHR2YXIgdXVpZCA9IF90aGlzLnByb2ZpbGUgKyAnOicgKyBfdGhpcy5hcHAgKyAnOicgKyBwcm9jZXNzSWQgKyAnOicgKyBwcm9jZXNzU2VxICsgJzonICsgc3ViUHJvY2Vzc0lkICsgJzonICsgc3ViUHJvY2Vzc1NlcTtcclxuXHRcdFx0XHR2YXIgbGFiZWwgPSBkYXRhLmxhYmVsO1xyXG5cdFx0XHRcdC8vIEJ1aWxkIHRoZSBzdWItcHJvY2VzcyByZWZlcmVuY2Ugb2JqZWN0XHJcblxyXG5cdFx0XHRcdC8vVE9ETzogQ2hhbmdlIHJlcXVpcmVkIHRvIG1vdmUgaXNBY3RpdmUgdG8gc3ViUHJvY2VzcyBmaWxlLlJlbW92ZSBmcm9tIGhlcmVcclxuXHJcblxyXG5cdFx0XHRcdHZhciBzdWJQcm9jZXNzUmVmID0ge1xyXG5cdFx0XHRcdFx0aWQ6IHN1YlByb2Nlc3NJZCxcclxuXHRcdFx0XHRcdHNlcTogc3ViUHJvY2Vzc1NlcSxcclxuXHRcdFx0XHRcdHV1aWQ6IHV1aWQsXHJcblx0XHRcdFx0XHRsYWJlbDpsYWJlbFxyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHQvLyBBZGQgdGhlIHJlZmVyZW5jZSB0byB0aGUgcHJvY2VzcyBtb2RlbFxyXG5cdFx0XHRcdHByb2Nlc3NNb2RlbC5zdWJQcm9jZXNzZXMucHVzaChzdWJQcm9jZXNzUmVmKTtcclxuXHRcdFx0XHQvLyBBZGQgdGhlIHN1YlByb2Nlc3MgbW9kZWwgdG8gdGhlIHN1YnByb2Nlc3NlcyBhcnJheVxyXG5cdFx0XHRcdC8vX3RoaXMuc3VicHJvY2Vzc2VzLnB1c2goc3ViUHJvY2Vzcy5kYXRhKTtcclxuXHRcdFx0XHQvLyBfdGhpcy5pbnN0YW5jZS5wcm9jZXNzZXMucHVzaChwcm9jZXNzTW9kZWwpO1xyXG5cdFx0XHRcdGZvciAodmFyIGluZGV4ID0gMDsgaW5kZXggPCBfdGhpcy5pbnN0YW5jZS5wcm9jZXNzZXMubGVuZ3RoOyBpbmRleCsrKXtcclxuXHRcdFx0XHRcdHZhciBwcm9jZXNzSXRlbSA9IF90aGlzLmluc3RhbmNlLnByb2Nlc3Nlc1tpbmRleF07XHJcblx0XHRcdFx0XHRpZiAocHJvY2Vzc0l0ZW0uaWQgPT0gcHJvY2Vzc0lkICYmIHByb2Nlc3NJdGVtLnNlcSA9PSBwcm9jZXNzU2VxKSB7XHJcblx0XHRcdFx0XHRcdC8vIFJlbW92ZSB0aGUgY3VycmVudCBwcm9jZXNzIGZyb20gdGhlIGFycmF5IGFuZCBhZGQgdGhlIHVwZGF0ZWQgcHJvY2Vzc01vZGVsXHJcblx0XHRcdFx0XHRcdF90aGlzLmluc3RhbmNlLnByb2Nlc3Nlcy5zcGxpY2UoaW5kZXgsIDEsIHByb2Nlc3NNb2RlbClcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHRcclxuXHRcdFx0XHQvLyBQcm9jZXNzIHRoZSBpbmRpY2F0b3IgZG9jdW1lbnRzIHdvcmtmbG93IHByb2Nlc3NlcyB1cGRhdGVzXHJcblx0XHRcdFx0dmFyIGluZGljYXRvcnMgPSBzdWJQcm9jZXNzLmRhdGEuaW5kaWNhdG9ycztcclxuXHRcdFx0XHR2YXIgc3RlcCA9IHN1YlByb2Nlc3MuZGF0YS5zdGVwO1xyXG5cdFx0XHRcdFByb2Nlc3MuaW5kaWNhdG9yRG9jcyhwcm9jZXNzSWQsIGluZGljYXRvcnMsIHN0ZXAsIF90aGlzKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCl7XHJcblx0XHRcdFx0XHR2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnUHJvY2VzczogJyArIF90aGlzLmNvbmZpZy5wcm9jZXNzZXNbMF0uX2lkICsgJyBpbml0aWFsaXplZCBzdWNjZXNzZnVsbHkuJywgX3RoaXMpO1xyXG5cdFx0XHRcdFx0cmVzb2x2ZShzdWNjZXNzKTtcclxuXHRcdFx0XHR9LCBmdW5jdGlvbihlcnIpe1xyXG5cdFx0XHRcdFx0cmVqZWN0KGVycik7XHJcblx0XHRcdFx0fSlcclxuXHJcblxyXG5cdFx0XHRcdFxyXG5cclxuXHJcblxyXG5cclxuXHRcdFx0fSwgZnVuY3Rpb24oZXJyKXtcclxuXHRcdFx0XHRfdGhpcy5pbnN0YW5jZS5wcm9jZXNzZXMgPSBfdGhpcy5pbnN0YW5jZS5wcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKCBvYmogKSB7XHJcblx0XHRcdFx0XHRyZXR1cm4gIShvYmouaWQgPT0gcHJvY2Vzc0lkICYmIG9iai5zZXEgPT0gcHJvY2Vzc1NlcSk7XHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdFx0Y29uc29sZS5sb2coZXJyKTtcclxuXHRcdFx0XHRyZWplY3QoZXJyKTtcclxuXHRcdFx0fSk7XHJcblx0XHR9IGNhdGNoKGVycikge1xyXG5cdFx0XHRyZWplY3QoZXJyKTtcclxuXHRcdH1cclxuXHR9KTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBXb3JrZmxvdyB0cmFuc2l0aW9uIHRvIHRoZSBuZXh0IHN0ZXAuIFRoaXMgbW92ZXMgdGhlIHdvcmtmbG93IGZyb20gdGhlIGN1cnJlbnQgcHJvY2VzcyxcclxuICogc3ViLXByb2Nlc3Mgc3RlcCB0byB0aGUgbmV4dCBvbmUgYXMgc3BlY2lmaWVkLlxyXG4gKlxyXG4gKiBAcGFyYW0ge3N0cmluZ30gcHJvY2Vzc0lkIC0gdGhlIFdvcmtmbG93IGNvbmZpZyAvIGRlZmluaXRpb24gcHJvY2VzcyBpZFxyXG4gKiBAcGFyYW0ge251bWJlcn0gcHJvY2Vzc1NlcSAtIHRoZSBXb3JrZmxvdyBpbnN0YW5jZSBwcm9jZXNzIHNlcVxyXG4gKiBAcGFyYW0ge3N0cmluZ30gc3ViUHJvY2Vzc0lkIC0gdGhlIFdvcmtmbG93IGNvbmZpZyAvIGRlZmluaXRpb24gc3ViLXByb2Nlc3MgaWRcclxuICogQHBhcmFtIHtudW1iZXJ9IHN1YlByb2Nlc3NTZXEgLSB0aGUgV29ya2Zsb3cgaW5zdGFuY2Ugc3ViLXByb2Nlc3Mgc2VxXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdGVwSWQgLSB0aGUgV29ya2Zsb3cgY29uZmlnIC8gZGVmaW5pdGlvbiBzdGVwIGlkXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSB0cmFuc2l0aW9uSWQgLSB0aGUgV29ya2Zsb3cgY29uZmlnIC8gZGVmaW5pdGlvbiB0cmFuc2l0aW9uIGlkXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBkYXRhIC0gYW55IGFkZGl0aW9uYWwgZGF0YSBwYXNzZWQgaW4gYXMga2V5IHZhbHVlIHBhaXJzXHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqIFdvcmtmbG93LnRyYW5zaXRpb24oJ3Byb2Nlc3NJZCcsIDEsICdzdWJQcm9jZXNzSWQnLCAxLCAnc3RlcElkJywgJ3RyYW5zaXRpb25JZCcsIHsga2V5OiAnJywgdmFsdWU6ICcnIH0pO1xyXG4gKlxyXG4gKiBAcmV0dXJuIFwiXCJcclxuICpcclxuICovXHJcbldvcmtmbG93LnByb3RvdHlwZS50cmFuc2l0aW9uID0gZnVuY3Rpb24ocHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIHN0ZXBJZCwgdHJhbnNpdGlvbklkLCBkYXRhKXtcclxuXHQvLyBSZS1hc3NpZ24gdGhpc1xyXG5cdHZhciBfdGhpcyA9IHRoaXM7XHJcblx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cdFx0dHJ5IHtcclxuXHRcdFx0UHJvY2Vzcy50cmFuc2l0aW9uKHByb2Nlc3NJZCwgcHJvY2Vzc1NlcSwgc3ViUHJvY2Vzc0lkLCBzdWJQcm9jZXNzU2VxLCBzdGVwSWQsIHRyYW5zaXRpb25JZCwgZGF0YSwgX3RoaXMpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KXtcclxuXHJcblx0XHRcdFx0XHJcblx0XHRcdFx0Ly8gVXBkYXRlIHRoZSBjdXJyZW50IHN1Yi1wcm9jZXNzIHN0ZXAgZGF0YVxyXG5cdFx0XHRcdHZhciB1cGRhdGUgPSBmdW5jdGlvbih0eXBlKXtcclxuXHRcdFx0XHRcdF90aGlzLmluc3RhbmNlLnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24ocHJvY2Vzc0l0ZW0pe1xyXG5cdFx0XHRcdFx0XHRpZiAocHJvY2Vzc0l0ZW0uaWQgPT0gcHJvY2Vzc0lkICYmIHByb2Nlc3NJdGVtLnNlcSA9PSBwcm9jZXNzU2VxKSB7XHJcblxyXG5cdFx0XHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0XHRcdHByb2Nlc3NJdGVtLnN1YlByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24oc3ViUHJvY2Vzc0l0ZW0pe1xyXG5cdFx0XHRcdFx0XHRcdFx0aWYgKHN1YlByb2Nlc3NJdGVtLmlkID09IHN1YlByb2Nlc3NJZCAmJiBzdWJQcm9jZXNzSXRlbS5zZXEgPT0gc3ViUHJvY2Vzc1NlcSkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcclxuXHJcblx0XHRcdFx0XHRcdFx0XHRcdF90aGlzLnN1YnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24oc3ViUHJvY2Vzc09iail7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKHN1YlByb2Nlc3NPYmouX2lkID09IHN1YlByb2Nlc3NJdGVtLnV1aWQpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0aWYgKHR5cGUgPT0gJ3N0ZXAnKSB7XHJcblxyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRzdWJQcm9jZXNzT2JqLnN0ZXAgPSByZXN1bHQuZGF0YTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0dmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MocmVzdWx0Lm1lc3NhZ2UsIHN1YlByb2Nlc3NPYmopO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcclxuXHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdHJlc29sdmUoc3VjY2Vzcyk7XHJcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKHR5cGUgPT0gJ3N0ZXBDb21wbGV0ZScpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0c3ViUHJvY2Vzc09iai5zdGVwID0gcmVzdWx0LmRhdGEuc3RlcDtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0c3ViUHJvY2Vzc09iai5jb21wbGV0ZSA9IHRydWVcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0dmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MocmVzdWx0Lm1lc3NhZ2UsIHN1YlByb2Nlc3NPYmopO1xyXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0cmVzb2x2ZShzdWNjZXNzKTtcclxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0XHRcdH0pXHJcblx0XHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0fSlcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fSlcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0aWYgKHJlc3VsdC5kYXRhLnN1YlByb2Nlc3NDb21wbGV0ZSkge1xyXG5cdFx0XHRcdFx0XHJcblx0XHRcdFx0XHR1cGRhdGUoJ3N0ZXBDb21wbGV0ZScpO1xyXG5cdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRcclxuXHRcdFx0XHRcdHVwZGF0ZSgnc3RlcCcpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSwgZnVuY3Rpb24oZXJyKXtcclxuXHRcdFx0XHRcclxuXHRcdFx0XHRyZWplY3QoZXJyKTtcclxuXHRcdFx0fSk7XHJcblx0XHR9IGNhdGNoKGVycikge1xyXG5cdFx0XHRcclxuXHRcdFx0cmVqZWN0KGVycik7XHJcblx0XHR9XHJcblx0fSk7XHJcbn07XHJcblxyXG4vKipcclxuICogV29ya2Zsb3cgYXNzaWduIHVzZXIuXHJcbiAqXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBwcm9jZXNzSWQgLSB0aGUgV29ya2Zsb3cgY29uZmlnIC8gZGVmaW5pdGlvbiBwcm9jZXNzIGlkXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBwcm9jZXNzU2VxIC0gdGhlIFdvcmtmbG93IGluc3RhbmNlIHByb2Nlc3Mgc2VxXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdWJQcm9jZXNzSWQgLSB0aGUgV29ya2Zsb3cgY29uZmlnIC8gZGVmaW5pdGlvbiBzdWItcHJvY2VzcyBpZFxyXG4gKiBAcGFyYW0ge251bWJlcn0gc3ViUHJvY2Vzc1NlcSAtIHRoZSBXb3JrZmxvdyBpbnN0YW5jZSBzdWItcHJvY2VzcyBzZXFcclxuICogQHBhcmFtIHtzdHJpbmd9IHN0ZXBJZCAtIHRoZSBXb3JrZmxvdyBjb25maWcgLyBkZWZpbml0aW9uIHN0ZXAgaWRcclxuICogQHBhcmFtIHtvYmplY3R9IHVzZXIgLSB0aGUgdXNlciBpZCBhbmQgbmFtZSBkYXRhXHJcbiAqXHJcbiAqIEBleGFtcGxlIFwiXCJcclxuICpcclxuICogQHJldHVybiBcIlwiXHJcbiAqXHJcbiAqL1xyXG5Xb3JrZmxvdy5wcm90b3R5cGUuYXNzaWduVXNlciA9IGZ1bmN0aW9uKHByb2Nlc3NJZCwgcHJvY2Vzc1NlcSwgc3ViUHJvY2Vzc0lkLCBzdWJQcm9jZXNzU2VxLCB1c2VyKXtcclxuXHQvLyBSZS1hc3NpZ24gdGhlIFdvcmtmbG93IGNvbnN0cnVjdG9yIGluc3RhbmNlIGFzIF90aGlzXHJcblx0dmFyIF90aGlzID0gdGhpcztcclxuXHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcblx0XHR0cnkge1xyXG5cdFx0XHRQcm9jZXNzLmFzc2lnblVzZXIocHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIHVzZXIsIF90aGlzKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCl7XHJcblx0XHRcdFx0cmVzb2x2ZShyZXN1bHQpO1xyXG5cdFx0XHR9LCBmdW5jdGlvbihlcnIpe1xyXG5cdFx0XHRcdHJlamVjdChlcnIpO1xyXG5cdFx0XHR9KVxyXG5cdFx0fSBjYXRjaChlcnIpIHtcclxuXHRcdFx0cmVqZWN0KGVycik7XHJcblx0XHR9XHJcblx0fSlcclxufTtcclxuXHJcbi8qKlxyXG4gKiBXb3JrZmxvdyB0YXNrLCB0aGlzIG1ldGhvZCBleGVjdXRlcyBhIHNwZWNpZmljIHRhc2suXHJcbiAqXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBwcm9jZXNzSWQgLSB0aGUgcHJvY2VzcyBpZCB0byBwcm9jZXNzXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBpbnB1dERhdGEgLSB0aGUgaW5wdXQgZGF0YSB0byBwcm9jZXNzXHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqIFdvcmtmbG93LmluaXRpYWxpemUoJ3Byb2Nlc3NJZCcsIHsgdmFsaWREYXRlOiAnZGF0ZScgfSk7XHJcbiAqXHJcbiAqIEByZXR1cm4gXCJcIlxyXG4gKlxyXG4gKi9cclxuV29ya2Zsb3cucHJvdG90eXBlLnVpID0gZnVuY3Rpb24oKXtcclxuXHQvLyBSZS1hc3NpZ24gdGhlIFdvcmtmbG93IGNvbnN0cnVjdG9yIGluc3RhbmNlIGFzIF90aGlzXHJcblx0dmFyIF90aGlzID0gdGhpcztcclxuXHRyZXR1cm4ge1xyXG5cdFx0Z2V0UHJvY2VzczogZnVuY3Rpb24ocHJvY2Vzc0lkLCBsYW5nKXtcclxuXHRcdFx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cdFx0XHRcdHRyeSB7XHJcblx0XHRcdFx0XHR1c2VySW50ZXJmYWNlLmdldFByb2Nlc3MocHJvY2Vzc0lkLCBsYW5nLCBfdGhpcykudGhlbihmdW5jdGlvbihtb2RlbCl7XHJcblx0XHRcdFx0XHRcdHJlc29sdmUobW9kZWwpO1xyXG5cdFx0XHRcdFx0fSwgZnVuY3Rpb24oZXJyKXtcclxuXHRcdFx0XHRcdFx0cmVqZWN0KGVycik7XHJcblx0XHRcdFx0XHR9KVxyXG5cdFx0XHRcdH0gY2F0Y2goZXJyKSB7XHJcblx0XHRcdFx0XHRyZWplY3QoZXJyKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0pXHJcblx0XHR9XHJcblx0fVxyXG59O1xyXG5cclxuXHJcblxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBXb3JrZmxvdztcclxuIiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxudmFyIHV0aWwgPSByZXF1aXJlKCd1dGlsaXR5Jyk7XHJcblxyXG4vKipcclxuICogQWN0aW9ucyBNb2R1bGVcclxuICpcclxuICogQG1vZHVsZSBsaWIvYWN0aW9uc1xyXG4gKiBAYXV0aG9yIEhhc2FuIEFiYmFzXHJcbiAqIEB2ZXJzaW9uIDIuMC4wXHJcbiAqIEBkZXNjcmlwdGlvbiB0ZXN0IGRlc2NyaXB0aW9uXHJcbiAqIEBjb3B5cmlnaHQgS3dhbnR1IEx0ZCBSU0EgMjAwOS0yMDE1LlxyXG4gKlxyXG4gKi9cclxuXHJcblxyXG52YXIgY29tbXVuaXR5ID0gKGZ1bmN0aW9uKCkge1xyXG5cclxuXHJcbiAgICByZXR1cm4ge1xyXG5cclxuICAgICAgICBjcmVhdGVDb21tdW5pdHk6IGZ1bmN0aW9uKF9XRkluc3RhbmNlKSB7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHdvcmtlck9iamVjdCA9IHdvcmtlci5nZXRXb3JrZXJXcmFwcGVyKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0Ll9pZCA9IGdlbmVyYXRlVVVJRCgpO1xyXG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0LmNvbW11bml0eUlkID0gYXBwLlNDT1BFLmNvbW11bml0eUlkO1xyXG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0LmFwcGxpY2F0aW9uSWQgPSBhcHAuU0NPUEUuYXBwbGljYXRpb25JZDtcclxuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5jcmVhdGVkRGF0ZVRpbWUgPSBuZXcgRGF0ZSgpLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgICAgICAgICB3b3JrZXJPYmplY3Quc2VuZGVyVXNlcklkID0gTE9DQUxfU0VUVElOR1MuU1VCU0NSSVBUSU9OUy51c2VySWQ7XHJcbiAgICAgICAgICAgICAgICB2YXIgdXVpZCA9IEpTT04ueHBhdGgoXCIvaW5kaWNhdG9yc1tjYXRlZ29yeS90ZXJtIGVxICdDb21tdW5pdHknXS9faWRcIiwgYXBwLlNDT1BFLndvcmtmbG93LCB7fSlbMF07XHJcbiAgICAgICAgICAgICAgICB2YXIgYWN0aW9uID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIFwiY3JlYXRlQ29tbXVuaXR5XCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJuZXdDb21tdW5pdHlJZFwiOiBfV0ZJbnN0YW5jZS5wcm9maWxlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImluZGljYXRvclVVSURcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJDb21tdW5pdHlcIjogdXVpZFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5hY3Rpb24gPSBhY3Rpb247XHJcbiAgICAgICAgICAgICAgICB3b3JrZXIuc2VuZCh3b3JrZXJPYmplY3QpLnRoZW4oZnVuY3Rpb24od29ya2VyU3VjY2Vzcykge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnRm9ybSBjcmVhdGVkIHN1Y2Nlc3NmdWxseS4nLCB3b3JrZXJTdWNjZXNzKTtcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xyXG5cclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKHdvcmtlckZhaWwpIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3Qod29ya2VyRmFpbCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzZXRWYXJpYWJsZTogZnVuY3Rpb24ocGFyYW0xKSB7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcblxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgfSxcclxuICAgICAgICB1c2VySm9pbkNvbW11bml0eTogZnVuY3Rpb24ocGFyYW0xKSB7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcblxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuXHJcblxyXG4gICAgfVxyXG5cclxufSkoKTtcclxuXHJcbnZhciB3b3JrZXIgPSAoZnVuY3Rpb24oKSB7XHJcblxyXG5cclxuICAgIHJldHVybiB7XHJcblxyXG4gICAgICAgIGdldFdvcmtlcldyYXBwZXI6IGZ1bmN0aW9uKCkge1xyXG5cclxuICAgICAgICAgICAgdmFyIHdyYXBwZXIgPSB7XHJcbiAgICAgICAgICAgICAgICBcInNvdXJjZVwiOiBcInJlbW90ZVwiLFxyXG4gICAgICAgICAgICAgICAgXCJ0eXBlXCI6IFwid29ya2VyT2JqZWN0XCIsXHJcbiAgICAgICAgICAgICAgICBcIl9pZFwiOiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgXCJjaGFubmVsc1wiOiBbXSxcclxuICAgICAgICAgICAgICAgIFwiY29tbXVuaXR5SWRcIjogXCJcIixcclxuICAgICAgICAgICAgICAgIFwiYXBwbGljYXRpb25JZFwiOiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgXCJtZXNzYWdlXCI6IFwiXCIsXHJcbiAgICAgICAgICAgICAgICBcIm1lc3NhZ2VUeXBlXCI6IFwiaW5mb1wiLFxyXG4gICAgICAgICAgICAgICAgXCJjcmVhdGVkRGF0ZVRpbWVcIjogXCJcIixcclxuICAgICAgICAgICAgICAgIFwic2VuZGVyVXNlcklkXCI6IFwiXCIsXHJcbiAgICAgICAgICAgICAgICBcIm5vdGlmaWNhdGlvblwiOiB7XHJcblxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIFwiYWN0aW9uXCI6IHtcclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gd3JhcHBlcjtcclxuXHJcbiAgICAgICAgfSxcclxuICAgICAgICBzZW5kOiBmdW5jdGlvbih3b3JrZXJPYmplY3QpIHtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnU3VibWl0dGluZyBXb3JrZXIgT2JqZWN0IHRvIHNlcnZlcicpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cod29ya2VyT2JqZWN0KTtcclxuICAgICAgICAgICAgICAgIGRhby5zYXZlKHdvcmtlck9iamVjdCkuZG9uZShmdW5jdGlvbih3b3JrZXJSZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUod29ya2VyUmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRXJyb3Igc3VibWl0dGluZyB3b3JrZXIgcmVzcG9uc2UgISEnICsgZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcblxyXG5cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbn0pKCk7XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHtcclxuXHJcbiAgICBjb21tdW5pdHk6IGNvbW11bml0eSxcclxuICAgIHdvcmtlcjogd29ya2VyXHJcblxyXG59IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuLy92YXIgZ2F0ZWtlZXBlciA9IHJlcXVpcmUoJy4uL2Jvd2VyX2NvbXBvbmVudHMvZ2F0ZWtlZXBlcicpO1xyXG52YXIgdXRpbCA9IHJlcXVpcmUoJ3V0aWxpdHknKTtcclxuXHJcbi8vIHZhciB1dWlkID0gcmVxdWlyZSgnbm9kZS11dWlkJyk7XHJcblxyXG52YXIgZ2F0ZWtlZXBlciA9IG5ldyBHSygpO1xyXG5cclxuLyoqXHJcbiAqIEZvcm0gTW9kdWxlXHJcbiAqXHJcbiAqIEBtb2R1bGUgbGliL2Zvcm1cclxuICogQGF1dGhvciBCcmVudCBHb3Jkb25cclxuICogQHZlcnNpb24gMi4wLjBcclxuICogQGRlc2NyaXB0aW9uIHRlc3QgZGVzY3JpcHRpb25cclxuICogQGNvcHlyaWdodCBLd2FudHUgTHRkIFJTQSAyMDA5LTIwMTUuXHJcbiAqXHJcbiAqL1xyXG5cclxuZnVuY3Rpb24gY3JlYXRlKGFyZ3MpIHtcclxuXHJcbiAgICB2YXIgcHJvY2Vzc0lkID0gYXJnc1swXSB8fCAnJztcclxuXHJcbiAgICB2YXIgc3ViUHJvY2VzcyA9IGFyZ3NbMV0gfHwge307XHJcblxyXG4gICAgdmFyIHN0ZXAgPSBhcmdzWzJdIHx8IHt9O1xyXG5cclxuICAgIHZhciBhY3Rpb24gPSBhcmdzWzNdIHx8IHt9O1xyXG5cclxuICAgIHZhciBfV0ZJbnN0YW5jZSA9IGFyZ3NbNl0gfHwge307XHJcblxyXG4gICAgdmFyIGRhdGEgPSBhcmdzWzZdIHx8IHt9O1xyXG5cclxuICAgIHZhciBpbmRpY2F0b3JzID0gc3ViUHJvY2Vzcy5pbmRpY2F0b3JzIHx8IFtdO1xyXG5cclxuICAgIHZhciByZXN1bHQgPSBbXTtcclxuXHJcbiAgICB2YXIgaW5kaWNhdG9yVHlwZSA9IGFjdGlvbi5fdHlwZTtcclxuXHJcbiAgICB2YXIgcHJvY2Vzc1NlcSA9IGFyZ3NbNF0gfHwgJyc7XHJcblxyXG4gICAgdmFyIHN1YlByb2Nlc3NTZXEgPSBhcmdzWzVdIHx8ICcnO1xyXG5cclxuICAgIHZhciBjcmVhdGVUeXBlID0gYXJnc1s3XSB8fCAnJztcclxuXHJcbiAgICB2YXIgc3ViUHJvY2Vzc0lkID0gc3ViUHJvY2Vzcy5faWQ7XHJcblxyXG4gICAgdmFyIHV1aWQgPSBhcmdzWzhdIHx8ICcnO1xyXG5cclxuICAgIHZhciBiYXNlVVVJRCA9IGFyZ3NbOV0gfHwgJyc7XHJcblxyXG4gICAgdmFyIHByb2ZpbGUgPSBfV0ZJbnN0YW5jZS5wcm9maWxlO1xyXG5cclxuXHJcblxyXG4gICAgdmFyIGlucHV0RGF0YSA9IGFyZ3NbMTBdIHx8IHt9O1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICB2YXIgdG9Qcm9jZXNzID0gaW5kaWNhdG9ycy5sZW5ndGg7XHJcblxyXG4gICAgICAgIHZhciBmb3JtQ3JlYXRlRm4gPSBmdW5jdGlvbihpZCwgaW5kaWNhdG9yVHlwZSwgaW5kaWNhdG9ySWQsIHZhbGlkRGF0ZSwgaW5zdGFudGlhdGVTb3VyY2UpIHtcclxuXHJcbiAgICAgICAgICAgIGdhdGVrZWVwZXIuaW5zdGFudGlhdGUoaWQsIGluZGljYXRvclR5cGUsIGluZGljYXRvcklkLCBfV0ZJbnN0YW5jZS5wcm9maWxlLCB2YWxpZERhdGUpLnRoZW4oZnVuY3Rpb24oZG9jQXJyYXkpIHtcclxuICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgaW5kaWNhdG9yIHdvcmtmbG93IHByb2Nlc3NlcyBzZWN0aW9uXHJcblxyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkb2NBcnJheS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBvYmplY3QgPSBkb2NBcnJheVtpXTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIW9iamVjdC5tb2RlbC5faWQuZW5kc1dpdGgoJzphcHByb3ZlZCcpICYmICFvYmplY3QubW9kZWwuX2lkLmVuZHNXaXRoKCc6cmVqZWN0ZWQnKSkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHdvcmtmbG93T2JqID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJpZFwiOiBfV0ZJbnN0YW5jZS5jb25maWcuX2lkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJpbnN0YW5jZVwiOiBfV0ZJbnN0YW5jZS5pbnN0YW5jZS5faWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInByb2Nlc3Nlc1wiOiBbe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiaWRcIjogcHJvY2Vzc0lkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3ViUHJvY2Vzc0lkXCI6IHN1YlByb2Nlc3MuX2lkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3ViUHJvY2Vzc1VVSURcIjogdXVpZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInN0ZXBcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImlkXCI6IHN0ZXAuaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic2VxXCI6IHN0ZXAuc2VxLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInN0YXJ0RGF0ZVwiOiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInN0YXR1c1wiOiBzdGVwLnN0YXR1cyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJtZXNzYWdlXCI6IHN0ZXAubWVzc2FnZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJhc3NpZ25lZFRvXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidXNlcklkXCI6IHN0ZXAuYXNzaWduZWRUby51c2VySWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogc3RlcC5hc3NpZ25lZFRvLm5hbWVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJjb21tZW50XCI6IHN0ZXAuY29tbWVudCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJjb21wbGV0ZVwiOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJlbmREYXRlXCI6IFwiXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWN0aW9uLnNldFdvcmtmbG93TGFiZWxJblRpdGxlICE9IHVuZGVmaW5lZCAmJiBhY3Rpb24uc2V0V29ya2Zsb3dMYWJlbEluVGl0bGUgIT0gJycgJiYgYWN0aW9uLnNldFdvcmtmbG93TGFiZWxJblRpdGxlID09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC5tb2RlbC50aXRsZSA9IGlucHV0RGF0YS5sYWJlbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFjdGlvbi5zZXREcmFmdCAhPSB1bmRlZmluZWQgJiYgYWN0aW9uLnNldERyYWZ0ICE9ICcnICYmIGFjdGlvbi5zZXREcmFmdCA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QubW9kZWwuY29udHJvbC5kcmFmdCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcblxyXG5cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QubW9kZWwud29ya2Zsb3dzLnB1c2god29ya2Zsb3dPYmopO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWFpbklkID0gb2JqZWN0Lm1vZGVsLl9pZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gcGVyc2lzdCB2aWEgZ2sgc28gdGhhdCBpdCBpcyBzYXZlIGluIGNvdWNoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdhdGVrZWVwZXIucGVyc2lzdChkb2NBcnJheSkudGhlbihmdW5jdGlvbihzYXZlZEFycmF5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3VzaW5nIHNhbWUgaWQgY2FsbCBpbml0aWFsaXNlRGF0YVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9jYWxsIGNvZGUgdG8gc2V0IHRvIHNldEluc3RhbmNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYW8uZ2V0KG1haW5JZCkuZG9uZShmdW5jdGlvbihkYXRhKSB7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5kaWNhdG9yTW9kZWwgPSBrby5tYXBwaW5nLmZyb21KUyh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiZGVmYXVsdE1vZGVsXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic2V0SWRcIjogaW5kaWNhdG9ySWRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYXRla2VlcGVyLmluc3RhbnRpYXRlRGF0YShtYWluSWQsIGluc3RhbnRpYXRlU291cmNlLCBpbmRpY2F0b3JNb2RlbCwgZGF0YS5tb2RlbC5wZW5kaW5nLnNlcSkudGhlbihmdW5jdGlvbihkYXRhKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YVswXS5zdGF0dXMgPT0gXCIyMDBcIikge1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWN0aW9uLnNldFdvcmtmbG93TGFiZWxJbkZpZWxkICE9IHVuZGVmaW5lZCAmJiBhY3Rpb24uc2V0V29ya2Zsb3dMYWJlbEluRmllbGQgIT0gJycgJiYgbWFpbklkID09IHByb2ZpbGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhWzBdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGF0aCA9IFwiZGF0YVswXS5tb2RlbC5tb2RlbC5wZW5kaW5nLmRhdGEuXCIgKyBhY3Rpb24uc2V0V29ya2Zsb3dMYWJlbEluRmllbGQgKyBcIj0nXCIgKyBpbnB1dERhdGEubGFiZWwgKyBcIidcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmFsKHBhdGgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhdGVrZWVwZXIucGVyc2lzdChkYXRhKS50aGVuKGZ1bmN0aW9uKHNhdmVkQXJyYXkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYW8uZ2V0KG1haW5JZCkuZG9uZShmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfV0ZJbnN0YW5jZS5pbmRpY2F0b3JzLmxlbmd0aCA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfV0ZJbnN0YW5jZS5pbmRpY2F0b3JzLnB1c2goZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1Byb2Nlc3MtLTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0b1Byb2Nlc3MgPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdGb3JtIGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5LicsIF9XRkluc3RhbmNlLmluZGljYXRvcnMpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZvdW5kID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgX1dGSW5zdGFuY2UuaW5kaWNhdG9ycy5sZW5ndGg7IGluZGV4KyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5kaWNhdG9yID0gX1dGSW5zdGFuY2UuaW5kaWNhdG9yc1tpbmRleF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZGljYXRvci5faWQgPT0gZGF0YS5faWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm91bmQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgdGhlIGN1cnJlbnQgaXRlbSBmcm9tIHRoZSBhcnJheSBhbmQgYWRkIHRoZSB1cGRhdGVkIHByb2Nlc3NNb2RlbFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfV0ZJbnN0YW5jZS5pbmRpY2F0b3JzLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9XRkluc3RhbmNlLmluZGljYXRvcnMucHVzaChkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9Qcm9jZXNzLS07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0b1Byb2Nlc3MgPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ0Zvcm0gY3JlYXRlZCBzdWNjZXNzZnVsbHkuJywgX1dGSW5zdGFuY2UuaW5kaWNhdG9ycyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZvdW5kID09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX1dGSW5zdGFuY2UuaW5kaWNhdG9ycy5wdXNoKGRhdGEpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1Byb2Nlc3MtLTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodG9Qcm9jZXNzID09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ0Zvcm0gY3JlYXRlZCBzdWNjZXNzZnVsbHkuJywgX1dGSW5zdGFuY2UuaW5kaWNhdG9ycyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmFpbHVyZSA9IHV0aWwuc3VjY2VzcygnMSBHYXRla2VlcGVyIGluaXRpYWxpc2F0aW9uIGZhaWxlZCB3aXRoIGluaXRpYWxpc2VEYXRhIG1lc3NhZ2UgJyArIGVyclswXS5tZXNzYWdlLCB7fSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChmYWlsdXJlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmYWlsdXJlID0gdXRpbC5zdWNjZXNzKCcyIEdhdGVrZWVwZXIgaW5pdGlhbGlzYXRpb24gZmFpbGVkIHdpdGggaW5pdGlhbGlzZURhdGEgbWVzc2FnZSAnICsgZXJyWzBdLm1lc3NhZ2UsIHt9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZmFpbHVyZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcblxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmYWlsdXJlID0gdXRpbC5zdWNjZXNzKCczIEdhdGVrZWVwZXIgaW5pdGlhbGlzYXRpb24gZmFpbGVkIHdpdGggaW5pdGlhbGlzZURhdGEgbWVzc2FnZSAnICsgZXJyWzBdLm1lc3NhZ2UsIHt9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChmYWlsdXJlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmYWlsdXJlID0gdXRpbC5zdWNjZXNzKCc0IEdhdGVrZWVwZXIgaW5pdGlhbGlzYXRpb24gZmFpbGVkIHdpdGggaW5pdGlhbGlzZURhdGEgbWVzc2FnZSAnICsgZXJyWzBdLm1lc3NhZ2UsIHt9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGZhaWx1cmUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZhaWx1cmUgPSB1dGlsLnN1Y2Nlc3MoJzUgR2F0ZWtlZXBlciBpbml0aWFsaXNhdGlvbiBmYWlsZWQgd2l0aCBpbml0aWFsaXNlRGF0YSBtZXNzYWdlICcgKyBlcnJbMF0ubWVzc2FnZSwge30pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChmYWlsdXJlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZhaWx1cmUgPSB1dGlsLnN1Y2Nlc3MoJzYgR2F0ZWtlZXBlciBpbml0aWFsaXNhdGlvbiBmYWlsZWQgd2l0aCBpbml0aWFsaXNlRGF0YSBtZXNzYWdlICcgKyBlcnJbMF0ubWVzc2FnZSwge30pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGZhaWx1cmUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvL3BlcnNpc3QgLSBzYXZlXHJcbiAgICAgICAgICAgICAgICAvL2xvb3Agb24gd29ya2Zsb3cgYXJyYXkgYW5kIGNoZWNrIGZvciA0IGNvbmRpdGlvbnMgYW5kIHNwbGljZSBhbmQgdXBkYXRlXHJcbiAgICAgICAgICAgICAgICAvLyBHb3QgdG8gdGhlIG5leHQgcHJvY2VzcyBpdGVtXHJcblxyXG4gICAgICAgICAgICAgICAgLyp2YXIgd29ya2Zsb3dzID0gZG9jLndvcmtmbG93cztcclxuICAgICAgICAgICAgICAgIHdvcmtmbG93cy5pZCA9IF9XRkluc3RhbmNlLmNvbmZpZy5faWQ7XHJcbiAgICAgICAgICAgICAgICB3b3JrZmxvd3MuaW5zdGFuY2UgPSBfV0ZJbnN0YW5jZS5pbnN0YW5jZS5faWQ7XHJcbiAgICAgICAgICAgICAgICBfV0ZJbnN0YW5jZS5pbmRpY2F0b3JzLnB1c2goZG9jKTtcclxuICAgICAgICAgICAgICAgIGxvb3AubmV4dCgpOyovXHJcblxyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuXHJcblxyXG5cclxuICAgICAgICAgICAgICAgIHZhciB0b0FkZFByb2Nlc3MgPSBbXTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgX1dGSW5zdGFuY2UuaW5zdGFuY2UucHJvY2Vzc2VzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKF9XRkluc3RhbmNlLmluc3RhbmNlLnByb2Nlc3Nlc1tpXS5zdWJQcm9jZXNzZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0b0FkZFByb2Nlc3MucHVzaChfV0ZJbnN0YW5jZS5pbnN0YW5jZS5wcm9jZXNzZXNbaV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIF9XRkluc3RhbmNlLmluc3RhbmNlLnByb2Nlc3NlcyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgX1dGSW5zdGFuY2UuaW5zdGFuY2UucHJvY2Vzc2VzID0gdG9BZGRQcm9jZXNzO1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgdG9BZGRTdWJQcm9jZXNzID0gW107XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IF9XRkluc3RhbmNlLnN1YnByb2Nlc3Nlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChfV0ZJbnN0YW5jZS5zdWJwcm9jZXNzZXNbaV0uaW5kaWNhdG9ycy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvQWRkU3ViUHJvY2Vzcy5wdXNoKF9XRkluc3RhbmNlLnN1YnByb2Nlc3Nlc1tpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgX1dGSW5zdGFuY2Uuc3VicHJvY2Vzc2VzID0gW107XHJcbiAgICAgICAgICAgICAgICBfV0ZJbnN0YW5jZS5zdWJwcm9jZXNzZXMgPSB0b0FkZFN1YlByb2Nlc3M7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcclxuICAgICAgICAgICAgICAgIHZhciBmYWlsdXJlID0gdXRpbC5zdWNjZXNzKCc3IEdhdGVrZWVwZXIgaW5pdGlhbGlzYXRpb24gZmFpbGVkIHdpdGggaW5pdGlhbGlzZURhdGEgbWVzc2FnZSAnICsgZXJyWzBdLm1lc3NhZ2UsIHt9KTtcclxuICAgICAgICAgICAgICAgIHJlamVjdChmYWlsdXJlKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBpbnN0YW50aWF0ZVNvdXJjZSA9ICdmcm9tRGVmaW5pdGlvbic7XHJcbiAgICAgICAgZm9yICh2YXIgY291bnRlciA9IDA7IGNvdW50ZXIgPCBpbmRpY2F0b3JzLmxlbmd0aDsgY291bnRlcisrKSB7XHJcbiAgICAgICAgICAgIHZhciBpbmRpY2F0b3JJZCA9IGluZGljYXRvcnNbY291bnRlcl0uX2lkO1xyXG4gICAgICAgICAgICB2YXIgaW5kaWNhdG9yTmFtZSA9IHV0aWwuZ2V0TmFtZShpbmRpY2F0b3JzW2NvdW50ZXJdLm5hbWUsICdlbicpO1xyXG4gICAgICAgICAgICB2YXIgaW5pdFR5cGUgPSBpbmRpY2F0b3JzW2NvdW50ZXJdLl90eXBlO1xyXG5cclxuICAgICAgICAgICAgdmFyIGlkID0gJyc7XHJcbiAgICAgICAgICAgIHZhciBpbmRpY2F0b3JEb2MgPSB7fTtcclxuXHJcbiAgICAgICAgICAgIGlmIChpbml0VHlwZSA9PSAnbmV3SW5zdGFuY2UnKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGJhc2VVVUlEICE9IHVuZGVmaW5lZCAmJiBiYXNlVVVJRCAhPSAnJyAmJiBiYXNlVVVJRC5sZW5ndGggPiAwKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBleGlzdGluZ1VVSUQgPSBKU09OLnhwYXRoKFwiL3N1YnByb2Nlc3Nlc1tfaWQgZXEgJ1wiICsgYmFzZVVVSUQgKyBcIiddL2luZGljYXRvcnNbaWQgZXEgJ1wiICsgaW5kaWNhdG9ySWQgKyBcIiddL2luc3RhbmNlc1sxXS91dWlkXCIsIF9XRkluc3RhbmNlLCB7fSlbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgaWQgPSBleGlzdGluZ1VVSUQ7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5pdFR5cGUgPSAnbmV3U2VxdWVuY2UnO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyB1cGRhdGUgcHJvY2Vzc2VzIGJsb2NrIHRvIG5vdCBkaXNwbGF5IHRoZSBvbGRlciBpbnN0YW5jZSBiYXNlZCBvbiBiYXNlVVVJRFxyXG5cclxuICAgICAgICAgICAgICAgICAgICAvL1RPRE86IENoYW5nZSByZXF1aXJlZCB0byBtb3ZlIGlzQWN0aXZlIHRvIHN1YlByb2Nlc3MgZmlsZS5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3AgPSBKU09OLnhwYXRoKFwiL3N1YnByb2Nlc3Nlc1tfaWQgZXEgJ1wiICsgYmFzZVVVSUQgKyBcIiddXCIsIGFwcC5TQ09QRS53b3JrZmxvdywge30pWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgIHNwLmFjdGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGluc3RhbnRpYXRlIG5ldyBzZXEgd2l0aCBwcmV2aW91cyBhdXRob3Jpc2VkIGRhdGFcclxuICAgICAgICAgICAgICAgICAgICBpbnN0YW50aWF0ZVNvdXJjZSA9ICdmcm9tQXV0aG9yaXNlZCc7XHJcblxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHN1YlByb2Nlc3MuaXNQcm9maWxlICE9IHVuZGVmaW5lZCAmJiBzdWJQcm9jZXNzLmlzUHJvZmlsZSAmJiBjb3VudGVyID09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWQgPSBwcm9maWxlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkID0gaW5kaWNhdG9ySWQgKyAnLScgKyBnZW5lcmF0ZVVVSUQoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgc3BMYXN0VXVpZCA9IEpTT04ueHBhdGgoXCIvaW5zdGFuY2UvcHJvY2Vzc2VzW2lkIGVxICdcIiArIHByb2Nlc3NJZCArIFwiJyBhbmQgc3ViUHJvY2Vzc2VzL2lkIGVxICdcIiArIHN1YlByb2Nlc3NJZCArIFwiJ11bMV0vc3ViUHJvY2Vzc2VzL3V1aWRcIiwgX1dGSW5zdGFuY2UsIHt9KVswXTtcclxuICAgICAgICAgICAgICAgIHZhciBpbmRJZCA9IEpTT04ueHBhdGgoXCIvc3VicHJvY2Vzc2VzW19pZCBlcSAnXCIgKyBzcExhc3RVdWlkICsgXCInXS9pbmRpY2F0b3JzW2lkIGVxICdcIiArIGluZGljYXRvcklkICsgXCInXS9pbnN0YW5jZXMvdXVpZFwiLCBhcHAuU0NPUEUud29ya2Zsb3csIHt9KVswXTtcclxuICAgICAgICAgICAgICAgIGlmIChzcExhc3RVdWlkID09ICcnIHx8IHNwTGFzdFV1aWQgPT0gdW5kZWZpbmVkIHx8IGluZElkID09ICcnIHx8IGluZElkID09IHVuZGVmaW5lZCkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoc3ViUHJvY2Vzcy5pc1Byb2ZpbGUgIT0gdW5kZWZpbmVkICYmIHN1YlByb2Nlc3MuaXNQcm9maWxlICYmIGNvdW50ZXIgPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZCA9IHByb2ZpbGU7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWQgPSBpbmRpY2F0b3JJZCArICctJyArIGdlbmVyYXRlVVVJRCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZCA9IGluZElkO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChiYXNlVVVJRCAhPSB1bmRlZmluZWQgJiYgYmFzZVVVSUQgIT0gJycgJiYgYmFzZVVVSUQubGVuZ3RoID4gMCkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvL1RPRE86IENoYW5nZSByZXF1aXJlZCB0byBtb3ZlIGlzQWN0aXZlIHRvIHN1YlByb2Nlc3MgZmlsZS5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNwID0gSlNPTi54cGF0aChcIi9zdWJwcm9jZXNzZXNbX2lkIGVxICdcIiArIGJhc2VVVUlEICsgXCInXVwiLCBhcHAuU0NPUEUud29ya2Zsb3csIHt9KVswXTtcclxuICAgICAgICAgICAgICAgICAgICBzcC5hY3RpdmUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICBpbnN0YW50aWF0ZVNvdXJjZSA9ICdmcm9tQXV0aG9yaXNlZCc7XHJcblxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIFRPRE86IFJlcGxhY2Ugd2l0aCB0aGUgZ2F0ZWtlZXBlciBwcm9taXNlIGNhbGwsIHJldHVybiB0aGUgb2JqZWN0LCB1cGRhdGUgdGhlIGluZGljYXRvclxyXG4gICAgICAgICAgICAvLyBkb2N1bWVudCB3b3JrZmxvdyBwcm9jZXNzZXMgZGF0YSBhbmQgdXBkYXRlIHRoZSB3b3JrZmxvdyBjbGFzcyBpbmRpY2F0b3JzIGFycmF5LlxyXG4gICAgICAgICAgICBmb3JtQ3JlYXRlRm4oaWQsIGluaXRUeXBlLCBpbmRpY2F0b3JJZCwgJycsIGluc3RhbnRpYXRlU291cmNlKTtcclxuXHJcblxyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIC8vIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdGb3JtIGluZGljYXRvciBzZXQgc2F2ZWQgc3VjY2Vzc2Z1bGx5LicsIHJlc3VsdCk7XHJcbiAgICAgICAgLy8gcmVzb2x2ZShzdWNjZXNzKTtcclxuICAgIH0pO1xyXG59O1xyXG5cclxuZnVuY3Rpb24gc2V0SW5zdGFuY2VUaXRsZShhcmdzKSB7XHJcblxyXG4gICAgdmFyIF9XRkluc3RhbmNlID0gYXJnc1swXSB8fCB7fTtcclxuICAgIHZhciB1dWlkID0gYXJnc1syXSB8fCAnJztcclxuICAgIHZhciBkYXRhID0gYXJnc1s0XSB8fCB7fTtcclxuICAgIHZhciB0aXRsZSA9IGRhdGEubGFiZWw7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuICAgICAgICB2YXIgc3ViUHJvY2Vzc0luc3RhbmNlID0gSlNPTi54cGF0aChcIi9zdWJwcm9jZXNzZXNbX2lkIGVxICdcIiArIHV1aWQgKyBcIiddXCIsIF9XRkluc3RhbmNlLCB7fSlbMF07XHJcbiAgICAgICAgdmFyIGluZGljYXRvckluc3RhbmNlcyA9IHN1YlByb2Nlc3NJbnN0YW5jZS5pbmRpY2F0b3JzO1xyXG5cclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGluZGljYXRvckluc3RhbmNlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICB2YXIgaW5kaWNhdG9yVVVJRCA9IGluZGljYXRvckluc3RhbmNlc1tpXS5pbnN0YW5jZXNbMF0udXVpZDtcclxuICAgICAgICAgICAgdmFyIGluZGljYXRvckluc3RhbmNlID0gSlNPTi54cGF0aChcIi9pbmRpY2F0b3JzW19pZCBlcSAnXCIgKyBpbmRpY2F0b3JVVUlEICsgXCInXVwiLCBfV0ZJbnN0YW5jZSwge30pWzBdO1xyXG4gICAgICAgICAgICBpbmRpY2F0b3JJbnN0YW5jZS50aXRsZSA9IGluZGljYXRvckluc3RhbmNlc1tpXS5pZCArJyAnK3RpdGxlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJlc29sdmUoXCJTZXQgVGl0bGUgU3VjY2Vzc1wiLCBpbmRpY2F0b3JJbnN0YW5jZXMpO1xyXG5cclxuICAgIH0pO1xyXG5cclxufTtcclxuXHJcbmZ1bmN0aW9uIGRlbGV0ZVByb2ZpbGUoYXJncykge1xyXG5cclxuICAgIHZhciBfV0ZJbnN0YW5jZSA9IGFyZ3NbMF0gfHwge307XHJcbiAgICB2YXIgcHJvZmlsZUlkID0gX1dGSW5zdGFuY2UucHJvZmlsZTtcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcblxyXG4gICAgICAgIHZhciB3b3JrZXJPYmplY3QgPSB7XHJcbiAgICAgICAgICAgIFwic291cmNlXCI6IFwicmVtb3RlXCIsXHJcbiAgICAgICAgICAgIFwidHlwZVwiOiBcIndvcmtlck9iamVjdFwiLFxyXG4gICAgICAgICAgICBcIl9pZFwiOiBnZW5lcmF0ZVVVSUQoKSxcclxuICAgICAgICAgICAgXCJjaGFubmVsc1wiOiBbXSxcclxuICAgICAgICAgICAgXCJjb21tdW5pdHlJZFwiOiBhcHAuU0NPUEUuY29tbXVuaXR5SWQsXHJcbiAgICAgICAgICAgIFwiYXBwbGljYXRpb25JZFwiOiBhcHAuU0NPUEUuYXBwbGljYXRpb25JZCxcclxuICAgICAgICAgICAgXCJtZXNzYWdlXCI6IFwiXCIsXHJcbiAgICAgICAgICAgIFwibWVzc2FnZVR5cGVcIjogXCJpbmZvXCIsXHJcbiAgICAgICAgICAgIFwiY3JlYXRlZERhdGVUaW1lXCI6IG1vbWVudCgpLmZvcm1hdCgpLFxyXG4gICAgICAgICAgICBcInNlbmRlclVzZXJJZFwiOiBMT0NBTF9TRVRUSU5HUy5TVUJTQ1JJUFRJT05TLnVzZXJJZCxcclxuICAgICAgICAgICAgXCJub3RpZmljYXRpb25cIjoge1xyXG5cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgXCJwcm9maWxlXCI6IHtcclxuICAgICAgICAgICAgICAgIFwiYWN0aW9uXCI6IFwiZGVsZXRlUHJvZmlsZVwiLFxyXG4gICAgICAgICAgICAgICAgXCJwcm9maWxlSWRcIjogcHJvZmlsZUlkXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc29sZS5sb2cod29ya2VyT2JqZWN0KTtcclxuICAgICAgICBkYW8udXBzZXJ0KHdvcmtlck9iamVjdCkuZG9uZShmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiV29ya2VyIE9iamVjdCBzdWJtaXR0ZWQgZm9yIHByb2ZpbGUoXCIgKyBwcm9maWxlSWQgKyBcIikgZGVsZXRpb24uXCIpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcclxuICAgICAgICAgICAgcmVzb2x2ZShkYXRhKTtcclxuICAgICAgICB9KS5mYWlsKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xyXG4gICAgICAgICAgICByZWplY3QoZGF0YSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG5cclxuICAgIH0pO1xyXG5cclxuXHJcbn07XHJcblxyXG5cclxuZnVuY3Rpb24gY3JlYXRlUHJvZmlsZShhcmdzKSB7XHJcblxyXG5cclxuXHJcbiAgICB2YXIgX1dGSW5zdGFuY2UgPSBhcmdzWzFdIHx8IHt9O1xyXG5cclxuICAgIHZhciBjb21tdW5pdHlJZCA9IF9XRkluc3RhbmNlLmNvbW11bml0eUlkO1xyXG4gICAgdmFyIHByb2ZpbGVJZCA9IF9XRkluc3RhbmNlLnByb2ZpbGU7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuICAgICAgICBsaWJyYXJ5LmNyZWF0ZVByb2ZpbGVEb2N1bWVudHMoY29tbXVuaXR5SWQsIHByb2ZpbGVJZCkuZG9uZShmdW5jdGlvbihkYXRhKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnRm9ybSBjcmVhdGVkIHN1Y2Nlc3NmdWxseS4nLCBkYXRhKTtcclxuICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcclxuXHJcbiAgICAgICAgfSkuZmFpbChmdW5jdGlvbihlcnIpIHtcclxuXHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcclxuICAgICAgICAgICAgdmFyIGZhaWx1cmUgPSB1dGlsLnN1Y2Nlc3MoJ0VSUk9SOiBQcm9maWxlIGNyZWF0aW9uIGZhaWxlZCcgKyBlcnJbMF0ubWVzc2FnZSwge30pO1xyXG4gICAgICAgICAgICByZWplY3QoZmFpbHVyZSk7XHJcblxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIH0pO1xyXG59O1xyXG5cclxuZnVuY3Rpb24gc2V0RHJhZnQoYXJncykge1xyXG5cclxuXHJcblxyXG4gICAgdmFyIF9XRkluc3RhbmNlID0gYXJnc1swXSB8fCB7fTtcclxuICAgIHZhciBjb21tdW5pdHlJZCA9IF9XRkluc3RhbmNlLmNvbW11bml0eUlkO1xyXG4gICAgdmFyIHByb2ZpbGVJZCA9IF9XRkluc3RhbmNlLnByb2ZpbGU7XHJcbiAgICB2YXIgdXVpZCA9IGFyZ3NbMl0gfHwgJyc7XHJcblxyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuXHJcbiAgICAgICAgdmFyIHN1YlByb2Nlc3NJbnN0YW5jZSA9IEpTT04ueHBhdGgoXCIvc3VicHJvY2Vzc2VzW19pZCBlcSAnXCIgKyB1dWlkICsgXCInXVwiLCBfV0ZJbnN0YW5jZSwge30pWzBdO1xyXG4gICAgICAgIHZhciBpbmRpY2F0b3JJbnN0YW5jZXMgPSBzdWJQcm9jZXNzSW5zdGFuY2UuaW5kaWNhdG9ycztcclxuXHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpbmRpY2F0b3JJbnN0YW5jZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgdmFyIGluZGljYXRvclVVSUQgPSBpbmRpY2F0b3JJbnN0YW5jZXNbaV0uaW5zdGFuY2VzWzBdLnV1aWQ7XHJcbiAgICAgICAgICAgIHZhciBpbmRpY2F0b3JJbnN0YW5jZSA9IEpTT04ueHBhdGgoXCIvaW5kaWNhdG9yc1tfaWQgZXEgJ1wiICsgaW5kaWNhdG9yVVVJRCArIFwiJ11cIiwgX1dGSW5zdGFuY2UsIHt9KVswXTtcclxuICAgICAgICAgICAgaW5kaWNhdG9ySW5zdGFuY2UuY29udHJvbC5kcmFmdCA9IHRydWU7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmVzb2x2ZShcIlNldCBEcmFmdCBTdWNjZXNzXCIsIGluZGljYXRvckluc3RhbmNlcyk7XHJcblxyXG4gICAgfSk7XHJcbn07XHJcblxyXG5mdW5jdGlvbiBzZXRVbkRyYWZ0KGFyZ3MpIHtcclxuXHJcbiAgICB2YXIgX1dGSW5zdGFuY2UgPSBhcmdzWzBdIHx8IHt9O1xyXG4gICAgdmFyIGNvbW11bml0eUlkID0gX1dGSW5zdGFuY2UuY29tbXVuaXR5SWQ7XHJcbiAgICB2YXIgcHJvZmlsZUlkID0gX1dGSW5zdGFuY2UucHJvZmlsZTtcclxuICAgIHZhciB1dWlkID0gYXJnc1syXSB8fCAnJztcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcblxyXG4gICAgICAgIHZhciBzdWJQcm9jZXNzSW5zdGFuY2UgPSBKU09OLnhwYXRoKFwiL3N1YnByb2Nlc3Nlc1tfaWQgZXEgJ1wiICsgdXVpZCArIFwiJ11cIiwgX1dGSW5zdGFuY2UsIHt9KVswXTtcclxuICAgICAgICB2YXIgaW5kaWNhdG9ySW5zdGFuY2VzID0gc3ViUHJvY2Vzc0luc3RhbmNlLmluZGljYXRvcnM7XHJcblxyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaW5kaWNhdG9ySW5zdGFuY2VzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHZhciBpbmRpY2F0b3JVVUlEID0gaW5kaWNhdG9ySW5zdGFuY2VzW2ldLmluc3RhbmNlc1swXS51dWlkO1xyXG4gICAgICAgICAgICB2YXIgaW5kaWNhdG9ySW5zdGFuY2UgPSBKU09OLnhwYXRoKFwiL2luZGljYXRvcnNbX2lkIGVxICdcIiArIGluZGljYXRvclVVSUQgKyBcIiddXCIsIF9XRkluc3RhbmNlLCB7fSlbMF07XHJcbiAgICAgICAgICAgIGluZGljYXRvckluc3RhbmNlLmNvbnRyb2wuZHJhZnQgPSBmYWxzZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXNvbHZlKFwiU2V0IERyYWZ0IFN1Y2Nlc3NcIiwgaW5kaWNhdG9ySW5zdGFuY2VzKTtcclxuXHJcbiAgICB9KTtcclxufTtcclxuXHJcblxyXG5cclxuZnVuY3Rpb24gc2F2ZShpbmRpY2F0b3IpIHtcclxuICAgIHZhciBjb21wbGV0ZWQgPSBbXTtcclxuICAgIHZhciByZXN1bHQgPSB7XHJcbiAgICAgICAgY29tcGxldGU6IHRydWUsXHJcbiAgICAgICAgZGF0YTogW11cclxuICAgIH07XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ0Zvcm0gaW5kaWNhdG9yIHNldCBzYXZlZCBzdWNjZXNzZnVsbHkuJywgcmVzdWx0KTtcclxuICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xyXG4gICAgfSk7XHJcbn07XHJcblxyXG5mdW5jdGlvbiBzdWJtaXQoZm9ybSkge1xyXG4gICAgdmFyIGNvbXBsZXRlZCA9IFtdO1xyXG4gICAgdmFyIHJlc3VsdCA9IHtcclxuICAgICAgICBjb21wbGV0ZTogdHJ1ZSxcclxuICAgICAgICBkYXRhOiBbXVxyXG4gICAgfTtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnRm9ybSBzdWJtaXR0ZWQgc3VjY2Vzc2Z1bGx5LicsIHJlc3VsdCk7XHJcbiAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcclxuICAgIH0pO1xyXG59O1xyXG5cclxuZnVuY3Rpb24gYXV0aG9yaXNlKGZvcm0pIHtcclxuICAgIHZhciBjb21wbGV0ZWQgPSBbXTtcclxuICAgIHZhciByZXN1bHQgPSB7XHJcbiAgICAgICAgY29tcGxldGU6IHRydWUsXHJcbiAgICAgICAgZGF0YTogW11cclxuICAgIH07XHJcblxyXG4gICAgdmFyIHByb2Nlc3NJZCA9IGZvcm1bMF0gfHwgJyc7XHJcblxyXG4gICAgdmFyIHN1YlByb2Nlc3MgPSBmb3JtWzFdIHx8IHt9O1xyXG5cclxuICAgIHZhciBzdWJQcm9jZXNzSWQgPSBzdWJQcm9jZXNzLl9pZDtcclxuXHJcbiAgICB2YXIgcHJvY2Vzc1NlcSA9IGZvcm1bMl0gfHwgJyc7XHJcblxyXG4gICAgdmFyIHN1YlByb2Nlc3NTZXEgPSBmb3JtWzNdIHx8ICcnO1xyXG5cclxuICAgIHZhciBfV0ZJbnN0YW5jZSA9IGZvcm1bNF0gfHwge307XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuICAgICAgICB2YXIgc3ViUHJvY2Vzc1VVSUQgPSBKU09OLnhwYXRoKFwiL3Byb2Nlc3Nlc1tpZCBlcSAnXCIgKyBwcm9jZXNzSWQgKyBcIicgYW5kIHNlcSBlcSAnXCIgKyBwcm9jZXNzU2VxICsgXCInXS9zdWJQcm9jZXNzZXNbaWQgZXEgJ1wiICsgc3ViUHJvY2Vzc0lkICsgXCInIGFuZCBzZXEgZXEgJ1wiICsgc3ViUHJvY2Vzc1NlcSArIFwiJ10vdXVpZFwiLCBfV0ZJbnN0YW5jZS5pbnN0YW5jZSwge30pWzBdO1xyXG4gICAgICAgIHZhciBzcEluZGljYXRvcnMgPSBKU09OLnhwYXRoKFwiL3N1YnByb2Nlc3Nlc1tfaWQgZXEgJ1wiICsgc3ViUHJvY2Vzc1VVSUQgKyBcIiddL2luZGljYXRvcnMvaW5zdGFuY2VzL3V1aWRcIiwgX1dGSW5zdGFuY2UsIHt9KTtcclxuICAgICAgICB2YXIgaXRlbXNUb1Byb2Nlc3MgPSBzcEluZGljYXRvcnMubGVuZ3RoO1xyXG4gICAgICAgIHZhciB1cGRhdGVkT2JqZWN0c0FycmF5ID0gW107XHJcblxyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaXRlbXNUb1Byb2Nlc3M7IGkrKykge1xyXG5cclxuXHJcblxyXG4gICAgICAgICAgICBnYXRla2VlcGVyLmF1dGhvcmlzZShzcEluZGljYXRvcnNbaV0pLnRoZW4oZnVuY3Rpb24oYXV0aG9yaXNlZFJldHVybikge1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICBnYXRla2VlcGVyLnBlcnNpc3QoYXV0aG9yaXNlZFJldHVybikudGhlbihmdW5jdGlvbihzYXZlZEFycmF5KSB7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgdXVpZFNhdmVkSW5kaWNhdG9yID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgYyA9IDA7IGMgPCBzYXZlZEFycmF5Lmxlbmd0aDsgYysrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghc2F2ZWRBcnJheVtjXS5pZC5lbmRzV2l0aCgnOmFwcHJvdmVkJykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV1aWRTYXZlZEluZGljYXRvciA9IHNhdmVkQXJyYXlbY10uaWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZGFvLmdldCh1dWlkU2F2ZWRJbmRpY2F0b3IpLmRvbmUoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoX1dGSW5zdGFuY2UuaW5kaWNhdG9ycy5sZW5ndGggPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX1dGSW5zdGFuY2UuaW5kaWNhdG9ycy5wdXNoKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXNUb1Byb2Nlc3MtLTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtc1RvUHJvY2VzcyA9PSAwKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdGb3JtIGF1dGhvcmlzZWQgc3VjY2Vzc2Z1bGx5LicsIHVwZGF0ZWRPYmplY3RzQXJyYXkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZm91bmQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGluZGV4ID0gMDsgaW5kZXggPCBfV0ZJbnN0YW5jZS5pbmRpY2F0b3JzLmxlbmd0aDsgaW5kZXgrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbmRpY2F0b3IgPSBfV0ZJbnN0YW5jZS5pbmRpY2F0b3JzW2luZGV4XTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5kaWNhdG9yLl9pZCA9PSBkYXRhLl9pZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZSB0aGUgY3VycmVudCBpdGVtIGZyb20gdGhlIGFycmF5IGFuZCBhZGQgdGhlIHVwZGF0ZWQgcHJvY2Vzc01vZGVsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9XRkluc3RhbmNlLmluZGljYXRvcnMuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX1dGSW5zdGFuY2UuaW5kaWNhdG9ycy5wdXNoKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtc1RvUHJvY2Vzcy0tO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbXNUb1Byb2Nlc3MgPT0gMCkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdGb3JtIGF1dGhvcmlzZWQgc3VjY2Vzc2Z1bGx5LicsIHVwZGF0ZWRPYmplY3RzQXJyYXkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmb3VuZCA9PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9XRkluc3RhbmNlLmluZGljYXRvcnMucHVzaChkYXRhKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXNUb1Byb2Nlc3MtLTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbXNUb1Byb2Nlc3MgPT0gMCkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ0Zvcm0gYXV0aG9yaXNlZCBzdWNjZXNzZnVsbHkuJywgdXBkYXRlZE9iamVjdHNBcnJheSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pLmZhaWwoZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuXHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBpdGVtc1RvUHJvY2Vzcy0tO1xyXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW1zVG9Qcm9jZXNzID09IDApIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ0Zvcm0gYXV0aG9yaXNlZCBzdWNjZXNzZnVsbHkuJywgdXBkYXRlZE9iamVjdHNBcnJheSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG5cclxuICAgICAgICB9XHJcblxyXG5cclxuICAgIH0pO1xyXG59O1xyXG5cclxuZnVuY3Rpb24gY2xvc2UoZm9ybSkge1xyXG4gICAgdmFyIGNvbXBsZXRlZCA9IFtdO1xyXG4gICAgdmFyIHJlc3VsdCA9IHtcclxuICAgICAgICBjb21wbGV0ZTogdHJ1ZSxcclxuICAgICAgICBkYXRhOiBbXVxyXG4gICAgfTtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnRm9ybSBjbG9zZWQgc3VjY2Vzc2Z1bGx5LicsIHJlc3VsdCk7XHJcbiAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcclxuICAgIH0pO1xyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSB7XHJcblxyXG4gICAgY3JlYXRlOiBjcmVhdGUsXHJcbiAgICBzYXZlOiBzYXZlLFxyXG4gICAgc3VibWl0OiBzdWJtaXQsXHJcbiAgICBhdXRob3Jpc2U6IGF1dGhvcmlzZSxcclxuICAgIGNsb3NlOiBjbG9zZSxcclxuICAgIHNldERyYWZ0OiBzZXREcmFmdCxcclxuICAgIHNldFVuRHJhZnQ6IHNldFVuRHJhZnQsXHJcbiAgICBjcmVhdGVQcm9maWxlOiBjcmVhdGVQcm9maWxlLFxyXG4gICAgc2V0SW5zdGFuY2VUaXRsZTogc2V0SW5zdGFuY2VUaXRsZSxcclxuICAgIGRlbGV0ZVByb2ZpbGU6IGRlbGV0ZVByb2ZpbGVcclxuXHJcbn0iLCIndXNlIHN0cmljdCc7XHJcblxyXG52YXIgdXRpbCA9IHJlcXVpcmUoJ3V0aWxpdHknKTtcclxuXHJcbi8qKlxyXG4gKiBVc2VyIEludGVyZmFjZSBNb2R1bGVcclxuICpcclxuICogQG1vZHVsZSBsaWIvdWlcclxuICogQGF1dGhvciBCcmVudCBHb3Jkb25cclxuICogQHZlcnNpb24gMC4xLjBcclxuICogQGRlc2NyaXB0aW9uIHRlc3QgZGVzY3JpcHRpb25cclxuICpcclxuICovXHJcblxyXG4gLyoqXHJcbiAgKiBHZXQgYWxsIHByb2Nlc3Mgc3ViLXByb2Nlc3NlcyB1c2VyIGludGVyZmFjZSBkYXRhXHJcbiAgKlxyXG4gICogQHBhcmFtIHtzdHJpbmd9IHByb2Nlc3NJZCAtIHRoZSBXb3JrZmxvdyBjb25maWcgLyBkZWZpbml0aW9uIHByb2Nlc3MgaWRcclxuICAqIEBwYXJhbSB7c3RyaW5nfSBsYW5nIC0gdGhlIHVzZXIgcHJlZmZlcmVkIGxhbmdhdWdlXHJcbiAgKiBAcGFyYW0ge29iamVjdH0gX1dGSW5zdGFuY2UgLSB0aGUgY3VycmVudCB3b3JrZmxvdyBjb25zdHJ1Y3RvciBpbnN0YW5jZVxyXG4gICpcclxuICAqIEBleGFtcGxlICcnXHJcbiAgKlxyXG4gICogQHJldHVybiAnJ1xyXG4gICpcclxuICAqL1xyXG4gZnVuY3Rpb24gZ2V0UHJvY2Vzcyhwcm9jZXNzSWQsIGxhbmcsIF9XRkluc3RhbmNlKXtcclxuICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICB0cnkge1xyXG4gICAgICB2YXIgcHJvY2Vzc01vZGVsID0gW107XHJcbiAgICAgIHZhciBwcm9jZXNzSW5zdGFuY2UgPSBbXTtcclxuICAgIFx0X1dGSW5zdGFuY2UuaW5zdGFuY2UucHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihwcm9jZXNzSXRlbSl7XHJcbiAgICBcdFx0aWYgKHByb2Nlc3NJdGVtLmlkID09IHByb2Nlc3NJZCkge1xyXG4gICAgXHRcdFx0cHJvY2Vzc0luc3RhbmNlID0gcHJvY2Vzc0l0ZW07XHJcbiAgICBcdFx0fVxyXG4gICAgXHR9KVxyXG4gICAgICAvLyBjb25zb2xlLmxvZyhwcm9jZXNzSW5zdGFuY2Uuc3ViUHJvY2Vzc2VzLmxlbmd0aCk7XHJcbiAgICAgIHV0aWwuc3luY0xvb3AocHJvY2Vzc0luc3RhbmNlLnN1YlByb2Nlc3Nlcy5sZW5ndGgsIGZ1bmN0aW9uKGxvb3Ape1xyXG4gIFx0XHRcdHZhciBjb3VudGVyID0gbG9vcC5pdGVyYXRpb24oKTtcclxuICAgICAgICB2YXIgcHJvY2Vzc1NlcSA9IHByb2Nlc3NJbnN0YW5jZS5zZXE7XHJcbiAgICAgICAgdmFyIHN1YlByb2Nlc3NJZCA9IHByb2Nlc3NJbnN0YW5jZS5zdWJQcm9jZXNzZXNbY291bnRlcl0uaWQ7XHJcbiAgICAgICAgdmFyIHN1YlByb2Nlc3NTZXEgPSBwcm9jZXNzSW5zdGFuY2Uuc3ViUHJvY2Vzc2VzW2NvdW50ZXJdLnNlcTtcclxuICAgICAgICBnZXRTdWJQcm9jZXNzKHByb2Nlc3NJZCwgcHJvY2Vzc1NlcSwgc3ViUHJvY2Vzc0lkLCBzdWJQcm9jZXNzU2VxLCBsYW5nLCBfV0ZJbnN0YW5jZSkudGhlbihmdW5jdGlvbihtb2RlbCl7XHJcbiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhtb2RlbCk7XHJcbiAgICAgICAgICBwcm9jZXNzTW9kZWwucHVzaChtb2RlbCk7XHJcbiAgICAgICAgICBsb29wLm5leHQoKTtcclxuICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHByb2Nlc3NNb2RlbCk7XHJcbiAgXHRcdFx0fSwgZnVuY3Rpb24oZXJyKXtcclxuICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHByb2Nlc3NNb2RlbCk7XHJcbiAgXHRcdFx0XHRsb29wLmJyZWFrKCk7XHJcbiAgXHRcdFx0XHRyZWplY3QoZXJyKTtcclxuICBcdFx0XHR9KTtcclxuICBcdFx0fSwgZnVuY3Rpb24oKXtcclxuICAgICAgICAvLyBjb25zb2xlLmxvZyhwcm9jZXNzTW9kZWwpO1xyXG4gIFx0XHRcdHJlc29sdmUocHJvY2Vzc01vZGVsKTtcclxuICBcdFx0fSk7XHJcbiAgICB9IGNhdGNoKGVycil7XHJcbiAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgfVxyXG4gIH0pXHJcbn07XHJcblxyXG4gLyoqXHJcbiAgKiBHZXQgU3ViUHJvY2VzcyB1c2VyIGludGVyZmFjZSBkYXRhXHJcbiAgKlxyXG4gICogQHBhcmFtIHtzdHJpbmd9IHByb2Nlc3NJZCAtIHRoZSBXb3JrZmxvdyBjb25maWcgLyBkZWZpbml0aW9uIHByb2Nlc3MgaWRcclxuICAqIEBwYXJhbSB7bnVtYmVyfSBwcm9jZXNzU2VxIC0gdGhlIFdvcmtmbG93IGluc3RhbmNlIHByb2Nlc3Mgc2VxXHJcbiAgKiBAcGFyYW0ge3N0cmluZ30gc3ViUHJvY2Vzc0lkIC0gdGhlIFdvcmtmbG93IGNvbmZpZyAvIGRlZmluaXRpb24gc3ViLXByb2Nlc3MgaWRcclxuICAqIEBwYXJhbSB7bnVtYmVyfSBzdWJQcm9jZXNzU2VxIC0gdGhlIFdvcmtmbG93IGluc3RhbmNlIHN1Yi1wcm9jZXNzIHNlcVxyXG4gICogQHBhcmFtIHtvYmplY3R9IF9XRkluc3RhbmNlIC0gdGhlIGN1cnJlbnQgd29ya2Zsb3cgY29uc3RydWN0b3IgaW5zdGFuY2VcclxuICAqXHJcbiAgKiBAZXhhbXBsZSAnJ1xyXG4gICpcclxuICAqIEByZXR1cm4gJydcclxuICAqXHJcbiAgKi9cclxuZnVuY3Rpb24gZ2V0U3ViUHJvY2Vzcyhwcm9jZXNzSWQsIHByb2Nlc3NTZXEsIHN1YlByb2Nlc3NJZCwgc3ViUHJvY2Vzc1NlcSwgbGFuZywgX1dGSW5zdGFuY2Upe1xyXG4gIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIHZhciBtb2RlbCA9IHtcclxuICAgICAgICBpZDogJycsXHJcbiAgICAgICAgc2VxOiAnJyxcclxuICAgICAgICBuYW1lOiAnJyxcclxuICAgICAgICBoZWxwOiAnJyxcclxuICAgICAgICBkYXRlczogJycsXHJcbiAgICAgICAgc3RlcDogJydcclxuICAgICAgfTtcclxuICAgICAgdmFyIHN1YlByb2Nlc3MgPSBbXTtcclxuICAgIFx0dmFyIHN1YlByb2Nlc3NDb25mID0gW107XHJcbiAgICBcdF9XRkluc3RhbmNlLmluc3RhbmNlLnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24ocHJvY2Vzc0l0ZW0pe1xyXG4gICAgXHRcdGlmIChwcm9jZXNzSXRlbS5pZCA9PSBwcm9jZXNzSWQgJiYgcHJvY2Vzc0l0ZW0uc2VxID09IHByb2Nlc3NTZXEpIHtcclxuICAgIFx0XHRcdHZhciBzcExlbmd0aCA9IHByb2Nlc3NJdGVtLnN1YlByb2Nlc3Nlcy5sZW5ndGg7XHJcbiAgICBcdFx0XHRwcm9jZXNzSXRlbS5zdWJQcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKHN1YlByb2Nlc3NJdGVtKXtcclxuICAgIFx0XHRcdFx0aWYgKHN1YlByb2Nlc3NJdGVtLmlkID09IHN1YlByb2Nlc3NJZCAmJiBzdWJQcm9jZXNzSXRlbS5zZXEgPT0gc3ViUHJvY2Vzc1NlcSAmJiBzdWJQcm9jZXNzSXRlbS5jb21wbGV0ZSA9PSBmYWxzZSkge1xyXG4gICAgXHRcdFx0XHRcdHN1YlByb2Nlc3MgPSBzdWJQcm9jZXNzSXRlbTtcclxuICAgIFx0XHRcdFx0fVxyXG4gICAgXHRcdFx0fSlcclxuICAgIFx0XHR9XHJcbiAgICBcdH0pXHJcbiAgICBcdC8vIEdldCB0aGUgY3VycmVudCBzdWJQcm9jZXNzIGNvbmZpZ3VyYXRpb25cclxuICAgIFx0X1dGSW5zdGFuY2UuY29uZmlnLnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24ocHJvY2Vzc0NvbmZpZyl7XHJcbiAgICBcdFx0aWYgKHByb2Nlc3NDb25maWcuX2lkID09IHByb2Nlc3NJZCkge1xyXG4gICAgXHRcdFx0cHJvY2Vzc0NvbmZpZy5zdWJQcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKHN1YlByb2Nlc3NDb25maWcpe1xyXG4gICAgXHRcdFx0XHRpZiAoc3ViUHJvY2Vzc0NvbmZpZy5faWQgPT0gc3ViUHJvY2Vzc0lkKSB7XHJcbiAgICBcdFx0XHRcdFx0c3ViUHJvY2Vzc0NvbmYgPSBzdWJQcm9jZXNzQ29uZmlnO1xyXG4gICAgXHRcdFx0XHR9XHJcbiAgICBcdFx0XHR9KVxyXG4gICAgXHRcdH1cclxuICAgIFx0fSlcclxuICAgICAgLy8gVXBkYXRlIHRoZSBtb2RlbFxyXG4gICAgICBtb2RlbC5pZCA9IHN1YlByb2Nlc3NDb25mLl9pZDtcclxuICAgICAgbW9kZWwuc2VxID0gc3ViUHJvY2Vzcy5zZXE7XHJcbiAgICAgIG1vZGVsLm5hbWUgPSB1dGlsLmdldE5hbWUoc3ViUHJvY2Vzc0NvbmYubmFtZSwgbGFuZyk7XHJcbiAgICAgIG1vZGVsLmhlbHAgPSB1dGlsLmdldE5hbWUoc3ViUHJvY2Vzc0NvbmYuaGVscCwgbGFuZyk7XHJcbiAgICAgIG1vZGVsLmRhdGVzID0gc3ViUHJvY2Vzcy5kYXRlcztcclxuICAgICAgbW9kZWwuc3RlcCA9IHN1YlByb2Nlc3Muc3RlcDtcclxuICAgICAgcmVzb2x2ZShtb2RlbCk7XHJcbiAgICB9IGNhdGNoKGVycikge1xyXG4gICAgICByZWplY3QoZXJyKTtcclxuICAgIH1cclxuICB9KVxyXG59O1xyXG5cclxuXHJcblxyXG5cclxuZnVuY3Rpb24gcHJlcGFyZU5vdGlmaWNhdGlvblNjcmVlbigpe1xyXG5cclxuICBcIlwiXHJcbn07XHJcblxyXG4gbW9kdWxlLmV4cG9ydHMgPSB7XHJcblxyXG4gIGdldFByb2Nlc3M6IGdldFByb2Nlc3NcclxuXHJcbiB9XHJcbiIsIid1c2Ugc3RyaWN0JztcclxuXHJcbnZhciB1dGlsID0gcmVxdWlyZSgndXRpbGl0eScpO1xyXG52YXIgYWN0aW9uc01vZHVsZSA9IHJlcXVpcmUoJy4vYWN0aW9ucycpO1xyXG52YXIgZm9ybSA9IHJlcXVpcmUoJy4vZm9ybScpO1xyXG5cclxuXHJcbi8qKlxyXG4gKiBQcm9jZXNzIE1vZHVsZVxyXG4gKlxyXG4gKiBAbW9kdWxlIGxpYi9wcm9jZXNzXHJcbiAqIEBhdXRob3IgQnJlbnQgR29yZG9uXHJcbiAqIEB2ZXJzaW9uIDAuMS4wXHJcbiAqIEBkZXNjcmlwdGlvbiB0ZXN0IGRlc2NyaXB0aW9uXHJcbiAqXHJcbiAqL1xyXG5cclxuLyoqXHJcbiAqIENvdW50IGFuIGFycmF5IG9mIGl0ZW1zXHJcbiAqXHJcbiAqIEBwYXJhbSB7QXJyYXl9IGFyciAtIHRoZSBhcnJheSBkYXRhXHJcbiAqXHJcbiAqIEBleGFtcGxlICcnXHJcbiAqXHJcbiAqIEByZXR1cm4gJydcclxuICpcclxuICovXHJcbmZ1bmN0aW9uIGNvdW50KGFycikge1xyXG4gICAgaWYgKGFyciAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgcmV0dXJuIGFyci5sZW5ndGg7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiAwO1xyXG4gICAgfVxyXG5cclxufTtcclxuXHJcbi8qKlxyXG4gKiBQcm9jZXNzIHByZS1yZXF1aXNpdGVzXHJcbiAqXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBwcmVyZXF1aXNpdGVzIC0gdGhlIHByZS1yZXF1aXNpdGVzIGNvbmZpZyBkYXRhXHJcbiAqXHJcbiAqIEBleGFtcGxlICcnXHJcbiAqXHJcbiAqIEByZXR1cm4gJydcclxuICpcclxuICovXHJcbmZ1bmN0aW9uIHByZVJlcXVpc2l0ZXMocHJlcmVxdWlzaXRlcywgX1dGSW5zdGFuY2UpIHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAvLyBVbmNvbW1lbnQgYmVsb3cgc2VjdGlvbiB3aGVuIHJlYWR5IHRvIGltcGxlbWVudFxyXG4gICAgICAgIHZhciBjb21wbGV0ZWQgPSBbXTtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICB1dGlsLnN5bmNMb29wKHByZXJlcXVpc2l0ZXMubGVuZ3RoLCBmdW5jdGlvbihsb29wKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY291bnRlciA9IGxvb3AuaXRlcmF0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICBwcmVSZXF1aXNpdGUocHJlcmVxdWlzaXRlc1tjb3VudGVyXSwgX1dGSW5zdGFuY2UpLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIGFsbCBwcmUtcmVxdWlzaXRlcyBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5LlxyXG4gICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZC5wdXNoKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxvb3AubmV4dCgpO1xyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkLnB1c2goZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxvb3AuYnJlYWsoKTtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIGlmIChjb21wbGV0ZWQuZXZlcnkoQm9vbGVhbikpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnUHJlLXJlcXVpc2l0ZXMgY29tcGxldGVkIHN1Y2Nlc3NmdWxseS4nLCB7fSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yID0gdXRpbC5lcnJvcignV0ZQcmVSZXF1aXNpdGVFcnJvcicsICdOb3QgYWxsIHByZS1yZXF1aXNpdGVzIHBhc3NlZC4nKTtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn07XHJcblxyXG4vKipcclxuICogUHJvY2VzcyBwcmUtcmVxdWlzaXRlLCBleGVjdXRlIHRoZSBwcmUtcmVxdWlzaXRlIGNvbmRpdGlvbi5cclxuICpcclxuICogQHBhcmFtIHtvYmplY3R9IHByZXJlcXVpc2l0ZSAtIHRoZSBwcmUtcmVxdWlzaXRlIGNvbmZpZyBkYXRhXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBfV0ZJbnN0YW5jZSAtIHRoZSB3b3JrZmxvdyBjb25zdHJ1Y3RvciBpbnN0YW5jZVxyXG4gKlxyXG4gKiBAZXhhbXBsZVxyXG4gKiBQcm9jZXNzLnByZVJlcXVpc2l0ZShjb25maWcsIGNvdW50ZXIsIGluc3RhbmNlLCBkb2MpO1xyXG4gKlxyXG4gKiBAcmV0dXJuICcnXHJcbiAqXHJcbiAqL1xyXG5mdW5jdGlvbiBwcmVSZXF1aXNpdGUocHJlcmVxdWlzaXRlLCBfV0ZJbnN0YW5jZSkge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIHN3aXRjaCAocHJlcmVxdWlzaXRlLl90eXBlKSB7XHJcbiAgICAgICAgICAgIC8vIFRPRE86IEFkZCB0aGUgY2FsbCB0byB0aGUgcmVsZXZhbnQgbWV0aG9kcyBiYXNlZCBvbiB0aGUgX3R5cGUgYXR0cmlidXRlLiBTaG91bGQgY2FsbCB0aGUgZ2VuZXJpYyBhY3Rpb24oKSBtZXRob2QuXHJcbiAgICAgICAgICAgIGNhc2UgJ3Byb2Nlc3NJbnN0YW5jZXMnOlxyXG4gICAgICAgICAgICAgICAgdHJ5IHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlkID0gcHJlcmVxdWlzaXRlLl9wYXJhbWV0ZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIF9maWx0ZXIgPSBwcmVyZXF1aXNpdGUuX2ZpbHRlcjtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3ViamVjdENvdW50ID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKF9maWx0ZXIgIT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfZmlsdGVyT3BlcmF0b3IgPSBfZmlsdGVyLl9vcGVyYXRvcjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHhwYXRoT3BlcmF0b3IgPSAnJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfZmlsdGVyT3BlcmF0b3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2dyZWF0ZXJUaGFuJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4cGF0aE9wZXJhdG9yID0gJ2d0JztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2xlc3NUaGFuJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4cGF0aE9wZXJhdG9yID0gJ2x0JztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2dyZWF0ZXJUaGFuRXF1YWwnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhwYXRoT3BlcmF0b3IgPSAnZ2UnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnbGVzc1RoYW5FcXVhbCc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeHBhdGhPcGVyYXRvciA9ICdsZSc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdlcXVhbFRvJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4cGF0aE9wZXJhdG9yID0gJ2VxJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ25vdEVxdWFsVG8nOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhwYXRoT3BlcmF0b3IgPSAnbmUnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfZmlsdGVyRWxlbWVudCA9IF9maWx0ZXIuX2VsZW1lbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfZmlsdGVyRWxlbWVudCA9IF9maWx0ZXJFbGVtZW50LnNwbGl0KCcuJykuam9pbignLycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgX2ZpbHRlclZhbHVlID0gX2ZpbHRlci5fdmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbm5lclhwYXRoID0gXCIvXCIgKyBfZmlsdGVyRWxlbWVudCArIFwiWy4gZXEgJ1wiICsgX2ZpbHRlclZhbHVlICsgXCInXVwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZnVsbFBhdGggPSBcImNvdW50KC9zdWJwcm9jZXNzZXNbaWQgZXEgJ1wiICsgaWQgKyBcIiddXCIgKyBpbm5lclhwYXRoICsgXCIpXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1YmplY3RDb3VudCA9IEpTT04ueHBhdGgoZnVsbFBhdGgsIF9XRkluc3RhbmNlLCB7fSlbMF07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1YmplY3RDb3VudCA9IEpTT04ueHBhdGgoXCJjb3VudCgvc3VicHJvY2Vzc2VzW2lkIGVxICdcIiArIGlkICsgXCInXSlcIiwgX1dGSW5zdGFuY2UsIHt9KVswXTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbXBhcmUgPSB1dGlsLmNvbXBhcmUoc3ViamVjdENvdW50LCBwcmVyZXF1aXNpdGUuX29wZXJhdG9yLCBwYXJzZUludChwcmVyZXF1aXNpdGUuX3ZhbHVlKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbXBhcmUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ1ByZS1yZXF1aXNpdGVzIHBhc3NlZC4nLCB7fSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSAnJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgcHJlcmVxdWlzaXRlLm1lc3NhZ2UuaTE4bi5maWx0ZXIoZnVuY3Rpb24oaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uX2xhbmcgPT0gJ2VuJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSBpdGVtLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlcnJvciA9IHV0aWwuZXJyb3IoJ1dGUHJlUmVxdWlzaXRlRXJyb3InLCBtZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIHZhciBlcnJvciA9IHV0aWwuZXJyb3IoJ1dGUHJlUmVxdWlzaXRlRXJyb3InLCAnUHJlLXJlcXVpc2l0ZSB0eXBlOiAnICsgcHJlcmVxdWlzaXRlLl90eXBlICsgJyBub3QgZGVmaW5lZC4nKTtcclxuICAgICAgICAgICAgICAgIHJlamVjdChlcnJvcik7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn07XHJcblxyXG4vKipcclxuICogUHJvY2VzcyBwcmUtYWN0aW9uc3NcclxuICpcclxuICogQHBhcmFtIHtvYmplY3R9IHByZUFjdGlvbnMgLSB0aGUgcHJlLWFjdGlvbnMgY29uZmlnIGRhdGFcclxuICogQHBhcmFtIHtvYmplY3R9IF9XRkluc3RhbmNlIC0gdGhlIGN1cnJlbnQgd29ya2Zsb3cgY29uc3RydWN0b3IgaW5zdGFuY2VcclxuICpcclxuICogQGV4YW1wbGUgJydcclxuICpcclxuICogQHJldHVybiAnJ1xyXG4gKlxyXG4gKi9cclxuZnVuY3Rpb24gcHJlQWN0aW9ucyhwcmVBY3Rpb25zLCBfV0ZJbnN0YW5jZSkge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIHZhciBjb21wbGV0ZWQgPSBbXTtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICB1dGlsLnN5bmNMb29wKHByZUFjdGlvbnMubGVuZ3RoLCBmdW5jdGlvbihsb29wKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY291bnRlciA9IGxvb3AuaXRlcmF0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICBhY3Rpb24ocHJlQWN0aW9uc1tjb3VudGVyXSwgX1dGSW5zdGFuY2UpLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIGFsbCBwcmUtcmVxdWlzaXRlcyBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5LlxyXG4gICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZC5wdXNoKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxvb3AubmV4dCgpO1xyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkLnB1c2goZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxvb3AuYnJlYWsoKTtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIGlmIChjb21wbGV0ZWQuZXZlcnkoQm9vbGVhbikpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnUHJlLWFjdGlvbnMgY29tcGxldGVkIHN1Y2Nlc3NmdWxseS4nLCB7fSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yID0gdXRpbC5lcnJvcignV0ZQcmVSZXF1aXNpdGVFcnJvcicsICdOb3QgYWxsIHByZS1hY3Rpb25zIHBhc3NlZC4nKTtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn07XHJcblxyXG4vKipcclxuICogV29ya2Zsb3cgZ2V0IHN1Yi1wcm9jZXNzIGRhdGEuXHJcbiAqXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBpZCAtIHRoZSBzdWJQcm9jZXNzIGNvbmZpZyBpZFxyXG4gKiBAcGFyYW0ge29iamVjdH0gX1dGSW5zdGFuY2UgLSB0aGUgY3VycmVudCB3b3JrZmxvdyBjb25zdHJ1Y3RvciBpbnN0YW5jZVxyXG4gKlxyXG4gKiBAZXhhbXBsZSBcIlwiXHJcbiAqXHJcbiAqIEByZXR1cm4gXCJcIlxyXG4gKlxyXG4gKi9cclxuZnVuY3Rpb24gZ2V0U3ViUHJvY2VzcyhpZCwgX1dGSW5zdGFuY2UpIHtcclxuICAgIGlmIChfV0ZJbnN0YW5jZS5zdWJwcm9jZXNzZXMgPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgcmV0dXJuIFtdO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBfV0ZJbnN0YW5jZS5zdWJwcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKHN1YlByb2Nlc3MpIHtcclxuICAgICAgICAgICAgaWYgKHN1YlByb2Nlc3MuaWQgPT0gaWQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBzdWJQcm9jZXNzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG59O1xyXG5cclxuLyoqXHJcbiAqIFByb2Nlc3Mgc3ViLXByb2Nlc3NcclxuICpcclxuICogQHBhcmFtIHtvYmplY3R9IHByb2Nlc3MgLSB0aGUgY3VycmVudCBwcm9jZXNzIGlkIGFuZCBzZXFcclxuICogQHBhcmFtIHtvYmplY3R9IHN1YlByb2Nlc3MgLSB0aGUgc3ViLXByb2Nlc3MgaWQgYW5kIHNlcVxyXG4gKiBAcGFyYW0ge29iamVjdH0gZGF0YSAtIHRoZSB1c2VyIGlucHV0IGRhdGFcclxuICogQHBhcmFtIHtvYmplY3R9IF9XRkluc3RhbmNlIC0gdGhlIGN1cnJlbnQgd29ya2Zsb3cgY29uc3RydWN0b3IgaW5zdGFuY2VcclxuICpcclxuICogQGV4YW1wbGUgJydcclxuICpcclxuICogQHJldHVybiAnJ1xyXG4gKlxyXG4gKi9cclxuZnVuY3Rpb24gc3ViUHJvY2Vzcyhwcm9jZXNzSWQsIHByb2Nlc3NTZXEsIHN1YlByb2Nlc3NJZCwgc3ViUHJvY2Vzc1NlcSwgZGF0YSwgX1dGSW5zdGFuY2UpIHtcclxuICAgIC8vIEdldCB0aGUgY3VycmVudCBwcm9jZXNzIHN1YlByb2Nlc3MgaW5zdGFuY2VcclxuICAgIC8vIHZhciBzdWJQcm9jZXNzU2VxID0gMTtcclxuICAgIHZhciBzdWJQcm9jZXNzID0gW107XHJcbiAgICB2YXIgcHJvY2Vzc0NvbmYgPSBbXTtcclxuICAgIHZhciBzdWJQcm9jZXNzQ29uZiA9IFtdO1xyXG4gICAgX1dGSW5zdGFuY2UuaW5zdGFuY2UucHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihvYmpQcm9jZXNzKSB7XHJcbiAgICAgICAgICAgIGlmIChvYmpQcm9jZXNzLmlkID09IHByb2Nlc3NJZCAmJiBvYmpQcm9jZXNzLnNlcSA9PSBwcm9jZXNzU2VxKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc3BMZW5ndGggPSBvYmpQcm9jZXNzLnN1YlByb2Nlc3Nlcy5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICBvYmpQcm9jZXNzLnN1YlByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24ob2JqU3ViUHJvY2Vzcykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmpTdWJQcm9jZXNzLmlkID09IHN1YlByb2Nlc3NJZCAmJiBvYmpTdWJQcm9jZXNzLnNlcSA9PSBzdWJQcm9jZXNzU2VxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1dWlkID0gb2JqU3ViUHJvY2Vzcy51dWlkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfV0ZJbnN0YW5jZS5zdWJwcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKHN1YlByb2Nlc3NJdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3ViUHJvY2Vzc0l0ZW0uX2lkID09IHV1aWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJQcm9jZXNzID0gc3ViUHJvY2Vzc0l0ZW07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLy8gR2V0IHRoZSBjdXJyZW50IHN1YlByb2Nlc3MgY29uZmlndXJhdGlvblxyXG4gICAgX1dGSW5zdGFuY2UuY29uZmlnLnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24ocHJvY2Vzc0NvbmZpZykge1xyXG4gICAgICAgICAgICBpZiAocHJvY2Vzc0NvbmZpZy5faWQgPT0gcHJvY2Vzc0lkKSB7XHJcbiAgICAgICAgICAgICAgICBwcm9jZXNzQ29uZiA9IHByb2Nlc3NDb25maWc7XHJcbiAgICAgICAgICAgICAgICBwcm9jZXNzQ29uZmlnLnN1YlByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24oc3ViUHJvY2Vzc0NvbmZpZykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzdWJQcm9jZXNzQ29uZmlnLl9pZCA9PSBzdWJQcm9jZXNzSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3ViUHJvY2Vzc0NvbmYgPSBzdWJQcm9jZXNzQ29uZmlnO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICAgIC8vIGlmIChzdWJQcm9jZXNzLmxlbmd0aCAhPT0gMCkge1xyXG4gICAgICAgIC8vIFx0c3ViUHJvY2Vzc1NlcSA9IHN1YlByb2Nlc3MubGVuZ3RoICsgMTtcclxuICAgICAgICAvLyB9XHJcbiAgICAgICAgLy8gVGhlIGRlZmF1bHQgc3ViUHJvY2VzcyBtb2RlbFxyXG5cclxuICAgIC8vVE9ETzogQ2hhbmdlIHJlcXVpcmVkIHRvIG1vdmUgaXNBY3RpdmUgdG8gc3ViUHJvY2VzcyBmaWxlLkhlcmVcclxuXHJcbiAgICB2YXIgZ3JvdXBLZXkgPSAnJztcclxuICAgIHZhciBiYXNlVVVJRCA9IGRhdGEuYmFzZVVVSUQ7XHJcbiAgICBpZiAoYmFzZVVVSUQgIT0gdW5kZWZpbmVkICYmIGJhc2VVVUlEICE9ICcnICYmIGJhc2VVVUlELmxlbmd0aCA+IDApIHtcclxuICAgICAgICB2YXIgcHJldmlvdXNPYmplY3QgPSBKU09OLnhwYXRoKFwiL3N1YnByb2Nlc3Nlc1tfaWQgZXEgJ1wiICsgYmFzZVVVSUQgKyBcIiddXCIsIF9XRkluc3RhbmNlLCB7fSlbMF07XHJcbiAgICAgICAgZ3JvdXBLZXkgPSBwcmV2aW91c09iamVjdC5ncm91cEtleTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgZ3JvdXBLZXkgPSBnZW5lcmF0ZVVVSUQoKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgdmFyIHN1YlByb2Nlc3NPYmplY3RJZCA9IF9XRkluc3RhbmNlLnByb2ZpbGUgKyAnOicgKyBfV0ZJbnN0YW5jZS5hcHAgKyAnOicgKyBwcm9jZXNzSWQgKyAnOicgKyBwcm9jZXNzU2VxICsgJzonICsgc3ViUHJvY2Vzc0lkICsgJzonICsgc3ViUHJvY2Vzc1NlcTtcclxuICAgIHZhciBtb2RlbCA9IHtcclxuICAgICAgICBfaWQ6IHN1YlByb2Nlc3NPYmplY3RJZCxcclxuICAgICAgICBpZDogc3ViUHJvY2Vzc0lkLFxyXG4gICAgICAgIHR5cGU6ICd3b3JrZmxvd0luc3RhbmNlU3ViUHJvY2VzcycsXHJcbiAgICAgICAgc2VxOiBzdWJQcm9jZXNzU2VxLFxyXG4gICAgICAgIGluaXRpYXRlZDogZmFsc2UsXHJcbiAgICAgICAgZGF0ZXM6IHtcclxuICAgICAgICAgICAgY3JlYXRlZDogJycsXHJcbiAgICAgICAgICAgIHZhbGlkOiAnJyxcclxuICAgICAgICAgICAgZHVlOiAnJyxcclxuICAgICAgICAgICAgY2xvc2VkOiAnJ1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgY29tcGxldGU6IGZhbHNlLFxyXG4gICAgICAgIGluZGljYXRvcnM6IFtdLFxyXG4gICAgICAgIHN0ZXA6IHt9LFxyXG4gICAgICAgIGFjdGl2ZTogdHJ1ZSxcclxuICAgICAgICBncm91cEtleTogZ3JvdXBLZXksXHJcbiAgICAgICAgY2hhbm5lbHM6IFtcclxuICAgICAgICAgICAgXCJjb21tdW5pdHlfXCIgKyBhcHAuU0NPUEUuY29tbXVuaXR5SWQsXHJcbiAgICAgICAgICAgIFwicHJvZmlsZV9cIiArIGFwcC5TQ09QRS5wcm9maWxlSWQsXHJcbiAgICAgICAgICAgIFwiYXBwbGljYXRpb25fXCIgKyBhcHAuU0NPUEUuYXBwbGljYXRpb25JZCxcclxuICAgICAgICAgICAgXCJjb21tdW5pdHlfXCIgKyBhcHAuU0NPUEUuY29tbXVuaXR5SWQgKyBcIl9hcHBsaWNhdGlvbl9cIiArIGFwcC5TQ09QRS5hcHBsaWNhdGlvbklkXHJcbiAgICAgICAgXVxyXG4gICAgfTtcclxuICAgIF9XRkluc3RhbmNlLnN1YnByb2Nlc3Nlcy5wdXNoKG1vZGVsKTtcclxuICAgIC8vIFJldHVybiBhIHByb21pc2VcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAvLyBDYXRjaCBhbGwgdW5jYXVnaHQgZXJyb3JzXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgLy8gMS4gUHJvY2VzcyB0aGUgcHJlLWFjdGlvbnNcclxuICAgICAgICAgICAgdmFyIHByZUFjdGlvbnNDb25mID0gcHJvY2Vzc0NvbmYucHJlQWN0aW9ucztcclxuICAgICAgICAgICAgcHJlQWN0aW9ucyhwcmVBY3Rpb25zQ29uZiwgX1dGSW5zdGFuY2UpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAvLyAyLiBQcm9jZXNzIHRoZSBwcmUtcmVxdWlzaXRlc1xyXG4gICAgICAgICAgICAgICAgdmFyIHByZXJlcXVpc2l0ZUNvbmYgPSBwcm9jZXNzQ29uZi5wcmVyZXF1aXNpdGVzO1xyXG4gICAgICAgICAgICAgICAgcHJlUmVxdWlzaXRlcyhwcmVyZXF1aXNpdGVDb25mLCBfV0ZJbnN0YW5jZSkudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyAzLiBJbml0aWF0ZSB0aGUgc3ViUHJvY2Vzc1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpbml0aWF0ZUNvbmYgPSBzdWJQcm9jZXNzQ29uZi5pbml0aWF0ZTtcclxuICAgICAgICAgICAgICAgICAgICBpbml0aWF0ZShpbml0aWF0ZUNvbmYsIHN1YlByb2Nlc3MsIGRhdGEpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vVXBkYXRlIHRoZSBzdWJQcm9jZXNzIG1vZGVsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsLmluaXRpYXRlZCA9IHJlc3VsdC5kYXRhLmluaXRpYXRlZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWwuZGF0ZXMgPSByZXN1bHQuZGF0YS5kYXRlcztcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gRXhlY3V0ZSB0aGUgZmlyc3Qgc3RlcFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3RlcElkID0gc3ViUHJvY2Vzc0NvbmYuc3RlcHNbMF0uX2lkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdHJhbnNpdGlvbklkID0gc3ViUHJvY2Vzc0NvbmYuc3RlcHNbMF0udHJhbnNpdGlvbnNbMF0uX2lkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3RlcFNlcSA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0ZXAocHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIHN0ZXBJZCwgc3RlcFNlcSwgZGF0YSwgX1dGSW5zdGFuY2UpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlbC5zdGVwID0gcmVzdWx0LmRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSBpbmRpY2F0b3Igc2VjdGlvbnMgb2YgdGhlIHN1YlByb2Nlc3NcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kaWNhdG9ycyhzdWJQcm9jZXNzQ29uZi5pbmRpY2F0b3JzLCBfV0ZJbnN0YW5jZSwgbW9kZWwuX2lkKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWwuaW5kaWNhdG9ycyA9IHJlc3VsdC5kYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBFeGVjdXRlIHRoZSB0cmFuc2l0aW9ucywgaWYgYXV0b1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2l0aW9uKHByb2Nlc3NJZCwgcHJvY2Vzc1NlcSwgc3ViUHJvY2Vzc0lkLCBzdWJQcm9jZXNzU2VxLCBzdGVwSWQsIHRyYW5zaXRpb25JZCwgZGF0YSwgX1dGSW5zdGFuY2UpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgdGhlIHN1YlByb2Nlc3Mgc3RlcCBkYXRhXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdHJhbnNSZXN1bHQgPSByZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlbC5zdGVwID0gcmVzdWx0LmRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyA0LiBQcm9jZXNzIHRoZSBwb3N0LWFjdGlvbnNcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwb3N0QWN0aW9uc0NvbmYgPSBwcm9jZXNzQ29uZi5wb3N0QWN0aW9ucztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3RBY3Rpb25zKHBvc3RBY3Rpb25zQ29uZiwgX1dGSW5zdGFuY2UpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3ModHJhbnNSZXN1bHQubWVzc2FnZSwgbW9kZWwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfV0ZJbnN0YW5jZS5zdWJwcm9jZXNzZXMgPSBfV0ZJbnN0YW5jZS5zdWJwcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKG9iaikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICEob2JqLl9pZCA9PSBzdWJQcm9jZXNzT2JqZWN0SWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIF9XRkluc3RhbmNlLnN1YnByb2Nlc3NlcyA9IF9XRkluc3RhbmNlLnN1YnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24ob2JqKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhKG9iai5faWQgPT0gc3ViUHJvY2Vzc09iamVjdElkKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgX1dGSW5zdGFuY2Uuc3VicHJvY2Vzc2VzID0gX1dGSW5zdGFuY2Uuc3VicHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihvYmopIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gIShvYmouX2lkID09IHN1YlByb2Nlc3NPYmplY3RJZCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBQcm9jZXNzIGluaXRpYXRlXHJcbiAqXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBpbml0aWF0ZSAtIHRoZSBpbml0aWF0ZSBjb25maWcgZGF0YVxyXG4gKiBAcGFyYW0ge29iamVjdH0gZGF0YSAtIHRoZSB1c2VyIGlucHV0IGRhdGFcclxuICpcclxuICogQGV4YW1wbGUgJydcclxuICpcclxuICogQHJldHVybiAnJ1xyXG4gKlxyXG4gKi9cclxuZnVuY3Rpb24gaW5pdGlhdGUoaW5pdGlhdGUsIHN1YlByb2Nlc3MsIGRhdGEpIHtcclxuICAgIHZhciBjb21wbGV0ZWQgPSBbXTtcclxuICAgIHZhciByZXN1bHQgPSB7XHJcbiAgICAgICAgaW5pdGlhdGVkOiBmYWxzZSxcclxuICAgICAgICBkYXRlczoge1xyXG4gICAgICAgICAgICBjcmVhdGVkOiAnJyxcclxuICAgICAgICAgICAgdmFsaWQ6ICcnLFxyXG4gICAgICAgICAgICBkdWU6ICcnLFxyXG4gICAgICAgICAgICBjbG9zZWQ6ICcnXHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgdmFyIGluaXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgc3dpdGNoIChpbml0aWF0ZS5fdHlwZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAndXNlcic6XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIHN1YlByb2Nlc3MgaW5pdGlhdGlvbiBpcyB1c2VyIGRlZmluZWQgdGhlblxyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5kYXRlcy5jcmVhdGVkID0gZGF0YS5jcmVhdGVkRGF0ZTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaW5pdGlhdGUuZGF0ZXMudmFsaWQuX3R5cGUgPT0gJ3VzZXJTZWxlY3RlZCcgfHwgaW5pdGlhdGUuZGF0ZXMudmFsaWQuX3R5cGUgPT0gJ2F1dG9TZWxlY3RlZCcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEudmFsaWREYXRlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5kYXRlcy52YWxpZCA9IGRhdGEudmFsaWREYXRlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXRpbC53YXJuKCdXRkluaXRpYXRlRXJyb3InLCAnTm8gdmFsaWQgZGF0ZSBwYXNzZWQgaW4gLSB7ZGF0YS52YWxpZERhdGV9Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGluaXRpYXRlLmRhdGVzLmR1ZS5fdHlwZSA9PSAndXNlclNlbGVjdGVkJyB8fCBpbml0aWF0ZS5kYXRlcy52YWxpZC5fdHlwZSA9PSAnYXV0b1NlbGVjdGVkJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5kdWVEYXRlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5kYXRlcy5kdWUgPSBkYXRhLmR1ZURhdGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dGlsLndhcm4oJ1dGSW5pdGlhdGVFcnJvcicsICdObyBkdWUgZGF0ZSBwYXNzZWQgaW4gLSB7ZGF0YS5kdWVEYXRlfScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5pbml0aWF0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdTdWItUHJvY2VzcyBpbml0aWF0ZSBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5LicsIHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ2F1dG8nOlxyXG4gICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSBzdWJQcm9jZXNzIGluaXRpYXRpb24gaXMgdXNlciBkZWZpbmVkIHRoZW5cclxuICAgICAgICAgICAgICAgICAgICByZXN1bHQuZGF0ZXMuY3JlYXRlZCA9IGRhdGEuY3JlYXRlZERhdGU7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGluaXRpYXRlLmRhdGVzLnZhbGlkLl90eXBlID09ICd1c2VyU2VsZWN0ZWQnIHx8IGluaXRpYXRlLmRhdGVzLnZhbGlkLl90eXBlID09ICdhdXRvU2VsZWN0ZWQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLnZhbGlkRGF0ZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuZGF0ZXMudmFsaWQgPSBkYXRhLnZhbGlkRGF0ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0aWwud2FybignV0ZJbml0aWF0ZUVycm9yJywgJ05vIHZhbGlkIGRhdGUgcGFzc2VkIGluIC0ge2RhdGEudmFsaWREYXRlfScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpbml0aWF0ZS5kYXRlcy5kdWUuX3R5cGUgPT0gJ3VzZXJTZWxlY3RlZCcgfHwgaW5pdGlhdGUuZGF0ZXMuZHVlLl90eXBlID09ICdhdXRvU2VsZWN0ZWQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLmR1ZURhdGUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmRhdGVzLmR1ZSA9IGRhdGEuZHVlRGF0ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0aWwud2FybignV0ZJbml0aWF0ZUVycm9yJywgJ05vIGR1ZSBkYXRlIHBhc3NlZCBpbiAtIHtkYXRhLmR1ZURhdGV9Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmluaXRpYXRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ1N1Yi1Qcm9jZXNzIGluaXRpYXRlIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkuJywgcmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3IgPSB1dGlsLmVycm9yKCdXRkluaXRpYXRlRXJyb3InLCAnSW5pdGlhdGUgdHlwZTogJyArIGluaXRpYXRlLl90eXBlICsgJyBub3QgZGVmaW5lZC4nKTtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChzdWJQcm9jZXNzLmNvbXBsZXRlID09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICBpbml0KCk7XHJcbiAgICAgICAgfSBlbHNlIGlmICghc3ViUHJvY2Vzcy5jb21wbGV0ZSkge1xyXG4gICAgICAgICAgICBpZiAoaW5pdGlhdGUucGFyYWxsZWxJbnN0YW5jZXMpIHtcclxuICAgICAgICAgICAgICAgIGluaXQoKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHZhciBlcnJvciA9IHV0aWwuZXJyb3IoJ1dGSW5pdGlhdGVFcnJvcicsICdTdWItcHJvY2VzczogJyArIHN1YlByb2Nlc3MuaWQgKyAnIHN0aWxsIGFjdGl2ZSBhbmQgcGFyYWxsZWwgaW5zdGFuY2VzIGFyZSBub3QgYWxsb3dlZC4nKTtcclxuICAgICAgICAgICAgICAgIHJlamVjdChlcnJvcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgfSk7XHJcbn07XHJcblxyXG4vKipcclxuICogUHJvY2VzcyBzdGVwXHJcbiAqXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBwcm9jZXNzSWQgLSB0aGUgY3VycmVudCBwcm9jZXNzIGlkXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdWJQcm9jZXNzSWQgLSB0aGUgY3VycmVudCBzdWItcHJvY2VzcyBpZFxyXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RlcElkIC0gdGhlIGN1cnJlbnQgc3ViLXByb2Nlc3Mgc3RlcCBpZFxyXG4gKiBAcGFyYW0ge251bWJlcn0gc3RlcFNlcSAtIHRoZSBjdXJyZW50IHN1Yi1wcm9jZXNzIHN0ZXAgaW5zdGFuY2UgY291bnRlciAvIHNlcXVlbmNlXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBkYXRhIC0gdGhlIHVzZXIgaW5wdXQgZGF0YVxyXG4gKiBAcGFyYW0ge29iamVjdH0gX1dGSW5zdGFuY2UgLSB0aGUgY3VycmVudCBfV0ZJbnN0YW5jZSBjb25zdHJ1Y3RvciBpbnN0YW5jZVxyXG4gKlxyXG4gKiBAZXhhbXBsZSAnJ1xyXG4gKlxyXG4gKiBAcmV0dXJuICcnXHJcbiAqXHJcbiAqL1xyXG5mdW5jdGlvbiBzdGVwKHByb2Nlc3NJZCwgcHJvY2Vzc1NlcSwgc3ViUHJvY2Vzc0lkLCBzdWJQcm9jZXNzU2VxLCBzdGVwSWQsIHN0ZXBTZXEsIGRhdGEsIF9XRkluc3RhbmNlKSB7XHJcblxyXG5cclxuICAgIC8vIERlZmF1bHQgc3RlcCBtb2RlbFxyXG4gICAgdmFyIG1vZGVsID0ge1xyXG4gICAgICAgIGlkOiAnJyxcclxuICAgICAgICBzZXE6ICcnLFxyXG4gICAgICAgIHN0YXR1czogJycsXHJcbiAgICAgICAgbWVzc2FnZTogJycsXHJcbiAgICAgICAgYXNzaWduZWRUbzoge1xyXG4gICAgICAgICAgICB1c2VySWQ6ICcnLFxyXG4gICAgICAgICAgICBuYW1lOiAnJ1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgYXNzaWdubWVudDoge30sXHJcbiAgICAgICAgY29tbWVudDogJydcclxuICAgIH07XHJcbiAgICB2YXIgc3ViUHJvY2VzcyA9IHt9O1xyXG4gICAgdmFyIHV1aWQgPSAnJztcclxuICAgIHZhciBpbnN0U3ViUHJvY2VzcztcclxuICAgIHZhciBzdGVwID0ge307XHJcbiAgICB2YXIgdHJhbnNpdGlvbklkID0gJyc7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgLy9HZXQgdGhlIGN1cnJlbnQgc3ViUHJvY2VzcyBpbnN0YW5jZSBkYXRhXHJcblxyXG5cclxuXHJcbiAgICAgICAgICAgIF9XRkluc3RhbmNlLmluc3RhbmNlLnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24ob2JqUHJvY2Vzcykge1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAob2JqUHJvY2Vzcy5pZCA9PSBwcm9jZXNzSWQgJiYgb2JqUHJvY2Vzcy5zZXEgPT0gcHJvY2Vzc1NlcSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9ialByb2Nlc3Muc3ViUHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihvYmpTdWJQcm9jZXNzKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqU3ViUHJvY2Vzcy5pZCA9PSBzdWJQcm9jZXNzSWQgJiYgb2JqU3ViUHJvY2Vzcy5zZXEgPT0gc3ViUHJvY2Vzc1NlcSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXVpZCA9IG9ialN1YlByb2Nlc3MudXVpZDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICBfV0ZJbnN0YW5jZS5zdWJwcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKHN1YlByb2Nlc3NJdGVtKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoc3ViUHJvY2Vzc0l0ZW0uX2lkID09IHV1aWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpbnN0U3ViUHJvY2VzcyA9IHN1YlByb2Nlc3NJdGVtO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICBfV0ZJbnN0YW5jZS5jb25maWcucHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihvYmpQcm9jZXNzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAob2JqUHJvY2Vzcy5faWQgPT0gcHJvY2Vzc0lkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqUHJvY2Vzcy5zdWJQcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKG9ialN1YlByb2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9ialN1YlByb2Nlc3MuX2lkID09IHN1YlByb2Nlc3NJZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ViUHJvY2VzcyA9IG9ialN1YlByb2Nlc3M7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmpTdWJQcm9jZXNzLnN0ZXBzLmZpbHRlcihmdW5jdGlvbihvYmpTdGVwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9ialN0ZXAuX2lkID09IHN0ZXBJZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGVwID0gb2JqU3RlcDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgc3ViLXByb2Nlc3Mgc3RlcCBkYXRhXHJcbiAgICAgICAgICAgIG1vZGVsLmlkID0gc3RlcElkO1xyXG4gICAgICAgICAgICBtb2RlbC5zZXEgPSBzdGVwU2VxO1xyXG4gICAgICAgICAgICBtb2RlbC5zdGF0dXMgPSBzdGVwLl9zZXRJbnN0YW5jZVN0YXR1c1RvO1xyXG4gICAgICAgICAgICBtb2RlbC5tZXNzYWdlID0gc3RlcC5fc2V0U3RhdHVzTXNnVG87XHJcbiAgICAgICAgICAgIC8vbW9kZWwuYXNzaWduZWRUby51c2VySWQgPSBkYXRhLnVzZXJJZCAhPT0gdW5kZWZpbmVkID8gZGF0YS51c2VySWQgOiAnJztcclxuICAgICAgICAgICAgLy9tb2RlbC5hc3NpZ25lZFRvLm5hbWUgPSBkYXRhLm5hbWUgIT09IHVuZGVmaW5lZCA/IGRhdGEubmFtZSA6ICcnO1xyXG4gICAgICAgICAgICBtb2RlbC5jb21tZW50ID0gZGF0YS5jb21tZW50ICE9PSB1bmRlZmluZWQgPyBkYXRhLmNvbW1lbnQgOiAnJztcclxuICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSBpbmRpY2F0b3IgZG9jdW1lbnRzIHByb2Nlc3Mgc3RlcCBkYXRhXHJcbiAgICAgICAgICAgIC8vY29tc28ubG9nKCdpbnN0U3ViUHJvY2Vzcz09PScpO1xyXG4gICAgICAgICAgICAvL2NvbXNvLmxvZyhpbnN0U3ViUHJvY2Vzcyk7XHJcbiAgICAgICAgICAgIHZhciBpbmRpY2F0b3JzID0gaW5zdFN1YlByb2Nlc3MgIT09IHVuZGVmaW5lZCA/IGluc3RTdWJQcm9jZXNzLmluZGljYXRvcnMgOiBbXTtcclxuICAgICAgICAgICAgaW5kaWNhdG9yRG9jcyhwcm9jZXNzSWQsIGluZGljYXRvcnMsIG1vZGVsLCBfV0ZJbnN0YW5jZSkudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgIC8vIElmIGFjdGlvbnMgYXJlIHNwZWNpZmllZCwgZXhlY3V0ZSB0aGVtXHJcbiAgICAgICAgICAgICAgICB2YXIgY3JlYXRlZElEID0gX1dGSW5zdGFuY2UucHJvZmlsZSArICc6JyArIF9XRkluc3RhbmNlLmFwcCArICc6JyArIHByb2Nlc3NJZCArICc6JyArIHByb2Nlc3NTZXEgKyAnOicgKyBzdWJQcm9jZXNzSWQgKyAnOicgKyBzdWJQcm9jZXNzU2VxO1xyXG4gICAgICAgICAgICAgICAgdXVpZCA9IGNyZWF0ZWRJRDtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoc3RlcC5hY3Rpb25zWzBdICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBhY3Rpb25zKHN0ZXAuYWN0aW9ucywgcHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIHN1YlByb2Nlc3MsIG1vZGVsLCBfV0ZJbnN0YW5jZSwgZGF0YSwgdXVpZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBFeGVjdXRlIHRoZSB0cmFuc2l0aW9ucywgaWYgYXV0b1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdBY3Rpb25zIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkuJywgbW9kZWwpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEVsc2UgdGFza3MgYXJlIHNwcmVjaWZpZWQsIGV4ZWN1dGUgdGhlbVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzdGVwLnRhc2sgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIE1ha2UgYXNzaWdubWVudHNcclxuICAgICAgICAgICAgICAgICAgICB0YXNrKHByb2Nlc3NJZCwgcHJvY2Vzc1NlcSwgc3RlcC50YXNrLCBjcmVhdGVkSUQsIG1vZGVsKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBkbyB0YXNrIHN1Y2Nlc3MgaGFuZGxpbmdcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1Rhc2sgY29tcGxldGUuJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdUYXNrIGF3YWl0aW5nIHVzZXIgYWN0aW9uLicsIG1vZGVsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcclxuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn07XHJcblxyXG4vKipcclxuICogUHJvY2VzcyBpbmRpY2F0b3IgdXBkYXRlc1xyXG4gKlxyXG4gKiBAcGFyYW0ge29iamVjdH0gYWN0aW9ucyAtIHRoZSBhY3Rpb25zIGNvbmZpZyBkYXRhXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBzdWJQcm9jZXNzIC0gdGhlIGN1cnJlbnQgc3ViLXByb2Nlc3MgZm9ybSBjb25maWcgZGF0YVxyXG4gKiBAcGFyYW0ge29iamVjdH0gX1dGSW5zdGFuY2UgLSB0aGUgY3VycmVudCB3b3JrZmxvdyBjb25zdHJ1Y3RvciBpbnN0YW5jZVxyXG4gKlxyXG4gKiBAZXhhbXBsZSAnJ1xyXG4gKlxyXG4gKiBAcmV0dXJuICcnXHJcbiAqXHJcbiAqL1xyXG5mdW5jdGlvbiBpbmRpY2F0b3JzKGluZGljYXRvcnMsIF9XRkluc3RhbmNlLCBzcHV1aWQpIHtcclxuICAgIHZhciBtb2RlbCA9IFtdO1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgaW5kaWNhdG9yIHNlY3Rpb25zIG9mIHRoZSBzdWJQcm9jZXNzXHJcblxyXG4gICAgICAgICAgICB2YXIgYXJyYXkgPSBKU09OLnhwYXRoKFwiaW5kaWNhdG9yc1tmbjpjb3VudCguL3dvcmtmbG93cy9wcm9jZXNzZXNbc3ViUHJvY2Vzc1VVSUQgZXEgJ1wiICsgc3B1dWlkICsgXCInXSkgZ3QgMF1cIiwgX1dGSW5zdGFuY2UsIHt9KTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBhcnJheS5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGluZGljYXRvciA9IGFycmF5W2pdO1xyXG4gICAgICAgICAgICAgICAgdmFyIGluZGljYXRvck1vZGVsID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlkOiAnJyxcclxuICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZXM6IFtdXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB2YXIgaW5zdGFuY2VNb2RlbCA9IHtcclxuICAgICAgICAgICAgICAgICAgICB1dWlkOiAnJyxcclxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogJycsXHJcbiAgICAgICAgICAgICAgICAgICAga2V5OiAnJyxcclxuICAgICAgICAgICAgICAgICAgICBzZXE6IDFcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGluZGljYXRvck1vZGVsLmlkID0gaW5kaWNhdG9yLmNhdGVnb3J5LnRlcm07XHJcbiAgICAgICAgICAgICAgICBpbnN0YW5jZU1vZGVsLnV1aWQgPSBpbmRpY2F0b3IuX2lkO1xyXG4gICAgICAgICAgICAgICAgaW5zdGFuY2VNb2RlbC50aXRsZSA9IGluZGljYXRvci50aXRsZTtcclxuICAgICAgICAgICAgICAgIGluc3RhbmNlTW9kZWwua2V5ID0gJyc7XHJcbiAgICAgICAgICAgICAgICBpbnN0YW5jZU1vZGVsLnNlcSA9IGluZGljYXRvci5tb2RlbC5wZW5kaW5nLnNlcTsgLy8gaW5kaWNhdG9yIHNlcSBudW1iZXIgaGVyZSB3aGljaCBpcyBnZXR0aW5nIHVwZGF0ZWQuXHJcbiAgICAgICAgICAgICAgICBpbmRpY2F0b3JNb2RlbC5pbnN0YW5jZXMucHVzaChpbnN0YW5jZU1vZGVsKTtcclxuICAgICAgICAgICAgICAgIG1vZGVsLnB1c2goaW5kaWNhdG9yTW9kZWwpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ1Byb2Nlc3MgaW5kaWNhdG9yIG1vZGVsIHVwZGF0ZWQuJywgbW9kZWwpO1xyXG4gICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xyXG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICB9XHJcbiAgICB9KVxyXG59O1xyXG5cclxuLyoqXHJcbiAqIFByb2Nlc3MgYXNzaWduIHVzZXJcclxuICpcclxuICogQHBhcmFtIHtzdHJpbmd9IHByb2Nlc3NJZCAtIHRoZSBXb3JrZmxvdyBjb25maWcgLyBkZWZpbml0aW9uIHByb2Nlc3MgaWRcclxuICogQHBhcmFtIHtudW1iZXJ9IHByb2Nlc3NTZXEgLSB0aGUgV29ya2Zsb3cgaW5zdGFuY2UgcHJvY2VzcyBzZXFcclxuICogQHBhcmFtIHtzdHJpbmd9IHN1YlByb2Nlc3NJZCAtIHRoZSBXb3JrZmxvdyBjb25maWcgLyBkZWZpbml0aW9uIHN1Yi1wcm9jZXNzIGlkXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBzdWJQcm9jZXNzU2VxIC0gdGhlIFdvcmtmbG93IGluc3RhbmNlIHN1Yi1wcm9jZXNzIHNlcVxyXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RlcElkIC0gdGhlIFdvcmtmbG93IGNvbmZpZyAvIGRlZmluaXRpb24gc3RlcCBpZFxyXG4gKiBAcGFyYW0ge3N0cmluZ30gdHJhbnNpdGlvbklkIC0gdGhlIFdvcmtmbG93IGNvbmZpZyAvIGRlZmluaXRpb24gdHJhbnNpdGlvbiBpZFxyXG4gKiBAcGFyYW0ge29iamVjdH0gdXNlciAtIHRoZSB1c2VyIHRvIGFzc2lnbiB0b1xyXG4gKiBAcGFyYW0ge29iamVjdH0gX1dGSW5zdGFuY2UgLSB0aGUgY3VycmVudCB3b3JrZmxvdyBjb25zdHJ1Y3RvciBpbnN0YW5jZVxyXG4gKlxyXG4gKiBAZXhhbXBsZSAnJ1xyXG4gKlxyXG4gKiBAcmV0dXJuICcnXHJcbiAqXHJcbiAqL1xyXG5mdW5jdGlvbiBhc3NpZ25Vc2VyKHByb2Nlc3NJZCwgcHJvY2Vzc1NlcSwgc3ViUHJvY2Vzc0lkLCBzdWJQcm9jZXNzU2VxLCB1c2VyLCBfV0ZJbnN0YW5jZSkge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIHZhciB1dWlkID0gJyc7XHJcbiAgICAgICAgICAgIC8vIEdldCB0aGUgY3VycmVudCBzdWJQcm9jZXNzIGluc3RhbmNlIGRhdGFcclxuICAgICAgICAgICAgX1dGSW5zdGFuY2UuaW5zdGFuY2UucHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihvYmpQcm9jZXNzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAob2JqUHJvY2Vzcy5pZCA9PSBwcm9jZXNzSWQgJiYgb2JqUHJvY2Vzcy5zZXEgPT0gcHJvY2Vzc1NlcSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9ialByb2Nlc3Muc3ViUHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihvYmpTdWJQcm9jZXNzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmpTdWJQcm9jZXNzLmlkID09IHN1YlByb2Nlc3NJZCAmJiBvYmpTdWJQcm9jZXNzLnNlcSA9PSBzdWJQcm9jZXNzU2VxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dWlkID0gb2JqU3ViUHJvY2Vzcy51dWlkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgX1dGSW5zdGFuY2Uuc3VicHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihzdWJQcm9jZXNzSXRlbSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHN1YlByb2Nlc3NJdGVtLl9pZCA9PSB1dWlkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSB1c2VyIGRldGFpbHNcclxuICAgICAgICAgICAgICAgICAgICBzdWJQcm9jZXNzSXRlbS5zdGVwLmFzc2lnbmVkVG8udXNlcklkID0gdXNlci5pZDtcclxuICAgICAgICAgICAgICAgICAgICBzdWJQcm9jZXNzSXRlbS5zdGVwLmFzc2lnbmVkVG8ubmFtZSA9IHVzZXIubmFtZTtcclxuICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgdGhlIGluZGljYXRvcnMgdXNlciBkZXRhaWxzXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGluZGljYXRvcnMgPSBzdWJQcm9jZXNzSXRlbS5pbmRpY2F0b3JzO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaW5kaWNhdG9ycy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5kaWNhdG9yID0gaW5kaWNhdG9yc1tpXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBpbmRpY2F0b3IuaW5zdGFuY2VzLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5zdGFuY2UgPSBpbmRpY2F0b3IuaW5zdGFuY2VzW2pdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCBfV0ZJbnN0YW5jZS5pbmRpY2F0b3JzLmxlbmd0aDsgaysrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRvYyA9IF9XRkluc3RhbmNlLmluZGljYXRvcnNba107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluc3RhbmNlLnV1aWQgPT0gZG9jLl9pZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2Mud29ya2Zsb3dzLmZpbHRlcihmdW5jdGlvbih3b3JrZmxvdykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdvcmtmbG93LmlkID09IF9XRkluc3RhbmNlLmNvbmZpZy5faWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3b3JrZmxvdy5wcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKHByb2Nlc3NJdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcm9jZXNzSXRlbS5pZCA9PSBwcm9jZXNzSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgdXNlciBpZCBhbmQgbmFtZSBpbiB0aGUgZG9jdW1lbnRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NJdGVtLnN0ZXAuYXNzaWduZWRUby51c2VySWQgPSB1c2VyLmlkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc0l0ZW0uc3RlcC5hc3NpZ25lZFRvLm5hbWUgPSB1c2VyLm5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnVXNlciBhc3NpZ25lZCBzdWNjZXNzZnVsbHkuIFVzZXJJZDogXCInICsgdXNlci5pZCArICdcIiwgTmFtZTogXCInICsgdXNlci5uYW1lICsgJ1wiJywgc3ViUHJvY2Vzc0l0ZW0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59O1xyXG4vKipcclxuICogUHJvY2VzcyBpbmRpY2F0b3IgZG9jdW1lbnQgdXBkYXRlc1xyXG4gKlxyXG4gKiBAcGFyYW0ge29iamVjdH0gYWN0aW9ucyAtIHRoZSBhY3Rpb25zIGNvbmZpZyBkYXRhXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBzdWJQcm9jZXNzIC0gdGhlIGN1cnJlbnQgc3ViLXByb2Nlc3MgZm9ybSBjb25maWcgZGF0YVxyXG4gKiBAcGFyYW0ge29iamVjdH0gX1dGSW5zdGFuY2UgLSB0aGUgY3VycmVudCB3b3JrZmxvdyBjb25zdHJ1Y3RvciBpbnN0YW5jZVxyXG4gKlxyXG4gKiBAZXhhbXBsZSAnJ1xyXG4gKlxyXG4gKiBAcmV0dXJuICcnXHJcbiAqXHJcbiAqL1xyXG5mdW5jdGlvbiBpbmRpY2F0b3JEb2NzKHByb2Nlc3NJZCwgaW5kaWNhdG9ycywgc3RlcCwgX1dGSW5zdGFuY2UpIHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAvLyBVcGRhdGUgdGhlIGluZGljYXRvciBzZWN0aW9ucyBvZiB0aGUgc3ViUHJvY2Vzc1xyXG4gICAgICAgICAgICBpZiAoaW5kaWNhdG9ycyA9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIHZhciBlcnJvciA9IHV0aWwuZXJyb3IoJ1dGSW5kaWNhdG9yc1VwZGF0ZScsICdJbmRpY2F0b3JzIHBhcmFtZXRlciBpcyByZXF1aXJlZC4gLSBWYWx1ZTogJyArIGluZGljYXRvcnMpXHJcbiAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaW5kaWNhdG9ycy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vY29tc28ubG9nKCctLT4+Pj4+PiBGaXJzdCBJZiBjb25zaXRpb24nKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaW5kaWNhdG9yID0gaW5kaWNhdG9yc1tpXTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGluZGljYXRvci5pbnN0YW5jZXMubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9jb21zby5sb2coJy0tPj4+Pj4+IFNlY29uZCBJZiBjb25zaXRpb24nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGluc3RhbmNlID0gaW5kaWNhdG9yLmluc3RhbmNlc1tqXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCBfV0ZJbnN0YW5jZS5pbmRpY2F0b3JzLmxlbmd0aDsgaysrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2NvbXNvLmxvZygnLS0+Pj4+Pj4gVGhpcmQgSWYgY29uc2l0aW9uJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZG9jID0gX1dGSW5zdGFuY2UuaW5kaWNhdG9yc1trXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbnN0YW5jZS51dWlkID09IGRvYy5faWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2NvbXNvLmxvZygnLS0+Pj4+Pj4gRm91cnRoIElmIGNvbnNpdGlvbicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvYy53b3JrZmxvd3MuZmlsdGVyKGZ1bmN0aW9uKHdvcmtmbG93KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3b3JrZmxvdy5pZCA9PSBfV0ZJbnN0YW5jZS5jb25maWcuX2lkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2NvbXNvLmxvZygnLS0+Pj4+Pj4gRmlmdGggSWYgY29uc2l0aW9uJyk7XHJcblxyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3b3JrZmxvdy5wcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKHByb2Nlc3NJdGVtKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcm9jZXNzSXRlbS5pZCA9PSBwcm9jZXNzSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc0l0ZW0uc3RlcC5pZCA9IHN0ZXAuaWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NJdGVtLnN0ZXAuc2VxID0gc3RlcC5zZXE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NJdGVtLnN0ZXAuc3RhdHVzID0gc3RlcC5zdGF0dXM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NJdGVtLnN0ZXAubWVzc2FnZSA9IHN0ZXAubWVzc2FnZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc0l0ZW0uc3RlcC5hc3NpZ25lZFRvLnVzZXJJZCA9IHN0ZXAuYXNzaWduZWRUby51c2VySWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NJdGVtLnN0ZXAuYXNzaWduZWRUby5uYW1lID0gc3RlcC5hc3NpZ25lZFRvLm5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NJdGVtLnN0ZXAuY29tbWVudCA9IHN0ZXAuY29tbWVudCAhPT0gdW5kZWZpbmVkID8gc3RlcC5jb21tZW50IDogJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnSW5kaWNhdG9yIGRvY3VtZW50cyB3b3JrZmxvdyBwcm9jZXNzIG1vZGVsIHVwZGF0ZWQuJywgX1dGSW5zdGFuY2UpO1xyXG4gICAgICAgICAgICAgICAgLy9jb21zby5sb2coJ2luZGljYXRvckRvY3MgZnVuY3Rpb24gRU5EUy0tLS0tLS0tLS0tLS0tJyk7XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgIH1cclxuICAgIH0pXHJcbn07XHJcblxyXG4vKipcclxuICogUHJvY2VzcyBhY3Rpb25zXHJcbiAqXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBhY3Rpb25zIC0gdGhlIGFjdGlvbnMgY29uZmlnIGRhdGFcclxuICogQHBhcmFtIHtvYmplY3R9IHN1YlByb2Nlc3MgLSB0aGUgY3VycmVudCBzdWItcHJvY2VzcyBmb3JtIGNvbmZpZyBkYXRhXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBfV0ZJbnN0YW5jZSAtIHRoZSBjdXJyZW50IHdvcmtmbG93IGNvbnN0cnVjdG9yIGluc3RhbmNlXHJcbiAqXHJcbiAqIEBleGFtcGxlICcnXHJcbiAqXHJcbiAqIEByZXR1cm4gJydcclxuICpcclxuICovXHJcbmZ1bmN0aW9uIGFjdGlvbnMoYWN0aW9ucywgcHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIHN1YlByb2Nlc3MsIHN0ZXAsIF9XRkluc3RhbmNlLCBkYXRhLCB1dWlkKSB7XHJcbiAgICB2YXIgYXJyQWN0aW9ucyA9IFtdO1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIHV0aWwuc3luY0xvb3AoYWN0aW9ucy5sZW5ndGgsIGZ1bmN0aW9uKGxvb3ApIHtcclxuICAgICAgICAgICAgdmFyIGNvdW50ZXIgPSBsb29wLml0ZXJhdGlvbigpO1xyXG4gICAgICAgICAgICBhY3Rpb24oYWN0aW9uc1tjb3VudGVyXSwgcHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIHN1YlByb2Nlc3MsIHN0ZXAsIF9XRkluc3RhbmNlLCBkYXRhLCB1dWlkKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJldEFjdGlvbiA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGFjdGlvbnNbY291bnRlcl0uX2lkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXE6IGNvdW50ZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHJlc3VsdFxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgYXJyQWN0aW9ucy5wdXNoKHJldEFjdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9vcC5uZXh0KCk7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBsb29wLmJyZWFrKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9LCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgLy8gT24gY29tcGxldGlvbiBvZiB0aGUgbG9vcFxyXG5cclxuICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ0FjdGlvbnMgY29tcGxldGVkIHN1Y2Nlc3NmdWxseS4nLCBhcnJBY3Rpb25zKTtcclxuXHJcbiAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBQcm9jZXNzIGFjdGlvblxyXG4gKlxyXG4gKiBAcGFyYW0ge29iamVjdH0gYWN0aW9uIC0gdGhlIGFjdGlvbiBjb25maWcgZGF0YVxyXG4gKiBAcGFyYW0ge29iamVjdH0gc3ViUHJvY2VzcyAtIHRoZSBjdXJyZW50IHN1Yi1wcm9jZXNzIGZvcm0gY29uZmlnIGRhdGFcclxuICogQHBhcmFtIHtvYmplY3R9IF9XRkluc3RhbmNlIC0gdGhlIGN1cnJlbnQgd29ya2Zsb3cgY29uc3RydWN0b3IgaW5zdGFuY2VcclxuICpcclxuICogQGV4YW1wbGUgJydcclxuICpcclxuICogQHJldHVybiAnJ1xyXG4gKlxyXG4gKi9cclxuZnVuY3Rpb24gYWN0aW9uKGFjdGlvbiwgcHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIHN1YlByb2Nlc3MsIHN0ZXAsIF9XRkluc3RhbmNlLCBkYXRhLCB1dWlkKSB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcblxyXG4gICAgICAgIGlmIChhY3Rpb24ubWV0aG9kICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICB2YXIgbWV0aG9kUG9zc2libGVJdGVtcyA9IFtcImZvcm1cIiwgXCJpbmRpY2F0b3JcIiwgXCJwcm9maWxlXCIsIFwic3ViUHJvY2Vzc0luc3RhbmNlXCIsIFwic3RlcFwiLCBcImNvbW11bml0eVwiLCBcImFwcGxpY2F0aW9uRGVmaW5pdGlvblwiLCBcImFwcGxpY2F0aW9uQWRvcHRpb25cIiwgXCJ1c2VyXCIsIFwic2RvXCJdO1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHByb3BlcnR5RXhpc3RzKGFjdGlvbi5tZXRob2QsIG1ldGhvZFBvc3NpYmxlSXRlbXMpKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdmb3JtJzpcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ2luZGljYXRvcic6XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdwcm9maWxlJzpcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ3N1YlByb2Nlc3NJbnN0YW5jZSc6XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdzdGVwJzpcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ2NvbW11bml0eSc6XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbW11bml0eVBvc3NpYmxlSXRlbXMgPSBbXCJzZXRWYXJpYWJsZVwiLCBcImNyZWF0ZUNvbW11bml0eVwiLCBcInVzZXJKb2luQ29tbXVuaXR5XCJdO1xyXG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAocHJvcGVydHlFeGlzdHMoYWN0aW9uLm1ldGhvZC5jb21tdW5pdHksIGNvbW11bml0eVBvc3NpYmxlSXRlbXMpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ3NldFZhcmlhYmxlJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnY3JlYXRlQ29tbXVuaXR5JzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhY3Rpb25zTW9kdWxlLmNvbW11bml0eS5jcmVhdGVDb21tdW5pdHkoX1dGSW5zdGFuY2UpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAndXNlckpvaW5Db21tdW5pdHknOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KFwiTm8gbWV0aG9kIGZvdW5kIGZyb20gaW1wbGVtZW50ZWQgbGlzdC5cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdhcHBsaWNhdGlvbkRlZmluaXRpb24nOlxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnYXBwbGljYXRpb25BZG9wdGlvbic6XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICd1c2VyJzpcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ3Nkbyc6XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChcIk5vIG1ldGhvZCBmb3VuZCBmcm9tIGltcGxlbWVudGVkIGxpc3QuXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuXHJcbiAgICAgICAgfSBlbHNlIHtcclxuXHJcbiAgICAgICAgICAgIHZhciBhcmdzID0gW107XHJcbiAgICAgICAgICAgIHZhciBjb250ZXh0ID0gJ2dsb2JhbCc7XHJcbiAgICAgICAgICAgIHZhciBtZXRob2QgPSAnJztcclxuICAgICAgICAgICAgaWYgKGFjdGlvbi5faWQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgY29udGV4dCA9IGFjdGlvbi5faWQuc3BsaXQoXCIuXCIpWzBdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChhY3Rpb24uX2lkICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZCA9IGFjdGlvbi5faWQuc3BsaXQoXCIuXCIpWzFdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGFyZ3MubGVuZ3RoID0gMDtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhY3Rpb24uX2FyZ3MubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciBhcmcgPSBhY3Rpb24uX2FyZ3NbaV07XHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKGFyZykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3Byb2Nlc3NJZCc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaChwcm9jZXNzSWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdwcm9jZXNzU2VxJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKHByb2Nlc3NTZXEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdzdWJQcm9jZXNzSWQnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2goc3ViUHJvY2Vzc0lkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnc3ViUHJvY2Vzc1NlcSc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaChzdWJQcm9jZXNzU2VxKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnc3ViUHJvY2Vzcyc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaChzdWJQcm9jZXNzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnc3RlcCc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaChzdGVwKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnYWN0aW9uJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKGFjdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBBZGQgdGhlIHJlcXVpcmVkIHBhcmFtZXRlcnMgdG8gdGhlIGFyZ3MgYXJyYXlcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXJncyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGFyZ3MucHVzaChfV0ZJbnN0YW5jZSk7XHJcbiAgICAgICAgICAgIGFyZ3MucHVzaChkYXRhLmNyZWF0ZVR5cGUpO1xyXG4gICAgICAgICAgICBhcmdzLnB1c2godXVpZCk7XHJcbiAgICAgICAgICAgIGFyZ3MucHVzaChkYXRhLmJhc2VVVUlEKTtcclxuICAgICAgICAgICAgYXJncy5wdXNoKGRhdGEpO1xyXG5cclxuXHJcbiAgICAgICAgICAgIGlmIChhY3Rpb24uX2lkID09ICdmb3JtLmNyZWF0ZScpIHtcclxuICAgICAgICAgICAgICAgIGZvcm0uY3JlYXRlKGFyZ3MpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0LmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChhY3Rpb24uX2lkID09ICdmb3JtLmF1dGhvcmlzZScpIHtcclxuICAgICAgICAgICAgICAgIGZvcm0uYXV0aG9yaXNlKGFyZ3MpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGFjdGlvbi5faWQgPT0gJ2Zvcm0uY2xvc2UnKSB7XHJcbiAgICAgICAgICAgICAgICBmb3JtLmNsb3NlKGFyZ3MpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGFjdGlvbi5faWQgPT0gJ2Zvcm0uc2V0RHJhZnQnKSB7XHJcbiAgICAgICAgICAgICAgICBmb3JtLnNldERyYWZ0KGFyZ3MpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGFjdGlvbi5faWQgPT0gJ2Zvcm0uc2V0VW5EcmFmdCcpIHtcclxuICAgICAgICAgICAgICAgIGZvcm0uc2V0VW5EcmFmdChhcmdzKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0LmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChhY3Rpb24uX2lkID09ICdmb3JtLmNyZWF0ZVByb2ZpbGUnKSB7XHJcbiAgICAgICAgICAgICAgICBmb3JtLmNyZWF0ZVByb2ZpbGUoYXJncykudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdC5kYXRhKTtcclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoYWN0aW9uLl9pZCA9PSAnZm9ybS5zZXRJbnN0YW5jZVRpdGxlJykge1xyXG4gICAgICAgICAgICAgICAgZm9ybS5zZXRJbnN0YW5jZVRpdGxlKGFyZ3MpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGFjdGlvbi5faWQgPT0gJ3Byb2ZpbGUuZGVsZXRlJykge1xyXG4gICAgICAgICAgICAgICAgZm9ybS5kZWxldGVQcm9maWxlKGFyZ3MpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdmFyIGVycm9yID0gdXRpbC5lcnJvcignV0ZBY3Rpb25FcnJvcicsICdNZXRob2Q6ICcgKyBhY3Rpb25faWQgKyAnIG5vdCBkZWZpbmVkLicpO1xyXG4gICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBpZiAoY29udGV4dCA9PSAnZm9ybScpIHtcclxuICAgICAgICAgICAgLy8gXHRmb3JtW21ldGhvZF0oYXJncykudGhlbihmdW5jdGlvbihyZXN1bHQpe1xyXG4gICAgICAgICAgICAvLyBcdFx0cmVzb2x2ZShyZXN1bHQuZGF0YSk7XHJcbiAgICAgICAgICAgIC8vIFx0fSwgZnVuY3Rpb24oZXJyKXtcclxuICAgICAgICAgICAgLy8gXHRcdHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAvLyBcdH0pO1xyXG4gICAgICAgICAgICAvLyB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBcdHZhciBlcnJvciA9IHV0aWwuZXJyb3IoJ1dGQWN0aW9uRXJyb3InLCAnTW9kdWxlOiAnICsgY29udGV4dCArICcgbm90IGRlZmluZWQuJyk7XHJcbiAgICAgICAgICAgIC8vIFx0cmVqZWN0KGVycm9yKTtcclxuICAgICAgICAgICAgLy8gfVxyXG5cclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBQcm9jZXNzIHRhc2tzXHJcbiAqXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSB0YXNrIC0gdGhlIHRhc2sgY29uZmlnIGRhdGFcclxuICogQHBhcmFtIHtvYmplY3R9IGlucHV0RGF0YSAtIHRoZSB1c2VyIGlucHV0IGRhdGFcclxuICpcclxuICogQGV4YW1wbGUgJydcclxuICpcclxuICogQHJldHVybiAnJ1xyXG4gKlxyXG4gKi9cclxuZnVuY3Rpb24gdGFzayhzdWJwcm9jZXNzSUQsIHN1YnByb2Nlc3NTRVEsIHRhc2ssIHNwdXVpZCwgbW9kZWwpIHtcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgdmFyIGxpc3QgPSBbXTtcclxuICAgICAgICBpZiAodGFzay5hc3NpZ24ucHJvZmlsZVJvbGUgIT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHZhciBhc3NpZ25UeXBlID0gJ3Byb2ZpbGVSb2xlJztcclxuICAgICAgICAgICAgdmFyIHByb2ZpbGVJZCA9IGFwcC5TQ09QRS53b3JrZmxvdy5wcm9maWxlO1xyXG4gICAgICAgICAgICB2YXIgaWQgPSAnJztcclxuICAgICAgICAgICAgaWYgKHRhc2suYXNzaWduLnByb2ZpbGVSb2xlLnByb2ZpbGUgPT0gJ2N1cnJlbnQnKSB7XHJcbiAgICAgICAgICAgICAgICBpZCA9IGFwcC5TQ09QRS53b3JrZmxvdy5wcm9maWxlO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRhc2suYXNzaWduLnByb2ZpbGVSb2xlLnByb2ZpbGUgPT0gJ2NvbW11bml0eScpIHtcclxuICAgICAgICAgICAgICAgIGlkID0gYXBwLlNDT1BFLmNvbW11bml0eUlkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciByb2xlID0gdGFzay5hc3NpZ24ucHJvZmlsZVJvbGUucm9sZTtcclxuXHJcbiAgICAgICAgICAgIGxpYnJhcnkuZ2V0VXNlcnNMaXN0QnlSb2xlKGlkLCByb2xlKS50aGVuKGZ1bmN0aW9uKGxpc3QpIHtcclxuICAgICAgICAgICAgICAgIGlmIChsaXN0ICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChsaXN0Lmxlbmd0aCA+IDEpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFzc2lnbiB0byB1c2VycyBzZW5kIG5vdGlmaWNhdGlvbnNcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vdmFyIHByT2JqZWN0ID0gSlNPTi54cGF0aChcIi9pbnN0YW5jZS9wcm9jZXNzZXNbc3ViUHJvY2Vzc2VzL3V1aWQgZXEgJ1wiKyBzcHV1aWQgK1wiJ11cIixhcHAuU0NPUEUud29ya2Zsb3cse30pWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3BPYmplY3QgPSBKU09OLnhwYXRoKFwiL3N1YnByb2Nlc3Nlc1tfaWQgZXEgJ1wiICsgc3B1dWlkICsgXCInXVwiLCBhcHAuU0NPUEUud29ya2Zsb3csIHt9KVswXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNoYW5uZWxzID0gSlNPTi54cGF0aChcIi9zdWJwcm9jZXNzZXNbX2lkIGVxICdcIiArIHNwdXVpZCArIFwiJ10vY2hhbm5lbHNcIiwgYXBwLlNDT1BFLndvcmtmbG93LCB7fSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmaW5hbE1zZyA9IHByb2Nlc3NXb3JrZmxvd01lc3NhZ2UoTk9USUZJQ0FUSU9OX1VTRVJfTVNHX0FDQ0VQVCwgc3B1dWlkKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwcm9jZXNzSWQgPSBzcE9iamVjdC5pZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHByb2Nlc3NTZXEgPSBzcE9iamVjdC5zZXE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vdmFyIHN1YnByb2Nlc3NJRCA9IHByT2JqZWN0LmlkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL3ZhciBzdWJwcm9jZXNzU0VRID0gcHJPYmplY3Quc2VxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3VicHJvY2Vzc1VVSUQgPSBzcHV1aWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwcm9jZXNzX1ZhbGlkRGF0ZSA9IHNwT2JqZWN0LmRhdGVzLnZhbGlkO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbmZpZ1Byb2Nlc3MgPSBKU09OLnhwYXRoKFwiL2NvbmZpZy9wcm9jZXNzZXNbX2lkIGVxICdcIiArIHN1YnByb2Nlc3NJRCArIFwiJ11cIiwgYXBwLlNDT1BFLndvcmtmbG93LCB7fSlbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb25maWdTdWJQcm9jZXNzID0gSlNPTi54cGF0aChcIi9zdWJQcm9jZXNzZXNbX2lkIGVxICdcIiArIHByb2Nlc3NJZCArIFwiJ11cIiwgY29uZmlnUHJvY2Vzcywge30pWzBdO1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdGVwU2VxID0gc3BPYmplY3Quc3RlcC5zZXEgKyAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcHJvY2Vzc19DdXJyZW50U3RlcE5hbWUgPSBKU09OLnhwYXRoKFwiL3N0ZXBzW19zZXEgZXEgJ1wiICsgc3RlcFNlcSArIFwiJ10vbmFtZS9pMThuWzFdL3ZhbHVlXCIsIGNvbmZpZ1N1YlByb2Nlc3MsIHt9KVswXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHByb2Nlc3NOYW1lID0gY29uZmlnU3ViUHJvY2Vzcy5uYW1lLmkxOG5bMF0udmFsdWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbm90ZmljYXRpb25SZXF1ZXN0ID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJzb3VyY2VcIjogXCJyZW1vdGVcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidHlwZVwiOiBcIm5vdGlmaWNhdGlvblJlcXVlc3RcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiX2lkXCI6IHNwdXVpZCArIFwiOm5vdGlmaWNhdGlvblJlcXVlc3RcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiY2hhbm5lbHNcIjogY2hhbm5lbHMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImNvbW11bml0eUlkXCI6IGFwcC5TQ09QRS5jb21tdW5pdHlJZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYXBwbGljYXRpb25JZFwiOiBhcHAuU0NPUEUuYXBwbGljYXRpb25JZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibWVzc2FnZVwiOiBmaW5hbE1zZyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibWVzc2FnZVR5cGVcIjogXCJpbmZvXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImNyZWF0ZWREYXRlVGltZVwiOiBtb21lbnQoKS5mb3JtYXQoKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic2VuZGVyVXNlcklkXCI6IExPQ0FMX1NFVFRJTkdTLlNVQlNDUklQVElPTlMudXNlcklkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJhY3Rpb25zXCI6IFt7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJsYWJlbFwiOiBcIlZpZXdcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImZ1bmN0aW9uXCI6IFwiYXBwLm9wZW5TdWJwcm9jZXNzXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJwYXJhbXNcIjogW3Byb2ZpbGVJZCwgcHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBwcm9jZXNzTmFtZSwgc3VicHJvY2Vzc0lELCBzdWJwcm9jZXNzU0VRLCBzdWJwcm9jZXNzVVVJRCwgcHJvY2Vzc19WYWxpZERhdGUsIHByb2Nlc3NfQ3VycmVudFN0ZXBOYW1lXVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfV0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInJlY2VpdmVyXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IFt7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidHlwZVwiOiBcInJvbGVcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IHJvbGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwicHJvZmlsZUlkXCI6IGlkXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfV1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgZGFvLnVwc2VydChub3RmaWNhdGlvblJlcXVlc3QpLmRvbmUoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pLmZhaWwoZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vdmFyIHNwT2JqZWN0ID0gSlNPTi54cGF0aChcIi9zdWJwcm9jZXNzZXNbX2lkIGVxICdcIisgc3B1dWlkICtcIiddXCIsYXBwLlNDT1BFLndvcmtmbG93LCB7fSlbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhc3NpZ25tZW50ID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0YXNrLmFzc2lnbi5hc3NpZ25tZW50ICE9IHVuZGVmaW5lZCkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhc3NpZ25tZW50ID0gbW9kZWwuYXNzaWdubWVudDsgLy9KU09OLnhwYXRoKFwiL3N0ZXAvYXNzaWdubWVudFwiLHNwT2JqZWN0LHt9KVswXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhY2NlcHQgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJzaG93XCI6IHRhc2suYXNzaWduLmFzc2lnbm1lbnQuYWNjZXB0LnNob3csXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJsYWJlbFwiOiBfZ2V0TmFtZSh0YXNrLmFzc2lnbi5hc3NpZ25tZW50LmFjY2VwdC5sYWJlbC5pMThuLCAnZW4nKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzc2lnbm1lbnQuYWNjZXB0ID0gYWNjZXB0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNzaWdubWVudC5tZXNzYWdlID0gX2dldE5hbWUodGFzay5hc3NpZ24uYXNzaWdubWVudC5tZXNzYWdlLmkxOG4sICdlbicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlamVjdCA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInNob3dcIjogdGFzay5hc3NpZ24uYXNzaWdubWVudC5yZWplY3Quc2hvdyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImxhYmVsXCI6IF9nZXROYW1lKHRhc2suYXNzaWduLmFzc2lnbm1lbnQucmVqZWN0LmxhYmVsLmkxOG4sICdlbicpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNzaWdubWVudC5yZWplY3QgPSByZWplY3Q7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJwcm9maWxlSWRcIjogcHJvZmlsZUlkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwicm9sZUlkXCI6IHJvbGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ0eXBlXCI6IFwicm9sZVwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzc2lnbm1lbnQudmFsdWUgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzc2lnbm1lbnQucHJvZmlsZVJvbGVJZCA9IGlkO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCdOb3RpZmljYXRpb25zIHJlcXVlc3Qgc3VibWl0dGVkIGZvciBhY2NlcHRhbmNlLicpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGxpc3QubGVuZ3RoID09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9hdXRvIGFzc2lnblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdXNlcklkID0gbGlzdFswXS5pZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHVzZXJuYW1lID0gbGlzdFswXS5uYW1lO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy92YXIgc3BPYmplY3QgPSBKU09OLnhwYXRoKFwiL3N1YnByb2Nlc3Nlc1tfaWQgZXEgJ1wiKyBzcHV1aWQgK1wiJ11cIixhcHAuU0NPUEUud29ya2Zsb3csIHt9KVswXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFzc2lnbmVlID0gbW9kZWwuYXNzaWduZWRUbzsgLy9KU09OLnhwYXRoKFwiL3N0ZXAvYXNzaWduZWRUb1wiLHNwT2JqZWN0LHt9KVswXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXNzaWduZWUubmFtZSA9IHVzZXJuYW1lICsgXCJcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXNzaWduZWUudXNlcklkID0gdXNlcklkICsgXCJcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgnQXNzaWduZWQgdG8gdGhlIG9ubHkgdXNlciBpbiByb2xlLicpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB1c2UgZGVmYXVsdCB1c2VyXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGFzay5hc3NpZ24uZGVmYXVsdCAhPSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1c2VySWQgPSB0YXNrLmFzc2lnbi5kZWZhdWx0LnVzZXJJZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1c2VybmFtZSA9IHRhc2suYXNzaWduLmRlZmF1bHQudXNlck5hbWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy92YXIgc3BPYmplY3QgPSBKU09OLnhwYXRoKFwiL3N1YnByb2Nlc3Nlc1tfaWQgZXEgJ1wiKyBzcHV1aWQgK1wiJ11cIixhcHAuU0NPUEUud29ya2Zsb3csIHt9KVswXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhc3NpZ25lZSA9IG1vZGVsLmFzc2lnbmVkVG87IC8vIEpTT04ueHBhdGgoXCIvc3RlcC9hc3NpZ25lZFRvXCIsc3BPYmplY3Qse30pWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNzaWduZWUubmFtZSA9IHVzZXJuYW1lICsgXCJcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzc2lnbmVlLnVzZXJJZCA9IHVzZXJJZCArIFwiXCI7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgnQXNzaWduZWQgdG8gZGVmYXVsdCB1c2VyJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdFcnJvciBpbiBhc3NpZ25tZW50LiBEZWZhdWx0IHVzZXIgbm90IHNwZWNpZmllZC4nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdCgnRXJyb3IgaW4gYXNzaWdubWVudC4gRGVmYXVsdCB1c2VyIG5vdCBzcGVjaWZpZWQuJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRXJyb3IgaW4gZ2V0VXNlcnNMaXN0QnlSb2xlIHVuZGVmaW5lZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdFcnJvciBpbiBnZXRVc2Vyc0xpc3RCeVJvbGUnKTtcclxuICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9IGVsc2UgaWYgKHRhc2suYXNzaWduLnN3aW1sYW5lICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICByZXNvbHZlKCdzd2ltbGFuZScpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnU3dpbWxhbmUgaW1wbGVtZW50YXRpb24gISEnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfSk7XHJcblxyXG5cclxufTtcclxuXHJcblxyXG5cclxuXHJcbi8qKlxyXG4gKiBQcm9jZXNzIHRyYW5zaXRpb25cclxuICpcclxuICogQHBhcmFtIHtzdHJpbmd9IHByb2Nlc3NJZCAtIHRoZSBXb3JrZmxvdyBjb25maWcgLyBkZWZpbml0aW9uIHByb2Nlc3MgaWRcclxuICogQHBhcmFtIHtudW1iZXJ9IHByb2Nlc3NTZXEgLSB0aGUgV29ya2Zsb3cgaW5zdGFuY2UgcHJvY2VzcyBzZXFcclxuICogQHBhcmFtIHtzdHJpbmd9IHN1YlByb2Nlc3NJZCAtIHRoZSBXb3JrZmxvdyBjb25maWcgLyBkZWZpbml0aW9uIHN1Yi1wcm9jZXNzIGlkXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBzdWJQcm9jZXNzU2VxIC0gdGhlIFdvcmtmbG93IGluc3RhbmNlIHN1Yi1wcm9jZXNzIHNlcVxyXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RlcElkIC0gdGhlIFdvcmtmbG93IGNvbmZpZyAvIGRlZmluaXRpb24gc3RlcCBpZFxyXG4gKiBAcGFyYW0ge3N0cmluZ30gdHJhbnNpdGlvbklkIC0gdGhlIFdvcmtmbG93IGNvbmZpZyAvIGRlZmluaXRpb24gdHJhbnNpdGlvbiBpZFxyXG4gKiBAcGFyYW0ge29iamVjdH0gZGF0YSAtIGFueSBhZGRpdGlvbmFsIGRhdGEgcGFzc2VkIGluIGFzIGtleSB2YWx1ZSBwYWlyc1xyXG4gKiBAcGFyYW0ge29iamVjdH0gX1dGSW5zdGFuY2UgLSB0aGUgY3VycmVudCB3b3JrZmxvdyBjb25zdHJ1Y3RvciBpbnN0YW5jZVxyXG4gKlxyXG4gKiBAZXhhbXBsZSAnJ1xyXG4gKlxyXG4gKiBAcmV0dXJuICcnXHJcbiAqXHJcbiAqL1xyXG5mdW5jdGlvbiB0cmFuc2l0aW9uKHByb2Nlc3NJZCwgcHJvY2Vzc1NlcSwgc3ViUHJvY2Vzc0lkLCBzdWJQcm9jZXNzU2VxLCBzdGVwSWQsIHRyYW5zaXRpb25JZCwgZGF0YSwgX1dGSW5zdGFuY2UpIHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICB2YXIgc3RlcFNlcSA9IDA7XHJcbiAgICAgICAgICAgIHZhciBuZXh0U3RlcElkID0gJyc7XHJcbiAgICAgICAgICAgIHZhciBuZXh0U3RlcFNlcSA9IDA7XHJcbiAgICAgICAgICAgIHZhciBzdWJQcm9jZXNzID0gW107XHJcbiAgICAgICAgICAgIHZhciBjdXJyZW50UHJvY2VzcyA9IF9XRkluc3RhbmNlLmNvbmZpZy5wcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKG9ialByb2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgIGlmIChvYmpQcm9jZXNzLl9pZCA9PSBwcm9jZXNzSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqUHJvY2VzcztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHZhciBjdXJyZW50U3ViUHJvY2VzcyA9IGN1cnJlbnRQcm9jZXNzWzBdLnN1YlByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24ob2JqU3ViUHJvY2Vzcykge1xyXG4gICAgICAgICAgICAgICAgaWYgKG9ialN1YlByb2Nlc3MuX2lkID09IHN1YlByb2Nlc3NJZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvYmpTdWJQcm9jZXNzO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdmFyIGN1cnJlbnRTdGVwID0gY3VycmVudFN1YlByb2Nlc3NbMF0uc3RlcHMuZmlsdGVyKGZ1bmN0aW9uKG9ialN0ZXApIHtcclxuICAgICAgICAgICAgICAgIGlmIChvYmpTdGVwLl9pZCA9PSBzdGVwSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqU3RlcDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHZhciB0cmFuc2l0aW9uID0gY3VycmVudFN0ZXBbMF0udHJhbnNpdGlvbnMuZmlsdGVyKGZ1bmN0aW9uKG9ialRyYW5zaXRpb24pIHtcclxuICAgICAgICAgICAgICAgIGlmIChvYmpUcmFuc2l0aW9uLl9pZCA9PSB0cmFuc2l0aW9uSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqVHJhbnNpdGlvbjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY3VycmVudFN1YlByb2Nlc3NbMF0uc3RlcHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50U3ViUHJvY2Vzc1swXS5zdGVwc1tpXS5faWQgPT0gc3RlcElkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RlcFNlcSA9IHBhcnNlSW50KGN1cnJlbnRTdWJQcm9jZXNzWzBdLnN0ZXBzW2ldLl9zZXEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGN1cnJlbnRTdWJQcm9jZXNzWzBdLnN0ZXBzLmZpbHRlcihmdW5jdGlvbihzdGVwSXRlbSkge1xyXG4gICAgICAgICAgICAgICAgbmV4dFN0ZXBTZXEgPSBzdGVwU2VxICsgMTtcclxuICAgICAgICAgICAgICAgIGlmIChwYXJzZUludChzdGVwSXRlbS5fc2VxKSA9PSBuZXh0U3RlcFNlcSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5leHRTdGVwSWQgPSBzdGVwSXRlbS5faWQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIF9XRkluc3RhbmNlLmluc3RhbmNlLnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24ob2JqUHJvY2Vzcykge1xyXG4gICAgICAgICAgICAgICAgaWYgKG9ialByb2Nlc3MuaWQgPT0gcHJvY2Vzc0lkICYmIG9ialByb2Nlc3Muc2VxID09IHByb2Nlc3NTZXEpIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmpQcm9jZXNzLnN1YlByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24ob2JqU3ViUHJvY2Vzcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqU3ViUHJvY2Vzcy5pZCA9PSBzdWJQcm9jZXNzSWQgJiYgb2JqU3ViUHJvY2Vzcy5zZXEgPT0gc3ViUHJvY2Vzc1NlcSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHV1aWQgPSBvYmpTdWJQcm9jZXNzLnV1aWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzdWJQcm9jZXNzID0gb2JqU3ViUHJvY2VzcztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9XRkluc3RhbmNlLnN1YnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24oc3ViUHJvY2Vzc0l0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3ViUHJvY2Vzc0l0ZW0uX2lkID09IHV1aWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ViUHJvY2VzcyA9IHN1YlByb2Nlc3NJdGVtO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdmFyIG1heFN0ZXBzID0gY3VycmVudFN1YlByb2Nlc3NbMF0uc3RlcHMubGVuZ3RoO1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHRyYW5zaXRpb25bMF0uX3R5cGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ2F1dG8nOlxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0cmFuc2l0aW9uWzBdLmdvVG8uX3R5cGUgPT0gJ25leHRTdGVwJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGVwKHByb2Nlc3NJZCwgcHJvY2Vzc1NlcSwgc3ViUHJvY2Vzc0lkLCBzdWJQcm9jZXNzU2VxLCBuZXh0U3RlcElkLCBuZXh0U3RlcFNlcSwgZGF0YSwgX1dGSW5zdGFuY2UpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobmV4dFN0ZXBTZXEgPT0gbWF4U3RlcHMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnQWxsIFN0ZXAgdHJhbnNpdGlvbnMgaGF2ZSBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5LicsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ViUHJvY2Vzc0NvbXBsZXRlOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGVwOiByZXN1bHQuZGF0YVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdTdGVwIHRyYW5zaXRpb24gY29tcGxldGVkIHN1Y2Nlc3NmdWxseS4nLCByZXN1bHQuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ3VzZXInOlxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0cmFuc2l0aW9uWzBdLmdvVG8uX3R5cGUgPT0gJ25leHRTdGVwJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGVwKHByb2Nlc3NJZCwgcHJvY2Vzc1NlcSwgc3ViUHJvY2Vzc0lkLCBzdWJQcm9jZXNzU2VxLCBuZXh0U3RlcElkLCBuZXh0U3RlcFNlcSwgZGF0YSwgX1dGSW5zdGFuY2UpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobmV4dFN0ZXBTZXEgPT0gbWF4U3RlcHMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnQWxsIFN0ZXAgdHJhbnNpdGlvbnMgaGF2ZSBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5LicsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ViUHJvY2Vzc0NvbXBsZXRlOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGVwOiByZXN1bHQuZGF0YVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdTdGVwIHRyYW5zaXRpb24gY29tcGxldGVkIHN1Y2Nlc3NmdWxseS4nLCByZXN1bHQuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodHJhbnNpdGlvblswXS5nb1RvLl90eXBlID09ICdzdGVwSWQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBnb1RvU3RlcElkID0gdHJhbnNpdGlvblswXS5nb1RvLl9zdGVwSWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBnb1RvU3RlcFNlcSA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTdWJQcm9jZXNzWzBdLnN0ZXBzLmZpbHRlcihmdW5jdGlvbihzdGVwSXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0ZXBJdGVtLl9pZCA9PSBnb1RvU3RlcElkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ29Ub1N0ZXBTZXEgPSBwYXJzZUludChzdGVwSXRlbS5fc2VxKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3RlcChwcm9jZXNzSWQsIHByb2Nlc3NTZXEsIHN1YlByb2Nlc3NJZCwgc3ViUHJvY2Vzc1NlcSwgZ29Ub1N0ZXBJZCwgZ29Ub1N0ZXBTZXEsIGRhdGEsIF9XRkluc3RhbmNlKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGdvVG9TdGVwU2VxID09IG1heFN0ZXBzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ0FsbCBTdGVwIHRyYW5zaXRpb25zIGhhdmUgY29tcGxldGVkIHN1Y2Nlc3NmdWxseS4nLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1YlByb2Nlc3NDb21wbGV0ZTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RlcDogcmVzdWx0LmRhdGFcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnU3RlcCB0cmFuc2l0aW9uIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkuJywgcmVzdWx0LmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvciA9IHV0aWwuZXJyb3IoJ1dGVHJhbnNpdGlvbkVycm9yJywgJ1RyYW5zaXRpb24gdHlwZTogJyArIHRyYW5zaXRpb25bMF0uX3R5cGUgKyAnIG5vdCBkZWZpbmVkLicpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnJvcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn07XHJcblxyXG4vKipcclxuICogUHJvY2VzcyBwb3N0QWN0aW9uc1xyXG4gKlxyXG4gKiBAcGFyYW0ge29iamVjdH0gcG9zdEFjdGlvbnMgLSB0aGUgcG9zdEFjdGlvbnMgY29uZmlnIGRhdGFcclxuICpcclxuICogQGV4YW1wbGUgJydcclxuICpcclxuICogQHJldHVybiAnJ1xyXG4gKlxyXG4gKi9cclxuZnVuY3Rpb24gcG9zdEFjdGlvbnMocG9zdEFjdGlvbnMsIF9XRkluc3RhbmNlKSB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgdmFyIGNvbXBsZXRlZCA9IFtdO1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIHV0aWwuc3luY0xvb3AocG9zdEFjdGlvbnMubGVuZ3RoLCBmdW5jdGlvbihsb29wKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY291bnRlciA9IGxvb3AuaXRlcmF0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICBhY3Rpb24ocG9zdEFjdGlvbnNbY291bnRlcl0sIF9XRkluc3RhbmNlKS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBDaGVjayBpZiBhbGwgcHJlLXJlcXVpc2l0ZXMgY29tcGxldGVkIHN1Y2Nlc3NmdWxseS5cclxuICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWQucHVzaCh0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICBsb29wLm5leHQoKTtcclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZC5wdXNoKGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICBsb29wLmJyZWFrKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoY29tcGxldGVkLmV2ZXJ5KEJvb2xlYW4pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ1Bvc3QtYWN0aW9ucyBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5LicsIHt9KTtcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3IgPSB1dGlsLmVycm9yKCdXRlByZUFjdGlvbnNFcnJvcicsICdOb3QgYWxsIHBvc3QtYWN0aW9ucyBwYXNzZWQuJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59O1xyXG5cclxuXHJcblxyXG4vKlxyXG5mdW5jdGlvbiBzZW5kTm90aWZpY2F0aW9ucyh1c2Vyc0xpc3QsIHNwdXVpZCl7XHJcblxyXG4gIC8vIGdldCB1c2VycyBsaXN0IFxyXG4gIC8vIHNlbiBub3RpZmljYXRpb25zIHRvIHVzZXJzIHkgYWRkaW5nIGNoYW5uZWxzIHRvIHRoZW1cclxuIFxyXG4gIHZhciBjaGFubmVsQXJyYXkgPSBbXTtcclxuXHJcbiAgZm9yKGk9MDtpPHVzZXJzTGlzdC5sZW5ndGg7IGkrKyl7XHJcbiAgICBjaGFubmVsQXJyYXkucHVzaChcInVzZXJfXCIrdXNlcnNMaXN0W2ldLmlkKTtcclxuICB9XHJcblxyXG4gIFxyXG4gIGFzc2lnblRvVXNlcnMocHJvY2Vzc1dvcmtmbG93TWVzc2FnZShOT1RJRklDQVRJT05fVVNFUl9NU0dfQUNDRVBULCBzcHV1aWQpLCBjaGFubmVsQXJyYXkpO1xyXG5cclxuXHJcblxyXG59OyovXHJcblxyXG4vKmZ1bmN0aW9uIGFzc2lnblRvVXNlcnMobWVzc2FnZSwgY2hhbm5lbEFycmF5KXtcclxuXHJcbiAgICAgdmFyIGNoYW5uZWxzID0gY2hhbm5lbEFycmF5O1xyXG4gICAgIFxyXG4gICAgIHZhciBub3RpZmljYXRpb24gPSAgeyBcclxuICAgICAgICAgIFwiX2lkXCI6IGdlbmVyYXRlVVVJRCgpLFxyXG4gICAgICAgICAgXCJjaGFubmVsc1wiOmNoYW5uZWxzLFxyXG4gICAgICAgICAgXCJtZXNzYWdlXCI6IG1lc3NhZ2UsXHJcbiAgICAgICAgICBcIm1lc3NhZ2VUeXBlXCI6IFwiaW5mb1wiLFxyXG4gICAgICAgICAgXCJjcmVhdGVkRGF0ZVRpbWVcIjogbW9tZW50KCkuZm9ybWF0KCksXHJcbiAgICAgICAgICBcInJlYWRcIjogZmFsc2UsXHJcbiAgICAgICAgICBcInJlYWREYXRlVGltZVwiOiBcIlwiLFxyXG4gICAgICAgICAgXCJ0eXBlXCI6IFwibm90aWZpY2F0aW9uXCIsXHJcbiAgICAgICAgICBcInNlbmRlclVzZXJJZFwiOiBMT0NBTF9TRVRUSU5HUy5TVUJTQ1JJUFRJT05TLnVzZXJJZFxyXG4gICAgICAgfTtcclxuICAgICAgIGNvbnNvbGUubG9nKG5vdGlmaWNhdGlvbik7XHJcbiAgICAgICBkYW8udXBzZXJ0KG5vdGlmaWNhdGlvbik7XHJcblxyXG4gIH07Ki9cclxuXHJcbmZ1bmN0aW9uIHByb2Nlc3NXb3JrZmxvd01lc3NhZ2UobWVzc2FnZSwgc3B1dWlkKSB7XHJcblxyXG4gICAgdmFyIHJlcGxhY2VkTXNnID0gbWVzc2FnZTtcclxuXHJcbiAgICBpZiAocmVwbGFjZWRNc2cuaW5kZXhPZignI0lOU1RBTkNFX0xBQkVMJykgIT09IC0xKSB7XHJcbiAgICAgICAgdmFyIHZhbCA9IEpTT04ueHBhdGgoXCIvaW5zdGFuY2UvcHJvY2Vzc2VzL3N1YlByb2Nlc3Nlc1t1dWlkIGVxICdcIiArIHNwdXVpZCArIFwiJ10vbGFiZWxcIiwgYXBwLlNDT1BFLndvcmtmbG93LCB7fSlbMF07XHJcbiAgICAgICAgcmVwbGFjZWRNc2cgPSByZXBsYWNlZE1zZy5yZXBsYWNlKCcjSU5TVEFOQ0VfTEFCRUwnLCB2YWwpO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBpZiAocmVwbGFjZWRNc2cuaW5kZXhPZignI1VTRVJfTkFNRScpICE9PSAtMSkge1xyXG4gICAgICAgIHZhciB2YWwgPSBKU09OLnhwYXRoKFwiL3N1YnByb2Nlc3Nlc1tfaWQgZXEgJ1wiICsgc3B1dWlkICsgXCInXS9zdGVwL2Fzc2lnbmVkVG8vbmFtZVwiLCBhcHAuU0NPUEUud29ya2Zsb3csIHt9KVswXTtcclxuICAgICAgICByZXBsYWNlZE1zZyA9IHJlcGxhY2VkTXNnLnJlcGxhY2UoJyNVU0VSX05BTUUnLCB2YWwpO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBpZiAocmVwbGFjZWRNc2cuaW5kZXhPZignI1BST0ZJTEVfVElUTEUnKSAhPT0gLTEpIHtcclxuICAgICAgICB2YXIgdmFsID0gYXBwLnByb2ZpbGUudGl0bGU7XHJcbiAgICAgICAgcmVwbGFjZWRNc2cgPSByZXBsYWNlZE1zZy5yZXBsYWNlKCcjUFJPRklMRV9USVRMRScsIHZhbCk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIGlmIChyZXBsYWNlZE1zZy5pbmRleE9mKCcjUFJPRklMRV9UWVBFJykgIT09IC0xKSB7XHJcbiAgICAgICAgdmFyIHZhbCA9IGFwcC5TQ09QRS5BUFBfQ09ORklHLm5hbWU7XHJcbiAgICAgICAgcmVwbGFjZWRNc2cgPSByZXBsYWNlZE1zZy5yZXBsYWNlKCcjUFJPRklMRV9UWVBFJywgdmFsKTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHJlcGxhY2VkTXNnLmluZGV4T2YoJyNWQVJfU1BVVUlEJykgIT09IC0xKSB7XHJcbiAgICAgICAgdmFyIHZhbCA9IHNwdXVpZDtcclxuICAgICAgICByZXBsYWNlZE1zZyA9IHJlcGxhY2VkTXNnLnJlcGxhY2UoJyNWQVJfU1BVVUlEJywgdmFsKTtcclxuXHJcbiAgICB9XHJcblxyXG5cclxuICAgIHJldHVybiByZXBsYWNlZE1zZztcclxufTtcclxuXHJcbmZ1bmN0aW9uIF9nZXROYW1lKGFyciwgbGFuZykge1xyXG4gICAgaWYgKGFyciAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKGFycltpXS5fbGFuZyA9PT0gbGFuZykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGFycltpXS52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufTtcclxuXHJcblxyXG5cclxuXHJcbm1vZHVsZS5leHBvcnRzID0ge1xyXG5cclxuICAgIHByZVJlcXVpc2l0ZXM6IHByZVJlcXVpc2l0ZXMsXHJcbiAgICBwcmVBY3Rpb25zOiBwcmVBY3Rpb25zLFxyXG4gICAgc3ViUHJvY2Vzczogc3ViUHJvY2VzcyxcclxuICAgIGluZGljYXRvckRvY3M6IGluZGljYXRvckRvY3MsXHJcbiAgICB0YXNrOiB0YXNrLFxyXG4gICAgdHJhbnNpdGlvbjogdHJhbnNpdGlvbixcclxuICAgIGFzc2lnblVzZXI6IGFzc2lnblVzZXJcclxuXHJcbn0iLCIndXNlIHN0cmljdCc7XHJcblxyXG4vKipcclxuICogVXRpbGl0eSBNb2R1bGVcclxuICpcclxuICogQG1vZHVsZSBsaWIvdXRpbFxyXG4gKlxyXG4gKiBAYXV0aG9yIEJyZW50IEdvcmRvblxyXG4gKiBAdmVyc2lvbiAwLjEuMFxyXG4gKlxyXG4gKiBAZGVzY3JpcHRpb25cclxuICogV29ya2Zsb3cgdXRpbGl0eSBtb2R1bGUgdXNlZCB0byBmb3JtYXQgdGhlIHJldHVybiBhbmQgZXJyb3Igb2JqZWN0cywgYW5kXHJcbiAqIGNvbnRhaW5zIHNvbWUgb3RoZXIgdXRpbGl0eSBmdW5jdGlvbnMgc3VjaCBhcyBhIHN5bmMgbG9vcCBhbmQgY29tcGFyZS5cclxuICpcclxuICovXHJcblxyXG4vKipcclxuICogU3VjY2VzcyBibG9jayByZXR1cm4gb2JqZWN0LCBjb250YWlucyBhIG1lc3NhZ2UgYW5kIG9wdGlvbmFsIGRhdGEgb2JqZWN0LlxyXG4gKlxyXG4gKiBAcGFyYW0ge3N0cmluZ30gbWVzc2FnZSAtIHRoZSBzdWNjZXNzIG1lc3NhZ2VcclxuICogQHBhcmFtIHtzdHJpbmd8T2JqZWN0fSBbZGF0YV0gLSB0aGUgc3VjY2VzcyByZXR1cm5lZCBkYXRhXHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqIC8vIFJldHVybiBzdWNjZXNzIHdpdGhvdXQgYSBkYXRhIGJsb2NrXHJcbiAqIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdTdWNjZXNzIG1lc3NhZ2UgZ29lcyBoZXJlLi4uJyk7XHJcbiAqXHJcbiAqIEByZXR1cm4ge09iamVjdH0gLSB3aXRoIG1lc3NhZ2UgYW5kIGRhdGEgcHJvcGVydGllc1xyXG4gKlxyXG4gKi9cclxuZnVuY3Rpb24gc3VjY2VzcyhtZXNzYWdlLCBkYXRhKXtcclxuXHRyZXR1cm4ge1xyXG5cdFx0bWVzc2FnZTogbWVzc2FnZSxcclxuXHRcdGRhdGE6IGRhdGFcclxuXHR9O1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFdhcm5pbmcgYmxvY2sgcmV0dXJuIG9iamVjdCwgY29udGFpbnMgYSBtZXNzYWdlIGFuZCBvcHRpb25hbCBkYXRhIG9iamVjdC5cclxuICpcclxuICogQHBhcmFtIHtzdHJpbmd9IG1lc3NhZ2UgLSB0aGUgd2FybmluZyBtZXNzYWdlXHJcbiAqIEBwYXJhbSB7c3RyaW5nfE9iamVjdH0gW2RhdGFdIC0gdGhlIHJldHVybmVkIGRhdGFcclxuICpcclxuICogQGV4YW1wbGVcclxuICogLy8gUmV0dXJuIHN1Y2Nlc3Mgd2l0aG91dCBhIGRhdGEgYmxvY2tcclxuICogdmFyIHN1Y2Nlc3MgPSB1dGlsLndhcm4oJ1dhcm5pbmcgbWVzc2FnZSBnb2VzIGhlcmUuLi4nKTtcclxuICpcclxuICogQHJldHVybiB7T2JqZWN0fSB3aXRoIG1lc3NhZ2UgYW5kIGRhdGEgcHJvcGVydGllcywgYW5kIGxvZ3MgdGhlIHdhcm5pbmcgdG8gdGhlIGNvbnNvbGUuXHJcbiAqXHJcbiAqL1xyXG5mdW5jdGlvbiB3YXJuKG1lc3NhZ2UsIGRhdGEpe1xyXG5cdGNvbnNvbGUud2FybihkYXRhKTtcclxuXHRyZXR1cm4ge1xyXG5cdFx0d2FybmluZzogbWVzc2FnZSxcclxuXHRcdGRhdGE6IGRhdGFcclxuXHR9O1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIEVycm9yIGJsb2NrIEpTIGVycm9yIG9iamVjdCwgY29udGFpbnMgYSBjb2RlIGFuZCBtZXNzYWdlIGZvciB0aGUgZXJyb3IuXHJcbiAqXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBjb2RlIC0gdGhlIGVycm9yIGNvZGVcclxuICogQHBhcmFtIHtzdHJpbmd9IG1lc3NhZ2UgLSB0aGUgZXJyb3IgbWVzc2FnZVxyXG4gKlxyXG4gKiBAZXhhbXBsZVxyXG4gKiB2YXIgc3VjY2VzcyA9IHV0aWwuZXJyb3IoJ0Vycm9yMDAxJywnRXJyb3IgbWVzc2FnZSBnb2VzIGhlcmUuLi4nKTtcclxuICpcclxuICogQHJldHVybiB7T2JqZWN0fSB3aXRoIGEgY29kZSBhbmQgbWVzc2FnZSBwcm9wZXJ0aWVzLlxyXG4gKlxyXG4gKi9cclxuZnVuY3Rpb24gZXJyb3IoY29kZSwgbWVzc2FnZSl7XHJcblx0dmFyIGVyciA9IG5ldyBFcnJvcignJyk7XHJcblx0ZXJyLm5hbWUgPSBjb2RlO1xyXG5cdGVyci5tZXNzYWdlID0gbWVzc2FnZTtcclxuXHRyZXR1cm4gZXJyO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIEEgbG9vcCB3aGljaCBjYW4gbG9vcCBYIGFtb3VudCBvZiB0aW1lcywgd2hpY2ggY2FycmllcyBvdXRcclxuICogYXN5bmNocm9ub3VzIGNvZGUsIGJ1dCB3YWl0cyBmb3IgdGhhdCBjb2RlIHRvIGNvbXBsZXRlIGJlZm9yZSBsb29waW5nLlxyXG4gKlxyXG4gKiBAcGFyYW0ge251bWJlcn0gaXRlcmF0aW9ucyAtIHRoZSBudW1iZXIgb2YgaXRlcmF0aW9ucyB0byBjYXJyeSBvdXRcclxuICogQHBhcmFtIHtmdW5jdGlvbn0gcHJvY2VzcyAtIHRoZSBjb2RlL2Z1bmN0aW9uIHdlJ3JlIHJ1bm5pbmcgZm9yIGV2ZXJ5XHJcbiAqIGl0ZXJhdGlvblxyXG4gKiBAcGFyYW0ge2Z1bmN0aW9ufSBleGl0IC0gYW4gb3B0aW9uYWwgY2FsbGJhY2sgdG8gY2Fycnkgb3V0IG9uY2UgdGhlIGxvb3BcclxuICogaGFzIGNvbXBsZXRlZFxyXG4gKlxyXG4gKiBAZXhhbXBsZVxyXG4gKiB1dGlsLnN5bmNMb29wKDUsIGZ1bmN0aW9uKGxvb3Ape1xyXG4gKiBcdHZhciBjb3VudGVyID0gbG9vcC5pdGVyYXRpb24oKTtcclxuICogXHQvLyBBZGQgYXN5bmMgY2FsbHMgaGVyZS4uXHJcbiAqXHJcbiAqIH0sIGZ1bmN0aW9uKCl7XHJcbiAqIFx0Ly8gT24gY29tcGxldGUgcGVyZm9ybSBhY3Rpb25zIGhlcmUuLi5cclxuICpcclxuICogfSk7XHJcbiAqXHJcbiAqIEByZXR1cm4ge09iamVjdH0gdGhlIGxvb3AgY29udHJvbCBvYmplY3QuXHJcbiAqXHJcbiAqL1xyXG5mdW5jdGlvbiBzeW5jTG9vcChpdGVyYXRpb25zLCBwcm9jZXNzLCBleGl0KXtcclxuICAgIHZhciBpbmRleCA9IDAsXHJcbiAgICAgICAgZG9uZSA9IGZhbHNlLFxyXG4gICAgICAgIHNob3VsZEV4aXQgPSBmYWxzZTtcclxuICAgIHZhciBsb29wID0ge1xyXG4gICAgICAgIG5leHQ6ZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgaWYoZG9uZSl7XHJcbiAgICAgICAgICAgICAgICBpZihzaG91bGRFeGl0ICYmIGV4aXQpe1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBleGl0KCk7IC8vIEV4aXQgaWYgd2UncmUgZG9uZVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIElmIHdlJ3JlIG5vdCBmaW5pc2hlZFxyXG4gICAgICAgICAgICBpZihpbmRleCA8IGl0ZXJhdGlvbnMpe1xyXG4gICAgICAgICAgICAgICAgaW5kZXgrKzsgLy8gSW5jcmVtZW50IG91ciBpbmRleFxyXG4gICAgICAgICAgICAgICAgcHJvY2Vzcyhsb29wKTsgLy8gUnVuIG91ciBwcm9jZXNzLCBwYXNzIGluIHRoZSBsb29wXHJcbiAgICAgICAgICAgIC8vIE90aGVyd2lzZSB3ZSdyZSBkb25lXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBkb25lID0gdHJ1ZTsgLy8gTWFrZSBzdXJlIHdlIHNheSB3ZSdyZSBkb25lXHJcbiAgICAgICAgICAgICAgICBpZihleGl0KSBleGl0KCk7IC8vIENhbGwgdGhlIGNhbGxiYWNrIG9uIGV4aXRcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgaXRlcmF0aW9uOmZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgIHJldHVybiBpbmRleCAtIDE7IC8vIFJldHVybiB0aGUgbG9vcCBudW1iZXIgd2UncmUgb25cclxuICAgICAgICB9LFxyXG4gICAgICAgIGJyZWFrOmZ1bmN0aW9uKGVuZCl7XHJcbiAgICAgICAgICAgIGRvbmUgPSB0cnVlOyAvLyBFbmQgdGhlIGxvb3BcclxuICAgICAgICAgICAgc2hvdWxkRXhpdCA9IGVuZDsgLy8gUGFzc2luZyBlbmQgYXMgdHJ1ZSBtZWFucyB3ZSBzdGlsbCBjYWxsIHRoZSBleGl0IGNhbGxiYWNrXHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIGxvb3AubmV4dCgpO1xyXG4gICAgcmV0dXJuIGxvb3A7XHJcbn07XHJcblxyXG5mdW5jdGlvbiBjb21wYXJlKHN1YmplY3QsIG9wZXJhdG9yLCB2YWx1ZSkge1xyXG4gIFx0c3dpdGNoIChvcGVyYXRvcikge1xyXG4gIFx0XHRjYXNlICdncmVhdGVyVGhhbic6XHJcblx0XHRcdHJldHVybiBzdWJqZWN0ID4gdmFsdWU7XHJcblx0XHRjYXNlICdsZXNzVGhhbic6XHJcblx0XHRcdHJldHVybiBzdWJqZWN0IDwgdmFsdWU7XHJcblx0XHRjYXNlICdncmVhdGVyVGhhbkVxdWFsJzpcclxuXHRcdFx0cmV0dXJuIHN1YmplY3QgPj0gdmFsdWU7XHJcblx0XHRjYXNlICdsZXNzVGhhbkVxdWFsJzpcclxuXHRcdFx0cmV0dXJuIHN1YmplY3QgPD0gdmFsdWU7XHJcblx0XHRjYXNlICdlcXVhbFRvJzpcclxuXHRcdFx0cmV0dXJuIHN1YmplY3QgPT09IHZhbHVlO1xyXG5cdFx0Y2FzZSAnbm90RXF1YWxUbyc6XHJcblx0XHRcdHJldHVybiBzdWJqZWN0ICE9PSB2YWx1ZTtcclxuICBcdH1cclxufTtcclxuXHJcbmZ1bmN0aW9uIGdldE5hbWUoYXJyLCBsYW5nKXtcclxuXHRpZiAoYXJyICE9PSB1bmRlZmluZWQpIHtcclxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgYXJyLmxlbmd0aCA7IGkrKykge1xyXG5cdFx0XHRpZiAoYXJyW2ldLmkxOG4uX2xhbmcgPT09IGxhbmcpIHtcclxuXHRcdFx0XHRyZXR1cm4gYXJyW2ldLmkxOG4udmFsdWU7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0ge1xyXG5cclxuIFx0c3VjY2Vzczogc3VjY2VzcyxcclxuIFx0d2Fybjogd2FybixcclxuIFx0ZXJyb3I6IGVycm9yLFxyXG4gXHRzeW5jTG9vcDogc3luY0xvb3AsXHJcbiBcdGNvbXBhcmU6IGNvbXBhcmUsXHJcblx0Z2V0TmFtZTogZ2V0TmFtZVxyXG5cclxuIH1cclxuIl19
