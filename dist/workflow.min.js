(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.Workflow = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";function Workflow(e,s,t,i){var r=this;if(""==s||void 0==s)throw util.error("ParamRequired","A community id is required.");if("string"!=typeof s)throw new Error("The community id must be a javascript string.");if(r.communityId=s||"",""==e||void 0==e)throw util.error("ParamRequired","A profile id is required.");if("string"!=typeof e)throw new Error("The profile id must be a javascript string.");if(r.profile=e||"",""==t||void 0==t)throw util.error("ParamRequired","An app id is required.");if("string"!=typeof t)throw new Error("The app id must be a javascript string.");if(r.app=t||"",""==i||void 0==i)throw util.error("ParamRequired","A workflow configuration is required.");"object"!=typeof i?r.config=JSON.parse(i):r.config=i,r.instance,r.subprocesses=[],r.indicators=[],r.history=[]}var Process=require("./lib/process"),util=require("utility"),userInterface=require("./lib/interface");Workflow.prototype.getProfile=function(){return this.profile},Workflow.prototype.getApp=function(){return this.app},Workflow.prototype.getConfig=function(){return this.config},Workflow.prototype.getInstance=function(){return this.instance},Workflow.prototype.setInstance=function(e){this.instance=e},Workflow.prototype.getSubProcesses=function(){return this.subprocesses},Workflow.prototype.setSubProcesses=function(e){this.subprocesses=e},Workflow.prototype.getIndicators=function(){return this.indicators},Workflow.prototype.setIndicators=function(e){this.indicators=e},Workflow.prototype.create=function(){var e=this;return new Promise(function(s,t){try{if(void 0!==e.instance){var i=util.warn("Instance already exists.",e);s(i)}else{var r={_id:"",version:"",type:"workflowInstance",processes:[],channels:["community_"+app.SCOPE.getCommunityId(),"profile_"+app.SCOPE.profileId,"application_"+app.SCOPE.applicationId,"community_"+app.SCOPE.getCommunityId()+"_application_"+app.SCOPE.applicationId]};r._id=e.profile+":processes",r.version=e.config.version,e.instance=r;var o=util.success("Workflow processes instance created successfully.",e);s(o)}}catch(e){t(e)}})},Workflow.prototype.initialise=function(e,s){var t=this;return new Promise(function(i,r){try{var o=[];if(""!==e&&void 0!==e){if(o=t.config.processes.filter(function(s){if(s._id==e)return s}),void 0==o[0]._id){var n=util.error("WFConfigError","No valid process definition found with process id: "+e);r(n)}}else o.push(t.config.processes[0]),e=t.config.processes[0]._id;var c=[];t.instance.processes.filter(function(s){s.id==e&&c.push(s)});var a=c.length+1,u={id:"",seq:"",subProcesses:[]};u.id=e,u.seq=a,t.instance.processes.push(u);var p=o[0].subProcesses[0]._id,f=1;t.instance.processes.filter(function(s){s.id==e&&s.seq==a&&(f=s.subProcesses.length+1)}),Process.subProcess(e,a,p,f,s,t).then(function(o){var n=o.data._id,c=s.label,l={id:p,seq:f,uuid:n,label:c};u.subProcesses.push(l);for(var d=0;d<t.instance.processes.length;d++){var h=t.instance.processes[d];h.id==e&&h.seq==a&&t.instance.processes.splice(d,1,u)}var w=o.data.indicators,v=o.data.step;Process.indicatorDocs(e,w,v,t).then(function(e){var s=util.success("Process: "+t.config.processes[0]._id+" initialized successfully.",t);i(s)},function(e){r(e)})},function(s){t.instance.processes=t.instance.processes.filter(function(s){return!(s.id==e&&s.seq==a)}),console.log(s),r(s)})}catch(e){r(e)}})},Workflow.prototype.transition=function(e,s,t,i,r,o,n){var c=this;return new Promise(function(a,u){try{Process.transition(e,s,t,i,r,o,n,c).then(function(r){var o=function(o){c.instance.processes.filter(function(n){n.id==e&&n.seq==s&&n.subProcesses.filter(function(e){e.id==t&&e.seq==i&&c.subprocesses.filter(function(s){if(s._id==e.uuid)if("step"==o){s.step=r.data;var t=util.success(r.message,s);a(t)}else if("stepComplete"==o){s.step=r.data.step,s.complete=!0;var t=util.success(r.message,s);a(t)}})})})};o(r.data.subProcessComplete?"stepComplete":"step")},function(e){u(e)})}catch(e){u(e)}})},Workflow.prototype.assignUser=function(e,s,t,i,r){var o=this;return new Promise(function(n,c){try{Process.assignUser(e,s,t,i,r,o).then(function(e){n(e)},function(e){c(e)})}catch(e){c(e)}})},Workflow.prototype.ui=function(){var e=this;return{getProcess:function(s,t){return new Promise(function(i,r){try{userInterface.getProcess(s,t,e).then(function(e){i(e)},function(e){r(e)})}catch(e){r(e)}})}}},module.exports=Workflow;

},{"./lib/interface":5,"./lib/process":7,"utility":8}],2:[function(require,module,exports){
"use strict";var util=require("utility"),nodeValue=require("./nodeValue"),form=require("./form"),community=function(){return{createCommunity:function(e,i,t){return new Promise(function(e,i){var n=worker.getWorkerWrapper();n._id=generateUUID(),n.communityId=app.SCOPE.getCommunityId(),n.applicationId=app.SCOPE.applicationId,n.createdDateTime=(new Date).toString(),n.senderUserId=LOCAL_SETTINGS.SUBSCRIPTIONS.userId;var r=JSON.xpath("/indicators[category/term eq 'Community']/_id",t,{})[0],o={createCommunity:{newCommunityId:t.profile,indicatorUUID:{Community:r}}};n.action=o,worker.send(n).then(function(i){var t=util.success("Worker processed successfully.",i);e(t)},function(e){i(e)})})},userJoinCommunity:function(e,i,t){return new Promise(function(e,i){})},releaseAdoptedApplication:function(e,i,t){return new Promise(function(e,n){var r=worker.getWorkerWrapper();r._id=generateUUID(),r.communityId=app.SCOPE.getCommunityId(),r.applicationId=app.SCOPE.applicationId,r.createdDateTime=(new Date).toString(),r.senderUserId=LOCAL_SETTINGS.SUBSCRIPTIONS.userId;var o=JSON.xpath("/subprocesses[_id eq '"+i+"']/indicators[id eq 'adoptedApplication']/instances[1]/uuid",t,{})[0],a={releaseAdoptedApplication:{communityId:t.profile,indicatorUUID:{adoptedApplication:o}}};r.action=a,worker.send(r).then(function(i){var t=util.success("Worker processes successfully.",i);e(t)},function(e){n(e)})})}}}(),application=function(){return{createAppDefinition:function(e,i,t){return new Promise(function(e,i){var n=worker.getWorkerWrapper();n._id=generateUUID(),n.communityId=app.SCOPE.getCommunityId(),n.applicationId=app.SCOPE.applicationId,n.createdDateTime=(new Date).toString(),n.senderUserId=LOCAL_SETTINGS.SUBSCRIPTIONS.userId;var r=JSON.xpath("/indicators[category/term eq 'Application']/_id",t,{})[0],o={createApplication:{newApplicationId:t.profile,indicatorUUID:{Application:r}}};n.action=o,worker.send(n).then(function(i){var t=util.success("Worker processes successfully.",i);e(t)},function(e){i(e)})})},buildApplication:function(e,i,t){return new Promise(function(e,n){var r=worker.getWorkerWrapper();r._id=generateUUID(),r.communityId=app.SCOPE.getCommunityId(),r.applicationId=app.SCOPE.applicationId,r.createdDateTime=(new Date).toString(),r.senderUserId=LOCAL_SETTINGS.SUBSCRIPTIONS.userId;var o=JSON.xpath("/subprocesses[_id eq '"+i+"']/indicators[id eq 'PublishApplication']/instances[1]/uuid",t,{})[0],a=JSON.xpath("/indicators[category/term eq 'ApplicationDefinition']/_id",t,{})[0],c=JSON.xpath("/indicators[category/term eq 'Roles']/_id",t,{})[0],p=JSON.xpath("/indicators[category/term eq 'Application']/_id",t,{})[0],s=JSON.xpath("/indicators[category/term eq 'AppPermissions']/_id",t,{})[0],u={buildApplication:{applicationId:t.profile,indicatorUUID:{PublishApplication:o,ApplicationDefinition:a,Roles:c,Application:p,AppPermissions:s}}};r.action=u,worker.send(r).then(function(i){var t=util.success("Worker processes successfully.",i);e(t)},function(e){n(e)})})},applicationAdoption:function(e,i,t){return new Promise(function(e,n){var r=worker.getWorkerWrapper();r._id=generateUUID(),r.communityId=app.SCOPE.getCommunityId(),r.applicationId=app.SCOPE.applicationId,r.createdDateTime=(new Date).toString(),r.senderUserId=LOCAL_SETTINGS.SUBSCRIPTIONS.userId;var o=JSON.xpath("/subprocesses[_id eq '"+i+"']/indicators[id eq 'Adoption']/instances[1]/uuid",t,{})[0],a=JSON.xpath("/indicators[category/term eq 'PublishApplication']/_id",t,{})[0],c=JSON.xpath("/indicators[category/term eq 'Application']/_id",t,{})[0],p={adoptApplication:{applicationId:t.profile,indicatorUUID:{Adoption:o,PublishApplication:a,Application:c}}};r.action=p,worker.send(r).then(function(i){var t=util.success("Worker processes successfully.",i);e(t)},function(e){n(e)})})}}}(),worker=function(){return{getWorkerWrapper:function(){var e={source:"remote",type:"workerObject",_id:"",channels:[],communityId:"",applicationId:"",message:"",messageType:"info",createdDateTime:"",senderUserId:"",notification:{},action:{}};return e},send:function(e){return new Promise(function(i,t){console.log("Submitting Worker Object to server"),console.log(e),dao.save(e).done(function(e){i(e)}).fail(function(e){console.log("Error submitting worker response !!"+e),t(e)})})}}}(),performance=function(){return{createPlan:function(e,i,t){return new Promise(function(e,i){var n=worker.getWorkerWrapper();n._id=generateUUID(),n.communityId=app.SCOPE.getCommunityId(),n.applicationId=app.SCOPE.applicationId,n.createdDateTime=(new Date).toString(),n.senderUserId=LOCAL_SETTINGS.SUBSCRIPTIONS.userId;var r=JSON.xpath("/indicators[category/term eq 'plan']/_id",t,{})[0],o={createPlan:{planUUID:r}};n.action=o,worker.send(n).then(function(i){var t=util.success("Worker processed successfully.",i);e(t)},function(e){i(e)})})}}}();module.exports={community:community,application:application,performance:performance,worker:worker};

},{"./form":3,"./nodeValue":6,"utility":8}],3:[function(require,module,exports){
"use strict";function create(args){var processId=args[0]||"",subProcess=args[1]||{},step=args[2]||{},action=args[3]||{},_WFInstance=args[6]||{},data=args[6]||{},indicators=subProcess.indicators||[],result=[],indicatorType=action._type,processSeq=args[4]||"",subProcessSeq=args[5]||"",createType=args[7]||"",subProcessId=subProcess._id,uuid=args[8]||"",baseUUID=args[9]||"",profile=_WFInstance.profile,inputData=args[10]||{};return new Promise(function(resolve,reject){for(var toProcess=indicators.length,formCreateFn=function(id,indicatorType,indicatorId,validDate,instantiateSource){gatekeeper.instantiate(id,indicatorType,indicatorId,_WFInstance.profile,validDate).then(function(docArray){for(var i=0;i<docArray.length;i++){var object=docArray[i];if(!object.model._id.endsWith(":approved")&&!object.model._id.endsWith(":rejected")){var workflowObj={id:_WFInstance.config._id,instance:_WFInstance.instance._id,processes:[{id:processId,subProcessId:subProcess._id,subProcessUUID:uuid,step:{id:step.id,seq:step.seq,startDate:"",status:step.status,message:step.message,assignedTo:{userId:step.assignedTo.userId,name:step.assignedTo.name},comment:step.comment,complete:!1,endDate:""}}]};void 0!=action.setWorkflowLabelInTitle&&""!=action.setWorkflowLabelInTitle&&1==action.setWorkflowLabelInTitle&&(object.model.title=inputData.label),void 0!=action.setDraft&&""!=action.setDraft&&1==action.setDraft&&(object.model.control.draft=!0),object.model.workflows.push(workflowObj);var mainId=object.model._id;gatekeeper.persist(docArray).then(function(savedArray){dao.get(mainId).done(function(data){var indicatorModel=ko.mapping.fromJS({defaultModel:{setId:indicatorId}});gatekeeper.instantiateData(mainId,instantiateSource,indicatorModel,data.model.pending.seq).then(function(data){if("200"==data[0].status){if(void 0!=action.setWorkflowLabelInField&&""!=action.setWorkflowLabelInField&&mainId==profile){console.log(data[0]);var path="data[0].model.model.pending.data."+action.setWorkflowLabelInField+"='"+inputData.label+"'";eval(path)}gatekeeper.persist(data).then(function(e){dao.get(mainId).done(function(e){if(0==_WFInstance.indicators.length){if(_WFInstance.indicators.push(e),toProcess--,0==toProcess){var s=util.success("Form created successfully.",_WFInstance.indicators);resolve(s)}}else{for(var t=!1,i=0;i<_WFInstance.indicators.length;i++){var a=_WFInstance.indicators[i];if(a._id==e._id&&(t=!0,_WFInstance.indicators.splice(i,1),_WFInstance.indicators.push(e),toProcess--,0==toProcess)){var s=util.success("Form created successfully.",_WFInstance.indicators);resolve(s)}}if(0==t&&(_WFInstance.indicators.push(e),toProcess--,0==toProcess)){var s=util.success("Form created successfully.",_WFInstance.indicators);resolve(s)}}}).fail(function(e){console.error(e);var s=util.success("1 Gatekeeper initialisation failed with initialiseData message "+e[0].message,{});reject(s)})},function(e){console.error(e);var s=util.success("2 Gatekeeper initialisation failed with initialiseData message "+e[0].message,{});reject(s)})}else{var failure=util.success("3 Gatekeeper initialisation failed with initialiseData message "+err[0].message,{});reject(failure)}},function(e){var s=util.success("4 Gatekeeper initialisation failed with initialiseData message "+e[0].message,{});reject(s)})}).fail(function(e){console.error(e);var s=util.success("5 Gatekeeper initialisation failed with initialiseData message "+e[0].message,{});reject(s)})},function(e){console.error(e);var s=util.success("6 Gatekeeper initialisation failed with initialiseData message "+e[0].message,{});reject(s)})}}},function(e){for(var s=[],t=0;t<_WFInstance.instance.processes.length;t++)_WFInstance.instance.processes[t].subProcesses.length>0&&s.push(_WFInstance.instance.processes[t]);_WFInstance.instance.processes=[],_WFInstance.instance.processes=s;for(var i=[],t=0;t<_WFInstance.subprocesses.length;t++)_WFInstance.subprocesses[t].indicators.length>0&&i.push(_WFInstance.subprocesses[t]);_WFInstance.subprocesses=[],_WFInstance.subprocesses=i,console.error(e);var a=util.success("7 Gatekeeper initialisation failed with initialiseData message "+e[0].message,{});reject(a)})},instantiateSource="fromDefinition",counter=0;counter<indicators.length;counter++){var indicatorId=indicators[counter]._id,indicatorName=util.getName(indicators[counter].name,"en"),initType="";void 0!=subProcess.instanceType.newSequence?initType="newSequence":void 0!=subProcess.instanceType.newInstance&&(initType="newInstance");var id="",indicatorDoc={};if("newInstance"==initType)if(void 0!=baseUUID&&""!=baseUUID&&baseUUID.length>0){var existingUUID=JSON.xpath("/subprocesses[_id eq '"+baseUUID+"']/indicators[id eq '"+indicatorId+"']/instances[1]/uuid",_WFInstance,{})[0];id=existingUUID,initType="newSequence";var sp=JSON.xpath("/subprocesses[_id eq '"+baseUUID+"']",app.SCOPE.workflow,{})[0];sp.active=!1,instantiateSource="fromAuthorised"}else id=void 0==subProcess.isProfile||!subProcess.isProfile||indicatorId!=PROFILE_SET_ID&&1!=app.SCOPE.APP_CONFIG.indicators.length?indicatorId+"-"+generateUUID():profile;else{var spLastUuid=JSON.xpath("/instance/processes[id eq '"+processId+"' and subProcesses/id eq '"+subProcessId+"'][1]/subProcesses/uuid",_WFInstance,{})[0],indId=JSON.xpath("/subprocesses[_id eq '"+spLastUuid+"']/indicators[id eq '"+indicatorId+"']/instances/uuid",app.SCOPE.workflow,{})[0];if(id=""==spLastUuid||void 0==spLastUuid||""==indId||void 0==indId?void 0==subProcess.isProfile||!subProcess.isProfile||indicatorId!=PROFILE_SET_ID&&1!=app.SCOPE.APP_CONFIG.indicators.length?indicatorId+"-"+generateUUID():profile:indId,void 0!=baseUUID&&""!=baseUUID&&baseUUID.length>0){var sp=JSON.xpath("/subprocesses[_id eq '"+baseUUID+"']",app.SCOPE.workflow,{})[0];sp.active=!1,instantiateSource="fromAuthorised"}}console.log(id),console.log(initType),console.log(indicatorId),console.log(instantiateSource),formCreateFn(id,initType,indicatorId,"",instantiateSource)}})}function setInstanceTitle(e){var s=e[0]||{},t=e[2]||"",i=e[4]||{},a=i.label;return new Promise(function(e,i){for(var n=JSON.xpath("/subprocesses[_id eq '"+t+"']",s,{})[0],r=n.indicators,o=0;o<r.length;o++){var c=r[o].instances[0].uuid,d=JSON.xpath("/indicators[_id eq '"+c+"']",s,{})[0];d.title=r[o].id+" "+a}e("Set Title Success",r)})}function deleteProfile(e){var s=e[0]||{},t=s.profile;return new Promise(function(e,s){var i={source:"remote",type:"workerObject",_id:generateUUID(),channels:[],communityId:app.SCOPE.getCommunityId(),applicationId:app.SCOPE.applicationId,message:"",messageType:"info",createdDateTime:moment().format(),senderUserId:LOCAL_SETTINGS.SUBSCRIPTIONS.userId,notification:{},profile:{action:"deleteProfile",profileId:t}};console.log(i),dao.upsert(i).done(function(s){console.log("Worker Object submitted for profile("+t+") deletion."),console.log(s),e(s)}).fail(function(e){console.log(e),s(data)})})}function createProfile(e){var s=e[1]||{},t=s.communityId,i=s.profile;return new Promise(function(e,s){library.createProfileDocuments(t,i).done(function(s){var t=util.success("Form created successfully.",s);e(t)}).fail(function(e){console.error(e);var t=util.success("ERROR: Profile creation failed"+e[0].message,{});s(t)})})}function setDraft(e){var s=e[0]||{},t=(s.communityId,s.profile,e[2]||"");return new Promise(function(e,i){for(var a=JSON.xpath("/subprocesses[_id eq '"+t+"']",s,{})[0],n=a.indicators,r=0;r<n.length;r++){var o=n[r].instances[0].uuid,c=JSON.xpath("/indicators[_id eq '"+o+"']",s,{})[0];c.control.draft=!0}e("Set Draft Success",n)})}function setUnDraft(e){var s=e[0]||{},t=(s.communityId,s.profile,e[2]||"");return new Promise(function(e,i){for(var a=JSON.xpath("/subprocesses[_id eq '"+t+"']",s,{})[0],n=a.indicators,r=0;r<n.length;r++){var o=n[r].instances[0].uuid,c=JSON.xpath("/indicators[_id eq '"+o+"']",s,{})[0];c.control.draft=!1}e("Set Draft Success",n)})}function save(e){var s={complete:!0,data:[]};return new Promise(function(e,t){var i=util.success("Form indicator set saved successfully.",s);e(i)})}function submit(e){var s={complete:!0,data:[]};return new Promise(function(e,t){var i=util.success("Form submitted successfully.",s);e(i)})}function authorise(e){var s=e[0]||"",t=e[1]||{},i=t._id,a=e[2]||"",n=e[3]||"",r=e[4]||{};return new Promise(function(e,t){for(var o=JSON.xpath("/processes[id eq '"+s+"' and seq eq '"+a+"']/subProcesses[id eq '"+i+"' and seq eq '"+n+"']/uuid",r.instance,{})[0],c=JSON.xpath("/subprocesses[_id eq '"+o+"']/indicators/instances/uuid",r,{}),d=c.length,u=[],l=0;l<d;l++)gatekeeper.authorise(c[l]).then(function(s){gatekeeper.persist(s).then(function(s){for(var t="",i=0;i<s.length;i++)s[i].id.endsWith(":approved")||(t=s[i].id);dao.get(t).done(function(s){if(0==r.indicators.length){if(r.indicators.push(s),d--,0==d){var t=util.success("Form authorised successfully.",u);e(t)}}else{for(var i=!1,a=0;a<r.indicators.length;a++){var n=r.indicators[a];if(n._id==s._id&&(i=!0,r.indicators.splice(a,1),r.indicators.push(s),d--,0==d)){var t=util.success("Form authorised successfully.",u);e(t)}}if(0==i&&(r.indicators.push(s),d--,0==d)){var t=util.success("Form authorised successfully.",u);e(t)}}}).fail(function(e){console.error(e)})},function(e){console.error(err)})},function(s){if(d--,0==d){var t=util.success("Form authorised successfully.",u);e(t)}})})}function close(e){var s={complete:!0,data:[]};return new Promise(function(e,t){var i=util.success("Form closed successfully.",s);e(i)})}function updateIndicator(args){var _WFInstance=args[0]||{},uuid=args[1]||"",path=args[2]||"",dataValue=args[3]||"";return new Promise(function(resolve,reject){var subProcessInstance=JSON.xpath("/subprocesses[_id eq '"+uuid+"']",_WFInstance,{})[0],indicatorInstances=subProcessInstance.indicators,setId=path.split(".",1)[0],indicatorUUID=JSON.xpath("/*[id eq '"+setId+"']/instances/uuid",indicatorInstances,{})[0],indObject=JSON.xpath("/indicators[_id eq '"+indicatorUUID+"']",_WFInstance,{})[0],expr="indObject.model.pending.data."+path+' = "'+dataValue+'"';eval(expr);var itemsToProcess=1,stuff=[],obj={};obj.model=indObject,stuff.push(obj),gatekeeper.persist(stuff).then(function(e){for(var s="",t=0;t<e.length;t++)e[t].id.endsWith(":approved")||(s=e[t].id);dao.get(s).done(function(e){if(0==_WFInstance.indicators.length){if(_WFInstance.indicators.push(e),itemsToProcess--,0==itemsToProcess){var s=util.success("Indicator updated.",stuff);resolve(s)}}else{for(var t=!1,i=0;i<_WFInstance.indicators.length;i++){var a=_WFInstance.indicators[i];if(a._id==e._id&&(t=!0,_WFInstance.indicators.splice(i,1),_WFInstance.indicators.push(e),itemsToProcess--,0==itemsToProcess)){var s=util.success("Indicator updated.",stuff);resolve(s)}}if(0==t&&(_WFInstance.indicators.push(e),itemsToProcess--,0==itemsToProcess)){var s=util.success("Indicator updated.",stuff);resolve(s)}}}).fail(function(e){console.error(e)})},function(e){console.error(e)})})}function markUpdateIndicator(e){var s=e[0]||{},t=(e[1]||"",e[2]||""),i=e[3]||"";return new Promise(function(e,a){var n=JSON.xpath("/indicators[category/term eq '"+i+"']",s,{})[0];n.model.pending.status=t;var r=1,o=[],c={};c.model=n,o.push(c),gatekeeper.persist(o).then(function(t){for(var i="",a=0;a<t.length;a++)t[a].id.endsWith(":approved")||(i=t[a].id);dao.get(i).done(function(t){if(0==s.indicators.length){if(s.indicators.push(t),r--,0==r){var i=util.success("Indicator updated.",o);e(i)}}else{for(var a=!1,n=0;n<s.indicators.length;n++){var c=s.indicators[n];if(c._id==t._id&&(a=!0,s.indicators.splice(n,1),s.indicators.push(t),r--,0==r)){var i=util.success("Indicator updated.",o);e(i)}}if(0==a&&(s.indicators.push(t),r--,0==r)){var i=util.success("Indicator updated.",o);e(i)}}}).fail(function(e){console.error(e)})},function(e){console.error(e)})})}var util=require("utility"),gatekeeper=new GK;module.exports={create:create,save:save,submit:submit,authorise:authorise,close:close,setDraft:setDraft,setUnDraft:setUnDraft,createProfile:createProfile,setInstanceTitle:setInstanceTitle,deleteProfile:deleteProfile,updateIndicator:updateIndicator,markUpdateIndicator:markUpdateIndicator};

},{"utility":8}],4:[function(require,module,exports){
"use strict";function getLanguageMessage(message){var language=service.getLanguage(),res=eval("message.i18n."+language);return console.log(res),res}function getNodeValue(e,a,i){if(void 0!=e.value);else if(void 0!=e.currentIndicator);else{if(void 0!=e.indicator){var t=JSON.xpath("/subprocesses[_id eq '"+i+"']/indicators[id eq '"+e.indicator.indicatorSetId+"']/instances/uuid",a,{})[0],s=JSON.xpath("/indicators[_id eq '"+t+"']",a,{})[0],n=s.model.pending.data[e.indicator.indicatorSetId][e.indicator.elementId];return n}void 0!=e.system||void 0!=e.variable}}module.exports={getLanguageMessage:getLanguageMessage,getNodeValue:getNodeValue};

},{}],5:[function(require,module,exports){
"use strict";function getProcess(e,s,t){return new Promise(function(n,i){try{var c=[],r=[];t.instance.processes.filter(function(s){s.id==e&&(r=s)}),util.syncLoop(r.subProcesses.length,function(n){var o=n.iteration(),u=r.seq,f=r.subProcesses[o].id,a=r.subProcesses[o].seq;getSubProcess(e,u,f,a,s,t).then(function(e){c.push(e),n.next()},function(e){n.break(),i(e)})},function(){n(c)})}catch(e){i(e)}})}function getSubProcess(e,s,t,n,i,c){return new Promise(function(r,o){try{var u={id:"",seq:"",name:"",help:"",dates:"",step:""},f=[],a=[];c.instance.processes.filter(function(i){if(i.id==e&&i.seq==s){i.subProcesses.length;i.subProcesses.filter(function(e){e.id==t&&e.seq==n&&0==e.complete&&(f=e)})}}),c.config.processes.filter(function(s){s._id==e&&s.subProcesses.filter(function(e){e._id==t&&(a=e)})}),u.id=a._id,u.seq=f.seq,u.name=util.getName(a.name,i),u.help=util.getName(a.help,i),u.dates=f.dates,u.step=f.step,r(u)}catch(e){o(e)}})}function prepareNotificationScreen(){""}var util=require("utility");module.exports={getProcess:getProcess};

},{"utility":8}],6:[function(require,module,exports){
"use strict";function get(){return new Promise(function(e,t){})}module.exports={get:get};

},{}],7:[function(require,module,exports){
"use strict";function count(e){return void 0!==e?e.length:0}function preRequisites(e,t){return new Promise(function(s,i){var n=[];try{util.syncLoop(e.length,function(s){var o=s.iteration();preRequisite(e[o],t).then(function(e){n.push(!0),s.next()},function(e){n.push(!1),s.break(),i(e)})},function(){if(n.every(Boolean)){var e=util.success("Pre-requisites completed successfully.",{});s(e)}else{var t=util.error("WFPreRequisiteError","Not all pre-requisites passed.");i(t)}})}catch(e){i(e)}})}function preRequisite(e,t){return new Promise(function(s,i){var n="";if(void 0!=e.check.numberProcessInstances){var o=e.check.numberProcessInstances,a=o.operator,r="";switch(a){case"greaterThan":r="gt";break;case"lessThan":r="lt";break;case"greaterThanEqual":r="ge";break;case"lessThanEqual":r="le";break;case"equalTo":r="eq";break;case"notEqualTo":r="ne"}var c=o.subProcessId,u="step/status",d=o.type,p="/"+u+"[. eq '"+d+"']",l="count(/subprocesses[id eq '"+c+"']"+p+")";n=JSON.xpath(l,t,{})[0]}else if(void 0!=e.check.variableConfirm);else{var f=util.error("WFPreRequisiteError","Pre-requisite type not defined.");i(f)}var m="";if(e.check.numberProcessInstances?m=util.compare(n,e.check.numberProcessInstances.operator,parseInt(e.check.numberProcessInstances.count)):e.check.variableConfirm,m){var h=util.success("Pre-requisites passed.",{});s(h)}else{var v=helper.getLanguageMessage(e.message),f=util.error("WFPreRequisiteError",v);i(f)}})}function preActions(e,t){return new Promise(function(s,i){var n=[];try{util.syncLoop(e.length,function(s){var o=s.iteration();action(e[o],t).then(function(e){n.push(!0),s.next()},function(e){n.push(!1),s.break(),i(e)})},function(){if(n.every(Boolean)){var e=util.success("Pre-actions completed successfully.",{});s(e)}else{var t=util.error("WFPreRequisiteError","Not all pre-actions passed.");i(t)}})}catch(e){i(e)}})}function getSubProcess(e,t){return void 0==t.subprocesses?[]:void t.subprocesses.filter(function(t){if(t.id==e)return t})}function subProcess(e,t,s,i,n,o){var a=[],r=[],c=[];o.instance.processes.filter(function(n){if(n.id==e&&n.seq==t){n.subProcesses.length;n.subProcesses.filter(function(e){if(e.id==s&&e.seq==i){var t=e.uuid;o.subprocesses.filter(function(e){e._id==t&&(a=e)})}})}}),o.config.processes.filter(function(t){t._id==e&&(r=t,t.subProcesses.filter(function(e){e._id==s&&(c=e)}))});var u="",d=n.baseUUID;if(void 0!=d&&""!=d&&d.length>0){var p=JSON.xpath("/subprocesses[_id eq '"+d+"']",o,{})[0];u=p.groupKey}else u=generateUUID();var l=o.profile+":"+o.app+":"+e+":"+t+":"+s+":"+i,f={_id:l,id:s,type:"workflowInstanceSubProcess",seq:i,initiated:!1,dates:{created:"",valid:"",due:"",closed:""},complete:!1,indicators:[],step:{},active:!0,groupKey:u,channels:["community_"+app.SCOPE.getCommunityId(),"profile_"+app.SCOPE.profileId,"application_"+app.SCOPE.applicationId,"community_"+app.SCOPE.getCommunityId()+"_application_"+app.SCOPE.applicationId]};return o.subprocesses.push(f),new Promise(function(u,d){try{var p=r.preActions;preActions(p,o).then(function(p){var m=r.prerequisites;preRequisites(m,o).then(function(p){var m=c.initiate;initiate(m,a,n).then(function(a){f.initiated=a.data.initiated,f.dates=a.data.dates;var p=c.steps[0]._id,l=c.steps[0].transition[0]._id,m=1;step(e,t,s,i,p,m,n,o).then(function(a){f.step=a.data,indicators(c.indicators,o,f._id).then(function(a){f.indicators=a.data,transition(e,t,s,i,p,l,n,o).then(function(e){var t=e;f.step=e.data;var s=r.postActions;postActions(s,o).then(function(e){var s=util.success(t.message,f);u(s)},function(e){d(e)})},function(e){d(e)})},function(e){d(e)})},function(e){d(e)})},function(e){o.subprocesses=o.subprocesses.filter(function(e){return!(e._id==l)}),d(e)})},function(e){o.subprocesses=o.subprocesses.filter(function(e){return!(e._id==l)}),d(e)})},function(e){o.subprocesses=o.subprocesses.filter(function(e){return!(e._id==l)}),d(e)})}catch(e){d(e)}})}function initiate(e,t,s){var i={initiated:!1,dates:{created:"",valid:"",due:"",closed:""}};return new Promise(function(n,o){var a=function(){if(void 0!=e.user){i.dates.created=s.createdDate,"userSelected"!=e.user.validDate._type&&"autoSelected"!=e.user.validDate._type||(void 0!==s.validDate?i.dates.valid=s.validDate:util.warn("WFInitiateError","No valid date passed in - {data.validDate}")),"userSelected"!=e.user.dueDate._type&&"autoSelected"!=e.user.dueDate._type||(void 0!==s.dueDate?i.dates.due=s.dueDate:util.warn("WFInitiateError","No due date passed in - {data.dueDate}")),i.initiated=!0;var t=util.success("Sub-Process initiate completed successfully.",i);n(t)}else if(void 0!=e.auto);else{var a=util.error("WFInitiateError","Initiate type: "+e._type+" not defined.");o(a)}};if(void 0==t.complete)a();else if(!t.complete)if(e.parallelInstances)a();else{var r=util.error("WFInitiateError","Sub-process: "+t.id+" still active and parallel instances are not allowed.");o(r)}})}function step(processId,processSeq,subProcessId,subProcessSeq,stepId,stepSeq,data,_WFInstance){var model={id:"",seq:"",status:"",message:"",assignedTo:{userId:"",name:""},assignment:{},comment:""},subProcess={},uuid="",instSubProcess,step={},transitionId="";return new Promise(function(resolve,reject){try{_WFInstance.instance.processes.filter(function(e){e.id==processId&&e.seq==processSeq&&e.subProcesses.filter(function(e){e.id==subProcessId&&e.seq==subProcessSeq&&(uuid=e.uuid,console.log("uuid==="+uuid))})}),_WFInstance.subprocesses.filter(function(e){e._id==uuid&&(instSubProcess=e)}),_WFInstance.config.processes.filter(function(e){e._id==processId&&e.subProcesses.filter(function(e){e._id==subProcessId&&(subProcess=e,e.steps.filter(function(e){e._id==stepId&&(step=e)}))})}),model.id=stepId,model.seq=stepSeq;var instanceStatus="";void 0!=step.setInstanceStatusTo.NotStarted?instanceStatus="NotStarted":void 0!=step.setInstanceStatusTo.Created?instanceStatus="Created":void 0!=step.setInstanceStatusTo.InProgress?instanceStatus="InProgress":void 0!=step.setInstanceStatusTo.Submitted?instanceStatus="Submitted":void 0!=step.setInstanceStatusTo.Complete&&(instanceStatus="Complete");var language=service.getLanguage();model.status=instanceStatus,model.message=eval("step.setInstanceStatusTo."+instanceStatus+".label."+language),model.comment=void 0!==data.comment?data.comment:"";var indicators=void 0!==instSubProcess?instSubProcess.indicators:[];indicatorDocs(processId,indicators,model,_WFInstance).then(function(e){var t=_WFInstance.profile+":"+_WFInstance.app+":"+processId+":"+processSeq+":"+subProcessId+":"+subProcessSeq;uuid=t,void 0!=step.function.actions?actions(step.function.actions,processId,processSeq,subProcessId,subProcessSeq,subProcess,model,_WFInstance,data,uuid).then(function(e){var t=util.success("Actions completed successfully.",model);resolve(t)},function(e){reject(e)}):void 0!=step.function.task&&task(processId,processSeq,step.function.task,t,model).then(function(e){console.log("Task complete.");var t=util.success("Task awaiting user action.",model);resolve(t)},function(e){reject(e)})},function(e){reject(e)})}catch(e){reject(e)}})}function indicators(e,t,s){var i=[];return new Promise(function(e,n){try{for(var o=JSON.xpath("indicators[fn:count(./workflows/processes[subProcessUUID eq '"+s+"']) gt 0]",t,{}),a=0;a<o.length;a++){var r=o[a],c={id:"",instances:[]},u={uuid:"",title:"",key:"",seq:1};c.id=r.category.term,u.uuid=r._id,u.title=r.title,u.key="",u.seq=r.model.pending.seq,c.instances.push(u),i.push(c)}var d=util.success("Process indicator model updated.",i);e(d)}catch(e){n(e)}})}function assignUser(e,t,s,i,n,o){return new Promise(function(a,r){try{var c="";o.instance.processes.filter(function(n){n.id==e&&n.seq==t&&n.subProcesses.filter(function(e){e.id==s&&e.seq==i&&(c=e.uuid)})}),o.subprocesses.filter(function(t){if(t._id==c){t.step.assignedTo.userId=n.id,t.step.assignedTo.name=n.name;for(var s=t.indicators,i=0;i<s.length;i++)for(var r=s[i],u=0;u<r.instances.length;u++)for(var d=r.instances[u],p=0;p<o.indicators.length;p++){var l=o.indicators[p];d.uuid==l._id&&l.workflows.filter(function(t){t.id==o.config._id&&t.processes.filter(function(t){t.id==e&&(t.step.assignedTo.userId=n.id,t.step.assignedTo.name=n.name)})})}var f=util.success('User assigned successfully. UserId: "'+n.id+'", Name: "'+n.name+'"',t);a(f)}})}catch(e){r(e)}})}function indicatorDocs(e,t,s,i){return new Promise(function(n,o){try{if(void 0==t){util.error("WFIndicatorsUpdate","Indicators parameter is required. - Value: "+t);o(err)}else{for(var a=0;a<t.length;a++)for(var r=t[a],c=0;c<r.instances.length;c++)for(var u=r.instances[c],d=0;d<i.indicators.length;d++){var p=i.indicators[d];u.uuid==p._id&&p.workflows.filter(function(t){t.id==i.config._id&&t.processes.filter(function(t){t.id==e&&(t.step.id=s.id,t.step.seq=s.seq,t.step.status=s.status,t.step.message=s.message,t.step.assignedTo.userId=s.assignedTo.userId,t.step.assignedTo.name=s.assignedTo.name,t.step.comment=void 0!==s.comment?s.comment:"")})})}var l=util.success("Indicator documents workflow process model updated.",i);n(l)}}catch(e){o(e)}})}function actions(e,t,s,i,n,o,a,r,c,u){var d=[];return new Promise(function(p,l){util.syncLoop(e.length,function(p){var f=p.iteration();action(e[f],t,s,i,n,o,a,r,c,u).then(function(t){var s={id:e[f]._id,seq:f,data:t};d.push(s),p.next()},function(e){p.break(),l(e)})},function(){var e=util.success("Actions completed successfully.",d);p(e)})})}function action(e,t,s,i,n,o,a,r,c,u){return new Promise(function(d,p){if(void 0!=e.method){var l=["form","indicator","profile","subProcessInstance","step","community","application","user","sdo","performance"];switch(propertyExists(e.method,l)){case"form":if(void 0!=e.method.form.create){var f=[];f.push(t),f.push(o),f.push(a),f.push(e),f.push(s),f.push(n),f.push(r),f.push(c.createType),f.push(u),f.push(c.baseUUID),f.push(c),form.create(f).then(function(e){d(e.data)},function(e){p(e)})}else if(void 0!=e.method.form.authorise){var f=[];f.push(t),f.push(o),f.push(s),f.push(n),f.push(r),f.push(c.createType),f.push(u),f.push(c.baseUUID),f.push(c),form.authorise(f).then(function(e){d(e.data)},function(e){p(e)})}else if(void 0!=e.method.form.undraft){var f=[];f.push(r),f.push(c.createType),f.push(u),f.push(c.baseUUID),f.push(c),form.setUnDraft(f).then(function(e){d(e.data)},function(e){p(e)})}else if(void 0!=e.method.form.draft){var f=[];f.push(r),f.push(c.createType),f.push(u),f.push(c.baseUUID),f.push(c),form.setDraft(f).then(function(e){d(e.data)},function(e){p(e)})}else if(void 0!=e.method.form.close){var f=[];f.push(o.indicators),f.push(r),f.push(c.createType),f.push(u),f.push(c.baseUUID),f.push(c),form.close(f).then(function(e){d(e.data)},function(e){p(e)})}break;case"indicator":if(void 0!=e.method.indicator.create);else if(void 0!=e.method.indicator.instantiate);else if(void 0!=e.method.indicator.setValue){var m=e.method.indicator.setValue.path,h=helper.getNodeValue(e.method.indicator.setValue.data,r,u),f=[];f.push(r),f.push(u),f.push(m),f.push(h),form.updateIndicator(f).then(function(e){d(e.data)},function(e){p(e)})}else if(void 0!=e.method.indicator.updateStatus){var v=e.method.indicator.updateStatus,g=e.method.indicator.indicatorSetId,f=[];f.push(r),f.push(u),f.push(v),f.push(g),form.markUpdateIndicator(f).then(function(e){d(e.data)},function(e){p(e)})}break;case"profile":if(void 0!=e.method.profile.create){var f=[];f.push(t),f.push(r),f.push(c.createType),f.push(u),f.push(c.baseUUID),f.push(c),form.createProfile(f).then(function(e){d(e.data)},function(e){p(e)})}else void 0!=e.method.profile.X;break;case"subProcessInstance":break;case"step":break;case"community":var b=["createCommunity","releaseAdoptedApplication","userJoinCommunity"];switch(propertyExists(e.method.community,b)){case"createCommunity":return actionsModule.community.createCommunity(e.method.community.createCommunity,u,r).then(function(e){d(e.data)},function(e){p(e)});case"releaseAdoptedApplication":return actionsModule.community.releaseAdoptedApplication(e.method.community.releaseAdoptedApplication,u,r).then(function(e){d(e.data)},function(e){p(e)});case"userJoinCommunity":return actionsModule.community.userJoinCommunity(e.method.community.userJoinCommunity,u,r).then(function(e){d(e.data)},function(e){p(e)});default:p("No method found from implemented list.")}break;case"application":var I=["createAppDefinition","buildApplication","applicationAdoption"];switch(propertyExists(e.method.application,I)){case"createAppDefinition":return actionsModule.application.createAppDefinition(e.method.application.createAppDefinition,u,r).then(function(e){d(e.data)},function(e){p(e)});case"buildApplication":return actionsModule.application.buildApplication(e.method.application.buildApplication,u,r).then(function(e){d(e.data)},function(e){p(e)});case"applicationAdoption":return actionsModule.application.applicationAdoption(e.method.application.applicationAdoption,u,r).then(function(e){d(e.data)},function(e){p(e)});default:p("No method found from implemented list.")}break;case"user":break;case"sdo":break;case"performance":var P=["createPlan"];switch(propertyExists(e.method.performance,P)){case"createPlan":return actionsModule.performance.createPlan(e.method.performance.createPlan,u,r).then(function(e){d(e.data)},function(e){p(e)});default:p("No method found from implemented list.")}break;default:p("No method found from implemented list.")}}else{var f=[],_="global",S="";void 0!==e._id&&(_=e._id.split(".")[0]),void 0!==e._id&&(S=e._id.split(".")[1]),f.length=0;for(var y=0;y<e._args.length;y++){var q=e._args[y];switch(q){case"processId":f.push(t);break;case"processSeq":f.push(s);break;case"subProcessId":f.push(i);break;case"subProcessSeq":f.push(n);break;case"subProcess":f.push(o);break;case"step":f.push(a);break;case"action":f.push(e);break;default:f=[]}}if(f.push(r),f.push(c.createType),f.push(u),f.push(c.baseUUID),f.push(c),"form.create"==e._id)form.create(f).then(function(e){d(e.data)},function(e){p(e)});else if("form.authorise"==e._id)form.authorise(f).then(function(e){d(e.data)},function(e){p(e)});else if("form.close"==e._id)form.close(f).then(function(e){d(e.data)},function(e){p(e)});else if("form.setDraft"==e._id)form.setDraft(f).then(function(e){d(e.data)},function(e){p(e)});else if("form.setUnDraft"==e._id)form.setUnDraft(f).then(function(e){d(e.data)},function(e){p(e)});else if("form.createProfile"==e._id)form.createProfile(f).then(function(e){d(e.data)},function(e){p(e)});else if("form.setInstanceTitle"==e._id)form.setInstanceTitle(f).then(function(e){d(e.data)},function(e){p(e)});else if("profile.delete"==e._id)form.deleteProfile(f).then(function(e){d(e.data)},function(e){p(e)});else{var k=util.error("WFActionError","Method: "+action_id+" not defined.");p(k)}}})}function task(e,t,s,i,n){return new Promise(function(o,a){if(void 0!=s.assign.role){var r=app.SCOPE.workflow.profile,c="";"current"==s.assign.role.profile?c=app.SCOPE.workflow.profile:"community"==s.assign.role.profile&&(c=app.SCOPE.getCommunityId());var u=s.assign.role.roleId;library.getUsersListByRole(c,u).then(function(a){if(void 0!=a)if(a.length>1){var d=JSON.xpath("/subprocesses[_id eq '"+i+"']",app.SCOPE.workflow,{})[0],p=JSON.xpath("/subprocesses[_id eq '"+i+"']/channels",app.SCOPE.workflow,{}),l=processWorkflowMessage(NOTIFICATION_USER_MSG_ACCEPT,i),f=d.id,m=d.seq,h=i,v=d.dates.valid,g=JSON.xpath("/config/processes[_id eq '"+e+"']",app.SCOPE.workflow,{})[0],b=JSON.xpath("/subProcesses[_id eq '"+f+"']",g,{})[0],I=d.step.seq+0,P=JSON.xpath("/steps[_seq eq '"+I+"']/name/i18n",b,{})[0],_=_getNameByLang(P),S=_getNameByLang(b.name.i18n),y={source:"remote",type:"notificationRequest",_id:i+":notificationRequest",channels:p,communityId:app.SCOPE.getCommunityId(),applicationId:app.SCOPE.applicationId,message:l,messageType:"info",createdDateTime:moment().format(),senderUserId:LOCAL_SETTINGS.SUBSCRIPTIONS.userId,actions:[{label:"View",function:"app.openSubprocess",params:[r,f,m,S,e,t,h,v,_]}],receiver:{value:[{type:"role",name:u,profileId:c}]}};dao.upsert(y).done(function(e){console.log(e)}).fail(function(e){console.log(e)});var q="";if(void 0!=s.assign.assignment){var q=n.assignment,k={show:s.assign.assignment.accept.show,label:_getNameByLang(s.assign.assignment.accept.label.i18n)};q.accept=k,q.message=_getNameByLang(s.assign.assignment.message.i18n);var w={show:s.assign.assignment.reject.show,label:_getNameByLang(s.assign.assignment.reject.label.i18n)};q.reject=w;var E={profileId:r,roleId:u,type:"role"};q.value=E,q.profileRoleId=c}o("Notifications request submitted for acceptance.")}else if(1==a.length){var T=a[0].id,A=a[0].name,C=n.assignedTo;C.name=A+"",C.userId=T+"",o("Assigned to the only user in role.")}else if(void 0!=s.assign.default){var T=s.assign.default.userId,A=s.assign.default.userName,C=n.assignedTo;C.name=A+"",C.userId=T+"",o("Assigned to default user")}else console.log("Error in assignment. Default user not specified."),w("Error in assignment. Default user not specified.");else console.log("Error in getUsersListByRole undefined"),w(err)},function(e){console.log("Error in getUsersListByRole"),a(e)})}else void 0!=s.assign.swimlane&&(o("swimlane"),console.log("Swimlane implementation !!"))})}function transition(e,t,s,i,n,o,a,r){return new Promise(function(c,u){try{for(var d=0,p="",l=0,f=[],m=r.config.processes.filter(function(t){if(t._id==e)return t}),h=m[0].subProcesses.filter(function(e){if(e._id==s)return e}),v=h[0].steps.filter(function(e){if(e._id==n)return e}),g=v[0].transition.filter(function(e){if(e._id==o)return e}),b=0;b<h[0].steps.length;b++)h[0].steps[b]._id==n&&(d=parseInt(h[0].steps[b]._seq));h[0].steps.filter(function(e){l=d+1,parseInt(e._seq)==l&&(p=e._id)}),r.instance.processes.filter(function(n){n.id==e&&n.seq==t&&n.subProcesses.filter(function(e){if(e.id==s&&e.seq==i){var t=e.uuid;r.subprocesses.filter(function(e){e._id==t&&(f=e)})}})});var I=h[0].steps.length;if(void 0!=g[0].transitionAction.goToStep){var P=parseInt(v[0]._seq)+parseInt(g[0].transitionAction.goToStep.default),_="";h[0].steps.filter(function(e){parseInt(e._seq)==l&&(_=e._id)}),step(e,t,s,i,_,P,a,r).then(function(e){if(P==I){var t=util.success("All Step transitions have completed successfully.",{subProcessComplete:!0,step:e.data});c(t)}else{var t=util.success("Step transition completed successfully.",e.data);c(t)}},function(e){u(e)})}else if(void 0!=g[0].transitionAction.goToStepId){var S=g[0].transitionAction.goToStepId.stepId,y=1;h[0].steps.filter(function(e){e._id==S&&(y=parseInt(e._seq))}),step(e,t,s,i,S,y,a,r).then(function(e){if(y==I){var t=util.success("All Step transitions have completed successfully.",{subProcessComplete:!0,step:e.data});c(t)}else{var t=util.success("Step transition completed successfully.",e.data);c(t)}},function(e){u(e)})}}catch(e){u(e)}})}function postActions(e,t){return new Promise(function(s,i){var n=[];try{util.syncLoop(e.length,function(s){var o=s.iteration();action(e[o],t).then(function(e){n.push(!0),s.next()},function(e){n.push(!1),s.break(),i(e)})},function(){if(n.every(Boolean)){var e=util.success("Post-actions completed successfully.",{});s(e)}else{var t=util.error("WFPreActionsError","Not all post-actions passed.");i(t)}})}catch(e){i(e)}})}function processWorkflowMessage(e,t){var s=e;if(s.indexOf("#INSTANCE_LABEL")!==-1){var i=JSON.xpath("/instance/processes/subProcesses[uuid eq '"+t+"']/label",app.SCOPE.workflow,{})[0];s=s.replace("#INSTANCE_LABEL",i)}if(s.indexOf("#USER_NAME")!==-1){var i=JSON.xpath("/subprocesses[_id eq '"+t+"']/step/assignedTo/name",app.SCOPE.workflow,{})[0];s=s.replace("#USER_NAME",i)}if(s.indexOf("#PROFILE_TITLE")!==-1){var i=app.profile.title;s=s.replace("#PROFILE_TITLE",i)}if(s.indexOf("#PROFILE_TYPE")!==-1){var i=app.SCOPE.APP_CONFIG.name;s=s.replace("#PROFILE_TYPE",i)}if(s.indexOf("#VAR_SPUUID")!==-1){var i=t;s=s.replace("#VAR_SPUUID",i)}return s}function _getName(e,t){if(void 0!==e)for(var s=0;s<e.length;s++)if(e[s]._lang===t)return e[s].value}function _getNameByLang(obj){var lang=service.getLanguage(),expr="obj."+lang;return eval(expr)}var util=require("utility"),actionsModule=require("./actions"),helper=require("./helper"),form=require("./form");module.exports={preRequisites:preRequisites,preActions:preActions,subProcess:subProcess,indicatorDocs:indicatorDocs,task:task,transition:transition,assignUser:assignUser};

},{"./actions":2,"./form":3,"./helper":4,"utility":8}],8:[function(require,module,exports){
"use strict";function success(r,e){return{message:r,data:e}}function warn(r,e){return console.warn(e),{warning:r,data:e}}function error(r,e){var n=new Error("");return n.name=r,n.message=e,n}function syncLoop(r,e,n){var a=0,t=!1,o=!1,u={next:function(){return t&&o&&n?n():void(a<r?(a++,e(u)):(t=!0,n&&n()))},iteration:function(){return a-1},break:function(r){t=!0,o=r}};return u.next(),u}function compare(r,e,n){switch(e){case"greaterThan":return r>n;case"lessThan":return r<n;case"greaterThanEqual":return r>=n;case"lessThanEqual":return r<=n;case"equalTo":return r===n;case"notEqualTo":return r!==n}}function getName(r,e){if(void 0!==r)for(var n=0;n<r.length;n++)if(r[n].i18n._lang===e)return r[n].i18n.value}module.exports={success:success,warn:warn,error:error,syncLoop:syncLoop,compare:compare,getName:getName};

},{}]},{},[1])(1)
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL1VzZXJzL0hhc2FuL0FwcERhdGEvUm9hbWluZy9ucG0vbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsImluZGV4LmpzIiwibGliXFxhY3Rpb25zLmpzIiwibGliXFxmb3JtLmpzIiwibGliXFxoZWxwZXIuanMiLCJsaWJcXGludGVyZmFjZS5qcyIsImxpYlxcbm9kZVZhbHVlLmpzIiwibGliXFxwcm9jZXNzLmpzIiwibm9kZV9tb2R1bGVzXFx1dGlsaXR5XFxpbmRleC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBLFlBMENBLFNBQVMsVUFBUyxFQUFTLEVBQWEsRUFBSyxHQUN6QyxHQUFJLEdBQVEsSUFHWixJQUFtQixJQUFmLEdBQW9DLFFBQWYsRUFDckIsS0FBTSxNQUFLLE1BQU0sZ0JBQWlCLDhCQUMvQixJQUE0QixnQkFBbEIsR0FDYixLQUFNLElBQUksT0FBTSxnREFNcEIsSUFKSSxFQUFNLFlBQWMsR0FBZSxHQUl4QixJQUFYLEdBQTRCLFFBQVgsRUFDakIsS0FBTSxNQUFLLE1BQU0sZ0JBQWlCLDRCQUMvQixJQUF3QixnQkFBZCxHQUNiLEtBQU0sSUFBSSxPQUFNLDhDQUtwQixJQUhJLEVBQU0sUUFBVSxHQUFXLEdBR3BCLElBQVAsR0FBb0IsUUFBUCxFQUNiLEtBQU0sTUFBSyxNQUFNLGdCQUFpQix5QkFDL0IsSUFBb0IsZ0JBQVYsR0FDYixLQUFNLElBQUksT0FBTSwwQ0FLcEIsSUFISSxFQUFNLElBQU0sR0FBTyxHQUdULElBQVYsR0FBMEIsUUFBVixFQUNoQixLQUFNLE1BQUssTUFBTSxnQkFBaUIsd0NBQ1IsaUJBQWIsR0FDYixFQUFNLE9BQVMsS0FBSyxNQUFNLEdBRTFCLEVBQU0sT0FBUyxFQUduQixFQUFNLFNBRU4sRUFBTSxnQkFFTixFQUFNLGNBRU4sRUFBTSxXQW5GVixHQUFJLFNBQVUsUUFBUSxpQkFDbEIsS0FBTyxRQUFRLFdB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VixFQUFLLEtBQUssR0FDVixFQUFLLEtBQUssR0FDVixFQUFLLEtBQUssR0FDVixFQUFLLEtBQUssR0FDVixFQUFLLEtBQUssRUFBSyxZQUNmLEVBQUssS0FBSyxHQUNWLEVBQUssS0FBSyxFQUFLLFVBQ2YsRUFBSyxLQUFLLEdBQ1YsS0FBSyxVQUFVLEdBQU0sS0FBSyxTQUFTLEdBQy9CLEVBQVEsRUFBTyxPQUNoQixTQUFTLEdBQ1IsRUFBTyxTQUdSLElBQWtDLFFBQTlCLEVBQU8sT0FBTyxLQUFLLFFBQXNCLENBQ2hELEdBQUksS0FDSixHQUFLLEtBQUssR0FDVixFQUFLLEtBQUssRUFBSyxZQUNmLEVBQUssS0FBSyxHQUNWLEVBQUssS0FBSyxFQUFLLFVBQ2YsRUFBSyxLQUFLLEdBQ1YsS0FBSyxXQUFXLEdBQU0sS0FBSyxTQUFTLEdBQ2hDLEVBQVEsRUFBTyxPQUNoQixTQUFTLEdBQ1IsRUFBTyxTQUdSLElBQWdDLFFBQTVCLEVBQU8sT0FBTyxLQUFLLE1BQW9CLENBQzlDLEdBQUksS0FDSixHQUFLLEtBQUssR0FDVixFQUFLLEtBQUssRUFBSyxZQUNmLEVBQUssS0FBSyxHQUNWLEVBQUssS0FBSyxFQUFLLFVBQ2YsRUFBSyxLQUFLLEdBQ1YsS0FBSyxTQUFTLEdBQU0sS0FBSyxTQUFTLEdBQzlCLEVBQVEsRUFBTyxPQUNoQixTQUFTLEdBQ1IsRUFBTyxTQUdSLElBQWdDLFFBQTVCLEVBQU8sT0FBTyxLQUFLLE1BQW9CLENBRTlDLEdBQUksS0FDSixHQUFLLEtBQUssRUFBVyxZQUNyQixFQUFLLEtBQUssR0FDVixFQUFLLEtBQUssRUFBSyxZQUNmLEVBQUssS0FBSyxHQUNWLEVBQUssS0FBSyxFQUFLLFVBQ2YsRUFBSyxLQUFLLEdBQ1YsS0FBSyxNQUFNLEdBQU0sS0FBSyxTQUFTLEdBQzNCLEVBQVEsRUFBTyxPQUNoQixTQUFTLEdBQ1IsRUFBTyxLQUtmLEtBQ0osS0FBSyxZQUNELEdBQXNDLFFBQWxDLEVBQU8sT0FBTyxVQUFVLFlBRXJCLElBQTJDLFFBQXZDLEVBQU8sT0FBTyxVQUFVLGlC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LE9BQ0MsUUFBUyxFQUNULEtBQU0sR0FpQlIsUUFBUyxNQUFLLEVBQVMsR0FFdEIsTUFEQSxTQUFRLEtBQUssSUFFWixRQUFTLEVBQ1QsS0FBTSxHQWdCUixRQUFTLE9BQU0sRUFBTSxHQUNwQixHQUFJLEdBQU0sR0FBSSxPQUFNLEdBR3BCLE9BRkEsR0FBSSxLQUFPLEVBQ1gsRUFBSSxRQUFVLEVBQ1AsRUEwQlIsUUFBUyxVQUFTLEVBQVksRUFBUyxHQUNuQyxHQUFJLEdBQVEsRUFDUixHQUFPLEVBQ1AsR0FBYSxFQUNiLEdBQ0EsS0FBSyxXQUNELE1BQUcsSUFDSSxHQUFjLEVBQ04sU0FJWixFQUFRLEdBQ1AsSUFDQSxFQUFRLEtBR1IsR0FBTyxFQUNKLEdBQU0sT0FHakIsVUFBVSxXQUNOLE1BQU8sR0FBUSxHQUVuQixNQUFNLFNBQVMsR0FDWCxHQUFPLEVBQ1AsRUFBYSxHQUlyQixPQURBLEdBQUssT0FDRSxFQUdYLFFBQVMsU0FBUSxFQUFTLEVBQVUsR0FDakMsT0FBUSxHQUNQLElBQUssY0FDTixNQUFPLEdBQVUsQ0FDbEIsS0FBSyxXQUNKLE1BQU8sR0FBVSxDQUNsQixLQUFLLG1CQUNKLE1BQU8sSUFBVyxDQUNuQixLQUFLLGdCQUNKLE1BQU8sSUFBVyxDQUNuQixLQUFLLFVBQ0osTUFBTyxLQUFZLENBQ3BCLEtBQUssYUFDSixNQUFPLEtBQVksR0FJdEIsUUFBUyxTQUFRLEVBQUssR0FDckIsR0FBWSxTQUFSLEVBQ0gsSUFBSyxHQUFJLEdBQUksRUFBRyxFQUFJLEVBQUksT0FBUyxJQUNoQyxHQUFJLEVBQUksR0FBRyxLQUFLLFFBQVUsRUFDekIsTUFBTyxHQUFJLEdBQUcsS0FBSyxNQU12QixPQUFPLFNBRUwsUUFBUyxRQUNULEtBQU0sS0FDTixNQUFPLE1BQ1AsU0FBVSxTQUNWLFFBQVMsUUFDVixRQUFTIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIid1c2Ugc3RyaWN0JztcclxuXHJcbnZhciBQcm9jZXNzID0gcmVxdWlyZSgnLi9saWIvcHJvY2VzcycpO1xyXG52YXIgdXRpbCA9IHJlcXVpcmUoJ3V0aWxpdHknKTtcclxudmFyIHVzZXJJbnRlcmZhY2UgPSByZXF1aXJlKCcuL2xpYi9pbnRlcmZhY2UnKTtcclxuXHJcbi8qZ2xvYmFscyAqL1xyXG5cclxuLyoqXHJcbiAqIEEgbmV3IFdvcmtmbG93IGNvbnN0cnVjdG9yIGluc3RhbmNlIGNvbnRhaW5zIHRoZSByZWZlcmVuY2UgdG8gdGhlIGFwcGxpY2F0aW9uXHJcbiAqIGFuZCBhc3NvY2lhdGVkIHByb2ZpbGUgd2hpY2ggaXQgcmVxdWlyZXMgYXMgdGhlIGZpcnN0IHR3byBwYXJhbWV0ZXJzLiBJdCBhbHNvXHJcbiAqIHJlcXVpcmVzIGEgd29ya2Zsb3cgY29uZmlndXJhdGlvbiwgYXMgdGhlIHRoaXJkIHBhcmFtZXRlciwgd2hpY2ggaXMgdXNlZCB0b1xyXG4gKiBkZXNjaWJlIHRoZSB3b3JrZmxvdyBwcm9jZXNzZXMuIElmIGEgd29ya2Zsb3cgaW5zdGFuY2UgZXhpc3RzIHlvdSBjYW4gcGFzcyBpdFxyXG4gKiBpbiBhcyB0aGUgZm91cnRoIHBhcmFtZXRlciB3aGljaCBpdCB3aWxsIHRoZW4gdXNlLCBlbHNlIGNyZWF0ZSBhIG5ldyBvbmUuXHJcbiAqXHJcbiAqIEBjb25zdHJ1Y3RvclxyXG4gKlxyXG4gKiBAcGFyYW0ge3N0cmluZ30gcHJvZmlsZSAtIFRoZSBjdXJyZW50IHByb2ZpbGUgaWRcclxuICogQHBhcmFtIHtzdHJpbmd9IGFwcCAtIFRoZSBhc3NvY2lhdGVkIGFwcGxpY2F0aW9uIGlkXHJcbiAqIEBwYXJhbSB7T2JqZWN0fSBjb25maWcgLSBUaGUgYXBwbGljYXRpb24gd29ya2Zsb3cgY29uZmlndXJhdGlvbiAvIGRlZmluaXRpb25cclxuICogQHBhcmFtIHtPYmplY3R9IFtpbnN0YW5jZV0gLSBBbiBleGlzdGluZyBhcHBsaWNhdGlvbiBwcm9maWxlIHdvcmtmbG93IGluc3RhbmNlIGJhc2VkXHJcbiAqIG9uIHRoZSBkZWZpbml0aW9uXHJcbiAqXHJcbiAqIEBhdXRob3IgQnJlbnQgR29yZG9uXHJcbiAqIEB2ZXJzaW9uIDAuMS4wXHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqIHZhciBjb25maWcgPSB7ICdfaWQnOiAnYWJjMTIzJyB9O1xyXG4gKiB2YXIgaW5zdGFuY2UgPSB7ICdfaWQnOiAnaW5zdGFuY2VfYWJjMTIzJyB9O1xyXG4gKiAvLyBJZiB0aGVyZSBpc24ndCBhbiBleGlzdGluZyBpbnN0YW5jZVxyXG4gKiB2YXIgd29ya2Zsb3cgPSBuZXcgV29ya2Zsb3coJzEyMzQnLCAnNTY3OCcsIGNvbmZpZyk7XHJcbiAqIC8vIElmIHRoZXJlIGlzIGFuIGV4aXN0aW5nIGluc3RhbmNlXHJcbiAqIHZhciB3b3JrZmxvdyA9IG5ldyBXb3JrZmxvdygnMTIzNCcsICc1Njc4JywgY29uZmlnLCBpbnN0YW5jZSk7XHJcbiAqXHJcbiAqIEByZXR1cm4ge09iamVjdH0gbmV3IFdvcmtmbG93IG9iamVjdFxyXG4gKlxyXG4gKiBAdGhyb3dzIEVycm9yOiBBIHByb2ZpbGUgaWQgaXMgcmVxdWlyZWRcclxuICogQHRocm93cyBFcnJvcjogQW4gYXBwIGlkIGlzIHJlcXVpcmVkXHJcbiAqIEB0aHJvd3MgRXJyb3I6IEEgd29ya2Zsb3cgY29uZmlndXJhdGlvbiBpcyByZXF1aXJlZFxyXG4gKlxyXG4gKi9cclxuXHJcbmZ1bmN0aW9uIFdvcmtmbG93KHByb2ZpbGUsIGNvbW11bml0eUlkLCBhcHAsIGNvbmZpZykge1xyXG4gICAgdmFyIF90aGlzID0gdGhpcztcclxuXHJcbiAgICAvLyBDb21tdW5pdHkgSUQgdmFsaWRhdGlvbiBjaGVja3NcclxuICAgIGlmIChjb21tdW5pdHlJZCA9PSAnJyB8fCBjb21tdW5pdHlJZCA9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICB0aHJvdyB1dGlsLmVycm9yKCdQYXJhbVJlcXVpcmVkJywgJ0EgY29tbXVuaXR5IGlkIGlzIHJlcXVpcmVkLicpO1xyXG4gICAgfSBlbHNlIGlmICh0eXBlb2YoY29tbXVuaXR5SWQpICE9PSAnc3RyaW5nJykge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIGNvbW11bml0eSBpZCBtdXN0IGJlIGEgamF2YXNjcmlwdCBzdHJpbmcuJyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIF90aGlzLmNvbW11bml0eUlkID0gY29tbXVuaXR5SWQgfHwgJyc7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gUHJvZmlsZSBJRCB2YWxpZGF0aW9uIGNoZWNrc1xyXG4gICAgaWYgKHByb2ZpbGUgPT0gJycgfHwgcHJvZmlsZSA9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICB0aHJvdyB1dGlsLmVycm9yKCdQYXJhbVJlcXVpcmVkJywgJ0EgcHJvZmlsZSBpZCBpcyByZXF1aXJlZC4nKTtcclxuICAgIH0gZWxzZSBpZiAodHlwZW9mKHByb2ZpbGUpICE9PSAnc3RyaW5nJykge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIHByb2ZpbGUgaWQgbXVzdCBiZSBhIGphdmFzY3JpcHQgc3RyaW5nLicpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBfdGhpcy5wcm9maWxlID0gcHJvZmlsZSB8fCAnJztcclxuICAgIH1cclxuICAgIC8vIEFwcCBJRCB2YWxpZGF0aW9uIGNoZWNrc1xyXG4gICAgaWYgKGFwcCA9PSAnJyB8fCBhcHAgPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgdGhyb3cgdXRpbC5lcnJvcignUGFyYW1SZXF1aXJlZCcsICdBbiBhcHAgaWQgaXMgcmVxdWlyZWQuJyk7XHJcbiAgICB9IGVsc2UgaWYgKHR5cGVvZihhcHApICE9PSAnc3RyaW5nJykge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIGFwcCBpZCBtdXN0IGJlIGEgamF2YXNjcmlwdCBzdHJpbmcuJyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIF90aGlzLmFwcCA9IGFwcCB8fCAnJztcclxuICAgIH1cclxuICAgIC8vIFdvcmtmbG93IGNvbmZpZ3VyYXRpb24gdmFsaWRhdGlvbiBjaGVja3NcclxuICAgIGlmIChjb25maWcgPT0gJycgfHwgY29uZmlnID09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIHRocm93IHV0aWwuZXJyb3IoJ1BhcmFtUmVxdWlyZWQnLCAnQSB3b3JrZmxvdyBjb25maWd1cmF0aW9uIGlzIHJlcXVpcmVkLicpO1xyXG4gICAgfSBlbHNlIGlmICh0eXBlb2YoY29uZmlnKSAhPT0gJ29iamVjdCcpIHtcclxuICAgICAgICBfdGhpcy5jb25maWcgPSBKU09OLnBhcnNlKGNvbmZpZyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIF90aGlzLmNvbmZpZyA9IGNvbmZpZztcclxuICAgIH1cclxuICAgIC8vIFdvcmtmbG93IGluc3RhbmNlIHZhbGlkYXRpb24gY2hlY2tzXHJcbiAgICBfdGhpcy5pbnN0YW5jZTtcclxuICAgIC8vIFdvcmtmbG93IHN1Yi1wcm9jZXNzZXMgdmFsaWRhdGlvbiBjaGVja3NcclxuICAgIF90aGlzLnN1YnByb2Nlc3NlcyA9IFtdO1xyXG4gICAgLy8gV29ya2Zsb3cgaW5kaWNhdG9ycyBwbGFjZSBob2xkZXJcclxuICAgIF90aGlzLmluZGljYXRvcnMgPSBbXTtcclxuICAgIC8vIFdvcmtmbG93IHN1Yi1wcm9jZXNzIHN0ZXAgaGlzdG9yeSBwbGFjZSBob2xkZXJcclxuICAgIF90aGlzLmhpc3RvcnkgPSBbXTtcclxuXHJcbn1cclxuXHJcbi8qKlxyXG4gKiBXb3JrZmxvdyBnZXQgcHJvZmlsZSBpZC5cclxuICpcclxuICogQGV4YW1wbGUgXCJcIlxyXG4gKlxyXG4gKiBAcmV0dXJuIFwiXCJcclxuICpcclxuICovXHJcbldvcmtmbG93LnByb3RvdHlwZS5nZXRQcm9maWxlID0gZnVuY3Rpb24oKSB7XHJcbiAgICByZXR1cm4gdGhpcy5wcm9maWxlO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFdvcmtmbG93IGdldCBhcHAgaWQuXHJcbiAqXHJcbiAqIEBleGFtcGxlIFwiXCJcclxuICpcclxuICogQHJldHVybiBcIlwiXHJcbiAqXHJcbiAqL1xyXG5Xb3JrZmxvdy5wcm90b3R5cGUuZ2V0QXBwID0gZnVuY3Rpb24oKSB7XHJcbiAgICByZXR1cm4gdGhpcy5hcHA7XHJcbn07XHJcblxyXG4vKipcclxuICogV29ya2Zsb3cgZ2V0IGNvbmZpZy5cclxuICpcclxuICogQGV4YW1wbGUgXCJcIlxyXG4gKlxyXG4gKiBAcmV0dXJuIFwiXCJcclxuICpcclxuICovXHJcbldvcmtmbG93LnByb3RvdHlwZS5nZXRDb25maWcgPSBmdW5jdGlvbigpIHtcclxuICAgIHJldHVybiB0aGlzLmNvbmZpZztcclxufTtcclxuXHJcbi8qKlxyXG4gKiBXb3JrZmxvdyBnZXQgaW5zdGFuY2UuXHJcbiAqXHJcbiAqIEBleGFtcGxlIFwiXCJcclxuICpcclxuICogQHJldHVybiBcIlwiXHJcbiAqXHJcbiAqL1xyXG5cclxuXHJcbldvcmtmbG93LnByb3RvdHlwZS5nZXRJbnN0YW5jZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuaW5zdGFuY2U7XHJcbn07XHJcblxyXG4vKipcclxuICogV29ya2Zsb3cgc2V0IHRoZSBpbnN0YW5jZSBkYXRhLlxyXG4gKlxyXG4gKiBAcGFyYW0ge09iamVjdH0gZGF0YSAtIHRoZSB3b3JrZmxvdyBwcm9jZXNzIGluc3RhbmNlIGRhdGFcclxuICpcclxuICogQGV4YW1wbGUgXCJcIlxyXG4gKlxyXG4gKiBAcmV0dXJuIFwiXCJcclxuICpcclxuICovXHJcbldvcmtmbG93LnByb3RvdHlwZS5zZXRJbnN0YW5jZSA9IGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgIHRoaXMuaW5zdGFuY2UgPSBkYXRhO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFdvcmtmbG93IGdldCBzdWItcHJvY2Vzc2VzIGRhdGEuXHJcbiAqXHJcbiAqIEBleGFtcGxlIFwiXCJcclxuICpcclxuICogQHJldHVybiBcIlwiXHJcbiAqXHJcbiAqL1xyXG5Xb3JrZmxvdy5wcm90b3R5cGUuZ2V0U3ViUHJvY2Vzc2VzID0gZnVuY3Rpb24oKSB7XHJcbiAgICByZXR1cm4gdGhpcy5zdWJwcm9jZXNzZXM7XHJcbn07XHJcblxyXG4vKipcclxuICogV29ya2Zsb3cgc2V0IHRoZSBzdWItcHJvY2Vzc2VzIGRhdGEuXHJcbiAqXHJcbiAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhIC0gdGhlIHdvcmtmbG93IHByb2Nlc3MgaW5zdGFuY2UgZGF0YVxyXG4gKlxyXG4gKiBAZXhhbXBsZSBcIlwiXHJcbiAqXHJcbiAqIEByZXR1cm4gXCJcIlxyXG4gKlxyXG4gKi9cclxuV29ya2Zsb3cucHJvdG90eXBlLnNldFN1YlByb2Nlc3NlcyA9IGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgIHRoaXMuc3VicHJvY2Vzc2VzID0gZGF0YTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBXb3JrZmxvdyBnZXQgaW5kaWNhdG9yIHNldCBkYXRhLlxyXG4gKlxyXG4gKiBAZXhhbXBsZSBcIlwiXHJcbiAqXHJcbiAqIEByZXR1cm4gXCJcIlxyXG4gKlxyXG4gKi9cclxuV29ya2Zsb3cucHJvdG90eXBlLmdldEluZGljYXRvcnMgPSBmdW5jdGlvbigpIHtcclxuICAgIHJldHVybiB0aGlzLmluZGljYXRvcnM7XHJcbn07XHJcblxyXG4vKipcclxuICogV29ya2Zsb3cgc2V0IHRoZSBpbmRpY2F0b3Igc2V0IGRhdGEuXHJcbiAqXHJcbiAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhIC0gdGhlIHdvcmtmbG93IHByb2Nlc3MgaW5zdGFuY2UgZGF0YVxyXG4gKlxyXG4gKiBAZXhhbXBsZSBcIlwiXHJcbiAqXHJcbiAqIEByZXR1cm4gXCJcIlxyXG4gKlxyXG4gKi9cclxuV29ya2Zsb3cucHJvdG90eXBlLnNldEluZGljYXRvcnMgPSBmdW5jdGlvbihkYXRhKSB7XHJcbiAgICB0aGlzLmluZGljYXRvcnMgPSBkYXRhO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFNldCB0aGUgdmFyaWFibGUgdmFsdWUuXHJcbiAqXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBwcm9jZXNzSWQgLSB0aGUgV29ya2Zsb3cgY29uZmlnIC8gZGVmaW5pdGlvbiBwcm9jZXNzIGlkXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBwcm9jZXNzU2VxIC0gdGhlIFdvcmtmbG93IGluc3RhbmNlIHByb2Nlc3Mgc2VxXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdWJQcm9jZXNzSWQgLSB0aGUgV29ya2Zsb3cgY29uZmlnIC8gZGVmaW5pdGlvbiBzdWItcHJvY2VzcyBpZFxyXG4gKiBAcGFyYW0ge251bWJlcn0gc3ViUHJvY2Vzc1NlcSAtIHRoZSBXb3JrZmxvdyBpbnN0YW5jZSBzdWItcHJvY2VzcyBzZXFcclxuICogQHBhcmFtIHtzdHJpbmd9IHN0ZXBJZCAtIHRoZSBXb3JrZmxvdyBjb25maWcgLyBkZWZpbml0aW9uIHN0ZXAgaWRcclxuICogQHBhcmFtIHtPYmplY3R9IHZhcmlhYmxlIC0gdGhlIFdvcmtmbG93IHZhcmlhYmxlIG9iamVjdFxyXG4gKlxyXG4gKiBAZXhhbXBsZSAnJ1xyXG4gKlxyXG4gKiBAcmV0dXJuICcnXHJcbiAqXHJcbiAqL1xyXG4vLyBXb3JrZmxvdy5wcm90b3R5cGUuc2V0VmFyaWFibGUgPSBmdW5jdGlvbihwcm9jZXNzSWQsIHByb2Nlc3NTZXEsIHN1YlByb2Nlc3NJZCwgc3ViUHJvY2Vzc1NlcSwgc3RlcElkLCB2YXJpYWJsZSl7XHJcbi8vIFx0dmFyIF90aGlzID0gdGhpcztcclxuLy8gXHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbi8vIFx0XHR0cnkge1xyXG4vLyBcdFx0XHRQcm9jZXNzLmdldFZhcmlhYmxlKHByb2Nlc3NJZCwgcHJvY2Vzc1NlcSwgc3ViUHJvY2Vzc0lkLCBzdWJQcm9jZXNzU2VxLCBzdGVwSWQsIHZhcmlhYmxlKS50aGVuKGZ1bmNpb24ocmVzdWx0KXtcclxuLy8gXHRcdFx0XHRyZXNvbHZlKHJlc3VsdC5kYXRhKTtcclxuLy8gXHRcdFx0fSwgZnVuY3Rpb24oZXJyKXtcclxuLy8gXHRcdFx0XHRyZWplY3QoZXJyKTtcclxuLy8gXHRcdFx0fSlcclxuLy8gXHRcdH0gY2F0Y2ggKGVycikge1xyXG4vLyBcdFx0XHRyZWplY3QoZXJyKTtcclxuLy8gXHRcdH1cclxuLy8gXHR9KTtcclxuLy8gfTtcclxuXHJcbi8qKlxyXG4gKiBHZXQgdGhlIHZhcmlhYmxlIHZhbHVlLlxyXG4gKlxyXG4gKiBAcGFyYW0ge3N0cmluZ30gcHJvY2Vzc0lkIC0gdGhlIFdvcmtmbG93IGNvbmZpZyAvIGRlZmluaXRpb24gcHJvY2VzcyBpZFxyXG4gKiBAcGFyYW0ge251bWJlcn0gcHJvY2Vzc1NlcSAtIHRoZSBXb3JrZmxvdyBpbnN0YW5jZSBwcm9jZXNzIHNlcVxyXG4gKiBAcGFyYW0ge3N0cmluZ30gc3ViUHJvY2Vzc0lkIC0gdGhlIFdvcmtmbG93IGNvbmZpZyAvIGRlZmluaXRpb24gc3ViLXByb2Nlc3MgaWRcclxuICogQHBhcmFtIHtudW1iZXJ9IHN1YlByb2Nlc3NTZXEgLSB0aGUgV29ya2Zsb3cgaW5zdGFuY2Ugc3ViLXByb2Nlc3Mgc2VxXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdGVwSWQgLSB0aGUgV29ya2Zsb3cgY29uZmlnIC8gZGVmaW5pdGlvbiBzdGVwIGlkXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgLSB0aGUgV29ya2Zsb3cgdmFyaWFibGUgaWRcclxuICpcclxuICogQGV4YW1wbGUgJydcclxuICpcclxuICogQHJldHVybiAnJ1xyXG4gKlxyXG4gKi9cclxuLy8gV29ya2Zsb3cucHJvdG90eXBlLmdldFZhcmlhYmxlID0gZnVuY3Rpb24ocHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIHN0ZXBJZCwga2V5KXtcclxuLy8gXHR2YXIgX3RoaXMgPSB0aGlzO1xyXG4vLyBcdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuLy8gXHRcdHRyeSB7XHJcbi8vIFx0XHRcdFByb2Nlc3Muc2V0VmFyaWFibGUocHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIHN0ZXBJZCwga2V5KS50aGVuKGZ1bmNpb24ocmVzdWx0KXtcclxuLy8gXHRcdFx0XHRyZXNvbHZlKHJlc3VsdC5kYXRhKTtcclxuLy8gXHRcdFx0fSwgZnVuY3Rpb24oZXJyKXtcclxuLy8gXHRcdFx0XHRyZWplY3QoZXJyKTtcclxuLy8gXHRcdFx0fSlcclxuLy8gXHRcdH0gY2F0Y2ggKGVycikge1xyXG4vLyBcdFx0XHRyZWplY3QoZXJyKTtcclxuLy8gXHRcdH1cclxuLy8gXHR9KTtcclxuLy8gfTtcclxuXHJcbi8qKlxyXG4gKiBUaGlzIG1ldGhvZCBjcmVhdGVzIGEgbmV3IHdvcmtmbG93IHByb2Nlc3MgaS5lLiBpdCBjcmVhdGVzIGEgd29ya2Zsb3cgcHJvY2Vzc2VzIGluc3RhbmNlXHJcbiAqIG9iamVjdCB3aXRoIHRoZSBtaW5pbXVtIHJlcXVpcmVkIGRhdGEuIFRoaXMgaW5zdGFuY2UgY2FuIGJlIHJlZmVyZW5jZWQgaW4gdGhlIGZvbGxvd2luZ1xyXG4gKiB3YXksIHNlZSBleGFtcGxlIGJlbG93LlxyXG4gKlxyXG4gKiBAZXhhbXBsZVxyXG4gKiB2YXIgY29uZmlnID0geyAnX2lkJzogJ2FiYzEyMycgfTtcclxuICogdmFyIHdvcmtmbG93ID0gbmV3IFdvcmtmbG93KCcxMjM0JywgJzU2NzgnLCBjb25maWcpO1xyXG4gKiB3b3JrZmxvdy5jcmVhdGUoKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCl7XHJcbiAqXHRjb25zb2xlLmxvZyhyZXN1bHQubWVzc2FnZSk7XHJcbiAqXHQvLyBUaGUgZm9sbG93aW5nIHByb3BlcnRpZXMgY2FuIG5vdyBiZSBhY2Nlc3NlZFxyXG4gKiBcdHZhciBwcm9maWxlID0gd29ya2Zsb3cucHJvZmlsZTtcclxuICogXHR2YXIgYXBwID0gd29ya2Zsb3cuYXBwO1xyXG4gKiBcdHZhciBjb25maWcgPSB3b3JrZmxvdy5jb25maWc7XHJcbiAqXHQvLyBPbiBzdWNjZXNzIHlvdSBjYW4gYWNjZXNzIHRoZSBpbnN0YW5jZSB0aGUgZm9sbG93aW5nIHdheVxyXG4gKlx0dmFyIGluc3RhbmNlID0gd29ya2Zsb3cuaW5zdGFuY2U7XHJcbiAqIH0sIGZ1bmN0aW9uKGVycm9yKXtcclxuICpcdGNvbnNvbGUubG9nKGVycm9yKTtcclxuICogfSk7XHJcbiAqXHJcbiAqIEByZXR1cm4ge09iamVjdH0gbmV3IFdvcmtmbG93IGluc3RhbmNlIHdpdGggdXBkYXRlZCBpbnN0YW5jZSBkYXRhLlxyXG4gKlxyXG4gKi9cclxuXHJcblxyXG5cclxuV29ya2Zsb3cucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBpZiAoX3RoaXMuaW5zdGFuY2UgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHdhcm4gPSB1dGlsLndhcm4oJ0luc3RhbmNlIGFscmVhZHkgZXhpc3RzLicsIF90aGlzKVxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSh3YXJuKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vIENyZWF0ZSB0aGUgd29ya2Zsb3cgcHJvY2Vzc2VzIGluc3RhbmNlIG9iamVjdFxyXG4gICAgICAgICAgICAgICAgdmFyIG1vZGVsID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIF9pZDogJycsXHJcbiAgICAgICAgICAgICAgICAgICAgdmVyc2lvbjogJycsXHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3dvcmtmbG93SW5zdGFuY2UnLFxyXG4gICAgICAgICAgICAgICAgICAgIHByb2Nlc3NlczogW10sXHJcbiAgICAgICAgICAgICAgICAgICAgY2hhbm5lbHM6IFtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJjb21tdW5pdHlfXCIgKyBhcHAuU0NPUEUuZ2V0Q29tbXVuaXR5SWQoKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJwcm9maWxlX1wiICsgYXBwLlNDT1BFLnByb2ZpbGVJZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJhcHBsaWNhdGlvbl9cIiArIGFwcC5TQ09QRS5hcHBsaWNhdGlvbklkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImNvbW11bml0eV9cIiArIGFwcC5TQ09QRS5nZXRDb21tdW5pdHlJZCgpICsgXCJfYXBwbGljYXRpb25fXCIgKyBhcHAuU0NPUEUuYXBwbGljYXRpb25JZFxyXG4gICAgICAgICAgICAgICAgICAgIF1cclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICBtb2RlbC5faWQgPSBfdGhpcy5wcm9maWxlICsgJzpwcm9jZXNzZXMnO1xyXG4gICAgICAgICAgICAgICAgbW9kZWwudmVyc2lvbiA9IF90aGlzLmNvbmZpZy52ZXJzaW9uO1xyXG4gICAgICAgICAgICAgICAgX3RoaXMuaW5zdGFuY2UgPSBtb2RlbDtcclxuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdXb3JrZmxvdyBwcm9jZXNzZXMgaW5zdGFuY2UgY3JlYXRlZCBzdWNjZXNzZnVsbHkuJywgX3RoaXMpO1xyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn07XHJcblxyXG4vKipcclxuICogV29ya2Zsb3cgaW5pdGlhbGlzZSwgdGhpcyBmdW5jdGlvbiBleGVjdXRlcyBhIHByb2Nlc3Mgd2l0aGluIGEgd29ya2Zsb3dcclxuICogY29uZmlndXJhdGlvbi5cclxuICpcclxuICogQHBhcmFtIHtzdHJpbmd9IHByb2Nlc3NJZCAtIHRoZSBwcm9jZXNzIGlkIHRvIHByb2Nlc3NcclxuICogQHBhcmFtIHtvYmplY3R9IFtkYXRhXSAtIHRoZSBpbnB1dCBkYXRhIHRvIHByb2Nlc3NcclxuICpcclxuICogQGV4YW1wbGVcclxuICogV29ya2Zsb3cuaW5pdGlhbGlzZSgncHJvY2Vzc0lkJywgeyB2YWxpZERhdGU6ICdkYXRlJyB9KTtcclxuICpcclxuICogQHJldHVybiBcIlwiXHJcbiAqXHJcbiAqL1xyXG5Xb3JrZmxvdy5wcm90b3R5cGUuaW5pdGlhbGlzZSA9IGZ1bmN0aW9uKHByb2Nlc3NJZCwgZGF0YSkge1xyXG4gICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICB2YXIgY29uZmlnUHJvY2VzcyA9IFtdO1xyXG4gICAgICAgICAgICAvLyBDaGVjayB0aGUgcGFzc2VkIGluIHBhcmFtZXRlcnNcclxuICAgICAgICAgICAgaWYgKHByb2Nlc3NJZCAhPT0gJycgJiYgcHJvY2Vzc0lkICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIC8vIEdldCB0aGUgY3VycmVudCBwcm9jZXNzIGNvbmZpZ1xyXG4gICAgICAgICAgICAgICAgY29uZmlnUHJvY2VzcyA9IF90aGlzLmNvbmZpZy5wcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKG9ialByb2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAob2JqUHJvY2Vzcy5faWQgPT0gcHJvY2Vzc0lkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvYmpQcm9jZXNzO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNvbmZpZ1Byb2Nlc3NbMF0uX2lkID09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvciA9IHV0aWwuZXJyb3IoJ1dGQ29uZmlnRXJyb3InLCAnTm8gdmFsaWQgcHJvY2VzcyBkZWZpbml0aW9uIGZvdW5kIHdpdGggcHJvY2VzcyBpZDogJyArIHByb2Nlc3NJZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvbmZpZ1Byb2Nlc3MucHVzaChfdGhpcy5jb25maWcucHJvY2Vzc2VzWzBdKTtcclxuICAgICAgICAgICAgICAgIHByb2Nlc3NJZCA9IF90aGlzLmNvbmZpZy5wcm9jZXNzZXNbMF0uX2lkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIEdldCB0aGUgY3VycmVudCBsaXN0IG9mIHByb2Nlc3MgaW5zdGFuY2VzXHJcbiAgICAgICAgICAgIC8vIHZhciBwcm9jZXNzU2VxID0gMTtcclxuICAgICAgICAgICAgdmFyIGN1cnJlbnRQcm9jZXNzID0gW107XHJcbiAgICAgICAgICAgIF90aGlzLmluc3RhbmNlLnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24ocHJvY2Vzc0l0ZW0pIHtcclxuICAgICAgICAgICAgICAgIGlmIChwcm9jZXNzSXRlbS5pZCA9PSBwcm9jZXNzSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50UHJvY2Vzcy5wdXNoKHByb2Nlc3NJdGVtKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHZhciBwcm9jZXNzU2VxID0gY3VycmVudFByb2Nlc3MubGVuZ3RoICsgMTtcclxuICAgICAgICAgICAgLy8gdmFyIG5leHRTZXEgPSBwcm9jZXNzU2VxICsgMTtcclxuICAgICAgICAgICAgLy8gUHVzaCB0aGUgcHJvY2VzcyBvYmplY3QgaW50byB0aGUgYXJyYXlcclxuICAgICAgICAgICAgdmFyIHByb2Nlc3NNb2RlbCA9IHtcclxuICAgICAgICAgICAgICAgICAgICBpZDogJycsXHJcbiAgICAgICAgICAgICAgICAgICAgc2VxOiAnJyxcclxuICAgICAgICAgICAgICAgICAgICBzdWJQcm9jZXNzZXM6IFtdLFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy8gMS4gVXBkYXRlIHRoZSBwcm9jZXNzIGlkIGFuZCBzZXFcclxuICAgICAgICAgICAgcHJvY2Vzc01vZGVsLmlkID0gcHJvY2Vzc0lkO1xyXG4gICAgICAgICAgICBwcm9jZXNzTW9kZWwuc2VxID0gcHJvY2Vzc1NlcTtcclxuICAgICAgICAgICAgX3RoaXMuaW5zdGFuY2UucHJvY2Vzc2VzLnB1c2gocHJvY2Vzc01vZGVsKTtcclxuICAgICAgICAgICAgLy8gUGFyYW1ldGVyc1xyXG4gICAgICAgICAgICB2YXIgc3ViUHJvY2Vzc0lkID0gY29uZmlnUHJvY2Vzc1swXS5zdWJQcm9jZXNzZXNbMF0uX2lkO1xyXG4gICAgICAgICAgICB2YXIgc3ViUHJvY2Vzc1NlcSA9IDE7XHJcbiAgICAgICAgICAgIF90aGlzLmluc3RhbmNlLnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24ocHJvY2Vzc0l0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocHJvY2Vzc0l0ZW0uaWQgPT0gcHJvY2Vzc0lkICYmIHByb2Nlc3NJdGVtLnNlcSA9PSBwcm9jZXNzU2VxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1YlByb2Nlc3NTZXEgPSBwcm9jZXNzSXRlbS5zdWJQcm9jZXNzZXMubGVuZ3RoICsgMVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAvLyBDYWxsIHRoZSBzdWJwcm9jZXNzIG1ldGhvZFxyXG5cclxuXHJcblxyXG4gICAgICAgICAgICBQcm9jZXNzLnN1YlByb2Nlc3MocHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIGRhdGEsIF90aGlzKS50aGVuKGZ1bmN0aW9uKHN1YlByb2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgIC8vIEdlbmVyYXRlIHRoZSB1dWlkXHJcblxyXG5cclxuICAgICAgICAgICAgICAgIHZhciB1dWlkID0gc3ViUHJvY2Vzcy5kYXRhLl9pZDsgLy9fdGhpcy5wcm9maWxlICsgJzonICsgX3RoaXMuYXBwICsgJzonICsgcHJvY2Vzc0lkICsgJzonICsgcHJvY2Vzc1NlcSArICc6JyArIHN1YlByb2Nlc3NJZCArICc6JyArIHN1YlByb2Nlc3NTZXE7XHJcbiAgICAgICAgICAgICAgICB2YXIgbGFiZWwgPSBkYXRhLmxhYmVsO1xyXG4gICAgICAgICAgICAgICAgLy8gQnVpbGQgdGhlIHN1Yi1wcm9jZXNzIHJlZmVyZW5jZSBvYmplY3RcclxuXHJcbiAgICAgICAgICAgICAgICAvL1RPRE86IENoYW5nZSByZXF1aXJlZCB0byBtb3ZlIGlzQWN0aXZlIHRvIHN1YlByb2Nlc3MgZmlsZS5SZW1vdmUgZnJvbSBoZXJlXHJcblxyXG5cclxuICAgICAgICAgICAgICAgIHZhciBzdWJQcm9jZXNzUmVmID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogc3ViUHJvY2Vzc0lkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXE6IHN1YlByb2Nlc3NTZXEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHV1aWQ6IHV1aWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiBsYWJlbFxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAvLyBBZGQgdGhlIHJlZmVyZW5jZSB0byB0aGUgcHJvY2VzcyBtb2RlbFxyXG4gICAgICAgICAgICAgICAgcHJvY2Vzc01vZGVsLnN1YlByb2Nlc3Nlcy5wdXNoKHN1YlByb2Nlc3NSZWYpO1xyXG4gICAgICAgICAgICAgICAgLy8gQWRkIHRoZSBzdWJQcm9jZXNzIG1vZGVsIHRvIHRoZSBzdWJwcm9jZXNzZXMgYXJyYXlcclxuICAgICAgICAgICAgICAgIC8vX3RoaXMuc3VicHJvY2Vzc2VzLnB1c2goc3ViUHJvY2Vzcy5kYXRhKTtcclxuICAgICAgICAgICAgICAgIC8vIF90aGlzLmluc3RhbmNlLnByb2Nlc3Nlcy5wdXNoKHByb2Nlc3NNb2RlbCk7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgX3RoaXMuaW5zdGFuY2UucHJvY2Vzc2VzLmxlbmd0aDsgaW5kZXgrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBwcm9jZXNzSXRlbSA9IF90aGlzLmluc3RhbmNlLnByb2Nlc3Nlc1tpbmRleF07XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHByb2Nlc3NJdGVtLmlkID09IHByb2Nlc3NJZCAmJiBwcm9jZXNzSXRlbS5zZXEgPT0gcHJvY2Vzc1NlcSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgdGhlIGN1cnJlbnQgcHJvY2VzcyBmcm9tIHRoZSBhcnJheSBhbmQgYWRkIHRoZSB1cGRhdGVkIHByb2Nlc3NNb2RlbFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5pbnN0YW5jZS5wcm9jZXNzZXMuc3BsaWNlKGluZGV4LCAxLCBwcm9jZXNzTW9kZWwpXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy8gUHJvY2VzcyB0aGUgaW5kaWNhdG9yIGRvY3VtZW50cyB3b3JrZmxvdyBwcm9jZXNzZXMgdXBkYXRlc1xyXG4gICAgICAgICAgICAgICAgdmFyIGluZGljYXRvcnMgPSBzdWJQcm9jZXNzLmRhdGEuaW5kaWNhdG9ycztcclxuICAgICAgICAgICAgICAgIHZhciBzdGVwID0gc3ViUHJvY2Vzcy5kYXRhLnN0ZXA7XHJcbiAgICAgICAgICAgICAgICBQcm9jZXNzLmluZGljYXRvckRvY3MocHJvY2Vzc0lkLCBpbmRpY2F0b3JzLCBzdGVwLCBfdGhpcykudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnUHJvY2VzczogJyArIF90aGlzLmNvbmZpZy5wcm9jZXNzZXNbMF0uX2lkICsgJyBpbml0aWFsaXplZCBzdWNjZXNzZnVsbHkuJywgX3RoaXMpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgIF90aGlzLmluc3RhbmNlLnByb2Nlc3NlcyA9IF90aGlzLmluc3RhbmNlLnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24ob2JqKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICEob2JqLmlkID09IHByb2Nlc3NJZCAmJiBvYmouc2VxID09IHByb2Nlc3NTZXEpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xyXG4gICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBXb3JrZmxvdyB0cmFuc2l0aW9uIHRvIHRoZSBuZXh0IHN0ZXAuIFRoaXMgbW92ZXMgdGhlIHdvcmtmbG93IGZyb20gdGhlIGN1cnJlbnQgcHJvY2VzcyxcclxuICogc3ViLXByb2Nlc3Mgc3RlcCB0byB0aGUgbmV4dCBvbmUgYXMgc3BlY2lmaWVkLlxyXG4gKlxyXG4gKiBAcGFyYW0ge3N0cmluZ30gcHJvY2Vzc0lkIC0gdGhlIFdvcmtmbG93IGNvbmZpZyAvIGRlZmluaXRpb24gcHJvY2VzcyBpZFxyXG4gKiBAcGFyYW0ge251bWJlcn0gcHJvY2Vzc1NlcSAtIHRoZSBXb3JrZmxvdyBpbnN0YW5jZSBwcm9jZXNzIHNlcVxyXG4gKiBAcGFyYW0ge3N0cmluZ30gc3ViUHJvY2Vzc0lkIC0gdGhlIFdvcmtmbG93IGNvbmZpZyAvIGRlZmluaXRpb24gc3ViLXByb2Nlc3MgaWRcclxuICogQHBhcmFtIHtudW1iZXJ9IHN1YlByb2Nlc3NTZXEgLSB0aGUgV29ya2Zsb3cgaW5zdGFuY2Ugc3ViLXByb2Nlc3Mgc2VxXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdGVwSWQgLSB0aGUgV29ya2Zsb3cgY29uZmlnIC8gZGVmaW5pdGlvbiBzdGVwIGlkXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSB0cmFuc2l0aW9uSWQgLSB0aGUgV29ya2Zsb3cgY29uZmlnIC8gZGVmaW5pdGlvbiB0cmFuc2l0aW9uIGlkXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBkYXRhIC0gYW55IGFkZGl0aW9uYWwgZGF0YSBwYXNzZWQgaW4gYXMga2V5IHZhbHVlIHBhaXJzXHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqIFdvcmtmbG93LnRyYW5zaXRpb24oJ3Byb2Nlc3NJZCcsIDEsICdzdWJQcm9jZXNzSWQnLCAxLCAnc3RlcElkJywgJ3RyYW5zaXRpb25JZCcsIHsga2V5OiAnJywgdmFsdWU6ICcnIH0pO1xyXG4gKlxyXG4gKiBAcmV0dXJuIFwiXCJcclxuICpcclxuICovXHJcbldvcmtmbG93LnByb3RvdHlwZS50cmFuc2l0aW9uID0gZnVuY3Rpb24ocHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIHN0ZXBJZCwgdHJhbnNpdGlvbklkLCBkYXRhKSB7XHJcbiAgICAvLyBSZS1hc3NpZ24gdGhpc1xyXG4gICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBQcm9jZXNzLnRyYW5zaXRpb24ocHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIHN0ZXBJZCwgdHJhbnNpdGlvbklkLCBkYXRhLCBfdGhpcykudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSBjdXJyZW50IHN1Yi1wcm9jZXNzIHN0ZXAgZGF0YVxyXG4gICAgICAgICAgICAgICAgdmFyIHVwZGF0ZSA9IGZ1bmN0aW9uKHR5cGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBfdGhpcy5pbnN0YW5jZS5wcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKHByb2Nlc3NJdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcm9jZXNzSXRlbS5pZCA9PSBwcm9jZXNzSWQgJiYgcHJvY2Vzc0l0ZW0uc2VxID09IHByb2Nlc3NTZXEpIHtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc0l0ZW0uc3ViUHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihzdWJQcm9jZXNzSXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdWJQcm9jZXNzSXRlbS5pZCA9PSBzdWJQcm9jZXNzSWQgJiYgc3ViUHJvY2Vzc0l0ZW0uc2VxID09IHN1YlByb2Nlc3NTZXEpIHtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5zdWJwcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKHN1YlByb2Nlc3NPYmopIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdWJQcm9jZXNzT2JqLl9pZCA9PSBzdWJQcm9jZXNzSXRlbS51dWlkKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlID09ICdzdGVwJykge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ViUHJvY2Vzc09iai5zdGVwID0gcmVzdWx0LmRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKHJlc3VsdC5tZXNzYWdlLCBzdWJQcm9jZXNzT2JqKTtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSAnc3RlcENvbXBsZXRlJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJQcm9jZXNzT2JqLnN0ZXAgPSByZXN1bHQuZGF0YS5zdGVwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJQcm9jZXNzT2JqLmNvbXBsZXRlID0gdHJ1ZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcyhyZXN1bHQubWVzc2FnZSwgc3ViUHJvY2Vzc09iaik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuZGF0YS5zdWJQcm9jZXNzQ29tcGxldGUpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlKCdzdGVwQ29tcGxldGUnKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZSgnc3RlcCcpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuXHJcbiAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XHJcblxyXG4gICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBXb3JrZmxvdyBhc3NpZ24gdXNlci5cclxuICpcclxuICogQHBhcmFtIHtzdHJpbmd9IHByb2Nlc3NJZCAtIHRoZSBXb3JrZmxvdyBjb25maWcgLyBkZWZpbml0aW9uIHByb2Nlc3MgaWRcclxuICogQHBhcmFtIHtudW1iZXJ9IHByb2Nlc3NTZXEgLSB0aGUgV29ya2Zsb3cgaW5zdGFuY2UgcHJvY2VzcyBzZXFcclxuICogQHBhcmFtIHtzdHJpbmd9IHN1YlByb2Nlc3NJZCAtIHRoZSBXb3JrZmxvdyBjb25maWcgLyBkZWZpbml0aW9uIHN1Yi1wcm9jZXNzIGlkXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBzdWJQcm9jZXNzU2VxIC0gdGhlIFdvcmtmbG93IGluc3RhbmNlIHN1Yi1wcm9jZXNzIHNlcVxyXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RlcElkIC0gdGhlIFdvcmtmbG93IGNvbmZpZyAvIGRlZmluaXRpb24gc3RlcCBpZFxyXG4gKiBAcGFyYW0ge29iamVjdH0gdXNlciAtIHRoZSB1c2VyIGlkIGFuZCBuYW1lIGRhdGFcclxuICpcclxuICogQGV4YW1wbGUgXCJcIlxyXG4gKlxyXG4gKiBAcmV0dXJuIFwiXCJcclxuICpcclxuICovXHJcbldvcmtmbG93LnByb3RvdHlwZS5hc3NpZ25Vc2VyID0gZnVuY3Rpb24ocHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIHVzZXIpIHtcclxuICAgIC8vIFJlLWFzc2lnbiB0aGUgV29ya2Zsb3cgY29uc3RydWN0b3IgaW5zdGFuY2UgYXMgX3RoaXNcclxuICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgUHJvY2Vzcy5hc3NpZ25Vc2VyKHByb2Nlc3NJZCwgcHJvY2Vzc1NlcSwgc3ViUHJvY2Vzc0lkLCBzdWJQcm9jZXNzU2VxLCB1c2VyLCBfdGhpcykudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0KTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgfVxyXG4gICAgfSlcclxufTtcclxuXHJcbi8qKlxyXG4gKiBXb3JrZmxvdyB0YXNrLCB0aGlzIG1ldGhvZCBleGVjdXRlcyBhIHNwZWNpZmljIHRhc2suXHJcbiAqXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBwcm9jZXNzSWQgLSB0aGUgcHJvY2VzcyBpZCB0byBwcm9jZXNzXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBpbnB1dERhdGEgLSB0aGUgaW5wdXQgZGF0YSB0byBwcm9jZXNzXHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqIFdvcmtmbG93LmluaXRpYWxpemUoJ3Byb2Nlc3NJZCcsIHsgdmFsaWREYXRlOiAnZGF0ZScgfSk7XHJcbiAqXHJcbiAqIEByZXR1cm4gXCJcIlxyXG4gKlxyXG4gKi9cclxuV29ya2Zsb3cucHJvdG90eXBlLnVpID0gZnVuY3Rpb24oKSB7XHJcbiAgICAvLyBSZS1hc3NpZ24gdGhlIFdvcmtmbG93IGNvbnN0cnVjdG9yIGluc3RhbmNlIGFzIF90aGlzXHJcbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBnZXRQcm9jZXNzOiBmdW5jdGlvbihwcm9jZXNzSWQsIGxhbmcpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICB1c2VySW50ZXJmYWNlLmdldFByb2Nlc3MocHJvY2Vzc0lkLCBsYW5nLCBfdGhpcykudGhlbihmdW5jdGlvbihtb2RlbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG1vZGVsKTtcclxuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufTtcclxuXHJcblxyXG5cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gV29ya2Zsb3c7IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxudmFyIHV0aWwgPSByZXF1aXJlKCd1dGlsaXR5Jyk7XHJcbnZhciBub2RlVmFsdWUgPSByZXF1aXJlKCcuL25vZGVWYWx1ZScpO1xyXG52YXIgZm9ybSA9IHJlcXVpcmUoJy4vZm9ybScpO1xyXG4vKipcclxuICogQWN0aW9ucyBNb2R1bGVcclxuICpcclxuICogQG1vZHVsZSBsaWIvYWN0aW9uc1xyXG4gKiBAYXV0aG9yIEhhc2FuIEFiYmFzXHJcbiAqIEB2ZXJzaW9uIDIuMC4wXHJcbiAqIEBkZXNjcmlwdGlvbiB0ZXN0IGRlc2NyaXB0aW9uXHJcbiAqIEBjb3B5cmlnaHQgS3dhbnR1IEx0ZCBSU0EgMjAwOS0yMDE1LlxyXG4gKlxyXG4gKi9cclxuXHJcblxyXG52YXIgY29tbXVuaXR5ID0gKGZ1bmN0aW9uKCkge1xyXG5cclxuICAgIHJldHVybiB7XHJcblxyXG4gICAgICAgIGNyZWF0ZUNvbW11bml0eTogZnVuY3Rpb24oX2RlZiwgdXVpZCwgX1dGSW5zdGFuY2UpIHtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgd29ya2VyT2JqZWN0ID0gd29ya2VyLmdldFdvcmtlcldyYXBwZXIoKTtcclxuXHJcbiAgICAgICAgICAgICAgICB3b3JrZXJPYmplY3QuX2lkID0gZ2VuZXJhdGVVVUlEKCk7XHJcbiAgICAgICAgICAgICAgICB3b3JrZXJPYmplY3QuY29tbXVuaXR5SWQgPSBhcHAuU0NPUEUuZ2V0Q29tbXVuaXR5SWQoKTtcclxuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5hcHBsaWNhdGlvbklkID0gYXBwLlNDT1BFLmFwcGxpY2F0aW9uSWQ7XHJcbiAgICAgICAgICAgICAgICB3b3JrZXJPYmplY3QuY3JlYXRlZERhdGVUaW1lID0gbmV3IERhdGUoKS50b1N0cmluZygpO1xyXG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0LnNlbmRlclVzZXJJZCA9IExPQ0FMX1NFVFRJTkdTLlNVQlNDUklQVElPTlMudXNlcklkO1xyXG4gICAgICAgICAgICAgICAgdmFyIHV1aWRDb21tdW5pdHkgPSBKU09OLnhwYXRoKFwiL2luZGljYXRvcnNbY2F0ZWdvcnkvdGVybSBlcSAnQ29tbXVuaXR5J10vX2lkXCIsIF9XRkluc3RhbmNlLCB7fSlbMF07XHJcbiAgICAgICAgICAgICAgICB2YXIgYWN0aW9uID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIFwiY3JlYXRlQ29tbXVuaXR5XCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJuZXdDb21tdW5pdHlJZFwiOiBfV0ZJbnN0YW5jZS5wcm9maWxlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImluZGljYXRvclVVSURcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJDb21tdW5pdHlcIjogdXVpZENvbW11bml0eVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5hY3Rpb24gPSBhY3Rpb247XHJcbiAgICAgICAgICAgICAgICB3b3JrZXIuc2VuZCh3b3JrZXJPYmplY3QpLnRoZW4oZnVuY3Rpb24od29ya2VyU3VjY2Vzcykge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnV29ya2VyIHByb2Nlc3NlZCBzdWNjZXNzZnVsbHkuJywgd29ya2VyU3VjY2Vzcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcclxuXHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbih3b3JrZXJGYWlsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHdvcmtlckZhaWwpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdXNlckpvaW5Db21tdW5pdHk6IGZ1bmN0aW9uKF9kZWYsIHV1aWQsIF9XRkluc3RhbmNlKSB7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcblxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgfSxcclxuICAgICAgICByZWxlYXNlQWRvcHRlZEFwcGxpY2F0aW9uOiBmdW5jdGlvbihfZGVmLCB1dWlkLCBfV0ZJbnN0YW5jZSkge1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciB3b3JrZXJPYmplY3QgPSB3b3JrZXIuZ2V0V29ya2VyV3JhcHBlcigpO1xyXG5cclxuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5faWQgPSBnZW5lcmF0ZVVVSUQoKTtcclxuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5jb21tdW5pdHlJZCA9IGFwcC5TQ09QRS5nZXRDb21tdW5pdHlJZCgpO1xyXG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0LmFwcGxpY2F0aW9uSWQgPSBhcHAuU0NPUEUuYXBwbGljYXRpb25JZDtcclxuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5jcmVhdGVkRGF0ZVRpbWUgPSBuZXcgRGF0ZSgpLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgICAgICAgICB3b3JrZXJPYmplY3Quc2VuZGVyVXNlcklkID0gTE9DQUxfU0VUVElOR1MuU1VCU0NSSVBUSU9OUy51c2VySWQ7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHV1aWRSZWxlYXNlQWRvcHRlZEFwcGxpY2F0aW9uID0gSlNPTi54cGF0aChcIi9zdWJwcm9jZXNzZXNbX2lkIGVxICdcIiArIHV1aWQgKyBcIiddL2luZGljYXRvcnNbaWQgZXEgJ2Fkb3B0ZWRBcHBsaWNhdGlvbiddL2luc3RhbmNlc1sxXS91dWlkXCIsIF9XRkluc3RhbmNlLCB7fSlbMF07XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIHZhciBhY3Rpb24gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgXCJyZWxlYXNlQWRvcHRlZEFwcGxpY2F0aW9uXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJjb21tdW5pdHlJZFwiOiBfV0ZJbnN0YW5jZS5wcm9maWxlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImluZGljYXRvclVVSURcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJhZG9wdGVkQXBwbGljYXRpb25cIjogdXVpZFJlbGVhc2VBZG9wdGVkQXBwbGljYXRpb25cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB3b3JrZXJPYmplY3QuYWN0aW9uID0gYWN0aW9uO1xyXG4gICAgICAgICAgICAgICAgd29ya2VyLnNlbmQod29ya2VyT2JqZWN0KS50aGVuKGZ1bmN0aW9uKHdvcmtlclN1Y2Nlc3MpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ1dvcmtlciBwcm9jZXNzZXMgc3VjY2Vzc2Z1bGx5LicsIHdvcmtlclN1Y2Nlc3MpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24od29ya2VyRmFpbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdCh3b3JrZXJGYWlsKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxufSkoKTtcclxuXHJcbnZhciBhcHBsaWNhdGlvbiA9IChmdW5jdGlvbigpIHtcclxuXHJcbiAgICByZXR1cm4ge1xyXG5cclxuICAgICAgICBjcmVhdGVBcHBEZWZpbml0aW9uOiBmdW5jdGlvbihfZGVmLCB1dWlkLCBfV0ZJbnN0YW5jZSkge1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciB3b3JrZXJPYmplY3QgPSB3b3JrZXIuZ2V0V29ya2VyV3JhcHBlcigpO1xyXG5cclxuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5faWQgPSBnZW5lcmF0ZVVVSUQoKTtcclxuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5jb21tdW5pdHlJZCA9IGFwcC5TQ09QRS5nZXRDb21tdW5pdHlJZCgpO1xyXG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0LmFwcGxpY2F0aW9uSWQgPSBhcHAuU0NPUEUuYXBwbGljYXRpb25JZDtcclxuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5jcmVhdGVkRGF0ZVRpbWUgPSBuZXcgRGF0ZSgpLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgICAgICAgICB3b3JrZXJPYmplY3Quc2VuZGVyVXNlcklkID0gTE9DQUxfU0VUVElOR1MuU1VCU0NSSVBUSU9OUy51c2VySWQ7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHV1aWRBcHBsaWNhdGlvbiA9IEpTT04ueHBhdGgoXCIvaW5kaWNhdG9yc1tjYXRlZ29yeS90ZXJtIGVxICdBcHBsaWNhdGlvbiddL19pZFwiLCBfV0ZJbnN0YW5jZSwge30pWzBdO1xyXG4gICAgICAgICAgICAgICAgdmFyIGFjdGlvbiA9IHtcclxuICAgICAgICAgICAgICAgICAgICBcImNyZWF0ZUFwcGxpY2F0aW9uXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJuZXdBcHBsaWNhdGlvbklkXCI6IF9XRkluc3RhbmNlLnByb2ZpbGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiaW5kaWNhdG9yVVVJRFwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIkFwcGxpY2F0aW9uXCI6IHV1aWRBcHBsaWNhdGlvblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5hY3Rpb24gPSBhY3Rpb247XHJcbiAgICAgICAgICAgICAgICB3b3JrZXIuc2VuZCh3b3JrZXJPYmplY3QpLnRoZW4oZnVuY3Rpb24od29ya2VyU3VjY2Vzcykge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnV29ya2VyIHByb2Nlc3NlcyBzdWNjZXNzZnVsbHkuJywgd29ya2VyU3VjY2Vzcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcclxuXHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbih3b3JrZXJGYWlsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHdvcmtlckZhaWwpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBidWlsZEFwcGxpY2F0aW9uOiBmdW5jdGlvbihfZGVmLCB1dWlkLCBfV0ZJbnN0YW5jZSkge1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciB3b3JrZXJPYmplY3QgPSB3b3JrZXIuZ2V0V29ya2VyV3JhcHBlcigpO1xyXG5cclxuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5faWQgPSBnZW5lcmF0ZVVVSUQoKTtcclxuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5jb21tdW5pdHlJZCA9IGFwcC5TQ09QRS5nZXRDb21tdW5pdHlJZCgpO1xyXG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0LmFwcGxpY2F0aW9uSWQgPSBhcHAuU0NPUEUuYXBwbGljYXRpb25JZDtcclxuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5jcmVhdGVkRGF0ZVRpbWUgPSBuZXcgRGF0ZSgpLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgICAgICAgICB3b3JrZXJPYmplY3Quc2VuZGVyVXNlcklkID0gTE9DQUxfU0VUVElOR1MuU1VCU0NSSVBUSU9OUy51c2VySWQ7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHV1aWRQdWJsaXNoQXBwbGljYXRpb24gPSBKU09OLnhwYXRoKFwiL3N1YnByb2Nlc3Nlc1tfaWQgZXEgJ1wiICsgdXVpZCArIFwiJ10vaW5kaWNhdG9yc1tpZCBlcSAnUHVibGlzaEFwcGxpY2F0aW9uJ10vaW5zdGFuY2VzWzFdL3V1aWRcIiwgX1dGSW5zdGFuY2UsIHt9KVswXTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgdXVpZEFwcGxpY2F0aW9uRGVmaW5pdGlvbiA9IEpTT04ueHBhdGgoXCIvaW5kaWNhdG9yc1tjYXRlZ29yeS90ZXJtIGVxICdBcHBsaWNhdGlvbkRlZmluaXRpb24nXS9faWRcIiwgX1dGSW5zdGFuY2UsIHt9KVswXTtcclxuICAgICAgICAgICAgICAgIHZhciB1dWlkUm9sZXMgPSBKU09OLnhwYXRoKFwiL2luZGljYXRvcnNbY2F0ZWdvcnkvdGVybSBlcSAnUm9sZXMnXS9faWRcIiwgX1dGSW5zdGFuY2UsIHt9KVswXTtcclxuICAgICAgICAgICAgICAgIHZhciB1dWlkQXBwbGljYXRpb24gPSBKU09OLnhwYXRoKFwiL2luZGljYXRvcnNbY2F0ZWdvcnkvdGVybSBlcSAnQXBwbGljYXRpb24nXS9faWRcIiwgX1dGSW5zdGFuY2UsIHt9KVswXTtcclxuICAgICAgICAgICAgICAgIHZhciB1dWlkQXBwUGVybWlzc2lvbnMgPSBKU09OLnhwYXRoKFwiL2luZGljYXRvcnNbY2F0ZWdvcnkvdGVybSBlcSAnQXBwUGVybWlzc2lvbnMnXS9faWRcIiwgX1dGSW5zdGFuY2UsIHt9KVswXTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgYWN0aW9uID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIFwiYnVpbGRBcHBsaWNhdGlvblwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiYXBwbGljYXRpb25JZFwiOiBfV0ZJbnN0YW5jZS5wcm9maWxlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImluZGljYXRvclVVSURcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJQdWJsaXNoQXBwbGljYXRpb25cIjogdXVpZFB1Ymxpc2hBcHBsaWNhdGlvbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiQXBwbGljYXRpb25EZWZpbml0aW9uXCI6IHV1aWRBcHBsaWNhdGlvbkRlZmluaXRpb24sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIlJvbGVzXCI6IHV1aWRSb2xlcyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiQXBwbGljYXRpb25cIjogdXVpZEFwcGxpY2F0aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJBcHBQZXJtaXNzaW9uc1wiOiB1dWlkQXBwUGVybWlzc2lvbnNcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB3b3JrZXJPYmplY3QuYWN0aW9uID0gYWN0aW9uO1xyXG4gICAgICAgICAgICAgICAgd29ya2VyLnNlbmQod29ya2VyT2JqZWN0KS50aGVuKGZ1bmN0aW9uKHdvcmtlclN1Y2Nlc3MpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ1dvcmtlciBwcm9jZXNzZXMgc3VjY2Vzc2Z1bGx5LicsIHdvcmtlclN1Y2Nlc3MpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24od29ya2VyRmFpbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdCh3b3JrZXJGYWlsKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgYXBwbGljYXRpb25BZG9wdGlvbjogZnVuY3Rpb24oX2RlZiwgdXVpZCwgX1dGSW5zdGFuY2UpIHtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgd29ya2VyT2JqZWN0ID0gd29ya2VyLmdldFdvcmtlcldyYXBwZXIoKTtcclxuXHJcbiAgICAgICAgICAgICAgICB3b3JrZXJPYmplY3QuX2lkID0gZ2VuZXJhdGVVVUlEKCk7XHJcbiAgICAgICAgICAgICAgICB3b3JrZXJPYmplY3QuY29tbXVuaXR5SWQgPSBhcHAuU0NPUEUuZ2V0Q29tbXVuaXR5SWQoKTtcclxuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5hcHBsaWNhdGlvbklkID0gYXBwLlNDT1BFLmFwcGxpY2F0aW9uSWQ7XHJcbiAgICAgICAgICAgICAgICB3b3JrZXJPYmplY3QuY3JlYXRlZERhdGVUaW1lID0gbmV3IERhdGUoKS50b1N0cmluZygpO1xyXG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0LnNlbmRlclVzZXJJZCA9IExPQ0FMX1NFVFRJTkdTLlNVQlNDUklQVElPTlMudXNlcklkO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciB1dWlkQWRvcHRpb24gPSBKU09OLnhwYXRoKFwiL3N1YnByb2Nlc3Nlc1tfaWQgZXEgJ1wiICsgdXVpZCArIFwiJ10vaW5kaWNhdG9yc1tpZCBlcSAnQWRvcHRpb24nXS9pbnN0YW5jZXNbMV0vdXVpZFwiLCBfV0ZJbnN0YW5jZSwge30pWzBdO1xyXG5cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHV1aWRQdWJsaXNoQXBwbGljYXRpb24gPSBKU09OLnhwYXRoKFwiL2luZGljYXRvcnNbY2F0ZWdvcnkvdGVybSBlcSAnUHVibGlzaEFwcGxpY2F0aW9uJ10vX2lkXCIsIF9XRkluc3RhbmNlLCB7fSlbMF07XHJcbiAgICAgICAgICAgICAgICB2YXIgdXVpZEFwcGxpY2F0aW9uID0gSlNPTi54cGF0aChcIi9pbmRpY2F0b3JzW2NhdGVnb3J5L3Rlcm0gZXEgJ0FwcGxpY2F0aW9uJ10vX2lkXCIsIF9XRkluc3RhbmNlLCB7fSlbMF07XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGFjdGlvbiA9IHtcclxuICAgICAgICAgICAgICAgICAgICBcImFkb3B0QXBwbGljYXRpb25cIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImFwcGxpY2F0aW9uSWRcIjogX1dGSW5zdGFuY2UucHJvZmlsZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJpbmRpY2F0b3JVVUlEXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiQWRvcHRpb25cIjogdXVpZEFkb3B0aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJQdWJsaXNoQXBwbGljYXRpb25cIjogdXVpZFB1Ymxpc2hBcHBsaWNhdGlvbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiQXBwbGljYXRpb25cIjogdXVpZEFwcGxpY2F0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0LmFjdGlvbiA9IGFjdGlvbjtcclxuICAgICAgICAgICAgICAgIHdvcmtlci5zZW5kKHdvcmtlck9iamVjdCkudGhlbihmdW5jdGlvbih3b3JrZXJTdWNjZXNzKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdXb3JrZXIgcHJvY2Vzc2VzIHN1Y2Nlc3NmdWxseS4nLCB3b3JrZXJTdWNjZXNzKTtcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xyXG5cclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKHdvcmtlckZhaWwpIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3Qod29ya2VyRmFpbCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbn0pKCk7XHJcblxyXG5cclxudmFyIHdvcmtlciA9IChmdW5jdGlvbigpIHtcclxuXHJcblxyXG4gICAgcmV0dXJuIHtcclxuXHJcbiAgICAgICAgZ2V0V29ya2VyV3JhcHBlcjogZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgd3JhcHBlciA9IHtcclxuICAgICAgICAgICAgICAgIFwic291cmNlXCI6IFwicmVtb3RlXCIsXHJcbiAgICAgICAgICAgICAgICBcInR5cGVcIjogXCJ3b3JrZXJPYmplY3RcIixcclxuICAgICAgICAgICAgICAgIFwiX2lkXCI6IFwiXCIsXHJcbiAgICAgICAgICAgICAgICBcImNoYW5uZWxzXCI6IFtdLFxyXG4gICAgICAgICAgICAgICAgXCJjb21tdW5pdHlJZFwiOiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgXCJhcHBsaWNhdGlvbklkXCI6IFwiXCIsXHJcbiAgICAgICAgICAgICAgICBcIm1lc3NhZ2VcIjogXCJcIixcclxuICAgICAgICAgICAgICAgIFwibWVzc2FnZVR5cGVcIjogXCJpbmZvXCIsXHJcbiAgICAgICAgICAgICAgICBcImNyZWF0ZWREYXRlVGltZVwiOiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgXCJzZW5kZXJVc2VySWRcIjogXCJcIixcclxuICAgICAgICAgICAgICAgIFwibm90aWZpY2F0aW9uXCI6IHtcclxuXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgXCJhY3Rpb25cIjoge1xyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiB3cmFwcGVyO1xyXG5cclxuICAgICAgICB9LFxyXG4gICAgICAgIHNlbmQ6IGZ1bmN0aW9uKHdvcmtlck9iamVjdCkge1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdTdWJtaXR0aW5nIFdvcmtlciBPYmplY3QgdG8gc2VydmVyJyk7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh3b3JrZXJPYmplY3QpO1xyXG4gICAgICAgICAgICAgICAgZGFvLnNhdmUod29ya2VyT2JqZWN0KS5kb25lKGZ1bmN0aW9uKHdvcmtlclJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh3b3JrZXJSZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICB9KS5mYWlsKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdFcnJvciBzdWJtaXR0aW5nIHdvcmtlciByZXNwb25zZSAhIScgKyBlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuXHJcblxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxufSkoKTtcclxuXHJcbnZhciBwZXJmb3JtYW5jZSA9IChmdW5jdGlvbigpIHtcclxuXHJcbiAgICByZXR1cm4ge1xyXG5cclxuICAgICAgICBjcmVhdGVQbGFuOiBmdW5jdGlvbihfZGVmLCB1dWlkLCBfV0ZJbnN0YW5jZSkge1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciB3b3JrZXJPYmplY3QgPSB3b3JrZXIuZ2V0V29ya2VyV3JhcHBlcigpO1xyXG5cclxuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5faWQgPSBnZW5lcmF0ZVVVSUQoKTtcclxuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5jb21tdW5pdHlJZCA9IGFwcC5TQ09QRS5nZXRDb21tdW5pdHlJZCgpO1xyXG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0LmFwcGxpY2F0aW9uSWQgPSBhcHAuU0NPUEUuYXBwbGljYXRpb25JZDtcclxuICAgICAgICAgICAgICAgIHdvcmtlck9iamVjdC5jcmVhdGVkRGF0ZVRpbWUgPSBuZXcgRGF0ZSgpLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgICAgICAgICB3b3JrZXJPYmplY3Quc2VuZGVyVXNlcklkID0gTE9DQUxfU0VUVElOR1MuU1VCU0NSSVBUSU9OUy51c2VySWQ7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHV1aWRDb21tdW5pdHkgPSBKU09OLnhwYXRoKFwiL2luZGljYXRvcnNbY2F0ZWdvcnkvdGVybSBlcSAncGxhbiddL19pZFwiLCBfV0ZJbnN0YW5jZSwge30pWzBdO1xyXG4gICAgICAgICAgICAgICAgdmFyIGFjdGlvbiA9IHtcclxuICAgICAgICAgICAgICAgICAgICBcImNyZWF0ZVBsYW5cIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInBsYW5VVUlEXCI6IHV1aWRDb21tdW5pdHlcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgd29ya2VyT2JqZWN0LmFjdGlvbiA9IGFjdGlvbjtcclxuICAgICAgICAgICAgICAgIHdvcmtlci5zZW5kKHdvcmtlck9iamVjdCkudGhlbihmdW5jdGlvbih3b3JrZXJTdWNjZXNzKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdXb3JrZXIgcHJvY2Vzc2VkIHN1Y2Nlc3NmdWxseS4nLCB3b3JrZXJTdWNjZXNzKTtcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xyXG5cclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKHdvcmtlckZhaWwpIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3Qod29ya2VyRmFpbCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbn0pKCk7XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHtcclxuXHJcbiAgICBjb21tdW5pdHk6IGNvbW11bml0eSxcclxuICAgIGFwcGxpY2F0aW9uOiBhcHBsaWNhdGlvbixcclxuICAgIHBlcmZvcm1hbmNlOiBwZXJmb3JtYW5jZSxcclxuICAgIHdvcmtlcjogd29ya2VyXHJcblxyXG59IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuLy92YXIgZ2F0ZWtlZXBlciA9IHJlcXVpcmUoJy4uL2Jvd2VyX2NvbXBvbmVudHMvZ2F0ZWtlZXBlcicpO1xyXG52YXIgdXRpbCA9IHJlcXVpcmUoJ3V0aWxpdHknKTtcclxuXHJcbi8vIHZhciB1dWlkID0gcmVxdWlyZSgnbm9kZS11dWlkJyk7XHJcblxyXG52YXIgZ2F0ZWtlZXBlciA9IG5ldyBHSygpO1xyXG5cclxuLyoqXHJcbiAqIEZvcm0gTW9kdWxlXHJcbiAqXHJcbiAqIEBtb2R1bGUgbGliL2Zvcm1cclxuICogQGF1dGhvciBCcmVudCBHb3Jkb25cclxuICogQHZlcnNpb24gMi4wLjBcclxuICogQGRlc2NyaXB0aW9uIHRlc3QgZGVzY3JpcHRpb25cclxuICogQGNvcHlyaWdodCBLd2FudHUgTHRkIFJTQSAyMDA5LTIwMTUuXHJcbiAqXHJcbiAqL1xyXG5cclxuZnVuY3Rpb24gY3JlYXRlKGFyZ3MpIHtcclxuXHJcbiAgICB2YXIgcHJvY2Vzc0lkID0gYXJnc1swXSB8fCAnJztcclxuXHJcbiAgICB2YXIgc3ViUHJvY2VzcyA9IGFyZ3NbMV0gfHwge307XHJcblxyXG4gICAgdmFyIHN0ZXAgPSBhcmdzWzJdIHx8IHt9O1xyXG5cclxuICAgIHZhciBhY3Rpb24gPSBhcmdzWzNdIHx8IHt9O1xyXG5cclxuICAgIHZhciBfV0ZJbnN0YW5jZSA9IGFyZ3NbNl0gfHwge307XHJcblxyXG4gICAgdmFyIGRhdGEgPSBhcmdzWzZdIHx8IHt9O1xyXG5cclxuICAgIHZhciBpbmRpY2F0b3JzID0gc3ViUHJvY2Vzcy5pbmRpY2F0b3JzIHx8IFtdO1xyXG5cclxuICAgIHZhciByZXN1bHQgPSBbXTtcclxuXHJcbiAgICB2YXIgaW5kaWNhdG9yVHlwZSA9IGFjdGlvbi5fdHlwZTtcclxuXHJcbiAgICB2YXIgcHJvY2Vzc1NlcSA9IGFyZ3NbNF0gfHwgJyc7XHJcblxyXG4gICAgdmFyIHN1YlByb2Nlc3NTZXEgPSBhcmdzWzVdIHx8ICcnO1xyXG5cclxuICAgIHZhciBjcmVhdGVUeXBlID0gYXJnc1s3XSB8fCAnJztcclxuXHJcbiAgICB2YXIgc3ViUHJvY2Vzc0lkID0gc3ViUHJvY2Vzcy5faWQ7XHJcblxyXG4gICAgdmFyIHV1aWQgPSBhcmdzWzhdIHx8ICcnO1xyXG5cclxuICAgIHZhciBiYXNlVVVJRCA9IGFyZ3NbOV0gfHwgJyc7XHJcblxyXG4gICAgdmFyIHByb2ZpbGUgPSBfV0ZJbnN0YW5jZS5wcm9maWxlO1xyXG5cclxuXHJcblxyXG4gICAgdmFyIGlucHV0RGF0YSA9IGFyZ3NbMTBdIHx8IHt9O1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICB2YXIgdG9Qcm9jZXNzID0gaW5kaWNhdG9ycy5sZW5ndGg7XHJcblxyXG4gICAgICAgIHZhciBmb3JtQ3JlYXRlRm4gPSBmdW5jdGlvbihpZCwgaW5kaWNhdG9yVHlwZSwgaW5kaWNhdG9ySWQsIHZhbGlkRGF0ZSwgaW5zdGFudGlhdGVTb3VyY2UpIHtcclxuXHJcbiAgICAgICAgICAgIGdhdGVrZWVwZXIuaW5zdGFudGlhdGUoaWQsIGluZGljYXRvclR5cGUsIGluZGljYXRvcklkLCBfV0ZJbnN0YW5jZS5wcm9maWxlLCB2YWxpZERhdGUpLnRoZW4oZnVuY3Rpb24oZG9jQXJyYXkpIHtcclxuICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgaW5kaWNhdG9yIHdvcmtmbG93IHByb2Nlc3NlcyBzZWN0aW9uXHJcblxyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkb2NBcnJheS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBvYmplY3QgPSBkb2NBcnJheVtpXTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIW9iamVjdC5tb2RlbC5faWQuZW5kc1dpdGgoJzphcHByb3ZlZCcpICYmICFvYmplY3QubW9kZWwuX2lkLmVuZHNXaXRoKCc6cmVqZWN0ZWQnKSkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHdvcmtmbG93T2JqID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJpZFwiOiBfV0ZJbnN0YW5jZS5jb25maWcuX2lkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJpbnN0YW5jZVwiOiBfV0ZJbnN0YW5jZS5pbnN0YW5jZS5faWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInByb2Nlc3Nlc1wiOiBbe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiaWRcIjogcHJvY2Vzc0lkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3ViUHJvY2Vzc0lkXCI6IHN1YlByb2Nlc3MuX2lkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3ViUHJvY2Vzc1VVSURcIjogdXVpZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInN0ZXBcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImlkXCI6IHN0ZXAuaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic2VxXCI6IHN0ZXAuc2VxLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInN0YXJ0RGF0ZVwiOiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInN0YXR1c1wiOiBzdGVwLnN0YXR1cyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJtZXNzYWdlXCI6IHN0ZXAubWVzc2FnZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJhc3NpZ25lZFRvXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidXNlcklkXCI6IHN0ZXAuYXNzaWduZWRUby51c2VySWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogc3RlcC5hc3NpZ25lZFRvLm5hbWVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJjb21tZW50XCI6IHN0ZXAuY29tbWVudCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJjb21wbGV0ZVwiOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJlbmREYXRlXCI6IFwiXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWN0aW9uLnNldFdvcmtmbG93TGFiZWxJblRpdGxlICE9IHVuZGVmaW5lZCAmJiBhY3Rpb24uc2V0V29ya2Zsb3dMYWJlbEluVGl0bGUgIT0gJycgJiYgYWN0aW9uLnNldFdvcmtmbG93TGFiZWxJblRpdGxlID09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC5tb2RlbC50aXRsZSA9IGlucHV0RGF0YS5sYWJlbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFjdGlvbi5zZXREcmFmdCAhPSB1bmRlZmluZWQgJiYgYWN0aW9uLnNldERyYWZ0ICE9ICcnICYmIGFjdGlvbi5zZXREcmFmdCA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QubW9kZWwuY29udHJvbC5kcmFmdCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcblxyXG5cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QubW9kZWwud29ya2Zsb3dzLnB1c2god29ya2Zsb3dPYmopO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWFpbklkID0gb2JqZWN0Lm1vZGVsLl9pZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gcGVyc2lzdCB2aWEgZ2sgc28gdGhhdCBpdCBpcyBzYXZlIGluIGNvdWNoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdhdGVrZWVwZXIucGVyc2lzdChkb2NBcnJheSkudGhlbihmdW5jdGlvbihzYXZlZEFycmF5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3VzaW5nIHNhbWUgaWQgY2FsbCBpbml0aWFsaXNlRGF0YVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9jYWxsIGNvZGUgdG8gc2V0IHRvIHNldEluc3RhbmNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYW8uZ2V0KG1haW5JZCkuZG9uZShmdW5jdGlvbihkYXRhKSB7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5kaWNhdG9yTW9kZWwgPSBrby5tYXBwaW5nLmZyb21KUyh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiZGVmYXVsdE1vZGVsXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic2V0SWRcIjogaW5kaWNhdG9ySWRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYXRla2VlcGVyLmluc3RhbnRpYXRlRGF0YShtYWluSWQsIGluc3RhbnRpYXRlU291cmNlLCBpbmRpY2F0b3JNb2RlbCwgZGF0YS5tb2RlbC5wZW5kaW5nLnNlcSkudGhlbihmdW5jdGlvbihkYXRhKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YVswXS5zdGF0dXMgPT0gXCIyMDBcIikge1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWN0aW9uLnNldFdvcmtmbG93TGFiZWxJbkZpZWxkICE9IHVuZGVmaW5lZCAmJiBhY3Rpb24uc2V0V29ya2Zsb3dMYWJlbEluRmllbGQgIT0gJycgJiYgbWFpbklkID09IHByb2ZpbGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhWzBdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGF0aCA9IFwiZGF0YVswXS5tb2RlbC5tb2RlbC5wZW5kaW5nLmRhdGEuXCIgKyBhY3Rpb24uc2V0V29ya2Zsb3dMYWJlbEluRmllbGQgKyBcIj0nXCIgKyBpbnB1dERhdGEubGFiZWwgKyBcIidcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmFsKHBhdGgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhdGVrZWVwZXIucGVyc2lzdChkYXRhKS50aGVuKGZ1bmN0aW9uKHNhdmVkQXJyYXkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYW8uZ2V0KG1haW5JZCkuZG9uZShmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfV0ZJbnN0YW5jZS5pbmRpY2F0b3JzLmxlbmd0aCA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfV0ZJbnN0YW5jZS5pbmRpY2F0b3JzLnB1c2goZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1Byb2Nlc3MtLTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0b1Byb2Nlc3MgPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdGb3JtIGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5LicsIF9XRkluc3RhbmNlLmluZGljYXRvcnMpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZvdW5kID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgX1dGSW5zdGFuY2UuaW5kaWNhdG9ycy5sZW5ndGg7IGluZGV4KyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5kaWNhdG9yID0gX1dGSW5zdGFuY2UuaW5kaWNhdG9yc1tpbmRleF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZGljYXRvci5faWQgPT0gZGF0YS5faWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm91bmQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgdGhlIGN1cnJlbnQgaXRlbSBmcm9tIHRoZSBhcnJheSBhbmQgYWRkIHRoZSB1cGRhdGVkIHByb2Nlc3NNb2RlbFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfV0ZJbnN0YW5jZS5pbmRpY2F0b3JzLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9XRkluc3RhbmNlLmluZGljYXRvcnMucHVzaChkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9Qcm9jZXNzLS07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0b1Byb2Nlc3MgPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ0Zvcm0gY3JlYXRlZCBzdWNjZXNzZnVsbHkuJywgX1dGSW5zdGFuY2UuaW5kaWNhdG9ycyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZvdW5kID09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX1dGSW5zdGFuY2UuaW5kaWNhdG9ycy5wdXNoKGRhdGEpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b1Byb2Nlc3MtLTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodG9Qcm9jZXNzID09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ0Zvcm0gY3JlYXRlZCBzdWNjZXNzZnVsbHkuJywgX1dGSW5zdGFuY2UuaW5kaWNhdG9ycyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmFpbHVyZSA9IHV0aWwuc3VjY2VzcygnMSBHYXRla2VlcGVyIGluaXRpYWxpc2F0aW9uIGZhaWxlZCB3aXRoIGluaXRpYWxpc2VEYXRhIG1lc3NhZ2UgJyArIGVyclswXS5tZXNzYWdlLCB7fSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChmYWlsdXJlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmYWlsdXJlID0gdXRpbC5zdWNjZXNzKCcyIEdhdGVrZWVwZXIgaW5pdGlhbGlzYXRpb24gZmFpbGVkIHdpdGggaW5pdGlhbGlzZURhdGEgbWVzc2FnZSAnICsgZXJyWzBdLm1lc3NhZ2UsIHt9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZmFpbHVyZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcblxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmYWlsdXJlID0gdXRpbC5zdWNjZXNzKCczIEdhdGVrZWVwZXIgaW5pdGlhbGlzYXRpb24gZmFpbGVkIHdpdGggaW5pdGlhbGlzZURhdGEgbWVzc2FnZSAnICsgZXJyWzBdLm1lc3NhZ2UsIHt9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChmYWlsdXJlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmYWlsdXJlID0gdXRpbC5zdWNjZXNzKCc0IEdhdGVrZWVwZXIgaW5pdGlhbGlzYXRpb24gZmFpbGVkIHdpdGggaW5pdGlhbGlzZURhdGEgbWVzc2FnZSAnICsgZXJyWzBdLm1lc3NhZ2UsIHt9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGZhaWx1cmUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZhaWx1cmUgPSB1dGlsLnN1Y2Nlc3MoJzUgR2F0ZWtlZXBlciBpbml0aWFsaXNhdGlvbiBmYWlsZWQgd2l0aCBpbml0aWFsaXNlRGF0YSBtZXNzYWdlICcgKyBlcnJbMF0ubWVzc2FnZSwge30pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChmYWlsdXJlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZhaWx1cmUgPSB1dGlsLnN1Y2Nlc3MoJzYgR2F0ZWtlZXBlciBpbml0aWFsaXNhdGlvbiBmYWlsZWQgd2l0aCBpbml0aWFsaXNlRGF0YSBtZXNzYWdlICcgKyBlcnJbMF0ubWVzc2FnZSwge30pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGZhaWx1cmUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvL3BlcnNpc3QgLSBzYXZlXHJcbiAgICAgICAgICAgICAgICAvL2xvb3Agb24gd29ya2Zsb3cgYXJyYXkgYW5kIGNoZWNrIGZvciA0IGNvbmRpdGlvbnMgYW5kIHNwbGljZSBhbmQgdXBkYXRlXHJcbiAgICAgICAgICAgICAgICAvLyBHb3QgdG8gdGhlIG5leHQgcHJvY2VzcyBpdGVtXHJcblxyXG4gICAgICAgICAgICAgICAgLyp2YXIgd29ya2Zsb3dzID0gZG9jLndvcmtmbG93cztcclxuICAgICAgICAgICAgICAgIHdvcmtmbG93cy5pZCA9IF9XRkluc3RhbmNlLmNvbmZpZy5faWQ7XHJcbiAgICAgICAgICAgICAgICB3b3JrZmxvd3MuaW5zdGFuY2UgPSBfV0ZJbnN0YW5jZS5pbnN0YW5jZS5faWQ7XHJcbiAgICAgICAgICAgICAgICBfV0ZJbnN0YW5jZS5pbmRpY2F0b3JzLnB1c2goZG9jKTtcclxuICAgICAgICAgICAgICAgIGxvb3AubmV4dCgpOyovXHJcblxyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuXHJcblxyXG5cclxuICAgICAgICAgICAgICAgIHZhciB0b0FkZFByb2Nlc3MgPSBbXTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgX1dGSW5zdGFuY2UuaW5zdGFuY2UucHJvY2Vzc2VzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKF9XRkluc3RhbmNlLmluc3RhbmNlLnByb2Nlc3Nlc1tpXS5zdWJQcm9jZXNzZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0b0FkZFByb2Nlc3MucHVzaChfV0ZJbnN0YW5jZS5pbnN0YW5jZS5wcm9jZXNzZXNbaV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIF9XRkluc3RhbmNlLmluc3RhbmNlLnByb2Nlc3NlcyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgX1dGSW5zdGFuY2UuaW5zdGFuY2UucHJvY2Vzc2VzID0gdG9BZGRQcm9jZXNzO1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgdG9BZGRTdWJQcm9jZXNzID0gW107XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IF9XRkluc3RhbmNlLnN1YnByb2Nlc3Nlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChfV0ZJbnN0YW5jZS5zdWJwcm9jZXNzZXNbaV0uaW5kaWNhdG9ycy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvQWRkU3ViUHJvY2Vzcy5wdXNoKF9XRkluc3RhbmNlLnN1YnByb2Nlc3Nlc1tpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgX1dGSW5zdGFuY2Uuc3VicHJvY2Vzc2VzID0gW107XHJcbiAgICAgICAgICAgICAgICBfV0ZJbnN0YW5jZS5zdWJwcm9jZXNzZXMgPSB0b0FkZFN1YlByb2Nlc3M7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcclxuICAgICAgICAgICAgICAgIHZhciBmYWlsdXJlID0gdXRpbC5zdWNjZXNzKCc3IEdhdGVrZWVwZXIgaW5pdGlhbGlzYXRpb24gZmFpbGVkIHdpdGggaW5pdGlhbGlzZURhdGEgbWVzc2FnZSAnICsgZXJyWzBdLm1lc3NhZ2UsIHt9KTtcclxuICAgICAgICAgICAgICAgIHJlamVjdChmYWlsdXJlKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBpbnN0YW50aWF0ZVNvdXJjZSA9ICdmcm9tRGVmaW5pdGlvbic7XHJcbiAgICAgICAgZm9yICh2YXIgY291bnRlciA9IDA7IGNvdW50ZXIgPCBpbmRpY2F0b3JzLmxlbmd0aDsgY291bnRlcisrKSB7XHJcbiAgICAgICAgICAgIHZhciBpbmRpY2F0b3JJZCA9IGluZGljYXRvcnNbY291bnRlcl0uX2lkO1xyXG4gICAgICAgICAgICB2YXIgaW5kaWNhdG9yTmFtZSA9IHV0aWwuZ2V0TmFtZShpbmRpY2F0b3JzW2NvdW50ZXJdLm5hbWUsICdlbicpO1xyXG4gICAgICAgICAgICB2YXIgaW5pdFR5cGUgPSAnJztcclxuICAgICAgICAgICAgaWYgKHN1YlByb2Nlc3MuaW5zdGFuY2VUeXBlLm5ld1NlcXVlbmNlICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgaW5pdFR5cGUgPSAnbmV3U2VxdWVuY2UnO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHN1YlByb2Nlc3MuaW5zdGFuY2VUeXBlLm5ld0luc3RhbmNlICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgaW5pdFR5cGUgPSAnbmV3SW5zdGFuY2UnO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBpZCA9ICcnO1xyXG4gICAgICAgICAgICB2YXIgaW5kaWNhdG9yRG9jID0ge307XHJcblxyXG4gICAgICAgICAgICBpZiAoaW5pdFR5cGUgPT0gJ25ld0luc3RhbmNlJykge1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChiYXNlVVVJRCAhPSB1bmRlZmluZWQgJiYgYmFzZVVVSUQgIT0gJycgJiYgYmFzZVVVSUQubGVuZ3RoID4gMCkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgZXhpc3RpbmdVVUlEID0gSlNPTi54cGF0aChcIi9zdWJwcm9jZXNzZXNbX2lkIGVxICdcIiArIGJhc2VVVUlEICsgXCInXS9pbmRpY2F0b3JzW2lkIGVxICdcIiArIGluZGljYXRvcklkICsgXCInXS9pbnN0YW5jZXNbMV0vdXVpZFwiLCBfV0ZJbnN0YW5jZSwge30pWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgIGlkID0gZXhpc3RpbmdVVUlEO1xyXG4gICAgICAgICAgICAgICAgICAgIGluaXRUeXBlID0gJ25ld1NlcXVlbmNlJztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gdXBkYXRlIHByb2Nlc3NlcyBibG9jayB0byBub3QgZGlzcGxheSB0aGUgb2xkZXIgaW5zdGFuY2UgYmFzZWQgb24gYmFzZVVVSURcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy9UT0RPOiBDaGFuZ2UgcmVxdWlyZWQgdG8gbW92ZSBpc0FjdGl2ZSB0byBzdWJQcm9jZXNzIGZpbGUuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNwID0gSlNPTi54cGF0aChcIi9zdWJwcm9jZXNzZXNbX2lkIGVxICdcIiArIGJhc2VVVUlEICsgXCInXVwiLCBhcHAuU0NPUEUud29ya2Zsb3csIHt9KVswXTtcclxuICAgICAgICAgICAgICAgICAgICBzcC5hY3RpdmUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAvLyBpbnN0YW50aWF0ZSBuZXcgc2VxIHdpdGggcHJldmlvdXMgYXV0aG9yaXNlZCBkYXRhXHJcbiAgICAgICAgICAgICAgICAgICAgaW5zdGFudGlhdGVTb3VyY2UgPSAnZnJvbUF1dGhvcmlzZWQnO1xyXG5cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzdWJQcm9jZXNzLmlzUHJvZmlsZSAhPSB1bmRlZmluZWQgJiYgc3ViUHJvY2Vzcy5pc1Byb2ZpbGUgJiYgKGluZGljYXRvcklkID09IFBST0ZJTEVfU0VUX0lEIHx8IGFwcC5TQ09QRS5BUFBfQ09ORklHLmluZGljYXRvcnMubGVuZ3RoID09IDEpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkID0gcHJvZmlsZTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZCA9IGluZGljYXRvcklkICsgJy0nICsgZ2VuZXJhdGVVVUlEKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHNwTGFzdFV1aWQgPSBKU09OLnhwYXRoKFwiL2luc3RhbmNlL3Byb2Nlc3Nlc1tpZCBlcSAnXCIgKyBwcm9jZXNzSWQgKyBcIicgYW5kIHN1YlByb2Nlc3Nlcy9pZCBlcSAnXCIgKyBzdWJQcm9jZXNzSWQgKyBcIiddWzFdL3N1YlByb2Nlc3Nlcy91dWlkXCIsIF9XRkluc3RhbmNlLCB7fSlbMF07XHJcbiAgICAgICAgICAgICAgICB2YXIgaW5kSWQgPSBKU09OLnhwYXRoKFwiL3N1YnByb2Nlc3Nlc1tfaWQgZXEgJ1wiICsgc3BMYXN0VXVpZCArIFwiJ10vaW5kaWNhdG9yc1tpZCBlcSAnXCIgKyBpbmRpY2F0b3JJZCArIFwiJ10vaW5zdGFuY2VzL3V1aWRcIiwgYXBwLlNDT1BFLndvcmtmbG93LCB7fSlbMF07XHJcbiAgICAgICAgICAgICAgICBpZiAoc3BMYXN0VXVpZCA9PSAnJyB8fCBzcExhc3RVdWlkID09IHVuZGVmaW5lZCB8fCBpbmRJZCA9PSAnJyB8fCBpbmRJZCA9PSB1bmRlZmluZWQpIHtcclxuXHJcblxyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoc3ViUHJvY2Vzcy5pc1Byb2ZpbGUgIT0gdW5kZWZpbmVkICYmIHN1YlByb2Nlc3MuaXNQcm9maWxlICYmIChpbmRpY2F0b3JJZCA9PSBQUk9GSUxFX1NFVF9JRCB8fCBhcHAuU0NPUEUuQVBQX0NPTkZJRy5pbmRpY2F0b3JzLmxlbmd0aCA9PSAxKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZCA9IHByb2ZpbGU7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWQgPSBpbmRpY2F0b3JJZCArICctJyArIGdlbmVyYXRlVVVJRCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZCA9IGluZElkO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChiYXNlVVVJRCAhPSB1bmRlZmluZWQgJiYgYmFzZVVVSUQgIT0gJycgJiYgYmFzZVVVSUQubGVuZ3RoID4gMCkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvL1RPRE86IENoYW5nZSByZXF1aXJlZCB0byBtb3ZlIGlzQWN0aXZlIHRvIHN1YlByb2Nlc3MgZmlsZS5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNwID0gSlNPTi54cGF0aChcIi9zdWJwcm9jZXNzZXNbX2lkIGVxICdcIiArIGJhc2VVVUlEICsgXCInXVwiLCBhcHAuU0NPUEUud29ya2Zsb3csIHt9KVswXTtcclxuICAgICAgICAgICAgICAgICAgICBzcC5hY3RpdmUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICBpbnN0YW50aWF0ZVNvdXJjZSA9ICdmcm9tQXV0aG9yaXNlZCc7XHJcblxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIFRPRE86IFJlcGxhY2Ugd2l0aCB0aGUgZ2F0ZWtlZXBlciBwcm9taXNlIGNhbGwsIHJldHVybiB0aGUgb2JqZWN0LCB1cGRhdGUgdGhlIGluZGljYXRvclxyXG4gICAgICAgICAgICAvLyBkb2N1bWVudCB3b3JrZmxvdyBwcm9jZXNzZXMgZGF0YSBhbmQgdXBkYXRlIHRoZSB3b3JrZmxvdyBjbGFzcyBpbmRpY2F0b3JzIGFycmF5LlxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhpZCk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGluaXRUeXBlKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coaW5kaWNhdG9ySWQpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhpbnN0YW50aWF0ZVNvdXJjZSk7XHJcblxyXG5cclxuICAgICAgICAgICAgZm9ybUNyZWF0ZUZuKGlkLCBpbml0VHlwZSwgaW5kaWNhdG9ySWQsICcnLCBpbnN0YW50aWF0ZVNvdXJjZSk7XHJcblxyXG5cclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAvLyB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnRm9ybSBpbmRpY2F0b3Igc2V0IHNhdmVkIHN1Y2Nlc3NmdWxseS4nLCByZXN1bHQpO1xyXG4gICAgICAgIC8vIHJlc29sdmUoc3VjY2Vzcyk7XHJcbiAgICB9KTtcclxufTtcclxuXHJcbmZ1bmN0aW9uIHNldEluc3RhbmNlVGl0bGUoYXJncykge1xyXG5cclxuICAgIHZhciBfV0ZJbnN0YW5jZSA9IGFyZ3NbMF0gfHwge307XHJcbiAgICB2YXIgdXVpZCA9IGFyZ3NbMl0gfHwgJyc7XHJcbiAgICB2YXIgZGF0YSA9IGFyZ3NbNF0gfHwge307XHJcbiAgICB2YXIgdGl0bGUgPSBkYXRhLmxhYmVsO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuXHJcbiAgICAgICAgdmFyIHN1YlByb2Nlc3NJbnN0YW5jZSA9IEpTT04ueHBhdGgoXCIvc3VicHJvY2Vzc2VzW19pZCBlcSAnXCIgKyB1dWlkICsgXCInXVwiLCBfV0ZJbnN0YW5jZSwge30pWzBdO1xyXG4gICAgICAgIHZhciBpbmRpY2F0b3JJbnN0YW5jZXMgPSBzdWJQcm9jZXNzSW5zdGFuY2UuaW5kaWNhdG9ycztcclxuXHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpbmRpY2F0b3JJbnN0YW5jZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgdmFyIGluZGljYXRvclVVSUQgPSBpbmRpY2F0b3JJbnN0YW5jZXNbaV0uaW5zdGFuY2VzWzBdLnV1aWQ7XHJcbiAgICAgICAgICAgIHZhciBpbmRpY2F0b3JJbnN0YW5jZSA9IEpTT04ueHBhdGgoXCIvaW5kaWNhdG9yc1tfaWQgZXEgJ1wiICsgaW5kaWNhdG9yVVVJRCArIFwiJ11cIiwgX1dGSW5zdGFuY2UsIHt9KVswXTtcclxuICAgICAgICAgICAgaW5kaWNhdG9ySW5zdGFuY2UudGl0bGUgPSBpbmRpY2F0b3JJbnN0YW5jZXNbaV0uaWQgKyAnICcgKyB0aXRsZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXNvbHZlKFwiU2V0IFRpdGxlIFN1Y2Nlc3NcIiwgaW5kaWNhdG9ySW5zdGFuY2VzKTtcclxuXHJcbiAgICB9KTtcclxuXHJcbn07XHJcblxyXG5mdW5jdGlvbiBkZWxldGVQcm9maWxlKGFyZ3MpIHtcclxuXHJcbiAgICB2YXIgX1dGSW5zdGFuY2UgPSBhcmdzWzBdIHx8IHt9O1xyXG4gICAgdmFyIHByb2ZpbGVJZCA9IF9XRkluc3RhbmNlLnByb2ZpbGU7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuICAgICAgICB2YXIgd29ya2VyT2JqZWN0ID0ge1xyXG4gICAgICAgICAgICBcInNvdXJjZVwiOiBcInJlbW90ZVwiLFxyXG4gICAgICAgICAgICBcInR5cGVcIjogXCJ3b3JrZXJPYmplY3RcIixcclxuICAgICAgICAgICAgXCJfaWRcIjogZ2VuZXJhdGVVVUlEKCksXHJcbiAgICAgICAgICAgIFwiY2hhbm5lbHNcIjogW10sXHJcbiAgICAgICAgICAgIFwiY29tbXVuaXR5SWRcIjogYXBwLlNDT1BFLmdldENvbW11bml0eUlkKCksXHJcbiAgICAgICAgICAgIFwiYXBwbGljYXRpb25JZFwiOiBhcHAuU0NPUEUuYXBwbGljYXRpb25JZCxcclxuICAgICAgICAgICAgXCJtZXNzYWdlXCI6IFwiXCIsXHJcbiAgICAgICAgICAgIFwibWVzc2FnZVR5cGVcIjogXCJpbmZvXCIsXHJcbiAgICAgICAgICAgIFwiY3JlYXRlZERhdGVUaW1lXCI6IG1vbWVudCgpLmZvcm1hdCgpLFxyXG4gICAgICAgICAgICBcInNlbmRlclVzZXJJZFwiOiBMT0NBTF9TRVRUSU5HUy5TVUJTQ1JJUFRJT05TLnVzZXJJZCxcclxuICAgICAgICAgICAgXCJub3RpZmljYXRpb25cIjoge1xyXG5cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgXCJwcm9maWxlXCI6IHtcclxuICAgICAgICAgICAgICAgIFwiYWN0aW9uXCI6IFwiZGVsZXRlUHJvZmlsZVwiLFxyXG4gICAgICAgICAgICAgICAgXCJwcm9maWxlSWRcIjogcHJvZmlsZUlkXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc29sZS5sb2cod29ya2VyT2JqZWN0KTtcclxuICAgICAgICBkYW8udXBzZXJ0KHdvcmtlck9iamVjdCkuZG9uZShmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiV29ya2VyIE9iamVjdCBzdWJtaXR0ZWQgZm9yIHByb2ZpbGUoXCIgKyBwcm9maWxlSWQgKyBcIikgZGVsZXRpb24uXCIpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcclxuICAgICAgICAgICAgcmVzb2x2ZShkYXRhKTtcclxuICAgICAgICB9KS5mYWlsKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xyXG4gICAgICAgICAgICByZWplY3QoZGF0YSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG5cclxuICAgIH0pO1xyXG5cclxuXHJcbn07XHJcblxyXG5cclxuZnVuY3Rpb24gY3JlYXRlUHJvZmlsZShhcmdzKSB7XHJcblxyXG5cclxuXHJcbiAgICB2YXIgX1dGSW5zdGFuY2UgPSBhcmdzWzFdIHx8IHt9O1xyXG5cclxuICAgIHZhciBjb21tdW5pdHlJZCA9IF9XRkluc3RhbmNlLmNvbW11bml0eUlkO1xyXG4gICAgdmFyIHByb2ZpbGVJZCA9IF9XRkluc3RhbmNlLnByb2ZpbGU7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuICAgICAgICBsaWJyYXJ5LmNyZWF0ZVByb2ZpbGVEb2N1bWVudHMoY29tbXVuaXR5SWQsIHByb2ZpbGVJZCkuZG9uZShmdW5jdGlvbihkYXRhKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnRm9ybSBjcmVhdGVkIHN1Y2Nlc3NmdWxseS4nLCBkYXRhKTtcclxuICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcclxuXHJcbiAgICAgICAgfSkuZmFpbChmdW5jdGlvbihlcnIpIHtcclxuXHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcclxuICAgICAgICAgICAgdmFyIGZhaWx1cmUgPSB1dGlsLnN1Y2Nlc3MoJ0VSUk9SOiBQcm9maWxlIGNyZWF0aW9uIGZhaWxlZCcgKyBlcnJbMF0ubWVzc2FnZSwge30pO1xyXG4gICAgICAgICAgICByZWplY3QoZmFpbHVyZSk7XHJcblxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIH0pO1xyXG59O1xyXG5cclxuZnVuY3Rpb24gc2V0RHJhZnQoYXJncykge1xyXG5cclxuXHJcblxyXG4gICAgdmFyIF9XRkluc3RhbmNlID0gYXJnc1swXSB8fCB7fTtcclxuICAgIHZhciBjb21tdW5pdHlJZCA9IF9XRkluc3RhbmNlLmNvbW11bml0eUlkO1xyXG4gICAgdmFyIHByb2ZpbGVJZCA9IF9XRkluc3RhbmNlLnByb2ZpbGU7XHJcbiAgICB2YXIgdXVpZCA9IGFyZ3NbMl0gfHwgJyc7XHJcblxyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuXHJcbiAgICAgICAgdmFyIHN1YlByb2Nlc3NJbnN0YW5jZSA9IEpTT04ueHBhdGgoXCIvc3VicHJvY2Vzc2VzW19pZCBlcSAnXCIgKyB1dWlkICsgXCInXVwiLCBfV0ZJbnN0YW5jZSwge30pWzBdO1xyXG4gICAgICAgIHZhciBpbmRpY2F0b3JJbnN0YW5jZXMgPSBzdWJQcm9jZXNzSW5zdGFuY2UuaW5kaWNhdG9ycztcclxuXHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpbmRpY2F0b3JJbnN0YW5jZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgdmFyIGluZGljYXRvclVVSUQgPSBpbmRpY2F0b3JJbnN0YW5jZXNbaV0uaW5zdGFuY2VzWzBdLnV1aWQ7XHJcbiAgICAgICAgICAgIHZhciBpbmRpY2F0b3JJbnN0YW5jZSA9IEpTT04ueHBhdGgoXCIvaW5kaWNhdG9yc1tfaWQgZXEgJ1wiICsgaW5kaWNhdG9yVVVJRCArIFwiJ11cIiwgX1dGSW5zdGFuY2UsIHt9KVswXTtcclxuICAgICAgICAgICAgaW5kaWNhdG9ySW5zdGFuY2UuY29udHJvbC5kcmFmdCA9IHRydWU7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmVzb2x2ZShcIlNldCBEcmFmdCBTdWNjZXNzXCIsIGluZGljYXRvckluc3RhbmNlcyk7XHJcblxyXG4gICAgfSk7XHJcbn07XHJcblxyXG5mdW5jdGlvbiBzZXRVbkRyYWZ0KGFyZ3MpIHtcclxuXHJcbiAgICB2YXIgX1dGSW5zdGFuY2UgPSBhcmdzWzBdIHx8IHt9O1xyXG4gICAgdmFyIGNvbW11bml0eUlkID0gX1dGSW5zdGFuY2UuY29tbXVuaXR5SWQ7XHJcbiAgICB2YXIgcHJvZmlsZUlkID0gX1dGSW5zdGFuY2UucHJvZmlsZTtcclxuICAgIHZhciB1dWlkID0gYXJnc1syXSB8fCAnJztcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcblxyXG4gICAgICAgIHZhciBzdWJQcm9jZXNzSW5zdGFuY2UgPSBKU09OLnhwYXRoKFwiL3N1YnByb2Nlc3Nlc1tfaWQgZXEgJ1wiICsgdXVpZCArIFwiJ11cIiwgX1dGSW5zdGFuY2UsIHt9KVswXTtcclxuICAgICAgICB2YXIgaW5kaWNhdG9ySW5zdGFuY2VzID0gc3ViUHJvY2Vzc0luc3RhbmNlLmluZGljYXRvcnM7XHJcblxyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaW5kaWNhdG9ySW5zdGFuY2VzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHZhciBpbmRpY2F0b3JVVUlEID0gaW5kaWNhdG9ySW5zdGFuY2VzW2ldLmluc3RhbmNlc1swXS51dWlkO1xyXG4gICAgICAgICAgICB2YXIgaW5kaWNhdG9ySW5zdGFuY2UgPSBKU09OLnhwYXRoKFwiL2luZGljYXRvcnNbX2lkIGVxICdcIiArIGluZGljYXRvclVVSUQgKyBcIiddXCIsIF9XRkluc3RhbmNlLCB7fSlbMF07XHJcbiAgICAgICAgICAgIGluZGljYXRvckluc3RhbmNlLmNvbnRyb2wuZHJhZnQgPSBmYWxzZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXNvbHZlKFwiU2V0IERyYWZ0IFN1Y2Nlc3NcIiwgaW5kaWNhdG9ySW5zdGFuY2VzKTtcclxuXHJcbiAgICB9KTtcclxufTtcclxuXHJcblxyXG5cclxuZnVuY3Rpb24gc2F2ZShpbmRpY2F0b3IpIHtcclxuICAgIHZhciBjb21wbGV0ZWQgPSBbXTtcclxuICAgIHZhciByZXN1bHQgPSB7XHJcbiAgICAgICAgY29tcGxldGU6IHRydWUsXHJcbiAgICAgICAgZGF0YTogW11cclxuICAgIH07XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ0Zvcm0gaW5kaWNhdG9yIHNldCBzYXZlZCBzdWNjZXNzZnVsbHkuJywgcmVzdWx0KTtcclxuICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xyXG4gICAgfSk7XHJcbn07XHJcblxyXG5mdW5jdGlvbiBzdWJtaXQoZm9ybSkge1xyXG4gICAgdmFyIGNvbXBsZXRlZCA9IFtdO1xyXG4gICAgdmFyIHJlc3VsdCA9IHtcclxuICAgICAgICBjb21wbGV0ZTogdHJ1ZSxcclxuICAgICAgICBkYXRhOiBbXVxyXG4gICAgfTtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnRm9ybSBzdWJtaXR0ZWQgc3VjY2Vzc2Z1bGx5LicsIHJlc3VsdCk7XHJcbiAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcclxuICAgIH0pO1xyXG59O1xyXG5cclxuZnVuY3Rpb24gYXV0aG9yaXNlKGZvcm0pIHtcclxuICAgIHZhciBjb21wbGV0ZWQgPSBbXTtcclxuICAgIHZhciByZXN1bHQgPSB7XHJcbiAgICAgICAgY29tcGxldGU6IHRydWUsXHJcbiAgICAgICAgZGF0YTogW11cclxuICAgIH07XHJcblxyXG4gICAgdmFyIHByb2Nlc3NJZCA9IGZvcm1bMF0gfHwgJyc7XHJcblxyXG4gICAgdmFyIHN1YlByb2Nlc3MgPSBmb3JtWzFdIHx8IHt9O1xyXG5cclxuICAgIHZhciBzdWJQcm9jZXNzSWQgPSBzdWJQcm9jZXNzLl9pZDtcclxuXHJcbiAgICB2YXIgcHJvY2Vzc1NlcSA9IGZvcm1bMl0gfHwgJyc7XHJcblxyXG4gICAgdmFyIHN1YlByb2Nlc3NTZXEgPSBmb3JtWzNdIHx8ICcnO1xyXG5cclxuICAgIHZhciBfV0ZJbnN0YW5jZSA9IGZvcm1bNF0gfHwge307XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuICAgICAgICB2YXIgc3ViUHJvY2Vzc1VVSUQgPSBKU09OLnhwYXRoKFwiL3Byb2Nlc3Nlc1tpZCBlcSAnXCIgKyBwcm9jZXNzSWQgKyBcIicgYW5kIHNlcSBlcSAnXCIgKyBwcm9jZXNzU2VxICsgXCInXS9zdWJQcm9jZXNzZXNbaWQgZXEgJ1wiICsgc3ViUHJvY2Vzc0lkICsgXCInIGFuZCBzZXEgZXEgJ1wiICsgc3ViUHJvY2Vzc1NlcSArIFwiJ10vdXVpZFwiLCBfV0ZJbnN0YW5jZS5pbnN0YW5jZSwge30pWzBdO1xyXG4gICAgICAgIHZhciBzcEluZGljYXRvcnMgPSBKU09OLnhwYXRoKFwiL3N1YnByb2Nlc3Nlc1tfaWQgZXEgJ1wiICsgc3ViUHJvY2Vzc1VVSUQgKyBcIiddL2luZGljYXRvcnMvaW5zdGFuY2VzL3V1aWRcIiwgX1dGSW5zdGFuY2UsIHt9KTtcclxuICAgICAgICB2YXIgaXRlbXNUb1Byb2Nlc3MgPSBzcEluZGljYXRvcnMubGVuZ3RoO1xyXG4gICAgICAgIHZhciB1cGRhdGVkT2JqZWN0c0FycmF5ID0gW107XHJcblxyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaXRlbXNUb1Byb2Nlc3M7IGkrKykge1xyXG5cclxuXHJcblxyXG4gICAgICAgICAgICBnYXRla2VlcGVyLmF1dGhvcmlzZShzcEluZGljYXRvcnNbaV0pLnRoZW4oZnVuY3Rpb24oYXV0aG9yaXNlZFJldHVybikge1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICBnYXRla2VlcGVyLnBlcnNpc3QoYXV0aG9yaXNlZFJldHVybikudGhlbihmdW5jdGlvbihzYXZlZEFycmF5KSB7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgdXVpZFNhdmVkSW5kaWNhdG9yID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgYyA9IDA7IGMgPCBzYXZlZEFycmF5Lmxlbmd0aDsgYysrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghc2F2ZWRBcnJheVtjXS5pZC5lbmRzV2l0aCgnOmFwcHJvdmVkJykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV1aWRTYXZlZEluZGljYXRvciA9IHNhdmVkQXJyYXlbY10uaWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZGFvLmdldCh1dWlkU2F2ZWRJbmRpY2F0b3IpLmRvbmUoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoX1dGSW5zdGFuY2UuaW5kaWNhdG9ycy5sZW5ndGggPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX1dGSW5zdGFuY2UuaW5kaWNhdG9ycy5wdXNoKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXNUb1Byb2Nlc3MtLTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtc1RvUHJvY2VzcyA9PSAwKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdGb3JtIGF1dGhvcmlzZWQgc3VjY2Vzc2Z1bGx5LicsIHVwZGF0ZWRPYmplY3RzQXJyYXkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZm91bmQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGluZGV4ID0gMDsgaW5kZXggPCBfV0ZJbnN0YW5jZS5pbmRpY2F0b3JzLmxlbmd0aDsgaW5kZXgrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbmRpY2F0b3IgPSBfV0ZJbnN0YW5jZS5pbmRpY2F0b3JzW2luZGV4XTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5kaWNhdG9yLl9pZCA9PSBkYXRhLl9pZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZSB0aGUgY3VycmVudCBpdGVtIGZyb20gdGhlIGFycmF5IGFuZCBhZGQgdGhlIHVwZGF0ZWQgcHJvY2Vzc01vZGVsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9XRkluc3RhbmNlLmluZGljYXRvcnMuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX1dGSW5zdGFuY2UuaW5kaWNhdG9ycy5wdXNoKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtc1RvUHJvY2Vzcy0tO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbXNUb1Byb2Nlc3MgPT0gMCkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdGb3JtIGF1dGhvcmlzZWQgc3VjY2Vzc2Z1bGx5LicsIHVwZGF0ZWRPYmplY3RzQXJyYXkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmb3VuZCA9PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9XRkluc3RhbmNlLmluZGljYXRvcnMucHVzaChkYXRhKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXNUb1Byb2Nlc3MtLTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbXNUb1Byb2Nlc3MgPT0gMCkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ0Zvcm0gYXV0aG9yaXNlZCBzdWNjZXNzZnVsbHkuJywgdXBkYXRlZE9iamVjdHNBcnJheSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pLmZhaWwoZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuXHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBpdGVtc1RvUHJvY2Vzcy0tO1xyXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW1zVG9Qcm9jZXNzID09IDApIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ0Zvcm0gYXV0aG9yaXNlZCBzdWNjZXNzZnVsbHkuJywgdXBkYXRlZE9iamVjdHNBcnJheSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG5cclxuICAgICAgICB9XHJcblxyXG5cclxuICAgIH0pO1xyXG59O1xyXG5cclxuZnVuY3Rpb24gY2xvc2UoZm9ybSkge1xyXG4gICAgdmFyIGNvbXBsZXRlZCA9IFtdO1xyXG4gICAgdmFyIHJlc3VsdCA9IHtcclxuICAgICAgICBjb21wbGV0ZTogdHJ1ZSxcclxuICAgICAgICBkYXRhOiBbXVxyXG4gICAgfTtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnRm9ybSBjbG9zZWQgc3VjY2Vzc2Z1bGx5LicsIHJlc3VsdCk7XHJcbiAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcclxuICAgIH0pO1xyXG59O1xyXG5cclxuXHJcbmZ1bmN0aW9uIHVwZGF0ZUluZGljYXRvcihhcmdzKSB7XHJcblxyXG4gICAgdmFyIF9XRkluc3RhbmNlID0gYXJnc1swXSB8fCB7fTtcclxuICAgIHZhciB1dWlkID0gYXJnc1sxXSB8fCAnJztcclxuICAgIHZhciBwYXRoID0gYXJnc1syXSB8fCAnJztcclxuICAgIHZhciBkYXRhVmFsdWUgPSBhcmdzWzNdIHx8ICcnO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuXHJcbiAgICAgICAgdmFyIHN1YlByb2Nlc3NJbnN0YW5jZSA9IEpTT04ueHBhdGgoXCIvc3VicHJvY2Vzc2VzW19pZCBlcSAnXCIgKyB1dWlkICsgXCInXVwiLCBfV0ZJbnN0YW5jZSwge30pWzBdO1xyXG4gICAgICAgIHZhciBpbmRpY2F0b3JJbnN0YW5jZXMgPSBzdWJQcm9jZXNzSW5zdGFuY2UuaW5kaWNhdG9ycztcclxuXHJcbiAgICAgICAgdmFyIHNldElkID0gcGF0aC5zcGxpdChcIi5cIiwgMSlbMF07XHJcbiAgICAgICAgdmFyIGluZGljYXRvclVVSUQgPSBKU09OLnhwYXRoKFwiLypbaWQgZXEgJ1wiICsgc2V0SWQgKyBcIiddL2luc3RhbmNlcy91dWlkXCIsIGluZGljYXRvckluc3RhbmNlcywge30pWzBdO1xyXG4gICAgICAgIHZhciBpbmRPYmplY3QgPSBKU09OLnhwYXRoKFwiL2luZGljYXRvcnNbX2lkIGVxICdcIiArIGluZGljYXRvclVVSUQgKyBcIiddXCIsIF9XRkluc3RhbmNlLCB7fSlbMF07XHJcbiAgICAgICAgdmFyIGV4cHIgPSAnaW5kT2JqZWN0Lm1vZGVsLnBlbmRpbmcuZGF0YS4nICsgcGF0aCArICcgPSBcIicgKyBkYXRhVmFsdWUgKyAnXCInO1xyXG4gICAgICAgIGV2YWwoZXhwcik7XHJcbiAgICAgICAgdmFyIGl0ZW1zVG9Qcm9jZXNzID0gMTtcclxuICAgICAgICB2YXIgc3R1ZmYgPSBbXTtcclxuICAgICAgICB2YXIgb2JqID0ge307XHJcbiAgICAgICAgb2JqLm1vZGVsID0gaW5kT2JqZWN0O1xyXG4gICAgICAgIHN0dWZmLnB1c2gob2JqKTtcclxuXHJcbiAgICAgICAgLy8tLS0tLS0tLS0tXHJcbiAgICAgICAgZ2F0ZWtlZXBlci5wZXJzaXN0KHN0dWZmKS50aGVuKGZ1bmN0aW9uKHNhdmVkQXJyYXkpIHtcclxuXHJcblxyXG4gICAgICAgICAgICB2YXIgdXVpZFNhdmVkSW5kaWNhdG9yID0gJyc7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGMgPSAwOyBjIDwgc2F2ZWRBcnJheS5sZW5ndGg7IGMrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFzYXZlZEFycmF5W2NdLmlkLmVuZHNXaXRoKCc6YXBwcm92ZWQnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHV1aWRTYXZlZEluZGljYXRvciA9IHNhdmVkQXJyYXlbY10uaWQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZGFvLmdldCh1dWlkU2F2ZWRJbmRpY2F0b3IpXHJcbiAgICAgICAgICAgICAgICAuZG9uZShmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKF9XRkluc3RhbmNlLmluZGljYXRvcnMubGVuZ3RoID09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgX1dGSW5zdGFuY2UuaW5kaWNhdG9ycy5wdXNoKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtc1RvUHJvY2Vzcy0tO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbXNUb1Byb2Nlc3MgPT0gMCkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdJbmRpY2F0b3IgdXBkYXRlZC4nLCBzdHVmZik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZvdW5kID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGluZGV4ID0gMDsgaW5kZXggPCBfV0ZJbnN0YW5jZS5pbmRpY2F0b3JzLmxlbmd0aDsgaW5kZXgrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGluZGljYXRvciA9IF9XRkluc3RhbmNlLmluZGljYXRvcnNbaW5kZXhdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZGljYXRvci5faWQgPT0gZGF0YS5faWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIHRoZSBjdXJyZW50IGl0ZW0gZnJvbSB0aGUgYXJyYXkgYW5kIGFkZCB0aGUgdXBkYXRlZCBwcm9jZXNzTW9kZWxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfV0ZJbnN0YW5jZS5pbmRpY2F0b3JzLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX1dGSW5zdGFuY2UuaW5kaWNhdG9ycy5wdXNoKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zVG9Qcm9jZXNzLS07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW1zVG9Qcm9jZXNzID09IDApIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdJbmRpY2F0b3IgdXBkYXRlZC4nLCBzdHVmZik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmb3VuZCA9PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX1dGSW5zdGFuY2UuaW5kaWNhdG9ycy5wdXNoKGRhdGEpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zVG9Qcm9jZXNzLS07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbXNUb1Byb2Nlc3MgPT0gMCkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnSW5kaWNhdG9yIHVwZGF0ZWQuJywgc3R1ZmYpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgfSwgZnVuY3Rpb24oZXJyb3IpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgfSk7XHJcbn07XHJcblxyXG5cclxuZnVuY3Rpb24gbWFya1VwZGF0ZUluZGljYXRvcihhcmdzKSB7XHJcblxyXG4gICAgdmFyIF9XRkluc3RhbmNlID0gYXJnc1swXSB8fCB7fTtcclxuICAgIHZhciB1dWlkID0gYXJnc1sxXSB8fCAnJztcclxuICAgIHZhciBzdGF0dXMgPSBhcmdzWzJdIHx8ICcnO1xyXG4gICAgdmFyIGluZGljYXRvclNldElkID0gYXJnc1szXSB8fCAnJztcclxuXHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuXHJcbiAgICAgICAgdmFyIGluZE9iamVjdCA9IEpTT04ueHBhdGgoXCIvaW5kaWNhdG9yc1tjYXRlZ29yeS90ZXJtIGVxICdcIiArIGluZGljYXRvclNldElkICsgXCInXVwiLCBfV0ZJbnN0YW5jZSwge30pWzBdO1xyXG4gICAgICAgIGluZE9iamVjdC5tb2RlbC5wZW5kaW5nLnN0YXR1cyA9IHN0YXR1cztcclxuXHJcbiAgICAgICAgdmFyIGl0ZW1zVG9Qcm9jZXNzID0gMTtcclxuICAgICAgICB2YXIgc3R1ZmYgPSBbXTtcclxuICAgICAgICB2YXIgb2JqID0ge307XHJcbiAgICAgICAgb2JqLm1vZGVsID0gaW5kT2JqZWN0O1xyXG4gICAgICAgIHN0dWZmLnB1c2gob2JqKTtcclxuXHJcbiAgICAgICAgLy8tLS0tLS0tLS0tXHJcbiAgICAgICAgZ2F0ZWtlZXBlci5wZXJzaXN0KHN0dWZmKS50aGVuKGZ1bmN0aW9uKHNhdmVkQXJyYXkpIHtcclxuXHJcblxyXG4gICAgICAgICAgICB2YXIgdXVpZFNhdmVkSW5kaWNhdG9yID0gJyc7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGMgPSAwOyBjIDwgc2F2ZWRBcnJheS5sZW5ndGg7IGMrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFzYXZlZEFycmF5W2NdLmlkLmVuZHNXaXRoKCc6YXBwcm92ZWQnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHV1aWRTYXZlZEluZGljYXRvciA9IHNhdmVkQXJyYXlbY10uaWQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZGFvLmdldCh1dWlkU2F2ZWRJbmRpY2F0b3IpXHJcbiAgICAgICAgICAgICAgICAuZG9uZShmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKF9XRkluc3RhbmNlLmluZGljYXRvcnMubGVuZ3RoID09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgX1dGSW5zdGFuY2UuaW5kaWNhdG9ycy5wdXNoKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtc1RvUHJvY2Vzcy0tO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbXNUb1Byb2Nlc3MgPT0gMCkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdJbmRpY2F0b3IgdXBkYXRlZC4nLCBzdHVmZik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZvdW5kID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGluZGV4ID0gMDsgaW5kZXggPCBfV0ZJbnN0YW5jZS5pbmRpY2F0b3JzLmxlbmd0aDsgaW5kZXgrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGluZGljYXRvciA9IF9XRkluc3RhbmNlLmluZGljYXRvcnNbaW5kZXhdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZGljYXRvci5faWQgPT0gZGF0YS5faWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIHRoZSBjdXJyZW50IGl0ZW0gZnJvbSB0aGUgYXJyYXkgYW5kIGFkZCB0aGUgdXBkYXRlZCBwcm9jZXNzTW9kZWxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfV0ZJbnN0YW5jZS5pbmRpY2F0b3JzLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX1dGSW5zdGFuY2UuaW5kaWNhdG9ycy5wdXNoKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zVG9Qcm9jZXNzLS07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW1zVG9Qcm9jZXNzID09IDApIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdJbmRpY2F0b3IgdXBkYXRlZC4nLCBzdHVmZik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmb3VuZCA9PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX1dGSW5zdGFuY2UuaW5kaWNhdG9ycy5wdXNoKGRhdGEpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zVG9Qcm9jZXNzLS07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbXNUb1Byb2Nlc3MgPT0gMCkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnSW5kaWNhdG9yIHVwZGF0ZWQuJywgc3R1ZmYpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgfSwgZnVuY3Rpb24oZXJyb3IpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgfSk7XHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHtcclxuXHJcbiAgICBjcmVhdGU6IGNyZWF0ZSxcclxuICAgIHNhdmU6IHNhdmUsXHJcbiAgICBzdWJtaXQ6IHN1Ym1pdCxcclxuICAgIGF1dGhvcmlzZTogYXV0aG9yaXNlLFxyXG4gICAgY2xvc2U6IGNsb3NlLFxyXG4gICAgc2V0RHJhZnQ6IHNldERyYWZ0LFxyXG4gICAgc2V0VW5EcmFmdDogc2V0VW5EcmFmdCxcclxuICAgIGNyZWF0ZVByb2ZpbGU6IGNyZWF0ZVByb2ZpbGUsXHJcbiAgICBzZXRJbnN0YW5jZVRpdGxlOiBzZXRJbnN0YW5jZVRpdGxlLFxyXG4gICAgZGVsZXRlUHJvZmlsZTogZGVsZXRlUHJvZmlsZSxcclxuICAgIHVwZGF0ZUluZGljYXRvcjogdXBkYXRlSW5kaWNhdG9yLFxyXG4gICAgbWFya1VwZGF0ZUluZGljYXRvcjogbWFya1VwZGF0ZUluZGljYXRvclxyXG5cclxufSIsIid1c2Ugc3RyaWN0JztcclxuXHJcblxyXG5mdW5jdGlvbiBnZXRMYW5ndWFnZU1lc3NhZ2UobWVzc2FnZSkge1xyXG5cclxuICAgIHZhciBsYW5ndWFnZSA9IHNlcnZpY2UuZ2V0TGFuZ3VhZ2UoKTtcclxuICAgIHZhciByZXMgPSBldmFsKFwibWVzc2FnZS5pMThuLlwiICsgbGFuZ3VhZ2UpO1xyXG4gICAgY29uc29sZS5sb2cocmVzKTtcclxuICAgIHJldHVybiByZXM7XHJcblxyXG5cclxufTtcclxuXHJcbmZ1bmN0aW9uIGdldE5vZGVWYWx1ZShkYXRhLCBfV0ZJbnN0YW5jZSwgdXVpZCkge1xyXG5cclxuICAgIGlmIChkYXRhLnZhbHVlICE9IHVuZGVmaW5lZCkge1xyXG5cclxuICAgIH0gZWxzZSBpZiAoZGF0YS5jdXJyZW50SW5kaWNhdG9yICE9IHVuZGVmaW5lZCkge1xyXG5cclxuICAgIH0gZWxzZSBpZiAoZGF0YS5pbmRpY2F0b3IgIT0gdW5kZWZpbmVkKSB7XHJcblxyXG4gICAgICAgIHZhciBpbmRpY2F0b3JVVUlEID0gSlNPTi54cGF0aChcIi9zdWJwcm9jZXNzZXNbX2lkIGVxICdcIisgdXVpZCArXCInXS9pbmRpY2F0b3JzW2lkIGVxICdcIiArIGRhdGEuaW5kaWNhdG9yLmluZGljYXRvclNldElkICsgXCInXS9pbnN0YW5jZXMvdXVpZFwiLCBfV0ZJbnN0YW5jZSwge30pWzBdO1xyXG4gICAgICAgIHZhciBpbmRPYmplY3QgPSBKU09OLnhwYXRoKFwiL2luZGljYXRvcnNbX2lkIGVxICdcIiArIGluZGljYXRvclVVSUQgKyBcIiddXCIsIF9XRkluc3RhbmNlLCB7fSlbMF07XHJcbiAgICAgICAgdmFyIHZhbHVlID0gaW5kT2JqZWN0Lm1vZGVsLnBlbmRpbmcuZGF0YVtkYXRhLmluZGljYXRvci5pbmRpY2F0b3JTZXRJZF1bZGF0YS5pbmRpY2F0b3IuZWxlbWVudElkXTtcclxuICAgICAgICByZXR1cm4gdmFsdWU7XHJcblxyXG4gICAgfSBlbHNlIGlmIChkYXRhLnN5c3RlbSAhPSB1bmRlZmluZWQpIHtcclxuXHJcbiAgICB9IGVsc2UgaWYgKGRhdGEudmFyaWFibGUgIT0gdW5kZWZpbmVkKSB7XHJcblxyXG4gICAgfVxyXG5cclxuXHJcblxyXG5cclxuXHJcbn07XHJcblxyXG5cclxuXHJcbm1vZHVsZS5leHBvcnRzID0ge1xyXG5cclxuICAgIGdldExhbmd1YWdlTWVzc2FnZTogZ2V0TGFuZ3VhZ2VNZXNzYWdlLFxyXG4gICAgZ2V0Tm9kZVZhbHVlOiBnZXROb2RlVmFsdWVcclxuXHJcbn0iLCIndXNlIHN0cmljdCc7XHJcblxyXG52YXIgdXRpbCA9IHJlcXVpcmUoJ3V0aWxpdHknKTtcclxuXHJcbi8qKlxyXG4gKiBVc2VyIEludGVyZmFjZSBNb2R1bGVcclxuICpcclxuICogQG1vZHVsZSBsaWIvdWlcclxuICogQGF1dGhvciBCcmVudCBHb3Jkb25cclxuICogQHZlcnNpb24gMC4xLjBcclxuICogQGRlc2NyaXB0aW9uIHRlc3QgZGVzY3JpcHRpb25cclxuICpcclxuICovXHJcblxyXG4gLyoqXHJcbiAgKiBHZXQgYWxsIHByb2Nlc3Mgc3ViLXByb2Nlc3NlcyB1c2VyIGludGVyZmFjZSBkYXRhXHJcbiAgKlxyXG4gICogQHBhcmFtIHtzdHJpbmd9IHByb2Nlc3NJZCAtIHRoZSBXb3JrZmxvdyBjb25maWcgLyBkZWZpbml0aW9uIHByb2Nlc3MgaWRcclxuICAqIEBwYXJhbSB7c3RyaW5nfSBsYW5nIC0gdGhlIHVzZXIgcHJlZmZlcmVkIGxhbmdhdWdlXHJcbiAgKiBAcGFyYW0ge29iamVjdH0gX1dGSW5zdGFuY2UgLSB0aGUgY3VycmVudCB3b3JrZmxvdyBjb25zdHJ1Y3RvciBpbnN0YW5jZVxyXG4gICpcclxuICAqIEBleGFtcGxlICcnXHJcbiAgKlxyXG4gICogQHJldHVybiAnJ1xyXG4gICpcclxuICAqL1xyXG4gZnVuY3Rpb24gZ2V0UHJvY2Vzcyhwcm9jZXNzSWQsIGxhbmcsIF9XRkluc3RhbmNlKXtcclxuICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICB0cnkge1xyXG4gICAgICB2YXIgcHJvY2Vzc01vZGVsID0gW107XHJcbiAgICAgIHZhciBwcm9jZXNzSW5zdGFuY2UgPSBbXTtcclxuICAgIFx0X1dGSW5zdGFuY2UuaW5zdGFuY2UucHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihwcm9jZXNzSXRlbSl7XHJcbiAgICBcdFx0aWYgKHByb2Nlc3NJdGVtLmlkID09IHByb2Nlc3NJZCkge1xyXG4gICAgXHRcdFx0cHJvY2Vzc0luc3RhbmNlID0gcHJvY2Vzc0l0ZW07XHJcbiAgICBcdFx0fVxyXG4gICAgXHR9KVxyXG4gICAgICAvLyBjb25zb2xlLmxvZyhwcm9jZXNzSW5zdGFuY2Uuc3ViUHJvY2Vzc2VzLmxlbmd0aCk7XHJcbiAgICAgIHV0aWwuc3luY0xvb3AocHJvY2Vzc0luc3RhbmNlLnN1YlByb2Nlc3Nlcy5sZW5ndGgsIGZ1bmN0aW9uKGxvb3Ape1xyXG4gIFx0XHRcdHZhciBjb3VudGVyID0gbG9vcC5pdGVyYXRpb24oKTtcclxuICAgICAgICB2YXIgcHJvY2Vzc1NlcSA9IHByb2Nlc3NJbnN0YW5jZS5zZXE7XHJcbiAgICAgICAgdmFyIHN1YlByb2Nlc3NJZCA9IHByb2Nlc3NJbnN0YW5jZS5zdWJQcm9jZXNzZXNbY291bnRlcl0uaWQ7XHJcbiAgICAgICAgdmFyIHN1YlByb2Nlc3NTZXEgPSBwcm9jZXNzSW5zdGFuY2Uuc3ViUHJvY2Vzc2VzW2NvdW50ZXJdLnNlcTtcclxuICAgICAgICBnZXRTdWJQcm9jZXNzKHByb2Nlc3NJZCwgcHJvY2Vzc1NlcSwgc3ViUHJvY2Vzc0lkLCBzdWJQcm9jZXNzU2VxLCBsYW5nLCBfV0ZJbnN0YW5jZSkudGhlbihmdW5jdGlvbihtb2RlbCl7XHJcbiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhtb2RlbCk7XHJcbiAgICAgICAgICBwcm9jZXNzTW9kZWwucHVzaChtb2RlbCk7XHJcbiAgICAgICAgICBsb29wLm5leHQoKTtcclxuICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHByb2Nlc3NNb2RlbCk7XHJcbiAgXHRcdFx0fSwgZnVuY3Rpb24oZXJyKXtcclxuICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHByb2Nlc3NNb2RlbCk7XHJcbiAgXHRcdFx0XHRsb29wLmJyZWFrKCk7XHJcbiAgXHRcdFx0XHRyZWplY3QoZXJyKTtcclxuICBcdFx0XHR9KTtcclxuICBcdFx0fSwgZnVuY3Rpb24oKXtcclxuICAgICAgICAvLyBjb25zb2xlLmxvZyhwcm9jZXNzTW9kZWwpO1xyXG4gIFx0XHRcdHJlc29sdmUocHJvY2Vzc01vZGVsKTtcclxuICBcdFx0fSk7XHJcbiAgICB9IGNhdGNoKGVycil7XHJcbiAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgfVxyXG4gIH0pXHJcbn07XHJcblxyXG4gLyoqXHJcbiAgKiBHZXQgU3ViUHJvY2VzcyB1c2VyIGludGVyZmFjZSBkYXRhXHJcbiAgKlxyXG4gICogQHBhcmFtIHtzdHJpbmd9IHByb2Nlc3NJZCAtIHRoZSBXb3JrZmxvdyBjb25maWcgLyBkZWZpbml0aW9uIHByb2Nlc3MgaWRcclxuICAqIEBwYXJhbSB7bnVtYmVyfSBwcm9jZXNzU2VxIC0gdGhlIFdvcmtmbG93IGluc3RhbmNlIHByb2Nlc3Mgc2VxXHJcbiAgKiBAcGFyYW0ge3N0cmluZ30gc3ViUHJvY2Vzc0lkIC0gdGhlIFdvcmtmbG93IGNvbmZpZyAvIGRlZmluaXRpb24gc3ViLXByb2Nlc3MgaWRcclxuICAqIEBwYXJhbSB7bnVtYmVyfSBzdWJQcm9jZXNzU2VxIC0gdGhlIFdvcmtmbG93IGluc3RhbmNlIHN1Yi1wcm9jZXNzIHNlcVxyXG4gICogQHBhcmFtIHtvYmplY3R9IF9XRkluc3RhbmNlIC0gdGhlIGN1cnJlbnQgd29ya2Zsb3cgY29uc3RydWN0b3IgaW5zdGFuY2VcclxuICAqXHJcbiAgKiBAZXhhbXBsZSAnJ1xyXG4gICpcclxuICAqIEByZXR1cm4gJydcclxuICAqXHJcbiAgKi9cclxuZnVuY3Rpb24gZ2V0U3ViUHJvY2Vzcyhwcm9jZXNzSWQsIHByb2Nlc3NTZXEsIHN1YlByb2Nlc3NJZCwgc3ViUHJvY2Vzc1NlcSwgbGFuZywgX1dGSW5zdGFuY2Upe1xyXG4gIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIHZhciBtb2RlbCA9IHtcclxuICAgICAgICBpZDogJycsXHJcbiAgICAgICAgc2VxOiAnJyxcclxuICAgICAgICBuYW1lOiAnJyxcclxuICAgICAgICBoZWxwOiAnJyxcclxuICAgICAgICBkYXRlczogJycsXHJcbiAgICAgICAgc3RlcDogJydcclxuICAgICAgfTtcclxuICAgICAgdmFyIHN1YlByb2Nlc3MgPSBbXTtcclxuICAgIFx0dmFyIHN1YlByb2Nlc3NDb25mID0gW107XHJcbiAgICBcdF9XRkluc3RhbmNlLmluc3RhbmNlLnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24ocHJvY2Vzc0l0ZW0pe1xyXG4gICAgXHRcdGlmIChwcm9jZXNzSXRlbS5pZCA9PSBwcm9jZXNzSWQgJiYgcHJvY2Vzc0l0ZW0uc2VxID09IHByb2Nlc3NTZXEpIHtcclxuICAgIFx0XHRcdHZhciBzcExlbmd0aCA9IHByb2Nlc3NJdGVtLnN1YlByb2Nlc3Nlcy5sZW5ndGg7XHJcbiAgICBcdFx0XHRwcm9jZXNzSXRlbS5zdWJQcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKHN1YlByb2Nlc3NJdGVtKXtcclxuICAgIFx0XHRcdFx0aWYgKHN1YlByb2Nlc3NJdGVtLmlkID09IHN1YlByb2Nlc3NJZCAmJiBzdWJQcm9jZXNzSXRlbS5zZXEgPT0gc3ViUHJvY2Vzc1NlcSAmJiBzdWJQcm9jZXNzSXRlbS5jb21wbGV0ZSA9PSBmYWxzZSkge1xyXG4gICAgXHRcdFx0XHRcdHN1YlByb2Nlc3MgPSBzdWJQcm9jZXNzSXRlbTtcclxuICAgIFx0XHRcdFx0fVxyXG4gICAgXHRcdFx0fSlcclxuICAgIFx0XHR9XHJcbiAgICBcdH0pXHJcbiAgICBcdC8vIEdldCB0aGUgY3VycmVudCBzdWJQcm9jZXNzIGNvbmZpZ3VyYXRpb25cclxuICAgIFx0X1dGSW5zdGFuY2UuY29uZmlnLnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24ocHJvY2Vzc0NvbmZpZyl7XHJcbiAgICBcdFx0aWYgKHByb2Nlc3NDb25maWcuX2lkID09IHByb2Nlc3NJZCkge1xyXG4gICAgXHRcdFx0cHJvY2Vzc0NvbmZpZy5zdWJQcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKHN1YlByb2Nlc3NDb25maWcpe1xyXG4gICAgXHRcdFx0XHRpZiAoc3ViUHJvY2Vzc0NvbmZpZy5faWQgPT0gc3ViUHJvY2Vzc0lkKSB7XHJcbiAgICBcdFx0XHRcdFx0c3ViUHJvY2Vzc0NvbmYgPSBzdWJQcm9jZXNzQ29uZmlnO1xyXG4gICAgXHRcdFx0XHR9XHJcbiAgICBcdFx0XHR9KVxyXG4gICAgXHRcdH1cclxuICAgIFx0fSlcclxuICAgICAgLy8gVXBkYXRlIHRoZSBtb2RlbFxyXG4gICAgICBtb2RlbC5pZCA9IHN1YlByb2Nlc3NDb25mLl9pZDtcclxuICAgICAgbW9kZWwuc2VxID0gc3ViUHJvY2Vzcy5zZXE7XHJcbiAgICAgIG1vZGVsLm5hbWUgPSB1dGlsLmdldE5hbWUoc3ViUHJvY2Vzc0NvbmYubmFtZSwgbGFuZyk7XHJcbiAgICAgIG1vZGVsLmhlbHAgPSB1dGlsLmdldE5hbWUoc3ViUHJvY2Vzc0NvbmYuaGVscCwgbGFuZyk7XHJcbiAgICAgIG1vZGVsLmRhdGVzID0gc3ViUHJvY2Vzcy5kYXRlcztcclxuICAgICAgbW9kZWwuc3RlcCA9IHN1YlByb2Nlc3Muc3RlcDtcclxuICAgICAgcmVzb2x2ZShtb2RlbCk7XHJcbiAgICB9IGNhdGNoKGVycikge1xyXG4gICAgICByZWplY3QoZXJyKTtcclxuICAgIH1cclxuICB9KVxyXG59O1xyXG5cclxuXHJcblxyXG5cclxuZnVuY3Rpb24gcHJlcGFyZU5vdGlmaWNhdGlvblNjcmVlbigpe1xyXG5cclxuICBcIlwiXHJcbn07XHJcblxyXG4gbW9kdWxlLmV4cG9ydHMgPSB7XHJcblxyXG4gIGdldFByb2Nlc3M6IGdldFByb2Nlc3NcclxuXHJcbiB9XHJcbiIsIid1c2Ugc3RyaWN0JztcclxuXHJcblxyXG5mdW5jdGlvbiBnZXQoKSB7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuICAgIH0pO1xyXG5cclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0ge1xyXG5cclxuICAgIGdldDogZ2V0XHJcblxyXG59IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxudmFyIHV0aWwgPSByZXF1aXJlKCd1dGlsaXR5Jyk7XHJcbnZhciBhY3Rpb25zTW9kdWxlID0gcmVxdWlyZSgnLi9hY3Rpb25zJyk7XHJcbnZhciBoZWxwZXIgPSByZXF1aXJlKCcuL2hlbHBlcicpO1xyXG52YXIgZm9ybSA9IHJlcXVpcmUoJy4vZm9ybScpO1xyXG5cclxuXHJcbi8qKlxyXG4gKiBQcm9jZXNzIE1vZHVsZVxyXG4gKlxyXG4gKiBAbW9kdWxlIGxpYi9wcm9jZXNzXHJcbiAqIEBhdXRob3IgQnJlbnQgR29yZG9uXHJcbiAqIEB2ZXJzaW9uIDAuMS4wXHJcbiAqIEBkZXNjcmlwdGlvbiB0ZXN0IGRlc2NyaXB0aW9uXHJcbiAqXHJcbiAqL1xyXG5cclxuLyoqXHJcbiAqIENvdW50IGFuIGFycmF5IG9mIGl0ZW1zXHJcbiAqXHJcbiAqIEBwYXJhbSB7QXJyYXl9IGFyciAtIHRoZSBhcnJheSBkYXRhXHJcbiAqXHJcbiAqIEBleGFtcGxlICcnXHJcbiAqXHJcbiAqIEByZXR1cm4gJydcclxuICpcclxuICovXHJcbmZ1bmN0aW9uIGNvdW50KGFycikge1xyXG4gICAgaWYgKGFyciAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgcmV0dXJuIGFyci5sZW5ndGg7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiAwO1xyXG4gICAgfVxyXG5cclxufTtcclxuXHJcbi8qKlxyXG4gKiBQcm9jZXNzIHByZS1yZXF1aXNpdGVzXHJcbiAqXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBwcmVyZXF1aXNpdGVzIC0gdGhlIHByZS1yZXF1aXNpdGVzIGNvbmZpZyBkYXRhXHJcbiAqXHJcbiAqIEBleGFtcGxlICcnXHJcbiAqXHJcbiAqIEByZXR1cm4gJydcclxuICpcclxuICovXHJcbmZ1bmN0aW9uIHByZVJlcXVpc2l0ZXMocHJlcmVxdWlzaXRlcywgX1dGSW5zdGFuY2UpIHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAvLyBVbmNvbW1lbnQgYmVsb3cgc2VjdGlvbiB3aGVuIHJlYWR5IHRvIGltcGxlbWVudFxyXG4gICAgICAgIHZhciBjb21wbGV0ZWQgPSBbXTtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICB1dGlsLnN5bmNMb29wKHByZXJlcXVpc2l0ZXMubGVuZ3RoLCBmdW5jdGlvbihsb29wKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY291bnRlciA9IGxvb3AuaXRlcmF0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICBwcmVSZXF1aXNpdGUocHJlcmVxdWlzaXRlc1tjb3VudGVyXSwgX1dGSW5zdGFuY2UpLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIGFsbCBwcmUtcmVxdWlzaXRlcyBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5LlxyXG4gICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZC5wdXNoKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxvb3AubmV4dCgpO1xyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkLnB1c2goZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxvb3AuYnJlYWsoKTtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIGlmIChjb21wbGV0ZWQuZXZlcnkoQm9vbGVhbikpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnUHJlLXJlcXVpc2l0ZXMgY29tcGxldGVkIHN1Y2Nlc3NmdWxseS4nLCB7fSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yID0gdXRpbC5lcnJvcignV0ZQcmVSZXF1aXNpdGVFcnJvcicsICdOb3QgYWxsIHByZS1yZXF1aXNpdGVzIHBhc3NlZC4nKTtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn07XHJcblxyXG4vKipcclxuICogUHJvY2VzcyBwcmUtcmVxdWlzaXRlLCBleGVjdXRlIHRoZSBwcmUtcmVxdWlzaXRlIGNvbmRpdGlvbi5cclxuICpcclxuICogQHBhcmFtIHtvYmplY3R9IHByZXJlcXVpc2l0ZSAtIHRoZSBwcmUtcmVxdWlzaXRlIGNvbmZpZyBkYXRhXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBfV0ZJbnN0YW5jZSAtIHRoZSB3b3JrZmxvdyBjb25zdHJ1Y3RvciBpbnN0YW5jZVxyXG4gKlxyXG4gKiBAZXhhbXBsZVxyXG4gKiBQcm9jZXNzLnByZVJlcXVpc2l0ZShjb25maWcsIGNvdW50ZXIsIGluc3RhbmNlLCBkb2MpO1xyXG4gKlxyXG4gKiBAcmV0dXJuICcnXHJcbiAqXHJcbiAqL1xyXG5mdW5jdGlvbiBwcmVSZXF1aXNpdGUocHJlcmVxdWlzaXRlLCBfV0ZJbnN0YW5jZSkge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG5cclxuICAgICAgICB2YXIgc3ViamVjdENvdW50ID0gJyc7XHJcblxyXG4gICAgICAgIGlmIChwcmVyZXF1aXNpdGUuY2hlY2subnVtYmVyUHJvY2Vzc0luc3RhbmNlcyAhPSB1bmRlZmluZWQpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciBudW1iZXJQcm9jZXNzSW5zdGFuY2VzID0gcHJlcmVxdWlzaXRlLmNoZWNrLm51bWJlclByb2Nlc3NJbnN0YW5jZXM7XHJcbiAgICAgICAgICAgIHZhciBfZmlsdGVyT3BlcmF0b3IgPSBudW1iZXJQcm9jZXNzSW5zdGFuY2VzLm9wZXJhdG9yO1xyXG4gICAgICAgICAgICB2YXIgeHBhdGhPcGVyYXRvciA9ICcnO1xyXG4gICAgICAgICAgICBzd2l0Y2ggKF9maWx0ZXJPcGVyYXRvcikge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnZ3JlYXRlclRoYW4nOlxyXG4gICAgICAgICAgICAgICAgICAgIHhwYXRoT3BlcmF0b3IgPSAnZ3QnO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnbGVzc1RoYW4nOlxyXG4gICAgICAgICAgICAgICAgICAgIHhwYXRoT3BlcmF0b3IgPSAnbHQnO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnZ3JlYXRlclRoYW5FcXVhbCc6XHJcbiAgICAgICAgICAgICAgICAgICAgeHBhdGhPcGVyYXRvciA9ICdnZSc7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdsZXNzVGhhbkVxdWFsJzpcclxuICAgICAgICAgICAgICAgICAgICB4cGF0aE9wZXJhdG9yID0gJ2xlJztcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ2VxdWFsVG8nOlxyXG4gICAgICAgICAgICAgICAgICAgIHhwYXRoT3BlcmF0b3IgPSAnZXEnO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnbm90RXF1YWxUbyc6XHJcbiAgICAgICAgICAgICAgICAgICAgeHBhdGhPcGVyYXRvciA9ICduZSc7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIF9zdWJwcm9jZXNzSWQgPSBudW1iZXJQcm9jZXNzSW5zdGFuY2VzLnN1YlByb2Nlc3NJZDtcclxuICAgICAgICAgICAgdmFyIF9maWx0ZXJFbGVtZW50ID0gXCJzdGVwL3N0YXR1c1wiO1xyXG4gICAgICAgICAgICB2YXIgX2ZpbHRlclZhbHVlID0gbnVtYmVyUHJvY2Vzc0luc3RhbmNlcy50eXBlO1xyXG4gICAgICAgICAgICB2YXIgaW5uZXJYcGF0aCA9IFwiL1wiICsgX2ZpbHRlckVsZW1lbnQgKyBcIlsuIGVxICdcIiArIF9maWx0ZXJWYWx1ZSArIFwiJ11cIjtcclxuICAgICAgICAgICAgdmFyIGZ1bGxQYXRoID0gXCJjb3VudCgvc3VicHJvY2Vzc2VzW2lkIGVxICdcIiArIF9zdWJwcm9jZXNzSWQgKyBcIiddXCIgKyBpbm5lclhwYXRoICsgXCIpXCI7XHJcbiAgICAgICAgICAgIHN1YmplY3RDb3VudCA9IEpTT04ueHBhdGgoZnVsbFBhdGgsIF9XRkluc3RhbmNlLCB7fSlbMF07XHJcblxyXG5cclxuICAgICAgICB9IGVsc2UgaWYgKHByZXJlcXVpc2l0ZS5jaGVjay52YXJpYWJsZUNvbmZpcm0gIT0gdW5kZWZpbmVkKSB7XHJcblxyXG5cclxuICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgICAgdmFyIGVycm9yID0gdXRpbC5lcnJvcignV0ZQcmVSZXF1aXNpdGVFcnJvcicsICdQcmUtcmVxdWlzaXRlIHR5cGUgbm90IGRlZmluZWQuJyk7XHJcbiAgICAgICAgICAgIHJlamVjdChlcnJvcik7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIGNvbXBhcmUgPSAnJztcclxuXHJcbiAgICAgICAgaWYgKHByZXJlcXVpc2l0ZS5jaGVjay5udW1iZXJQcm9jZXNzSW5zdGFuY2VzKSB7XHJcbiAgICAgICAgICAgIGNvbXBhcmUgPSB1dGlsLmNvbXBhcmUoc3ViamVjdENvdW50LCBwcmVyZXF1aXNpdGUuY2hlY2subnVtYmVyUHJvY2Vzc0luc3RhbmNlcy5vcGVyYXRvciwgcGFyc2VJbnQocHJlcmVxdWlzaXRlLmNoZWNrLm51bWJlclByb2Nlc3NJbnN0YW5jZXMuY291bnQpKTtcclxuICAgICAgICB9IGVsc2UgaWYgKHByZXJlcXVpc2l0ZS5jaGVjay52YXJpYWJsZUNvbmZpcm0pIHtcclxuXHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGNvbXBhcmUpIHtcclxuICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ1ByZS1yZXF1aXNpdGVzIHBhc3NlZC4nLCB7fSk7XHJcbiAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuXHJcbiAgICAgICAgICAgIHZhciBtZXNzYWdlID0gaGVscGVyLmdldExhbmd1YWdlTWVzc2FnZShwcmVyZXF1aXNpdGUubWVzc2FnZSk7XHJcbiAgICAgICAgICAgIHZhciBlcnJvciA9IHV0aWwuZXJyb3IoJ1dGUHJlUmVxdWlzaXRlRXJyb3InLCBtZXNzYWdlKTtcclxuICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfSk7XHJcbn07XHJcblxyXG4vKipcclxuICogUHJvY2VzcyBwcmUtYWN0aW9uc3NcclxuICpcclxuICogQHBhcmFtIHtvYmplY3R9IHByZUFjdGlvbnMgLSB0aGUgcHJlLWFjdGlvbnMgY29uZmlnIGRhdGFcclxuICogQHBhcmFtIHtvYmplY3R9IF9XRkluc3RhbmNlIC0gdGhlIGN1cnJlbnQgd29ya2Zsb3cgY29uc3RydWN0b3IgaW5zdGFuY2VcclxuICpcclxuICogQGV4YW1wbGUgJydcclxuICpcclxuICogQHJldHVybiAnJ1xyXG4gKlxyXG4gKi9cclxuZnVuY3Rpb24gcHJlQWN0aW9ucyhwcmVBY3Rpb25zLCBfV0ZJbnN0YW5jZSkge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIHZhciBjb21wbGV0ZWQgPSBbXTtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICB1dGlsLnN5bmNMb29wKHByZUFjdGlvbnMubGVuZ3RoLCBmdW5jdGlvbihsb29wKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY291bnRlciA9IGxvb3AuaXRlcmF0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICBhY3Rpb24ocHJlQWN0aW9uc1tjb3VudGVyXSwgX1dGSW5zdGFuY2UpLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIGFsbCBwcmUtcmVxdWlzaXRlcyBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5LlxyXG4gICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZC5wdXNoKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxvb3AubmV4dCgpO1xyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkLnB1c2goZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxvb3AuYnJlYWsoKTtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIGlmIChjb21wbGV0ZWQuZXZlcnkoQm9vbGVhbikpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnUHJlLWFjdGlvbnMgY29tcGxldGVkIHN1Y2Nlc3NmdWxseS4nLCB7fSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yID0gdXRpbC5lcnJvcignV0ZQcmVSZXF1aXNpdGVFcnJvcicsICdOb3QgYWxsIHByZS1hY3Rpb25zIHBhc3NlZC4nKTtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn07XHJcblxyXG4vKipcclxuICogV29ya2Zsb3cgZ2V0IHN1Yi1wcm9jZXNzIGRhdGEuXHJcbiAqXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBpZCAtIHRoZSBzdWJQcm9jZXNzIGNvbmZpZyBpZFxyXG4gKiBAcGFyYW0ge29iamVjdH0gX1dGSW5zdGFuY2UgLSB0aGUgY3VycmVudCB3b3JrZmxvdyBjb25zdHJ1Y3RvciBpbnN0YW5jZVxyXG4gKlxyXG4gKiBAZXhhbXBsZSBcIlwiXHJcbiAqXHJcbiAqIEByZXR1cm4gXCJcIlxyXG4gKlxyXG4gKi9cclxuZnVuY3Rpb24gZ2V0U3ViUHJvY2VzcyhpZCwgX1dGSW5zdGFuY2UpIHtcclxuICAgIGlmIChfV0ZJbnN0YW5jZS5zdWJwcm9jZXNzZXMgPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgcmV0dXJuIFtdO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBfV0ZJbnN0YW5jZS5zdWJwcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKHN1YlByb2Nlc3MpIHtcclxuICAgICAgICAgICAgaWYgKHN1YlByb2Nlc3MuaWQgPT0gaWQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBzdWJQcm9jZXNzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG59O1xyXG5cclxuLyoqXHJcbiAqIFByb2Nlc3Mgc3ViLXByb2Nlc3NcclxuICpcclxuICogQHBhcmFtIHtvYmplY3R9IHByb2Nlc3MgLSB0aGUgY3VycmVudCBwcm9jZXNzIGlkIGFuZCBzZXFcclxuICogQHBhcmFtIHtvYmplY3R9IHN1YlByb2Nlc3MgLSB0aGUgc3ViLXByb2Nlc3MgaWQgYW5kIHNlcVxyXG4gKiBAcGFyYW0ge29iamVjdH0gZGF0YSAtIHRoZSB1c2VyIGlucHV0IGRhdGFcclxuICogQHBhcmFtIHtvYmplY3R9IF9XRkluc3RhbmNlIC0gdGhlIGN1cnJlbnQgd29ya2Zsb3cgY29uc3RydWN0b3IgaW5zdGFuY2VcclxuICpcclxuICogQGV4YW1wbGUgJydcclxuICpcclxuICogQHJldHVybiAnJ1xyXG4gKlxyXG4gKi9cclxuZnVuY3Rpb24gc3ViUHJvY2Vzcyhwcm9jZXNzSWQsIHByb2Nlc3NTZXEsIHN1YlByb2Nlc3NJZCwgc3ViUHJvY2Vzc1NlcSwgZGF0YSwgX1dGSW5zdGFuY2UpIHtcclxuICAgIC8vIEdldCB0aGUgY3VycmVudCBwcm9jZXNzIHN1YlByb2Nlc3MgaW5zdGFuY2VcclxuICAgIC8vIHZhciBzdWJQcm9jZXNzU2VxID0gMTtcclxuICAgIHZhciBzdWJQcm9jZXNzID0gW107XHJcbiAgICB2YXIgcHJvY2Vzc0NvbmYgPSBbXTtcclxuICAgIHZhciBzdWJQcm9jZXNzQ29uZiA9IFtdO1xyXG4gICAgX1dGSW5zdGFuY2UuaW5zdGFuY2UucHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihvYmpQcm9jZXNzKSB7XHJcbiAgICAgICAgICAgIGlmIChvYmpQcm9jZXNzLmlkID09IHByb2Nlc3NJZCAmJiBvYmpQcm9jZXNzLnNlcSA9PSBwcm9jZXNzU2VxKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc3BMZW5ndGggPSBvYmpQcm9jZXNzLnN1YlByb2Nlc3Nlcy5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICBvYmpQcm9jZXNzLnN1YlByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24ob2JqU3ViUHJvY2Vzcykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmpTdWJQcm9jZXNzLmlkID09IHN1YlByb2Nlc3NJZCAmJiBvYmpTdWJQcm9jZXNzLnNlcSA9PSBzdWJQcm9jZXNzU2VxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1dWlkID0gb2JqU3ViUHJvY2Vzcy51dWlkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfV0ZJbnN0YW5jZS5zdWJwcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKHN1YlByb2Nlc3NJdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3ViUHJvY2Vzc0l0ZW0uX2lkID09IHV1aWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJQcm9jZXNzID0gc3ViUHJvY2Vzc0l0ZW07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLy8gR2V0IHRoZSBjdXJyZW50IHN1YlByb2Nlc3MgY29uZmlndXJhdGlvblxyXG4gICAgX1dGSW5zdGFuY2UuY29uZmlnLnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24ocHJvY2Vzc0NvbmZpZykge1xyXG4gICAgICAgICAgICBpZiAocHJvY2Vzc0NvbmZpZy5faWQgPT0gcHJvY2Vzc0lkKSB7XHJcbiAgICAgICAgICAgICAgICBwcm9jZXNzQ29uZiA9IHByb2Nlc3NDb25maWc7XHJcbiAgICAgICAgICAgICAgICBwcm9jZXNzQ29uZmlnLnN1YlByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24oc3ViUHJvY2Vzc0NvbmZpZykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzdWJQcm9jZXNzQ29uZmlnLl9pZCA9PSBzdWJQcm9jZXNzSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3ViUHJvY2Vzc0NvbmYgPSBzdWJQcm9jZXNzQ29uZmlnO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICAgIC8vIGlmIChzdWJQcm9jZXNzLmxlbmd0aCAhPT0gMCkge1xyXG4gICAgICAgIC8vIFx0c3ViUHJvY2Vzc1NlcSA9IHN1YlByb2Nlc3MubGVuZ3RoICsgMTtcclxuICAgICAgICAvLyB9XHJcbiAgICAgICAgLy8gVGhlIGRlZmF1bHQgc3ViUHJvY2VzcyBtb2RlbFxyXG5cclxuICAgIC8vVE9ETzogQ2hhbmdlIHJlcXVpcmVkIHRvIG1vdmUgaXNBY3RpdmUgdG8gc3ViUHJvY2VzcyBmaWxlLkhlcmVcclxuXHJcbiAgICB2YXIgZ3JvdXBLZXkgPSAnJztcclxuICAgIHZhciBiYXNlVVVJRCA9IGRhdGEuYmFzZVVVSUQ7XHJcbiAgICBpZiAoYmFzZVVVSUQgIT0gdW5kZWZpbmVkICYmIGJhc2VVVUlEICE9ICcnICYmIGJhc2VVVUlELmxlbmd0aCA+IDApIHtcclxuICAgICAgICB2YXIgcHJldmlvdXNPYmplY3QgPSBKU09OLnhwYXRoKFwiL3N1YnByb2Nlc3Nlc1tfaWQgZXEgJ1wiICsgYmFzZVVVSUQgKyBcIiddXCIsIF9XRkluc3RhbmNlLCB7fSlbMF07XHJcbiAgICAgICAgZ3JvdXBLZXkgPSBwcmV2aW91c09iamVjdC5ncm91cEtleTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgZ3JvdXBLZXkgPSBnZW5lcmF0ZVVVSUQoKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgdmFyIHN1YlByb2Nlc3NPYmplY3RJZCA9IF9XRkluc3RhbmNlLnByb2ZpbGUgKyAnOicgKyBfV0ZJbnN0YW5jZS5hcHAgKyAnOicgKyBwcm9jZXNzSWQgKyAnOicgKyBwcm9jZXNzU2VxICsgJzonICsgc3ViUHJvY2Vzc0lkICsgJzonICsgc3ViUHJvY2Vzc1NlcTtcclxuICAgIHZhciBtb2RlbCA9IHtcclxuICAgICAgICBfaWQ6IHN1YlByb2Nlc3NPYmplY3RJZCxcclxuICAgICAgICBpZDogc3ViUHJvY2Vzc0lkLFxyXG4gICAgICAgIHR5cGU6ICd3b3JrZmxvd0luc3RhbmNlU3ViUHJvY2VzcycsXHJcbiAgICAgICAgc2VxOiBzdWJQcm9jZXNzU2VxLFxyXG4gICAgICAgIGluaXRpYXRlZDogZmFsc2UsXHJcbiAgICAgICAgZGF0ZXM6IHtcclxuICAgICAgICAgICAgY3JlYXRlZDogJycsXHJcbiAgICAgICAgICAgIHZhbGlkOiAnJyxcclxuICAgICAgICAgICAgZHVlOiAnJyxcclxuICAgICAgICAgICAgY2xvc2VkOiAnJ1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgY29tcGxldGU6IGZhbHNlLFxyXG4gICAgICAgIGluZGljYXRvcnM6IFtdLFxyXG4gICAgICAgIHN0ZXA6IHt9LFxyXG4gICAgICAgIGFjdGl2ZTogdHJ1ZSxcclxuICAgICAgICBncm91cEtleTogZ3JvdXBLZXksXHJcbiAgICAgICAgY2hhbm5lbHM6IFtcclxuICAgICAgICAgICAgXCJjb21tdW5pdHlfXCIgKyBhcHAuU0NPUEUuZ2V0Q29tbXVuaXR5SWQoKSxcclxuICAgICAgICAgICAgXCJwcm9maWxlX1wiICsgYXBwLlNDT1BFLnByb2ZpbGVJZCxcclxuICAgICAgICAgICAgXCJhcHBsaWNhdGlvbl9cIiArIGFwcC5TQ09QRS5hcHBsaWNhdGlvbklkLFxyXG4gICAgICAgICAgICBcImNvbW11bml0eV9cIiArIGFwcC5TQ09QRS5nZXRDb21tdW5pdHlJZCgpICsgXCJfYXBwbGljYXRpb25fXCIgKyBhcHAuU0NPUEUuYXBwbGljYXRpb25JZFxyXG4gICAgICAgIF1cclxuICAgIH07XHJcbiAgICBfV0ZJbnN0YW5jZS5zdWJwcm9jZXNzZXMucHVzaChtb2RlbCk7XHJcbiAgICAvLyBSZXR1cm4gYSBwcm9taXNlXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgLy8gQ2F0Y2ggYWxsIHVuY2F1Z2h0IGVycm9yc1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIC8vIDEuIFByb2Nlc3MgdGhlIHByZS1hY3Rpb25zXHJcbiAgICAgICAgICAgIHZhciBwcmVBY3Rpb25zQ29uZiA9IHByb2Nlc3NDb25mLnByZUFjdGlvbnM7XHJcbiAgICAgICAgICAgIHByZUFjdGlvbnMocHJlQWN0aW9uc0NvbmYsIF9XRkluc3RhbmNlKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgLy8gMi4gUHJvY2VzcyB0aGUgcHJlLXJlcXVpc2l0ZXNcclxuICAgICAgICAgICAgICAgIHZhciBwcmVyZXF1aXNpdGVDb25mID0gcHJvY2Vzc0NvbmYucHJlcmVxdWlzaXRlcztcclxuICAgICAgICAgICAgICAgIHByZVJlcXVpc2l0ZXMocHJlcmVxdWlzaXRlQ29uZiwgX1dGSW5zdGFuY2UpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gMy4gSW5pdGlhdGUgdGhlIHN1YlByb2Nlc3NcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaW5pdGlhdGVDb25mID0gc3ViUHJvY2Vzc0NvbmYuaW5pdGlhdGU7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5pdGlhdGUoaW5pdGlhdGVDb25mLCBzdWJQcm9jZXNzLCBkYXRhKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL1VwZGF0ZSB0aGUgc3ViUHJvY2VzcyBtb2RlbFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtb2RlbC5pbml0aWF0ZWQgPSByZXN1bHQuZGF0YS5pbml0aWF0ZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsLmRhdGVzID0gcmVzdWx0LmRhdGEuZGF0ZXM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEV4ZWN1dGUgdGhlIGZpcnN0IHN0ZXBcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN0ZXBJZCA9IHN1YlByb2Nlc3NDb25mLnN0ZXBzWzBdLl9pZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRyYW5zaXRpb25JZCA9IHN1YlByb2Nlc3NDb25mLnN0ZXBzWzBdLnRyYW5zaXRpb25bMF0uX2lkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3RlcFNlcSA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0ZXAocHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIHN0ZXBJZCwgc3RlcFNlcSwgZGF0YSwgX1dGSW5zdGFuY2UpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlbC5zdGVwID0gcmVzdWx0LmRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSBpbmRpY2F0b3Igc2VjdGlvbnMgb2YgdGhlIHN1YlByb2Nlc3NcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kaWNhdG9ycyhzdWJQcm9jZXNzQ29uZi5pbmRpY2F0b3JzLCBfV0ZJbnN0YW5jZSwgbW9kZWwuX2lkKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWwuaW5kaWNhdG9ycyA9IHJlc3VsdC5kYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBFeGVjdXRlIHRoZSB0cmFuc2l0aW9ucywgaWYgYXV0b1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2l0aW9uKHByb2Nlc3NJZCwgcHJvY2Vzc1NlcSwgc3ViUHJvY2Vzc0lkLCBzdWJQcm9jZXNzU2VxLCBzdGVwSWQsIHRyYW5zaXRpb25JZCwgZGF0YSwgX1dGSW5zdGFuY2UpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgdGhlIHN1YlByb2Nlc3Mgc3RlcCBkYXRhXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdHJhbnNSZXN1bHQgPSByZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlbC5zdGVwID0gcmVzdWx0LmRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyA0LiBQcm9jZXNzIHRoZSBwb3N0LWFjdGlvbnNcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwb3N0QWN0aW9uc0NvbmYgPSBwcm9jZXNzQ29uZi5wb3N0QWN0aW9ucztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3RBY3Rpb25zKHBvc3RBY3Rpb25zQ29uZiwgX1dGSW5zdGFuY2UpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3ModHJhbnNSZXN1bHQubWVzc2FnZSwgbW9kZWwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfV0ZJbnN0YW5jZS5zdWJwcm9jZXNzZXMgPSBfV0ZJbnN0YW5jZS5zdWJwcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKG9iaikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICEob2JqLl9pZCA9PSBzdWJQcm9jZXNzT2JqZWN0SWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIF9XRkluc3RhbmNlLnN1YnByb2Nlc3NlcyA9IF9XRkluc3RhbmNlLnN1YnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24ob2JqKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhKG9iai5faWQgPT0gc3ViUHJvY2Vzc09iamVjdElkKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgX1dGSW5zdGFuY2Uuc3VicHJvY2Vzc2VzID0gX1dGSW5zdGFuY2Uuc3VicHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihvYmopIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gIShvYmouX2lkID09IHN1YlByb2Nlc3NPYmplY3RJZCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBQcm9jZXNzIGluaXRpYXRlXHJcbiAqXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBpbml0aWF0ZSAtIHRoZSBpbml0aWF0ZSBjb25maWcgZGF0YVxyXG4gKiBAcGFyYW0ge29iamVjdH0gZGF0YSAtIHRoZSB1c2VyIGlucHV0IGRhdGFcclxuICpcclxuICogQGV4YW1wbGUgJydcclxuICpcclxuICogQHJldHVybiAnJ1xyXG4gKlxyXG4gKi9cclxuZnVuY3Rpb24gaW5pdGlhdGUoaW5pdGlhdGUsIHN1YlByb2Nlc3MsIGRhdGEpIHtcclxuICAgIHZhciBjb21wbGV0ZWQgPSBbXTtcclxuICAgIHZhciByZXN1bHQgPSB7XHJcbiAgICAgICAgaW5pdGlhdGVkOiBmYWxzZSxcclxuICAgICAgICBkYXRlczoge1xyXG4gICAgICAgICAgICBjcmVhdGVkOiAnJyxcclxuICAgICAgICAgICAgdmFsaWQ6ICcnLFxyXG4gICAgICAgICAgICBkdWU6ICcnLFxyXG4gICAgICAgICAgICBjbG9zZWQ6ICcnXHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgdmFyIGluaXQgPSBmdW5jdGlvbigpIHtcclxuXHJcbiAgICAgICAgICAgIGlmIChpbml0aWF0ZS51c2VyICE9IHVuZGVmaW5lZCkge1xyXG5cclxuICAgICAgICAgICAgICAgIHJlc3VsdC5kYXRlcy5jcmVhdGVkID0gZGF0YS5jcmVhdGVkRGF0ZTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoaW5pdGlhdGUudXNlci52YWxpZERhdGUuX3R5cGUgPT0gJ3VzZXJTZWxlY3RlZCcgfHwgaW5pdGlhdGUudXNlci52YWxpZERhdGUuX3R5cGUgPT0gJ2F1dG9TZWxlY3RlZCcpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS52YWxpZERhdGUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuZGF0ZXMudmFsaWQgPSBkYXRhLnZhbGlkRGF0ZTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB1dGlsLndhcm4oJ1dGSW5pdGlhdGVFcnJvcicsICdObyB2YWxpZCBkYXRlIHBhc3NlZCBpbiAtIHtkYXRhLnZhbGlkRGF0ZX0nKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoaW5pdGlhdGUudXNlci5kdWVEYXRlLl90eXBlID09ICd1c2VyU2VsZWN0ZWQnIHx8IGluaXRpYXRlLnVzZXIuZHVlRGF0ZS5fdHlwZSA9PSAnYXV0b1NlbGVjdGVkJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLmR1ZURhdGUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuZGF0ZXMuZHVlID0gZGF0YS5kdWVEYXRlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHV0aWwud2FybignV0ZJbml0aWF0ZUVycm9yJywgJ05vIGR1ZSBkYXRlIHBhc3NlZCBpbiAtIHtkYXRhLmR1ZURhdGV9Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmVzdWx0LmluaXRpYXRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnU3ViLVByb2Nlc3MgaW5pdGlhdGUgY29tcGxldGVkIHN1Y2Nlc3NmdWxseS4nLCByZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcclxuXHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaW5pdGlhdGUuYXV0byAhPSB1bmRlZmluZWQpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAvKlxyXG4gICAgICAgICAgICAgICAgcmVzdWx0LmRhdGVzLmNyZWF0ZWQgPSBkYXRhLmNyZWF0ZWREYXRlO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChpbml0aWF0ZS5kYXRlcy52YWxpZC5fdHlwZSA9PSAndXNlclNlbGVjdGVkJyB8fCBpbml0aWF0ZS5kYXRlcy52YWxpZC5fdHlwZSA9PSAnYXV0b1NlbGVjdGVkJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLnZhbGlkRGF0ZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5kYXRlcy52YWxpZCA9IGRhdGEudmFsaWREYXRlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHV0aWwud2FybignV0ZJbml0aWF0ZUVycm9yJywgJ05vIHZhbGlkIGRhdGUgcGFzc2VkIGluIC0ge2RhdGEudmFsaWREYXRlfScpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChpbml0aWF0ZS5kYXRlcy5kdWUuX3R5cGUgPT0gJ3VzZXJTZWxlY3RlZCcgfHwgaW5pdGlhdGUuZGF0ZXMuZHVlLl90eXBlID09ICdhdXRvU2VsZWN0ZWQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuZHVlRGF0ZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5kYXRlcy5kdWUgPSBkYXRhLmR1ZURhdGU7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXRpbC53YXJuKCdXRkluaXRpYXRlRXJyb3InLCAnTm8gZHVlIGRhdGUgcGFzc2VkIGluIC0ge2RhdGEuZHVlRGF0ZX0nKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXN1bHQuaW5pdGlhdGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdTdWItUHJvY2VzcyBpbml0aWF0ZSBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5LicsIHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpOyovXHJcblxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBlcnJvciA9IHV0aWwuZXJyb3IoJ1dGSW5pdGlhdGVFcnJvcicsICdJbml0aWF0ZSB0eXBlOiAnICsgaW5pdGlhdGUuX3R5cGUgKyAnIG5vdCBkZWZpbmVkLicpO1xyXG4gICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcclxuXHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHN1YlByb2Nlc3MuY29tcGxldGUgPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIGluaXQoKTtcclxuICAgICAgICB9IGVsc2UgaWYgKCFzdWJQcm9jZXNzLmNvbXBsZXRlKSB7XHJcbiAgICAgICAgICAgIGlmIChpbml0aWF0ZS5wYXJhbGxlbEluc3RhbmNlcykge1xyXG4gICAgICAgICAgICAgICAgaW5pdCgpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdmFyIGVycm9yID0gdXRpbC5lcnJvcignV0ZJbml0aWF0ZUVycm9yJywgJ1N1Yi1wcm9jZXNzOiAnICsgc3ViUHJvY2Vzcy5pZCArICcgc3RpbGwgYWN0aXZlIGFuZCBwYXJhbGxlbCBpbnN0YW5jZXMgYXJlIG5vdCBhbGxvd2VkLicpO1xyXG4gICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICB9KTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBQcm9jZXNzIHN0ZXBcclxuICpcclxuICogQHBhcmFtIHtzdHJpbmd9IHByb2Nlc3NJZCAtIHRoZSBjdXJyZW50IHByb2Nlc3MgaWRcclxuICogQHBhcmFtIHtzdHJpbmd9IHN1YlByb2Nlc3NJZCAtIHRoZSBjdXJyZW50IHN1Yi1wcm9jZXNzIGlkXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdGVwSWQgLSB0aGUgY3VycmVudCBzdWItcHJvY2VzcyBzdGVwIGlkXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBzdGVwU2VxIC0gdGhlIGN1cnJlbnQgc3ViLXByb2Nlc3Mgc3RlcCBpbnN0YW5jZSBjb3VudGVyIC8gc2VxdWVuY2VcclxuICogQHBhcmFtIHtvYmplY3R9IGRhdGEgLSB0aGUgdXNlciBpbnB1dCBkYXRhXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBfV0ZJbnN0YW5jZSAtIHRoZSBjdXJyZW50IF9XRkluc3RhbmNlIGNvbnN0cnVjdG9yIGluc3RhbmNlXHJcbiAqXHJcbiAqIEBleGFtcGxlICcnXHJcbiAqXHJcbiAqIEByZXR1cm4gJydcclxuICpcclxuICovXHJcbmZ1bmN0aW9uIHN0ZXAocHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIHN0ZXBJZCwgc3RlcFNlcSwgZGF0YSwgX1dGSW5zdGFuY2UpIHtcclxuXHJcblxyXG4gICAgLy8gRGVmYXVsdCBzdGVwIG1vZGVsXHJcbiAgICB2YXIgbW9kZWwgPSB7XHJcbiAgICAgICAgaWQ6ICcnLFxyXG4gICAgICAgIHNlcTogJycsXHJcbiAgICAgICAgc3RhdHVzOiAnJyxcclxuICAgICAgICBtZXNzYWdlOiAnJyxcclxuICAgICAgICBhc3NpZ25lZFRvOiB7XHJcbiAgICAgICAgICAgIHVzZXJJZDogJycsXHJcbiAgICAgICAgICAgIG5hbWU6ICcnXHJcbiAgICAgICAgfSxcclxuICAgICAgICBhc3NpZ25tZW50OiB7fSxcclxuICAgICAgICBjb21tZW50OiAnJ1xyXG4gICAgfTtcclxuICAgIHZhciBzdWJQcm9jZXNzID0ge307XHJcbiAgICB2YXIgdXVpZCA9ICcnO1xyXG4gICAgdmFyIGluc3RTdWJQcm9jZXNzO1xyXG4gICAgdmFyIHN0ZXAgPSB7fTtcclxuICAgIHZhciB0cmFuc2l0aW9uSWQgPSAnJztcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAvL0dldCB0aGUgY3VycmVudCBzdWJQcm9jZXNzIGluc3RhbmNlIGRhdGFcclxuXHJcblxyXG5cclxuICAgICAgICAgICAgX1dGSW5zdGFuY2UuaW5zdGFuY2UucHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihvYmpQcm9jZXNzKSB7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChvYmpQcm9jZXNzLmlkID09IHByb2Nlc3NJZCAmJiBvYmpQcm9jZXNzLnNlcSA9PSBwcm9jZXNzU2VxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqUHJvY2Vzcy5zdWJQcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKG9ialN1YlByb2Nlc3MpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmpTdWJQcm9jZXNzLmlkID09IHN1YlByb2Nlc3NJZCAmJiBvYmpTdWJQcm9jZXNzLnNlcSA9PSBzdWJQcm9jZXNzU2VxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dWlkID0gb2JqU3ViUHJvY2Vzcy51dWlkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3V1aWQ9PT0nICsgdXVpZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICBfV0ZJbnN0YW5jZS5zdWJwcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKHN1YlByb2Nlc3NJdGVtKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoc3ViUHJvY2Vzc0l0ZW0uX2lkID09IHV1aWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpbnN0U3ViUHJvY2VzcyA9IHN1YlByb2Nlc3NJdGVtO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICBfV0ZJbnN0YW5jZS5jb25maWcucHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihvYmpQcm9jZXNzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAob2JqUHJvY2Vzcy5faWQgPT0gcHJvY2Vzc0lkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqUHJvY2Vzcy5zdWJQcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKG9ialN1YlByb2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9ialN1YlByb2Nlc3MuX2lkID09IHN1YlByb2Nlc3NJZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ViUHJvY2VzcyA9IG9ialN1YlByb2Nlc3M7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmpTdWJQcm9jZXNzLnN0ZXBzLmZpbHRlcihmdW5jdGlvbihvYmpTdGVwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9ialN0ZXAuX2lkID09IHN0ZXBJZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGVwID0gb2JqU3RlcDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgc3ViLXByb2Nlc3Mgc3RlcCBkYXRhXHJcbiAgICAgICAgICAgIG1vZGVsLmlkID0gc3RlcElkO1xyXG4gICAgICAgICAgICBtb2RlbC5zZXEgPSBzdGVwU2VxO1xyXG5cclxuXHJcbiAgICAgICAgICAgIHZhciBpbnN0YW5jZVN0YXR1cyA9ICcnO1xyXG4gICAgICAgICAgICBpZiAoc3RlcC5zZXRJbnN0YW5jZVN0YXR1c1RvLk5vdFN0YXJ0ZWQgIT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICBpbnN0YW5jZVN0YXR1cyA9IFwiTm90U3RhcnRlZFwiO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHN0ZXAuc2V0SW5zdGFuY2VTdGF0dXNUby5DcmVhdGVkICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgaW5zdGFuY2VTdGF0dXMgPSBcIkNyZWF0ZWRcIjtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChzdGVwLnNldEluc3RhbmNlU3RhdHVzVG8uSW5Qcm9ncmVzcyAhPSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIGluc3RhbmNlU3RhdHVzID0gXCJJblByb2dyZXNzXCI7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RlcC5zZXRJbnN0YW5jZVN0YXR1c1RvLlN1Ym1pdHRlZCAhPSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIGluc3RhbmNlU3RhdHVzID0gXCJTdWJtaXR0ZWRcIjtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChzdGVwLnNldEluc3RhbmNlU3RhdHVzVG8uQ29tcGxldGUgIT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICBpbnN0YW5jZVN0YXR1cyA9IFwiQ29tcGxldGVcIjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdmFyIGxhbmd1YWdlID0gc2VydmljZS5nZXRMYW5ndWFnZSgpO1xyXG5cclxuICAgICAgICAgICAgbW9kZWwuc3RhdHVzID0gaW5zdGFuY2VTdGF0dXM7XHJcbiAgICAgICAgICAgIG1vZGVsLm1lc3NhZ2UgPSBldmFsKFwic3RlcC5zZXRJbnN0YW5jZVN0YXR1c1RvLlwiICsgaW5zdGFuY2VTdGF0dXMgKyBcIi5sYWJlbC5cIiArIGxhbmd1YWdlKTtcclxuICAgICAgICAgICAgLy9tb2RlbC5hc3NpZ25lZFRvLnVzZXJJZCA9IGRhdGEudXNlcklkICE9PSB1bmRlZmluZWQgPyBkYXRhLnVzZXJJZCA6ICcnO1xyXG4gICAgICAgICAgICAvL21vZGVsLmFzc2lnbmVkVG8ubmFtZSA9IGRhdGEubmFtZSAhPT0gdW5kZWZpbmVkID8gZGF0YS5uYW1lIDogJyc7XHJcbiAgICAgICAgICAgIG1vZGVsLmNvbW1lbnQgPSBkYXRhLmNvbW1lbnQgIT09IHVuZGVmaW5lZCA/IGRhdGEuY29tbWVudCA6ICcnO1xyXG4gICAgICAgICAgICAvLyBVcGRhdGUgdGhlIGluZGljYXRvciBkb2N1bWVudHMgcHJvY2VzcyBzdGVwIGRhdGFcclxuICAgICAgICAgICAgLy9jb21zby5sb2coJ2luc3RTdWJQcm9jZXNzPT09Jyk7XHJcbiAgICAgICAgICAgIC8vY29tc28ubG9nKGluc3RTdWJQcm9jZXNzKTtcclxuICAgICAgICAgICAgdmFyIGluZGljYXRvcnMgPSBpbnN0U3ViUHJvY2VzcyAhPT0gdW5kZWZpbmVkID8gaW5zdFN1YlByb2Nlc3MuaW5kaWNhdG9ycyA6IFtdO1xyXG4gICAgICAgICAgICBpbmRpY2F0b3JEb2NzKHByb2Nlc3NJZCwgaW5kaWNhdG9ycywgbW9kZWwsIF9XRkluc3RhbmNlKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgLy8gSWYgYWN0aW9ucyBhcmUgc3BlY2lmaWVkLCBleGVjdXRlIHRoZW1cclxuICAgICAgICAgICAgICAgIHZhciBjcmVhdGVkSUQgPSBfV0ZJbnN0YW5jZS5wcm9maWxlICsgJzonICsgX1dGSW5zdGFuY2UuYXBwICsgJzonICsgcHJvY2Vzc0lkICsgJzonICsgcHJvY2Vzc1NlcSArICc6JyArIHN1YlByb2Nlc3NJZCArICc6JyArIHN1YlByb2Nlc3NTZXE7XHJcbiAgICAgICAgICAgICAgICB1dWlkID0gY3JlYXRlZElEO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChzdGVwLmZ1bmN0aW9uLmFjdGlvbnMgIT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9ucyhzdGVwLmZ1bmN0aW9uLmFjdGlvbnMsIHByb2Nlc3NJZCwgcHJvY2Vzc1NlcSwgc3ViUHJvY2Vzc0lkLCBzdWJQcm9jZXNzU2VxLCBzdWJQcm9jZXNzLCBtb2RlbCwgX1dGSW5zdGFuY2UsIGRhdGEsIHV1aWQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRXhlY3V0ZSB0aGUgdHJhbnNpdGlvbnMsIGlmIGF1dG9cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnQWN0aW9ucyBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5LicsIG1vZGVsKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBFbHNlIHRhc2tzIGFyZSBzcHJlY2lmaWVkLCBleGVjdXRlIHRoZW1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RlcC5mdW5jdGlvbi50YXNrICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIE1ha2UgYXNzaWdubWVudHNcclxuICAgICAgICAgICAgICAgICAgICB0YXNrKHByb2Nlc3NJZCwgcHJvY2Vzc1NlcSwgc3RlcC5mdW5jdGlvbi50YXNrLCBjcmVhdGVkSUQsIG1vZGVsKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBkbyB0YXNrIHN1Y2Nlc3MgaGFuZGxpbmdcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1Rhc2sgY29tcGxldGUuJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdUYXNrIGF3YWl0aW5nIHVzZXIgYWN0aW9uLicsIG1vZGVsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcclxuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn07XHJcblxyXG4vKipcclxuICogUHJvY2VzcyBpbmRpY2F0b3IgdXBkYXRlc1xyXG4gKlxyXG4gKiBAcGFyYW0ge29iamVjdH0gYWN0aW9ucyAtIHRoZSBhY3Rpb25zIGNvbmZpZyBkYXRhXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBzdWJQcm9jZXNzIC0gdGhlIGN1cnJlbnQgc3ViLXByb2Nlc3MgZm9ybSBjb25maWcgZGF0YVxyXG4gKiBAcGFyYW0ge29iamVjdH0gX1dGSW5zdGFuY2UgLSB0aGUgY3VycmVudCB3b3JrZmxvdyBjb25zdHJ1Y3RvciBpbnN0YW5jZVxyXG4gKlxyXG4gKiBAZXhhbXBsZSAnJ1xyXG4gKlxyXG4gKiBAcmV0dXJuICcnXHJcbiAqXHJcbiAqL1xyXG5mdW5jdGlvbiBpbmRpY2F0b3JzKGluZGljYXRvcnMsIF9XRkluc3RhbmNlLCBzcHV1aWQpIHtcclxuICAgIHZhciBtb2RlbCA9IFtdO1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgaW5kaWNhdG9yIHNlY3Rpb25zIG9mIHRoZSBzdWJQcm9jZXNzXHJcblxyXG4gICAgICAgICAgICB2YXIgYXJyYXkgPSBKU09OLnhwYXRoKFwiaW5kaWNhdG9yc1tmbjpjb3VudCguL3dvcmtmbG93cy9wcm9jZXNzZXNbc3ViUHJvY2Vzc1VVSUQgZXEgJ1wiICsgc3B1dWlkICsgXCInXSkgZ3QgMF1cIiwgX1dGSW5zdGFuY2UsIHt9KTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBhcnJheS5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGluZGljYXRvciA9IGFycmF5W2pdO1xyXG4gICAgICAgICAgICAgICAgdmFyIGluZGljYXRvck1vZGVsID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlkOiAnJyxcclxuICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZXM6IFtdXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB2YXIgaW5zdGFuY2VNb2RlbCA9IHtcclxuICAgICAgICAgICAgICAgICAgICB1dWlkOiAnJyxcclxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogJycsXHJcbiAgICAgICAgICAgICAgICAgICAga2V5OiAnJyxcclxuICAgICAgICAgICAgICAgICAgICBzZXE6IDFcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGluZGljYXRvck1vZGVsLmlkID0gaW5kaWNhdG9yLmNhdGVnb3J5LnRlcm07XHJcbiAgICAgICAgICAgICAgICBpbnN0YW5jZU1vZGVsLnV1aWQgPSBpbmRpY2F0b3IuX2lkO1xyXG4gICAgICAgICAgICAgICAgaW5zdGFuY2VNb2RlbC50aXRsZSA9IGluZGljYXRvci50aXRsZTtcclxuICAgICAgICAgICAgICAgIGluc3RhbmNlTW9kZWwua2V5ID0gJyc7XHJcbiAgICAgICAgICAgICAgICBpbnN0YW5jZU1vZGVsLnNlcSA9IGluZGljYXRvci5tb2RlbC5wZW5kaW5nLnNlcTsgLy8gaW5kaWNhdG9yIHNlcSBudW1iZXIgaGVyZSB3aGljaCBpcyBnZXR0aW5nIHVwZGF0ZWQuXHJcbiAgICAgICAgICAgICAgICBpbmRpY2F0b3JNb2RlbC5pbnN0YW5jZXMucHVzaChpbnN0YW5jZU1vZGVsKTtcclxuICAgICAgICAgICAgICAgIG1vZGVsLnB1c2goaW5kaWNhdG9yTW9kZWwpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ1Byb2Nlc3MgaW5kaWNhdG9yIG1vZGVsIHVwZGF0ZWQuJywgbW9kZWwpO1xyXG4gICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xyXG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICB9XHJcbiAgICB9KVxyXG59O1xyXG5cclxuLyoqXHJcbiAqIFByb2Nlc3MgYXNzaWduIHVzZXJcclxuICpcclxuICogQHBhcmFtIHtzdHJpbmd9IHByb2Nlc3NJZCAtIHRoZSBXb3JrZmxvdyBjb25maWcgLyBkZWZpbml0aW9uIHByb2Nlc3MgaWRcclxuICogQHBhcmFtIHtudW1iZXJ9IHByb2Nlc3NTZXEgLSB0aGUgV29ya2Zsb3cgaW5zdGFuY2UgcHJvY2VzcyBzZXFcclxuICogQHBhcmFtIHtzdHJpbmd9IHN1YlByb2Nlc3NJZCAtIHRoZSBXb3JrZmxvdyBjb25maWcgLyBkZWZpbml0aW9uIHN1Yi1wcm9jZXNzIGlkXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBzdWJQcm9jZXNzU2VxIC0gdGhlIFdvcmtmbG93IGluc3RhbmNlIHN1Yi1wcm9jZXNzIHNlcVxyXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RlcElkIC0gdGhlIFdvcmtmbG93IGNvbmZpZyAvIGRlZmluaXRpb24gc3RlcCBpZFxyXG4gKiBAcGFyYW0ge3N0cmluZ30gdHJhbnNpdGlvbklkIC0gdGhlIFdvcmtmbG93IGNvbmZpZyAvIGRlZmluaXRpb24gdHJhbnNpdGlvbiBpZFxyXG4gKiBAcGFyYW0ge29iamVjdH0gdXNlciAtIHRoZSB1c2VyIHRvIGFzc2lnbiB0b1xyXG4gKiBAcGFyYW0ge29iamVjdH0gX1dGSW5zdGFuY2UgLSB0aGUgY3VycmVudCB3b3JrZmxvdyBjb25zdHJ1Y3RvciBpbnN0YW5jZVxyXG4gKlxyXG4gKiBAZXhhbXBsZSAnJ1xyXG4gKlxyXG4gKiBAcmV0dXJuICcnXHJcbiAqXHJcbiAqL1xyXG5mdW5jdGlvbiBhc3NpZ25Vc2VyKHByb2Nlc3NJZCwgcHJvY2Vzc1NlcSwgc3ViUHJvY2Vzc0lkLCBzdWJQcm9jZXNzU2VxLCB1c2VyLCBfV0ZJbnN0YW5jZSkge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIHZhciB1dWlkID0gJyc7XHJcbiAgICAgICAgICAgIC8vIEdldCB0aGUgY3VycmVudCBzdWJQcm9jZXNzIGluc3RhbmNlIGRhdGFcclxuICAgICAgICAgICAgX1dGSW5zdGFuY2UuaW5zdGFuY2UucHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihvYmpQcm9jZXNzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAob2JqUHJvY2Vzcy5pZCA9PSBwcm9jZXNzSWQgJiYgb2JqUHJvY2Vzcy5zZXEgPT0gcHJvY2Vzc1NlcSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9ialByb2Nlc3Muc3ViUHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihvYmpTdWJQcm9jZXNzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmpTdWJQcm9jZXNzLmlkID09IHN1YlByb2Nlc3NJZCAmJiBvYmpTdWJQcm9jZXNzLnNlcSA9PSBzdWJQcm9jZXNzU2VxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dWlkID0gb2JqU3ViUHJvY2Vzcy51dWlkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgX1dGSW5zdGFuY2Uuc3VicHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihzdWJQcm9jZXNzSXRlbSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHN1YlByb2Nlc3NJdGVtLl9pZCA9PSB1dWlkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSB1c2VyIGRldGFpbHNcclxuICAgICAgICAgICAgICAgICAgICBzdWJQcm9jZXNzSXRlbS5zdGVwLmFzc2lnbmVkVG8udXNlcklkID0gdXNlci5pZDtcclxuICAgICAgICAgICAgICAgICAgICBzdWJQcm9jZXNzSXRlbS5zdGVwLmFzc2lnbmVkVG8ubmFtZSA9IHVzZXIubmFtZTtcclxuICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgdGhlIGluZGljYXRvcnMgdXNlciBkZXRhaWxzXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGluZGljYXRvcnMgPSBzdWJQcm9jZXNzSXRlbS5pbmRpY2F0b3JzO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaW5kaWNhdG9ycy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5kaWNhdG9yID0gaW5kaWNhdG9yc1tpXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBpbmRpY2F0b3IuaW5zdGFuY2VzLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5zdGFuY2UgPSBpbmRpY2F0b3IuaW5zdGFuY2VzW2pdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCBfV0ZJbnN0YW5jZS5pbmRpY2F0b3JzLmxlbmd0aDsgaysrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRvYyA9IF9XRkluc3RhbmNlLmluZGljYXRvcnNba107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluc3RhbmNlLnV1aWQgPT0gZG9jLl9pZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2Mud29ya2Zsb3dzLmZpbHRlcihmdW5jdGlvbih3b3JrZmxvdykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdvcmtmbG93LmlkID09IF9XRkluc3RhbmNlLmNvbmZpZy5faWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3b3JrZmxvdy5wcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKHByb2Nlc3NJdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcm9jZXNzSXRlbS5pZCA9PSBwcm9jZXNzSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgdXNlciBpZCBhbmQgbmFtZSBpbiB0aGUgZG9jdW1lbnRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NJdGVtLnN0ZXAuYXNzaWduZWRUby51c2VySWQgPSB1c2VyLmlkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc0l0ZW0uc3RlcC5hc3NpZ25lZFRvLm5hbWUgPSB1c2VyLm5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnVXNlciBhc3NpZ25lZCBzdWNjZXNzZnVsbHkuIFVzZXJJZDogXCInICsgdXNlci5pZCArICdcIiwgTmFtZTogXCInICsgdXNlci5uYW1lICsgJ1wiJywgc3ViUHJvY2Vzc0l0ZW0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59O1xyXG4vKipcclxuICogUHJvY2VzcyBpbmRpY2F0b3IgZG9jdW1lbnQgdXBkYXRlc1xyXG4gKlxyXG4gKiBAcGFyYW0ge29iamVjdH0gYWN0aW9ucyAtIHRoZSBhY3Rpb25zIGNvbmZpZyBkYXRhXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBzdWJQcm9jZXNzIC0gdGhlIGN1cnJlbnQgc3ViLXByb2Nlc3MgZm9ybSBjb25maWcgZGF0YVxyXG4gKiBAcGFyYW0ge29iamVjdH0gX1dGSW5zdGFuY2UgLSB0aGUgY3VycmVudCB3b3JrZmxvdyBjb25zdHJ1Y3RvciBpbnN0YW5jZVxyXG4gKlxyXG4gKiBAZXhhbXBsZSAnJ1xyXG4gKlxyXG4gKiBAcmV0dXJuICcnXHJcbiAqXHJcbiAqL1xyXG5mdW5jdGlvbiBpbmRpY2F0b3JEb2NzKHByb2Nlc3NJZCwgaW5kaWNhdG9ycywgc3RlcCwgX1dGSW5zdGFuY2UpIHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAvLyBVcGRhdGUgdGhlIGluZGljYXRvciBzZWN0aW9ucyBvZiB0aGUgc3ViUHJvY2Vzc1xyXG4gICAgICAgICAgICBpZiAoaW5kaWNhdG9ycyA9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIHZhciBlcnJvciA9IHV0aWwuZXJyb3IoJ1dGSW5kaWNhdG9yc1VwZGF0ZScsICdJbmRpY2F0b3JzIHBhcmFtZXRlciBpcyByZXF1aXJlZC4gLSBWYWx1ZTogJyArIGluZGljYXRvcnMpXHJcbiAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaW5kaWNhdG9ycy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vY29tc28ubG9nKCctLT4+Pj4+PiBGaXJzdCBJZiBjb25zaXRpb24nKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaW5kaWNhdG9yID0gaW5kaWNhdG9yc1tpXTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGluZGljYXRvci5pbnN0YW5jZXMubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9jb21zby5sb2coJy0tPj4+Pj4+IFNlY29uZCBJZiBjb25zaXRpb24nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGluc3RhbmNlID0gaW5kaWNhdG9yLmluc3RhbmNlc1tqXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCBfV0ZJbnN0YW5jZS5pbmRpY2F0b3JzLmxlbmd0aDsgaysrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2NvbXNvLmxvZygnLS0+Pj4+Pj4gVGhpcmQgSWYgY29uc2l0aW9uJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZG9jID0gX1dGSW5zdGFuY2UuaW5kaWNhdG9yc1trXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbnN0YW5jZS51dWlkID09IGRvYy5faWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2NvbXNvLmxvZygnLS0+Pj4+Pj4gRm91cnRoIElmIGNvbnNpdGlvbicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvYy53b3JrZmxvd3MuZmlsdGVyKGZ1bmN0aW9uKHdvcmtmbG93KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3b3JrZmxvdy5pZCA9PSBfV0ZJbnN0YW5jZS5jb25maWcuX2lkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2NvbXNvLmxvZygnLS0+Pj4+Pj4gRmlmdGggSWYgY29uc2l0aW9uJyk7XHJcblxyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3b3JrZmxvdy5wcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKHByb2Nlc3NJdGVtKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcm9jZXNzSXRlbS5pZCA9PSBwcm9jZXNzSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc0l0ZW0uc3RlcC5pZCA9IHN0ZXAuaWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NJdGVtLnN0ZXAuc2VxID0gc3RlcC5zZXE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NJdGVtLnN0ZXAuc3RhdHVzID0gc3RlcC5zdGF0dXM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NJdGVtLnN0ZXAubWVzc2FnZSA9IHN0ZXAubWVzc2FnZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc0l0ZW0uc3RlcC5hc3NpZ25lZFRvLnVzZXJJZCA9IHN0ZXAuYXNzaWduZWRUby51c2VySWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NJdGVtLnN0ZXAuYXNzaWduZWRUby5uYW1lID0gc3RlcC5hc3NpZ25lZFRvLm5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NJdGVtLnN0ZXAuY29tbWVudCA9IHN0ZXAuY29tbWVudCAhPT0gdW5kZWZpbmVkID8gc3RlcC5jb21tZW50IDogJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnSW5kaWNhdG9yIGRvY3VtZW50cyB3b3JrZmxvdyBwcm9jZXNzIG1vZGVsIHVwZGF0ZWQuJywgX1dGSW5zdGFuY2UpO1xyXG4gICAgICAgICAgICAgICAgLy9jb21zby5sb2coJ2luZGljYXRvckRvY3MgZnVuY3Rpb24gRU5EUy0tLS0tLS0tLS0tLS0tJyk7XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgIH1cclxuICAgIH0pXHJcbn07XHJcblxyXG4vKipcclxuICogUHJvY2VzcyBhY3Rpb25zXHJcbiAqXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBhY3Rpb25zIC0gdGhlIGFjdGlvbnMgY29uZmlnIGRhdGFcclxuICogQHBhcmFtIHtvYmplY3R9IHN1YlByb2Nlc3MgLSB0aGUgY3VycmVudCBzdWItcHJvY2VzcyBmb3JtIGNvbmZpZyBkYXRhXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBfV0ZJbnN0YW5jZSAtIHRoZSBjdXJyZW50IHdvcmtmbG93IGNvbnN0cnVjdG9yIGluc3RhbmNlXHJcbiAqXHJcbiAqIEBleGFtcGxlICcnXHJcbiAqXHJcbiAqIEByZXR1cm4gJydcclxuICpcclxuICovXHJcbmZ1bmN0aW9uIGFjdGlvbnMoYWN0aW9ucywgcHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIHN1YlByb2Nlc3MsIHN0ZXAsIF9XRkluc3RhbmNlLCBkYXRhLCB1dWlkKSB7XHJcbiAgICB2YXIgYXJyQWN0aW9ucyA9IFtdO1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIHV0aWwuc3luY0xvb3AoYWN0aW9ucy5sZW5ndGgsIGZ1bmN0aW9uKGxvb3ApIHtcclxuICAgICAgICAgICAgdmFyIGNvdW50ZXIgPSBsb29wLml0ZXJhdGlvbigpO1xyXG4gICAgICAgICAgICBhY3Rpb24oYWN0aW9uc1tjb3VudGVyXSwgcHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIHN1YlByb2Nlc3MsIHN0ZXAsIF9XRkluc3RhbmNlLCBkYXRhLCB1dWlkKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJldEFjdGlvbiA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGFjdGlvbnNbY291bnRlcl0uX2lkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXE6IGNvdW50ZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHJlc3VsdFxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgYXJyQWN0aW9ucy5wdXNoKHJldEFjdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9vcC5uZXh0KCk7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBsb29wLmJyZWFrKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9LCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgLy8gT24gY29tcGxldGlvbiBvZiB0aGUgbG9vcFxyXG5cclxuICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ0FjdGlvbnMgY29tcGxldGVkIHN1Y2Nlc3NmdWxseS4nLCBhcnJBY3Rpb25zKTtcclxuXHJcbiAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBQcm9jZXNzIGFjdGlvblxyXG4gKlxyXG4gKiBAcGFyYW0ge29iamVjdH0gYWN0aW9uIC0gdGhlIGFjdGlvbiBjb25maWcgZGF0YVxyXG4gKiBAcGFyYW0ge29iamVjdH0gc3ViUHJvY2VzcyAtIHRoZSBjdXJyZW50IHN1Yi1wcm9jZXNzIGZvcm0gY29uZmlnIGRhdGFcclxuICogQHBhcmFtIHtvYmplY3R9IF9XRkluc3RhbmNlIC0gdGhlIGN1cnJlbnQgd29ya2Zsb3cgY29uc3RydWN0b3IgaW5zdGFuY2VcclxuICpcclxuICogQGV4YW1wbGUgJydcclxuICpcclxuICogQHJldHVybiAnJ1xyXG4gKlxyXG4gKi9cclxuZnVuY3Rpb24gYWN0aW9uKGFjdGlvbiwgcHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIHN1YlByb2Nlc3MsIHN0ZXAsIF9XRkluc3RhbmNlLCBkYXRhLCB1dWlkKSB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcblxyXG4gICAgICAgIGlmIChhY3Rpb24ubWV0aG9kICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICB2YXIgbWV0aG9kUG9zc2libGVJdGVtcyA9IFtcImZvcm1cIiwgXCJpbmRpY2F0b3JcIiwgXCJwcm9maWxlXCIsIFwic3ViUHJvY2Vzc0luc3RhbmNlXCIsIFwic3RlcFwiLCBcImNvbW11bml0eVwiLCBcImFwcGxpY2F0aW9uXCIsIFwidXNlclwiLCBcInNkb1wiLCBcInBlcmZvcm1hbmNlXCJdO1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHByb3BlcnR5RXhpc3RzKGFjdGlvbi5tZXRob2QsIG1ldGhvZFBvc3NpYmxlSXRlbXMpKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdmb3JtJzpcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYWN0aW9uLm1ldGhvZC5mb3JtLmNyZWF0ZSAhPSB1bmRlZmluZWQpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhcmdzID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaChwcm9jZXNzSWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2goc3ViUHJvY2Vzcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaChzdGVwKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKGFjdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaChwcm9jZXNzU2VxKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKHN1YlByb2Nlc3NTZXEpO1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaChfV0ZJbnN0YW5jZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaChkYXRhLmNyZWF0ZVR5cGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2godXVpZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaChkYXRhLmJhc2VVVUlEKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKGRhdGEpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9ybS5jcmVhdGUoYXJncykudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0LmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYWN0aW9uLm1ldGhvZC5mb3JtLmF1dGhvcmlzZSAhPSB1bmRlZmluZWQpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhcmdzID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaChwcm9jZXNzSWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2goc3ViUHJvY2Vzcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaChwcm9jZXNzU2VxKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKHN1YlByb2Nlc3NTZXEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2goX1dGSW5zdGFuY2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2goZGF0YS5jcmVhdGVUeXBlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKHV1aWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2goZGF0YS5iYXNlVVVJRCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaChkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9ybS5hdXRob3Jpc2UoYXJncykudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0LmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhY3Rpb24ubWV0aG9kLmZvcm0udW5kcmFmdCAhPSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKF9XRkluc3RhbmNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKGRhdGEuY3JlYXRlVHlwZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaCh1dWlkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKGRhdGEuYmFzZVVVSUQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2goZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm0uc2V0VW5EcmFmdChhcmdzKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFjdGlvbi5tZXRob2QuZm9ybS5kcmFmdCAhPSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKF9XRkluc3RhbmNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKGRhdGEuY3JlYXRlVHlwZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaCh1dWlkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKGRhdGEuYmFzZVVVSUQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2goZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm0uc2V0RHJhZnQoYXJncykudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0LmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhY3Rpb24ubWV0aG9kLmZvcm0uY2xvc2UgIT0gdW5kZWZpbmVkKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXJncyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2goc3ViUHJvY2Vzcy5pbmRpY2F0b3JzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKF9XRkluc3RhbmNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKGRhdGEuY3JlYXRlVHlwZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaCh1dWlkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKGRhdGEuYmFzZVVVSUQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2goZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm0uY2xvc2UoYXJncykudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0LmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ2luZGljYXRvcic6XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFjdGlvbi5tZXRob2QuaW5kaWNhdG9yLmNyZWF0ZSAhPSB1bmRlZmluZWQpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhY3Rpb24ubWV0aG9kLmluZGljYXRvci5pbnN0YW50aWF0ZSAhPSB1bmRlZmluZWQpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhY3Rpb24ubWV0aG9kLmluZGljYXRvci5zZXRWYWx1ZSAhPSB1bmRlZmluZWQpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYXRoID0gYWN0aW9uLm1ldGhvZC5pbmRpY2F0b3Iuc2V0VmFsdWUucGF0aDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkYXRhVmFsdWUgPSBoZWxwZXIuZ2V0Tm9kZVZhbHVlKGFjdGlvbi5tZXRob2QuaW5kaWNhdG9yLnNldFZhbHVlLmRhdGEsIF9XRkluc3RhbmNlLCB1dWlkKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhcmdzID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaChfV0ZJbnN0YW5jZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaCh1dWlkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKHBhdGgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2goZGF0YVZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gS2VlcCBpbmRpY2F0b3IgZnVuY3Rpb25zIGluIGluZGlhdG9yIGZpbGUgaXN0ZWFkIG9mIGZvcm0gZmlsZS5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm0udXBkYXRlSW5kaWNhdG9yKGFyZ3MpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdC5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhY3Rpb24ubWV0aG9kLmluZGljYXRvci51cGRhdGVTdGF0dXMgIT0gdW5kZWZpbmVkKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3RhdHVzID0gYWN0aW9uLm1ldGhvZC5pbmRpY2F0b3IudXBkYXRlU3RhdHVzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5kaWNhdG9yU2V0SWQgPSBhY3Rpb24ubWV0aG9kLmluZGljYXRvci5pbmRpY2F0b3JTZXRJZDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhcmdzID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaChfV0ZJbnN0YW5jZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaCh1dWlkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKHN0YXR1cyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaChpbmRpY2F0b3JTZXRJZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEtlZXAgaW5kaWNhdG9yIGZ1bmN0aW9ucyBpbiBpbmRpYXRvciBmaWxlIGlzdGVhZCBvZiBmb3JtIGZpbGUuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JtLm1hcmtVcGRhdGVJbmRpY2F0b3IoYXJncykudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0LmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdwcm9maWxlJzpcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYWN0aW9uLm1ldGhvZC5wcm9maWxlLmNyZWF0ZSAhPSB1bmRlZmluZWQpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhcmdzID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaChwcm9jZXNzSWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2goX1dGSW5zdGFuY2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2goZGF0YS5jcmVhdGVUeXBlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKHV1aWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2goZGF0YS5iYXNlVVVJRCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaChkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9ybS5jcmVhdGVQcm9maWxlKGFyZ3MpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdC5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYWN0aW9uLm1ldGhvZC5wcm9maWxlLlggIT0gdW5kZWZpbmVkKSB7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdzdWJQcm9jZXNzSW5zdGFuY2UnOlxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnc3RlcCc6XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdjb21tdW5pdHknOlxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjb21tdW5pdHlQb3NzaWJsZUl0ZW1zID0gW1wiY3JlYXRlQ29tbXVuaXR5XCIsIFwicmVsZWFzZUFkb3B0ZWRBcHBsaWNhdGlvblwiLCBcInVzZXJKb2luQ29tbXVuaXR5XCJdO1xyXG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAocHJvcGVydHlFeGlzdHMoYWN0aW9uLm1ldGhvZC5jb21tdW5pdHksIGNvbW11bml0eVBvc3NpYmxlSXRlbXMpKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdjcmVhdGVDb21tdW5pdHknOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFjdGlvbnNNb2R1bGUuY29tbXVuaXR5LmNyZWF0ZUNvbW11bml0eShhY3Rpb24ubWV0aG9kLmNvbW11bml0eS5jcmVhdGVDb21tdW5pdHksIHV1aWQsIF9XRkluc3RhbmNlKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0LmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ3JlbGVhc2VBZG9wdGVkQXBwbGljYXRpb24nOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFjdGlvbnNNb2R1bGUuY29tbXVuaXR5LnJlbGVhc2VBZG9wdGVkQXBwbGljYXRpb24oYWN0aW9uLm1ldGhvZC5jb21tdW5pdHkucmVsZWFzZUFkb3B0ZWRBcHBsaWNhdGlvbiwgdXVpZCwgX1dGSW5zdGFuY2UpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAndXNlckpvaW5Db21tdW5pdHknOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFjdGlvbnNNb2R1bGUuY29tbXVuaXR5LnVzZXJKb2luQ29tbXVuaXR5KGFjdGlvbi5tZXRob2QuY29tbXVuaXR5LnVzZXJKb2luQ29tbXVuaXR5LCB1dWlkLCBfV0ZJbnN0YW5jZSkudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdC5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KFwiTm8gbWV0aG9kIGZvdW5kIGZyb20gaW1wbGVtZW50ZWQgbGlzdC5cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdhcHBsaWNhdGlvbic6XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFwcGxpY2F0aW9uUG9zc2libGVJdGVtcyA9IFtcImNyZWF0ZUFwcERlZmluaXRpb25cIiwgXCJidWlsZEFwcGxpY2F0aW9uXCIsIFwiYXBwbGljYXRpb25BZG9wdGlvblwiXTtcclxuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHByb3BlcnR5RXhpc3RzKGFjdGlvbi5tZXRob2QuYXBwbGljYXRpb24sIGFwcGxpY2F0aW9uUG9zc2libGVJdGVtcykpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2NyZWF0ZUFwcERlZmluaXRpb24nOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFjdGlvbnNNb2R1bGUuYXBwbGljYXRpb24uY3JlYXRlQXBwRGVmaW5pdGlvbihhY3Rpb24ubWV0aG9kLmFwcGxpY2F0aW9uLmNyZWF0ZUFwcERlZmluaXRpb24sIHV1aWQsIF9XRkluc3RhbmNlKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0LmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2J1aWxkQXBwbGljYXRpb24nOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFjdGlvbnNNb2R1bGUuYXBwbGljYXRpb24uYnVpbGRBcHBsaWNhdGlvbihhY3Rpb24ubWV0aG9kLmFwcGxpY2F0aW9uLmJ1aWxkQXBwbGljYXRpb24sIHV1aWQsIF9XRkluc3RhbmNlKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0LmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2FwcGxpY2F0aW9uQWRvcHRpb24nOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFjdGlvbnNNb2R1bGUuYXBwbGljYXRpb24uYXBwbGljYXRpb25BZG9wdGlvbihhY3Rpb24ubWV0aG9kLmFwcGxpY2F0aW9uLmFwcGxpY2F0aW9uQWRvcHRpb24sIHV1aWQsIF9XRkluc3RhbmNlKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0LmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoXCJObyBtZXRob2QgZm91bmQgZnJvbSBpbXBsZW1lbnRlZCBsaXN0LlwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlICd1c2VyJzpcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ3Nkbyc6XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdwZXJmb3JtYW5jZSc6XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBlcmZvcm1hbmNlUG9zc2libGVJdGVtcyA9IFtcImNyZWF0ZVBsYW5cIl07XHJcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChwcm9wZXJ0eUV4aXN0cyhhY3Rpb24ubWV0aG9kLnBlcmZvcm1hbmNlLCBwZXJmb3JtYW5jZVBvc3NpYmxlSXRlbXMpKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdjcmVhdGVQbGFuJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhY3Rpb25zTW9kdWxlLnBlcmZvcm1hbmNlLmNyZWF0ZVBsYW4oYWN0aW9uLm1ldGhvZC5wZXJmb3JtYW5jZS5jcmVhdGVQbGFuLCB1dWlkLCBfV0ZJbnN0YW5jZSkudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdC5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChcIk5vIG1ldGhvZCBmb3VuZCBmcm9tIGltcGxlbWVudGVkIGxpc3QuXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoXCJObyBtZXRob2QgZm91bmQgZnJvbSBpbXBsZW1lbnRlZCBsaXN0LlwiKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcblxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIEltcGxlbWVudCBzZXRJbnN0YW5jZVRpdGxlIGFjdGlvbiA6IFJlbW92ZSB0aGlzIGVudGlyZSBlbHNlIGJsb2NrXHJcbiAgICAgICAgICAgIHZhciBhcmdzID0gW107XHJcbiAgICAgICAgICAgIHZhciBjb250ZXh0ID0gJ2dsb2JhbCc7XHJcbiAgICAgICAgICAgIHZhciBtZXRob2QgPSAnJztcclxuICAgICAgICAgICAgaWYgKGFjdGlvbi5faWQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgY29udGV4dCA9IGFjdGlvbi5faWQuc3BsaXQoXCIuXCIpWzBdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChhY3Rpb24uX2lkICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZCA9IGFjdGlvbi5faWQuc3BsaXQoXCIuXCIpWzFdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGFyZ3MubGVuZ3RoID0gMDtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhY3Rpb24uX2FyZ3MubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciBhcmcgPSBhY3Rpb24uX2FyZ3NbaV07XHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKGFyZykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3Byb2Nlc3NJZCc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaChwcm9jZXNzSWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdwcm9jZXNzU2VxJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKHByb2Nlc3NTZXEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdzdWJQcm9jZXNzSWQnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2goc3ViUHJvY2Vzc0lkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnc3ViUHJvY2Vzc1NlcSc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaChzdWJQcm9jZXNzU2VxKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnc3ViUHJvY2Vzcyc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaChzdWJQcm9jZXNzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnc3RlcCc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaChzdGVwKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnYWN0aW9uJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKGFjdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBBZGQgdGhlIHJlcXVpcmVkIHBhcmFtZXRlcnMgdG8gdGhlIGFyZ3MgYXJyYXlcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXJncyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGFyZ3MucHVzaChfV0ZJbnN0YW5jZSk7XHJcbiAgICAgICAgICAgIGFyZ3MucHVzaChkYXRhLmNyZWF0ZVR5cGUpO1xyXG4gICAgICAgICAgICBhcmdzLnB1c2godXVpZCk7XHJcbiAgICAgICAgICAgIGFyZ3MucHVzaChkYXRhLmJhc2VVVUlEKTtcclxuICAgICAgICAgICAgYXJncy5wdXNoKGRhdGEpO1xyXG5cclxuXHJcbiAgICAgICAgICAgIGlmIChhY3Rpb24uX2lkID09ICdmb3JtLmNyZWF0ZScpIHtcclxuICAgICAgICAgICAgICAgIGZvcm0uY3JlYXRlKGFyZ3MpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0LmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChhY3Rpb24uX2lkID09ICdmb3JtLmF1dGhvcmlzZScpIHtcclxuICAgICAgICAgICAgICAgIGZvcm0uYXV0aG9yaXNlKGFyZ3MpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGFjdGlvbi5faWQgPT0gJ2Zvcm0uY2xvc2UnKSB7XHJcbiAgICAgICAgICAgICAgICBmb3JtLmNsb3NlKGFyZ3MpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGFjdGlvbi5faWQgPT0gJ2Zvcm0uc2V0RHJhZnQnKSB7XHJcbiAgICAgICAgICAgICAgICBmb3JtLnNldERyYWZ0KGFyZ3MpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGFjdGlvbi5faWQgPT0gJ2Zvcm0uc2V0VW5EcmFmdCcpIHtcclxuICAgICAgICAgICAgICAgIGZvcm0uc2V0VW5EcmFmdChhcmdzKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0LmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChhY3Rpb24uX2lkID09ICdmb3JtLmNyZWF0ZVByb2ZpbGUnKSB7XHJcbiAgICAgICAgICAgICAgICBmb3JtLmNyZWF0ZVByb2ZpbGUoYXJncykudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdC5kYXRhKTtcclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoYWN0aW9uLl9pZCA9PSAnZm9ybS5zZXRJbnN0YW5jZVRpdGxlJykge1xyXG4gICAgICAgICAgICAgICAgZm9ybS5zZXRJbnN0YW5jZVRpdGxlKGFyZ3MpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGFjdGlvbi5faWQgPT0gJ3Byb2ZpbGUuZGVsZXRlJykge1xyXG4gICAgICAgICAgICAgICAgZm9ybS5kZWxldGVQcm9maWxlKGFyZ3MpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdmFyIGVycm9yID0gdXRpbC5lcnJvcignV0ZBY3Rpb25FcnJvcicsICdNZXRob2Q6ICcgKyBhY3Rpb25faWQgKyAnIG5vdCBkZWZpbmVkLicpO1xyXG4gICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBpZiAoY29udGV4dCA9PSAnZm9ybScpIHtcclxuICAgICAgICAgICAgLy8gXHRmb3JtW21ldGhvZF0oYXJncykudGhlbihmdW5jdGlvbihyZXN1bHQpe1xyXG4gICAgICAgICAgICAvLyBcdFx0cmVzb2x2ZShyZXN1bHQuZGF0YSk7XHJcbiAgICAgICAgICAgIC8vIFx0fSwgZnVuY3Rpb24oZXJyKXtcclxuICAgICAgICAgICAgLy8gXHRcdHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAvLyBcdH0pO1xyXG4gICAgICAgICAgICAvLyB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBcdHZhciBlcnJvciA9IHV0aWwuZXJyb3IoJ1dGQWN0aW9uRXJyb3InLCAnTW9kdWxlOiAnICsgY29udGV4dCArICcgbm90IGRlZmluZWQuJyk7XHJcbiAgICAgICAgICAgIC8vIFx0cmVqZWN0KGVycm9yKTtcclxuICAgICAgICAgICAgLy8gfVxyXG5cclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBQcm9jZXNzIHRhc2tzXHJcbiAqXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSB0YXNrIC0gdGhlIHRhc2sgY29uZmlnIGRhdGFcclxuICogQHBhcmFtIHtvYmplY3R9IGlucHV0RGF0YSAtIHRoZSB1c2VyIGlucHV0IGRhdGFcclxuICpcclxuICogQGV4YW1wbGUgJydcclxuICpcclxuICogQHJldHVybiAnJ1xyXG4gKlxyXG4gKi9cclxuZnVuY3Rpb24gdGFzayhzdWJwcm9jZXNzSUQsIHN1YnByb2Nlc3NTRVEsIHRhc2ssIHNwdXVpZCwgbW9kZWwpIHtcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgdmFyIGxpc3QgPSBbXTtcclxuICAgICAgICBpZiAodGFzay5hc3NpZ24ucm9sZSAhPSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgdmFyIGFzc2lnblR5cGUgPSAncHJvZmlsZVJvbGUnO1xyXG4gICAgICAgICAgICB2YXIgcHJvZmlsZUlkID0gYXBwLlNDT1BFLndvcmtmbG93LnByb2ZpbGU7XHJcbiAgICAgICAgICAgIHZhciBpZCA9ICcnO1xyXG4gICAgICAgICAgICBpZiAodGFzay5hc3NpZ24ucm9sZS5wcm9maWxlID09ICdjdXJyZW50Jykge1xyXG4gICAgICAgICAgICAgICAgaWQgPSBhcHAuU0NPUEUud29ya2Zsb3cucHJvZmlsZTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICh0YXNrLmFzc2lnbi5yb2xlLnByb2ZpbGUgPT0gJ2NvbW11bml0eScpIHtcclxuICAgICAgICAgICAgICAgIGlkID0gYXBwLlNDT1BFLmdldENvbW11bml0eUlkKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIHJvbGUgPSB0YXNrLmFzc2lnbi5yb2xlLnJvbGVJZDtcclxuXHJcbiAgICAgICAgICAgIGxpYnJhcnkuZ2V0VXNlcnNMaXN0QnlSb2xlKGlkLCByb2xlKS50aGVuKGZ1bmN0aW9uKGxpc3QpIHtcclxuICAgICAgICAgICAgICAgIGlmIChsaXN0ICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChsaXN0Lmxlbmd0aCA+IDEpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFzc2lnbiB0byB1c2VycyBzZW5kIG5vdGlmaWNhdGlvbnNcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vdmFyIHByT2JqZWN0ID0gSlNPTi54cGF0aChcIi9pbnN0YW5jZS9wcm9jZXNzZXNbc3ViUHJvY2Vzc2VzL3V1aWQgZXEgJ1wiKyBzcHV1aWQgK1wiJ11cIixhcHAuU0NPUEUud29ya2Zsb3cse30pWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3BPYmplY3QgPSBKU09OLnhwYXRoKFwiL3N1YnByb2Nlc3Nlc1tfaWQgZXEgJ1wiICsgc3B1dWlkICsgXCInXVwiLCBhcHAuU0NPUEUud29ya2Zsb3csIHt9KVswXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNoYW5uZWxzID0gSlNPTi54cGF0aChcIi9zdWJwcm9jZXNzZXNbX2lkIGVxICdcIiArIHNwdXVpZCArIFwiJ10vY2hhbm5lbHNcIiwgYXBwLlNDT1BFLndvcmtmbG93LCB7fSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmaW5hbE1zZyA9IHByb2Nlc3NXb3JrZmxvd01lc3NhZ2UoTk9USUZJQ0FUSU9OX1VTRVJfTVNHX0FDQ0VQVCwgc3B1dWlkKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwcm9jZXNzSWQgPSBzcE9iamVjdC5pZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHByb2Nlc3NTZXEgPSBzcE9iamVjdC5zZXE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vdmFyIHN1YnByb2Nlc3NJRCA9IHByT2JqZWN0LmlkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL3ZhciBzdWJwcm9jZXNzU0VRID0gcHJPYmplY3Quc2VxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3VicHJvY2Vzc1VVSUQgPSBzcHV1aWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwcm9jZXNzX1ZhbGlkRGF0ZSA9IHNwT2JqZWN0LmRhdGVzLnZhbGlkO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbmZpZ1Byb2Nlc3MgPSBKU09OLnhwYXRoKFwiL2NvbmZpZy9wcm9jZXNzZXNbX2lkIGVxICdcIiArIHN1YnByb2Nlc3NJRCArIFwiJ11cIiwgYXBwLlNDT1BFLndvcmtmbG93LCB7fSlbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb25maWdTdWJQcm9jZXNzID0gSlNPTi54cGF0aChcIi9zdWJQcm9jZXNzZXNbX2lkIGVxICdcIiArIHByb2Nlc3NJZCArIFwiJ11cIiwgY29uZmlnUHJvY2Vzcywge30pWzBdO1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdGVwU2VxID0gc3BPYmplY3Quc3RlcC5zZXEgKyAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcHJvY2Vzc19DdXJyZW50U3RlcE5hbWVpMTggPSBKU09OLnhwYXRoKFwiL3N0ZXBzW19zZXEgZXEgJ1wiICsgc3RlcFNlcSArIFwiJ10vbmFtZS9pMThuXCIsIGNvbmZpZ1N1YlByb2Nlc3MsIHt9KVswXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHByb2Nlc3NfQ3VycmVudFN0ZXBOYW1lID0gX2dldE5hbWVCeUxhbmcocHJvY2Vzc19DdXJyZW50U3RlcE5hbWVpMTgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHByb2Nlc3NOYW1lID0gX2dldE5hbWVCeUxhbmcoY29uZmlnU3ViUHJvY2Vzcy5uYW1lLmkxOG4pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5vdGZpY2F0aW9uUmVxdWVzdCA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic291cmNlXCI6IFwicmVtb3RlXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInR5cGVcIjogXCJub3RpZmljYXRpb25SZXF1ZXN0XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIl9pZFwiOiBzcHV1aWQgKyBcIjpub3RpZmljYXRpb25SZXF1ZXN0XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImNoYW5uZWxzXCI6IGNoYW5uZWxzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJjb21tdW5pdHlJZFwiOiBhcHAuU0NPUEUuZ2V0Q29tbXVuaXR5SWQoKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYXBwbGljYXRpb25JZFwiOiBhcHAuU0NPUEUuYXBwbGljYXRpb25JZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibWVzc2FnZVwiOiBmaW5hbE1zZyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibWVzc2FnZVR5cGVcIjogXCJpbmZvXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImNyZWF0ZWREYXRlVGltZVwiOiBtb21lbnQoKS5mb3JtYXQoKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic2VuZGVyVXNlcklkXCI6IExPQ0FMX1NFVFRJTkdTLlNVQlNDUklQVElPTlMudXNlcklkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJhY3Rpb25zXCI6IFt7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJsYWJlbFwiOiBcIlZpZXdcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImZ1bmN0aW9uXCI6IFwiYXBwLm9wZW5TdWJwcm9jZXNzXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJwYXJhbXNcIjogW3Byb2ZpbGVJZCwgcHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBwcm9jZXNzTmFtZSwgc3VicHJvY2Vzc0lELCBzdWJwcm9jZXNzU0VRLCBzdWJwcm9jZXNzVVVJRCwgcHJvY2Vzc19WYWxpZERhdGUsIHByb2Nlc3NfQ3VycmVudFN0ZXBOYW1lXVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfV0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInJlY2VpdmVyXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInZhbHVlXCI6IFt7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidHlwZVwiOiBcInJvbGVcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IHJvbGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwicHJvZmlsZUlkXCI6IGlkXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfV1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgZGFvLnVwc2VydChub3RmaWNhdGlvblJlcXVlc3QpLmRvbmUoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pLmZhaWwoZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vdmFyIHNwT2JqZWN0ID0gSlNPTi54cGF0aChcIi9zdWJwcm9jZXNzZXNbX2lkIGVxICdcIisgc3B1dWlkICtcIiddXCIsYXBwLlNDT1BFLndvcmtmbG93LCB7fSlbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhc3NpZ25tZW50ID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0YXNrLmFzc2lnbi5hc3NpZ25tZW50ICE9IHVuZGVmaW5lZCkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhc3NpZ25tZW50ID0gbW9kZWwuYXNzaWdubWVudDsgLy9KU09OLnhwYXRoKFwiL3N0ZXAvYXNzaWdubWVudFwiLHNwT2JqZWN0LHt9KVswXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhY2NlcHQgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJzaG93XCI6IHRhc2suYXNzaWduLmFzc2lnbm1lbnQuYWNjZXB0LnNob3csXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJsYWJlbFwiOiBfZ2V0TmFtZUJ5TGFuZyh0YXNrLmFzc2lnbi5hc3NpZ25tZW50LmFjY2VwdC5sYWJlbC5pMThuKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzc2lnbm1lbnQuYWNjZXB0ID0gYWNjZXB0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNzaWdubWVudC5tZXNzYWdlID0gX2dldE5hbWVCeUxhbmcodGFzay5hc3NpZ24uYXNzaWdubWVudC5tZXNzYWdlLmkxOG4pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlamVjdCA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInNob3dcIjogdGFzay5hc3NpZ24uYXNzaWdubWVudC5yZWplY3Quc2hvdyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImxhYmVsXCI6IF9nZXROYW1lQnlMYW5nKHRhc2suYXNzaWduLmFzc2lnbm1lbnQucmVqZWN0LmxhYmVsLmkxOG4pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNzaWdubWVudC5yZWplY3QgPSByZWplY3Q7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJwcm9maWxlSWRcIjogcHJvZmlsZUlkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwicm9sZUlkXCI6IHJvbGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ0eXBlXCI6IFwicm9sZVwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzc2lnbm1lbnQudmFsdWUgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzc2lnbm1lbnQucHJvZmlsZVJvbGVJZCA9IGlkO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCdOb3RpZmljYXRpb25zIHJlcXVlc3Qgc3VibWl0dGVkIGZvciBhY2NlcHRhbmNlLicpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGxpc3QubGVuZ3RoID09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9hdXRvIGFzc2lnblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdXNlcklkID0gbGlzdFswXS5pZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHVzZXJuYW1lID0gbGlzdFswXS5uYW1lO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy92YXIgc3BPYmplY3QgPSBKU09OLnhwYXRoKFwiL3N1YnByb2Nlc3Nlc1tfaWQgZXEgJ1wiKyBzcHV1aWQgK1wiJ11cIixhcHAuU0NPUEUud29ya2Zsb3csIHt9KVswXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFzc2lnbmVlID0gbW9kZWwuYXNzaWduZWRUbzsgLy9KU09OLnhwYXRoKFwiL3N0ZXAvYXNzaWduZWRUb1wiLHNwT2JqZWN0LHt9KVswXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXNzaWduZWUubmFtZSA9IHVzZXJuYW1lICsgXCJcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXNzaWduZWUudXNlcklkID0gdXNlcklkICsgXCJcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgnQXNzaWduZWQgdG8gdGhlIG9ubHkgdXNlciBpbiByb2xlLicpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB1c2UgZGVmYXVsdCB1c2VyXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGFzay5hc3NpZ24uZGVmYXVsdCAhPSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1c2VySWQgPSB0YXNrLmFzc2lnbi5kZWZhdWx0LnVzZXJJZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1c2VybmFtZSA9IHRhc2suYXNzaWduLmRlZmF1bHQudXNlck5hbWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy92YXIgc3BPYmplY3QgPSBKU09OLnhwYXRoKFwiL3N1YnByb2Nlc3Nlc1tfaWQgZXEgJ1wiKyBzcHV1aWQgK1wiJ11cIixhcHAuU0NPUEUud29ya2Zsb3csIHt9KVswXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhc3NpZ25lZSA9IG1vZGVsLmFzc2lnbmVkVG87IC8vIEpTT04ueHBhdGgoXCIvc3RlcC9hc3NpZ25lZFRvXCIsc3BPYmplY3Qse30pWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNzaWduZWUubmFtZSA9IHVzZXJuYW1lICsgXCJcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzc2lnbmVlLnVzZXJJZCA9IHVzZXJJZCArIFwiXCI7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgnQXNzaWduZWQgdG8gZGVmYXVsdCB1c2VyJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdFcnJvciBpbiBhc3NpZ25tZW50LiBEZWZhdWx0IHVzZXIgbm90IHNwZWNpZmllZC4nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdCgnRXJyb3IgaW4gYXNzaWdubWVudC4gRGVmYXVsdCB1c2VyIG5vdCBzcGVjaWZpZWQuJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRXJyb3IgaW4gZ2V0VXNlcnNMaXN0QnlSb2xlIHVuZGVmaW5lZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdFcnJvciBpbiBnZXRVc2Vyc0xpc3RCeVJvbGUnKTtcclxuICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9IGVsc2UgaWYgKHRhc2suYXNzaWduLnN3aW1sYW5lICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICByZXNvbHZlKCdzd2ltbGFuZScpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnU3dpbWxhbmUgaW1wbGVtZW50YXRpb24gISEnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfSk7XHJcblxyXG5cclxufTtcclxuXHJcblxyXG5cclxuXHJcbi8qKlxyXG4gKiBQcm9jZXNzIHRyYW5zaXRpb25cclxuICpcclxuICogQHBhcmFtIHtzdHJpbmd9IHByb2Nlc3NJZCAtIHRoZSBXb3JrZmxvdyBjb25maWcgLyBkZWZpbml0aW9uIHByb2Nlc3MgaWRcclxuICogQHBhcmFtIHtudW1iZXJ9IHByb2Nlc3NTZXEgLSB0aGUgV29ya2Zsb3cgaW5zdGFuY2UgcHJvY2VzcyBzZXFcclxuICogQHBhcmFtIHtzdHJpbmd9IHN1YlByb2Nlc3NJZCAtIHRoZSBXb3JrZmxvdyBjb25maWcgLyBkZWZpbml0aW9uIHN1Yi1wcm9jZXNzIGlkXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBzdWJQcm9jZXNzU2VxIC0gdGhlIFdvcmtmbG93IGluc3RhbmNlIHN1Yi1wcm9jZXNzIHNlcVxyXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RlcElkIC0gdGhlIFdvcmtmbG93IGNvbmZpZyAvIGRlZmluaXRpb24gc3RlcCBpZFxyXG4gKiBAcGFyYW0ge3N0cmluZ30gdHJhbnNpdGlvbklkIC0gdGhlIFdvcmtmbG93IGNvbmZpZyAvIGRlZmluaXRpb24gdHJhbnNpdGlvbiBpZFxyXG4gKiBAcGFyYW0ge29iamVjdH0gZGF0YSAtIGFueSBhZGRpdGlvbmFsIGRhdGEgcGFzc2VkIGluIGFzIGtleSB2YWx1ZSBwYWlyc1xyXG4gKiBAcGFyYW0ge29iamVjdH0gX1dGSW5zdGFuY2UgLSB0aGUgY3VycmVudCB3b3JrZmxvdyBjb25zdHJ1Y3RvciBpbnN0YW5jZVxyXG4gKlxyXG4gKiBAZXhhbXBsZSAnJ1xyXG4gKlxyXG4gKiBAcmV0dXJuICcnXHJcbiAqXHJcbiAqL1xyXG5mdW5jdGlvbiB0cmFuc2l0aW9uKHByb2Nlc3NJZCwgcHJvY2Vzc1NlcSwgc3ViUHJvY2Vzc0lkLCBzdWJQcm9jZXNzU2VxLCBzdGVwSWQsIHRyYW5zaXRpb25JZCwgZGF0YSwgX1dGSW5zdGFuY2UpIHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICB2YXIgc3RlcFNlcSA9IDA7XHJcbiAgICAgICAgICAgIHZhciBuZXh0U3RlcElkID0gJyc7XHJcbiAgICAgICAgICAgIHZhciBuZXh0U3RlcFNlcSA9IDA7XHJcbiAgICAgICAgICAgIHZhciBzdWJQcm9jZXNzID0gW107XHJcbiAgICAgICAgICAgIHZhciBjdXJyZW50UHJvY2VzcyA9IF9XRkluc3RhbmNlLmNvbmZpZy5wcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKG9ialByb2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgIGlmIChvYmpQcm9jZXNzLl9pZCA9PSBwcm9jZXNzSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqUHJvY2VzcztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHZhciBjdXJyZW50U3ViUHJvY2VzcyA9IGN1cnJlbnRQcm9jZXNzWzBdLnN1YlByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24ob2JqU3ViUHJvY2Vzcykge1xyXG4gICAgICAgICAgICAgICAgaWYgKG9ialN1YlByb2Nlc3MuX2lkID09IHN1YlByb2Nlc3NJZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvYmpTdWJQcm9jZXNzO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdmFyIGN1cnJlbnRTdGVwID0gY3VycmVudFN1YlByb2Nlc3NbMF0uc3RlcHMuZmlsdGVyKGZ1bmN0aW9uKG9ialN0ZXApIHtcclxuICAgICAgICAgICAgICAgIGlmIChvYmpTdGVwLl9pZCA9PSBzdGVwSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqU3RlcDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHZhciB0cmFuc2l0aW9uID0gY3VycmVudFN0ZXBbMF0udHJhbnNpdGlvbi5maWx0ZXIoZnVuY3Rpb24ob2JqVHJhbnNpdGlvbikge1xyXG4gICAgICAgICAgICAgICAgaWYgKG9ialRyYW5zaXRpb24uX2lkID09IHRyYW5zaXRpb25JZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvYmpUcmFuc2l0aW9uO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjdXJyZW50U3ViUHJvY2Vzc1swXS5zdGVwcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRTdWJQcm9jZXNzWzBdLnN0ZXBzW2ldLl9pZCA9PSBzdGVwSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBzdGVwU2VxID0gcGFyc2VJbnQoY3VycmVudFN1YlByb2Nlc3NbMF0uc3RlcHNbaV0uX3NlcSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY3VycmVudFN1YlByb2Nlc3NbMF0uc3RlcHMuZmlsdGVyKGZ1bmN0aW9uKHN0ZXBJdGVtKSB7XHJcbiAgICAgICAgICAgICAgICBuZXh0U3RlcFNlcSA9IHN0ZXBTZXEgKyAxO1xyXG4gICAgICAgICAgICAgICAgaWYgKHBhcnNlSW50KHN0ZXBJdGVtLl9zZXEpID09IG5leHRTdGVwU2VxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV4dFN0ZXBJZCA9IHN0ZXBJdGVtLl9pZDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgX1dGSW5zdGFuY2UuaW5zdGFuY2UucHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihvYmpQcm9jZXNzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAob2JqUHJvY2Vzcy5pZCA9PSBwcm9jZXNzSWQgJiYgb2JqUHJvY2Vzcy5zZXEgPT0gcHJvY2Vzc1NlcSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9ialByb2Nlc3Muc3ViUHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihvYmpTdWJQcm9jZXNzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmpTdWJQcm9jZXNzLmlkID09IHN1YlByb2Nlc3NJZCAmJiBvYmpTdWJQcm9jZXNzLnNlcSA9PSBzdWJQcm9jZXNzU2VxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdXVpZCA9IG9ialN1YlByb2Nlc3MudXVpZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN1YlByb2Nlc3MgPSBvYmpTdWJQcm9jZXNzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX1dGSW5zdGFuY2Uuc3VicHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihzdWJQcm9jZXNzSXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdWJQcm9jZXNzSXRlbS5faWQgPT0gdXVpZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJQcm9jZXNzID0gc3ViUHJvY2Vzc0l0ZW07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB2YXIgbWF4U3RlcHMgPSBjdXJyZW50U3ViUHJvY2Vzc1swXS5zdGVwcy5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICBpZiAodHJhbnNpdGlvblswXS50cmFuc2l0aW9uQWN0aW9uLmdvVG9TdGVwICE9IHVuZGVmaW5lZCkge1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBuZXh0U2VxID0gcGFyc2VJbnQoY3VycmVudFN0ZXBbMF0uX3NlcSkgKyBwYXJzZUludCh0cmFuc2l0aW9uWzBdLnRyYW5zaXRpb25BY3Rpb24uZ29Ub1N0ZXAuZGVmYXVsdCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgbmV4dElkID0gJyc7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50U3ViUHJvY2Vzc1swXS5zdGVwcy5maWx0ZXIoZnVuY3Rpb24oc3RlcEl0ZW0pIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlSW50KHN0ZXBJdGVtLl9zZXEpID09IG5leHRTdGVwU2VxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5leHRJZCA9IHN0ZXBJdGVtLl9pZDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KVxyXG5cclxuICAgICAgICAgICAgICAgIHN0ZXAocHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIG5leHRJZCwgbmV4dFNlcSwgZGF0YSwgX1dGSW5zdGFuY2UpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5leHRTZXEgPT0gbWF4U3RlcHMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ0FsbCBTdGVwIHRyYW5zaXRpb25zIGhhdmUgY29tcGxldGVkIHN1Y2Nlc3NmdWxseS4nLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJQcm9jZXNzQ29tcGxldGU6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGVwOiByZXN1bHQuZGF0YVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNjZXNzKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnU3RlcCB0cmFuc2l0aW9uIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkuJywgcmVzdWx0LmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgfSBlbHNlIGlmICh0cmFuc2l0aW9uWzBdLnRyYW5zaXRpb25BY3Rpb24uZ29Ub1N0ZXBJZCAhPSB1bmRlZmluZWQpIHtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgZ29Ub1N0ZXBJZCA9IHRyYW5zaXRpb25bMF0udHJhbnNpdGlvbkFjdGlvbi5nb1RvU3RlcElkLnN0ZXBJZDtcclxuICAgICAgICAgICAgICAgIHZhciBnb1RvU3RlcFNlcSA9IDE7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50U3ViUHJvY2Vzc1swXS5zdGVwcy5maWx0ZXIoZnVuY3Rpb24oc3RlcEl0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc3RlcEl0ZW0uX2lkID09IGdvVG9TdGVwSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ29Ub1N0ZXBTZXEgPSBwYXJzZUludChzdGVwSXRlbS5fc2VxKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgc3RlcChwcm9jZXNzSWQsIHByb2Nlc3NTZXEsIHN1YlByb2Nlc3NJZCwgc3ViUHJvY2Vzc1NlcSwgZ29Ub1N0ZXBJZCwgZ29Ub1N0ZXBTZXEsIGRhdGEsIF9XRkluc3RhbmNlKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChnb1RvU3RlcFNlcSA9PSBtYXhTdGVwcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnQWxsIFN0ZXAgdHJhbnNpdGlvbnMgaGF2ZSBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5LicsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1YlByb2Nlc3NDb21wbGV0ZTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ZXA6IHJlc3VsdC5kYXRhXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y2Nlc3MpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdTdGVwIHRyYW5zaXRpb24gY29tcGxldGVkIHN1Y2Nlc3NmdWxseS4nLCByZXN1bHQuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBQcm9jZXNzIHBvc3RBY3Rpb25zXHJcbiAqXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBwb3N0QWN0aW9ucyAtIHRoZSBwb3N0QWN0aW9ucyBjb25maWcgZGF0YVxyXG4gKlxyXG4gKiBAZXhhbXBsZSAnJ1xyXG4gKlxyXG4gKiBAcmV0dXJuICcnXHJcbiAqXHJcbiAqL1xyXG5mdW5jdGlvbiBwb3N0QWN0aW9ucyhwb3N0QWN0aW9ucywgX1dGSW5zdGFuY2UpIHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICB2YXIgY29tcGxldGVkID0gW107XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgdXRpbC5zeW5jTG9vcChwb3N0QWN0aW9ucy5sZW5ndGgsIGZ1bmN0aW9uKGxvb3ApIHtcclxuICAgICAgICAgICAgICAgIHZhciBjb3VudGVyID0gbG9vcC5pdGVyYXRpb24oKTtcclxuICAgICAgICAgICAgICAgIGFjdGlvbihwb3N0QWN0aW9uc1tjb3VudGVyXSwgX1dGSW5zdGFuY2UpLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIGFsbCBwcmUtcmVxdWlzaXRlcyBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5LlxyXG4gICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZC5wdXNoKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxvb3AubmV4dCgpO1xyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkLnB1c2goZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxvb3AuYnJlYWsoKTtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIGlmIChjb21wbGV0ZWQuZXZlcnkoQm9vbGVhbikpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnUG9zdC1hY3Rpb25zIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkuJywge30pO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvciA9IHV0aWwuZXJyb3IoJ1dGUHJlQWN0aW9uc0Vycm9yJywgJ05vdCBhbGwgcG9zdC1hY3Rpb25zIHBhc3NlZC4nKTtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn07XHJcblxyXG5cclxuXHJcbi8qXHJcbmZ1bmN0aW9uIHNlbmROb3RpZmljYXRpb25zKHVzZXJzTGlzdCwgc3B1dWlkKXtcclxuXHJcbiAgLy8gZ2V0IHVzZXJzIGxpc3QgXHJcbiAgLy8gc2VuIG5vdGlmaWNhdGlvbnMgdG8gdXNlcnMgeSBhZGRpbmcgY2hhbm5lbHMgdG8gdGhlbVxyXG4gXHJcbiAgdmFyIGNoYW5uZWxBcnJheSA9IFtdO1xyXG5cclxuICBmb3IoaT0wO2k8dXNlcnNMaXN0Lmxlbmd0aDsgaSsrKXtcclxuICAgIGNoYW5uZWxBcnJheS5wdXNoKFwidXNlcl9cIit1c2Vyc0xpc3RbaV0uaWQpO1xyXG4gIH1cclxuXHJcbiAgXHJcbiAgYXNzaWduVG9Vc2Vycyhwcm9jZXNzV29ya2Zsb3dNZXNzYWdlKE5PVElGSUNBVElPTl9VU0VSX01TR19BQ0NFUFQsIHNwdXVpZCksIGNoYW5uZWxBcnJheSk7XHJcblxyXG5cclxuXHJcbn07Ki9cclxuXHJcbi8qZnVuY3Rpb24gYXNzaWduVG9Vc2VycyhtZXNzYWdlLCBjaGFubmVsQXJyYXkpe1xyXG5cclxuICAgICB2YXIgY2hhbm5lbHMgPSBjaGFubmVsQXJyYXk7XHJcbiAgICAgXHJcbiAgICAgdmFyIG5vdGlmaWNhdGlvbiA9ICB7IFxyXG4gICAgICAgICAgXCJfaWRcIjogZ2VuZXJhdGVVVUlEKCksXHJcbiAgICAgICAgICBcImNoYW5uZWxzXCI6Y2hhbm5lbHMsXHJcbiAgICAgICAgICBcIm1lc3NhZ2VcIjogbWVzc2FnZSxcclxuICAgICAgICAgIFwibWVzc2FnZVR5cGVcIjogXCJpbmZvXCIsXHJcbiAgICAgICAgICBcImNyZWF0ZWREYXRlVGltZVwiOiBtb21lbnQoKS5mb3JtYXQoKSxcclxuICAgICAgICAgIFwicmVhZFwiOiBmYWxzZSxcclxuICAgICAgICAgIFwicmVhZERhdGVUaW1lXCI6IFwiXCIsXHJcbiAgICAgICAgICBcInR5cGVcIjogXCJub3RpZmljYXRpb25cIixcclxuICAgICAgICAgIFwic2VuZGVyVXNlcklkXCI6IExPQ0FMX1NFVFRJTkdTLlNVQlNDUklQVElPTlMudXNlcklkXHJcbiAgICAgICB9O1xyXG4gICAgICAgY29uc29sZS5sb2cobm90aWZpY2F0aW9uKTtcclxuICAgICAgIGRhby51cHNlcnQobm90aWZpY2F0aW9uKTtcclxuXHJcbiAgfTsqL1xyXG5cclxuZnVuY3Rpb24gcHJvY2Vzc1dvcmtmbG93TWVzc2FnZShtZXNzYWdlLCBzcHV1aWQpIHtcclxuXHJcbiAgICB2YXIgcmVwbGFjZWRNc2cgPSBtZXNzYWdlO1xyXG5cclxuICAgIGlmIChyZXBsYWNlZE1zZy5pbmRleE9mKCcjSU5TVEFOQ0VfTEFCRUwnKSAhPT0gLTEpIHtcclxuICAgICAgICB2YXIgdmFsID0gSlNPTi54cGF0aChcIi9pbnN0YW5jZS9wcm9jZXNzZXMvc3ViUHJvY2Vzc2VzW3V1aWQgZXEgJ1wiICsgc3B1dWlkICsgXCInXS9sYWJlbFwiLCBhcHAuU0NPUEUud29ya2Zsb3csIHt9KVswXTtcclxuICAgICAgICByZXBsYWNlZE1zZyA9IHJlcGxhY2VkTXNnLnJlcGxhY2UoJyNJTlNUQU5DRV9MQUJFTCcsIHZhbCk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIGlmIChyZXBsYWNlZE1zZy5pbmRleE9mKCcjVVNFUl9OQU1FJykgIT09IC0xKSB7XHJcbiAgICAgICAgdmFyIHZhbCA9IEpTT04ueHBhdGgoXCIvc3VicHJvY2Vzc2VzW19pZCBlcSAnXCIgKyBzcHV1aWQgKyBcIiddL3N0ZXAvYXNzaWduZWRUby9uYW1lXCIsIGFwcC5TQ09QRS53b3JrZmxvdywge30pWzBdO1xyXG4gICAgICAgIHJlcGxhY2VkTXNnID0gcmVwbGFjZWRNc2cucmVwbGFjZSgnI1VTRVJfTkFNRScsIHZhbCk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIGlmIChyZXBsYWNlZE1zZy5pbmRleE9mKCcjUFJPRklMRV9USVRMRScpICE9PSAtMSkge1xyXG4gICAgICAgIHZhciB2YWwgPSBhcHAucHJvZmlsZS50aXRsZTtcclxuICAgICAgICByZXBsYWNlZE1zZyA9IHJlcGxhY2VkTXNnLnJlcGxhY2UoJyNQUk9GSUxFX1RJVExFJywgdmFsKTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHJlcGxhY2VkTXNnLmluZGV4T2YoJyNQUk9GSUxFX1RZUEUnKSAhPT0gLTEpIHtcclxuICAgICAgICB2YXIgdmFsID0gYXBwLlNDT1BFLkFQUF9DT05GSUcubmFtZTtcclxuICAgICAgICByZXBsYWNlZE1zZyA9IHJlcGxhY2VkTXNnLnJlcGxhY2UoJyNQUk9GSUxFX1RZUEUnLCB2YWwpO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBpZiAocmVwbGFjZWRNc2cuaW5kZXhPZignI1ZBUl9TUFVVSUQnKSAhPT0gLTEpIHtcclxuICAgICAgICB2YXIgdmFsID0gc3B1dWlkO1xyXG4gICAgICAgIHJlcGxhY2VkTXNnID0gcmVwbGFjZWRNc2cucmVwbGFjZSgnI1ZBUl9TUFVVSUQnLCB2YWwpO1xyXG5cclxuICAgIH1cclxuXHJcblxyXG4gICAgcmV0dXJuIHJlcGxhY2VkTXNnO1xyXG59O1xyXG5cclxuZnVuY3Rpb24gX2dldE5hbWUoYXJyLCBsYW5nKSB7XHJcbiAgICBpZiAoYXJyICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBpZiAoYXJyW2ldLl9sYW5nID09PSBsYW5nKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYXJyW2ldLnZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59O1xyXG5cclxuZnVuY3Rpb24gX2dldE5hbWVCeUxhbmcob2JqKSB7XHJcbiAgICB2YXIgbGFuZyA9IHNlcnZpY2UuZ2V0TGFuZ3VhZ2UoKTtcclxuICAgIHZhciBleHByID0gJ29iai4nICsgbGFuZztcclxuICAgIHJldHVybiBldmFsKGV4cHIpO1xyXG59O1xyXG5cclxuXHJcblxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSB7XHJcblxyXG4gICAgcHJlUmVxdWlzaXRlczogcHJlUmVxdWlzaXRlcyxcclxuICAgIHByZUFjdGlvbnM6IHByZUFjdGlvbnMsXHJcbiAgICBzdWJQcm9jZXNzOiBzdWJQcm9jZXNzLFxyXG4gICAgaW5kaWNhdG9yRG9jczogaW5kaWNhdG9yRG9jcyxcclxuICAgIHRhc2s6IHRhc2ssXHJcbiAgICB0cmFuc2l0aW9uOiB0cmFuc2l0aW9uLFxyXG4gICAgYXNzaWduVXNlcjogYXNzaWduVXNlclxyXG5cclxufSIsIid1c2Ugc3RyaWN0JztcclxuXHJcbi8qKlxyXG4gKiBVdGlsaXR5IE1vZHVsZVxyXG4gKlxyXG4gKiBAbW9kdWxlIGxpYi91dGlsXHJcbiAqXHJcbiAqIEBhdXRob3IgQnJlbnQgR29yZG9uXHJcbiAqIEB2ZXJzaW9uIDAuMS4wXHJcbiAqXHJcbiAqIEBkZXNjcmlwdGlvblxyXG4gKiBXb3JrZmxvdyB1dGlsaXR5IG1vZHVsZSB1c2VkIHRvIGZvcm1hdCB0aGUgcmV0dXJuIGFuZCBlcnJvciBvYmplY3RzLCBhbmRcclxuICogY29udGFpbnMgc29tZSBvdGhlciB1dGlsaXR5IGZ1bmN0aW9ucyBzdWNoIGFzIGEgc3luYyBsb29wIGFuZCBjb21wYXJlLlxyXG4gKlxyXG4gKi9cclxuXHJcbi8qKlxyXG4gKiBTdWNjZXNzIGJsb2NrIHJldHVybiBvYmplY3QsIGNvbnRhaW5zIGEgbWVzc2FnZSBhbmQgb3B0aW9uYWwgZGF0YSBvYmplY3QuXHJcbiAqXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBtZXNzYWdlIC0gdGhlIHN1Y2Nlc3MgbWVzc2FnZVxyXG4gKiBAcGFyYW0ge3N0cmluZ3xPYmplY3R9IFtkYXRhXSAtIHRoZSBzdWNjZXNzIHJldHVybmVkIGRhdGFcclxuICpcclxuICogQGV4YW1wbGVcclxuICogLy8gUmV0dXJuIHN1Y2Nlc3Mgd2l0aG91dCBhIGRhdGEgYmxvY2tcclxuICogdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ1N1Y2Nlc3MgbWVzc2FnZSBnb2VzIGhlcmUuLi4nKTtcclxuICpcclxuICogQHJldHVybiB7T2JqZWN0fSAtIHdpdGggbWVzc2FnZSBhbmQgZGF0YSBwcm9wZXJ0aWVzXHJcbiAqXHJcbiAqL1xyXG5mdW5jdGlvbiBzdWNjZXNzKG1lc3NhZ2UsIGRhdGEpe1xyXG5cdHJldHVybiB7XHJcblx0XHRtZXNzYWdlOiBtZXNzYWdlLFxyXG5cdFx0ZGF0YTogZGF0YVxyXG5cdH07XHJcbn07XHJcblxyXG4vKipcclxuICogV2FybmluZyBibG9jayByZXR1cm4gb2JqZWN0LCBjb250YWlucyBhIG1lc3NhZ2UgYW5kIG9wdGlvbmFsIGRhdGEgb2JqZWN0LlxyXG4gKlxyXG4gKiBAcGFyYW0ge3N0cmluZ30gbWVzc2FnZSAtIHRoZSB3YXJuaW5nIG1lc3NhZ2VcclxuICogQHBhcmFtIHtzdHJpbmd8T2JqZWN0fSBbZGF0YV0gLSB0aGUgcmV0dXJuZWQgZGF0YVxyXG4gKlxyXG4gKiBAZXhhbXBsZVxyXG4gKiAvLyBSZXR1cm4gc3VjY2VzcyB3aXRob3V0IGEgZGF0YSBibG9ja1xyXG4gKiB2YXIgc3VjY2VzcyA9IHV0aWwud2FybignV2FybmluZyBtZXNzYWdlIGdvZXMgaGVyZS4uLicpO1xyXG4gKlxyXG4gKiBAcmV0dXJuIHtPYmplY3R9IHdpdGggbWVzc2FnZSBhbmQgZGF0YSBwcm9wZXJ0aWVzLCBhbmQgbG9ncyB0aGUgd2FybmluZyB0byB0aGUgY29uc29sZS5cclxuICpcclxuICovXHJcbmZ1bmN0aW9uIHdhcm4obWVzc2FnZSwgZGF0YSl7XHJcblx0Y29uc29sZS53YXJuKGRhdGEpO1xyXG5cdHJldHVybiB7XHJcblx0XHR3YXJuaW5nOiBtZXNzYWdlLFxyXG5cdFx0ZGF0YTogZGF0YVxyXG5cdH07XHJcbn07XHJcblxyXG4vKipcclxuICogRXJyb3IgYmxvY2sgSlMgZXJyb3Igb2JqZWN0LCBjb250YWlucyBhIGNvZGUgYW5kIG1lc3NhZ2UgZm9yIHRoZSBlcnJvci5cclxuICpcclxuICogQHBhcmFtIHtzdHJpbmd9IGNvZGUgLSB0aGUgZXJyb3IgY29kZVxyXG4gKiBAcGFyYW0ge3N0cmluZ30gbWVzc2FnZSAtIHRoZSBlcnJvciBtZXNzYWdlXHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqIHZhciBzdWNjZXNzID0gdXRpbC5lcnJvcignRXJyb3IwMDEnLCdFcnJvciBtZXNzYWdlIGdvZXMgaGVyZS4uLicpO1xyXG4gKlxyXG4gKiBAcmV0dXJuIHtPYmplY3R9IHdpdGggYSBjb2RlIGFuZCBtZXNzYWdlIHByb3BlcnRpZXMuXHJcbiAqXHJcbiAqL1xyXG5mdW5jdGlvbiBlcnJvcihjb2RlLCBtZXNzYWdlKXtcclxuXHR2YXIgZXJyID0gbmV3IEVycm9yKCcnKTtcclxuXHRlcnIubmFtZSA9IGNvZGU7XHJcblx0ZXJyLm1lc3NhZ2UgPSBtZXNzYWdlO1xyXG5cdHJldHVybiBlcnI7XHJcbn07XHJcblxyXG4vKipcclxuICogQSBsb29wIHdoaWNoIGNhbiBsb29wIFggYW1vdW50IG9mIHRpbWVzLCB3aGljaCBjYXJyaWVzIG91dFxyXG4gKiBhc3luY2hyb25vdXMgY29kZSwgYnV0IHdhaXRzIGZvciB0aGF0IGNvZGUgdG8gY29tcGxldGUgYmVmb3JlIGxvb3BpbmcuXHJcbiAqXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBpdGVyYXRpb25zIC0gdGhlIG51bWJlciBvZiBpdGVyYXRpb25zIHRvIGNhcnJ5IG91dFxyXG4gKiBAcGFyYW0ge2Z1bmN0aW9ufSBwcm9jZXNzIC0gdGhlIGNvZGUvZnVuY3Rpb24gd2UncmUgcnVubmluZyBmb3IgZXZlcnlcclxuICogaXRlcmF0aW9uXHJcbiAqIEBwYXJhbSB7ZnVuY3Rpb259IGV4aXQgLSBhbiBvcHRpb25hbCBjYWxsYmFjayB0byBjYXJyeSBvdXQgb25jZSB0aGUgbG9vcFxyXG4gKiBoYXMgY29tcGxldGVkXHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqIHV0aWwuc3luY0xvb3AoNSwgZnVuY3Rpb24obG9vcCl7XHJcbiAqIFx0dmFyIGNvdW50ZXIgPSBsb29wLml0ZXJhdGlvbigpO1xyXG4gKiBcdC8vIEFkZCBhc3luYyBjYWxscyBoZXJlLi5cclxuICpcclxuICogfSwgZnVuY3Rpb24oKXtcclxuICogXHQvLyBPbiBjb21wbGV0ZSBwZXJmb3JtIGFjdGlvbnMgaGVyZS4uLlxyXG4gKlxyXG4gKiB9KTtcclxuICpcclxuICogQHJldHVybiB7T2JqZWN0fSB0aGUgbG9vcCBjb250cm9sIG9iamVjdC5cclxuICpcclxuICovXHJcbmZ1bmN0aW9uIHN5bmNMb29wKGl0ZXJhdGlvbnMsIHByb2Nlc3MsIGV4aXQpe1xyXG4gICAgdmFyIGluZGV4ID0gMCxcclxuICAgICAgICBkb25lID0gZmFsc2UsXHJcbiAgICAgICAgc2hvdWxkRXhpdCA9IGZhbHNlO1xyXG4gICAgdmFyIGxvb3AgPSB7XHJcbiAgICAgICAgbmV4dDpmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICBpZihkb25lKXtcclxuICAgICAgICAgICAgICAgIGlmKHNob3VsZEV4aXQgJiYgZXhpdCl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGV4aXQoKTsgLy8gRXhpdCBpZiB3ZSdyZSBkb25lXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gSWYgd2UncmUgbm90IGZpbmlzaGVkXHJcbiAgICAgICAgICAgIGlmKGluZGV4IDwgaXRlcmF0aW9ucyl7XHJcbiAgICAgICAgICAgICAgICBpbmRleCsrOyAvLyBJbmNyZW1lbnQgb3VyIGluZGV4XHJcbiAgICAgICAgICAgICAgICBwcm9jZXNzKGxvb3ApOyAvLyBSdW4gb3VyIHByb2Nlc3MsIHBhc3MgaW4gdGhlIGxvb3BcclxuICAgICAgICAgICAgLy8gT3RoZXJ3aXNlIHdlJ3JlIGRvbmVcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGRvbmUgPSB0cnVlOyAvLyBNYWtlIHN1cmUgd2Ugc2F5IHdlJ3JlIGRvbmVcclxuICAgICAgICAgICAgICAgIGlmKGV4aXQpIGV4aXQoKTsgLy8gQ2FsbCB0aGUgY2FsbGJhY2sgb24gZXhpdFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICBpdGVyYXRpb246ZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgcmV0dXJuIGluZGV4IC0gMTsgLy8gUmV0dXJuIHRoZSBsb29wIG51bWJlciB3ZSdyZSBvblxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgYnJlYWs6ZnVuY3Rpb24oZW5kKXtcclxuICAgICAgICAgICAgZG9uZSA9IHRydWU7IC8vIEVuZCB0aGUgbG9vcFxyXG4gICAgICAgICAgICBzaG91bGRFeGl0ID0gZW5kOyAvLyBQYXNzaW5nIGVuZCBhcyB0cnVlIG1lYW5zIHdlIHN0aWxsIGNhbGwgdGhlIGV4aXQgY2FsbGJhY2tcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgbG9vcC5uZXh0KCk7XHJcbiAgICByZXR1cm4gbG9vcDtcclxufTtcclxuXHJcbmZ1bmN0aW9uIGNvbXBhcmUoc3ViamVjdCwgb3BlcmF0b3IsIHZhbHVlKSB7XHJcbiAgXHRzd2l0Y2ggKG9wZXJhdG9yKSB7XHJcbiAgXHRcdGNhc2UgJ2dyZWF0ZXJUaGFuJzpcclxuXHRcdFx0cmV0dXJuIHN1YmplY3QgPiB2YWx1ZTtcclxuXHRcdGNhc2UgJ2xlc3NUaGFuJzpcclxuXHRcdFx0cmV0dXJuIHN1YmplY3QgPCB2YWx1ZTtcclxuXHRcdGNhc2UgJ2dyZWF0ZXJUaGFuRXF1YWwnOlxyXG5cdFx0XHRyZXR1cm4gc3ViamVjdCA+PSB2YWx1ZTtcclxuXHRcdGNhc2UgJ2xlc3NUaGFuRXF1YWwnOlxyXG5cdFx0XHRyZXR1cm4gc3ViamVjdCA8PSB2YWx1ZTtcclxuXHRcdGNhc2UgJ2VxdWFsVG8nOlxyXG5cdFx0XHRyZXR1cm4gc3ViamVjdCA9PT0gdmFsdWU7XHJcblx0XHRjYXNlICdub3RFcXVhbFRvJzpcclxuXHRcdFx0cmV0dXJuIHN1YmplY3QgIT09IHZhbHVlO1xyXG4gIFx0fVxyXG59O1xyXG5cclxuZnVuY3Rpb24gZ2V0TmFtZShhcnIsIGxhbmcpe1xyXG5cdGlmIChhcnIgIT09IHVuZGVmaW5lZCkge1xyXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBhcnIubGVuZ3RoIDsgaSsrKSB7XHJcblx0XHRcdGlmIChhcnJbaV0uaTE4bi5fbGFuZyA9PT0gbGFuZykge1xyXG5cdFx0XHRcdHJldHVybiBhcnJbaV0uaTE4bi52YWx1ZTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSB7XHJcblxyXG4gXHRzdWNjZXNzOiBzdWNjZXNzLFxyXG4gXHR3YXJuOiB3YXJuLFxyXG4gXHRlcnJvcjogZXJyb3IsXHJcbiBcdHN5bmNMb29wOiBzeW5jTG9vcCxcclxuIFx0Y29tcGFyZTogY29tcGFyZSxcclxuXHRnZXROYW1lOiBnZXROYW1lXHJcblxyXG4gfVxyXG4iXX0=
