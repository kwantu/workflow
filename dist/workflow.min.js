(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.Workflow = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";function Workflow(e,s,i,r){var o=this;if(""===e||void 0===e)throw util.error("ParamRequired","A profile id is required.");if("string"!=typeof e)throw new Error("The profile id must be a javascript string.");if(o.profile=e||"",""===s||void 0===s)throw util.error("ParamRequired","An app id is required.");if("string"!=typeof s)throw new Error("The app id must be a javascript string.");if(o.app=s||"",""===i||void 0===i)throw util.error("ParamRequired","A workflow configuration is required.");"object"!=typeof i?o.config=JSON.parse(i):o.config=i,o.instance=r,o.indicators=[]}var Process=require("./lib/process"),util=require("./lib/utility");Workflow.prototype.create=function(){var e=this;return new Promise(function(s,i){try{if(void 0!==e.instance){var r=util.warn("Instance already exists.",e);s(r)}else{var o={_id:"",version:"",type:"workflowInstance",processes:[]};o._id=e.profile+":processes",o.version=e.config.version,e.instance=o;var t=util.success("Workflow processes instance created successfully.",e);s(t)}}catch(n){i(n)}})},Workflow.prototype.initialise=function(e,s){var i=this;return new Promise(function(r,o){try{var t=[];if(""!==e&&void 0!==e){if(t=i.config.processes.filter(function(s){return s._id===e?s:void 0}),void 0===t[0]._id){var n=util.error("WFConfigError","No valid process definition found with process id: "+e);o(n)}}else t.push(i.config.processes[0]),e=i.config.processes[0]._id;var c=[];i.instance.processes.filter(function(s){s.id===e&&c.push(s)});var a=0===c.length?1:c.length,u={id:"",seq:"",subProcesses:[]};u.id=e,u.seq=a,i.instance.processes.push(u);var f=t[0].subProcesses[0]._id,p=1;i.instance.processes.filter(function(s){s.id===e&&s.seq===a&&(p=s.subProcesses.length+1)}),Process.subProcess(e,a,f,p,s,i).then(function(e){u.subProcesses.push(e.data),i.instance.processes.push(u);var s=util.success("Process: "+i.config.processes[0]._id+" initialized successfully.",i);r(s)},function(e){o(e)})}catch(l){o(l)}})},Workflow.prototype.transition=function(e,s,i,r,o,t,n){var c=this;return new Promise(function(a,u){try{Process.transition(e,s,i,r,o,t,n,c).then(function(o){var t=function(t){c.instance.processes.filter(function(n){n.id===e&&n.seq===s&&n.subProcesses.filter(function(e){if(e.id===i&&e.seq===r)if("step"===t){e.step=o.data;var s=util.success(o.message,e);a(s)}else if("stepComplete"===t){e.step=o.data.step,e.complete=!0;var s=util.success(o.message,e);a(s)}})})};t(o.data.subProcessComplete?"stepComplete":"step")},function(e){u(e)})}catch(f){u(f)}})},Workflow.prototype.runTask=function(e,s){return new Promise(function(e,s){try{e("Success")}catch(i){s(i)}})},module.exports=Workflow;

},{"./lib/process":3,"./lib/utility":4}],2:[function(require,module,exports){
"use strict";function create(e){var s=(e[0]||[],e[1]||{},[]);return new Promise(function(e,t){var u=util.success("Form indicator set saved successfully.",s);e(u)})}function save(e){var s={complete:!0,data:[]};return new Promise(function(e,t){var u=util.success("Form indicator set saved successfully.",s);e(u)})}function submit(e){var s={complete:!0,data:[]};return new Promise(function(e,t){var u=util.success("Form submitted successfully.",s);e(u)})}function authorise(e){var s={complete:!0,data:[]};return new Promise(function(e,t){var u=util.success("Form authorised successfully.",s);e(u)})}function close(e){var s={complete:!0,data:[]};return new Promise(function(e,t){var u=util.success("Form closed successfully.",s);e(u)})}var util=require("./utility");module.exports={create:create,save:save,submit:submit,authorise:authorise,close:close};

},{"./utility":4}],3:[function(require,module,exports){
"use strict";function preRequisites(e){return new Promise(function(e,t){var s=util.success("Pre-requisites completed successfully.",{});e(s)})}function preRequisite(e,t,s){return new Promise(function(t,s){switch(e._type){default:var i=util.error("WFPreRequisiteError","Pre-requisite type: "+e._type+" not defined.");s(i)}})}function preActions(e,t){return new Promise(function(e,t){var s=util.success("Pre-actions completed successfully.",{});e(s)})}function subProcess(e,t,s,i,n,r){var o=[],a=[];r.instance.processes.filter(function(n){if(n.id===e&&n.seq===t){n.subProcesses.length;n.subProcesses.filter(function(e){e.id===s&&e.seq===i&&(o=e)})}}),r.config.processes.filter(function(t){if(t._id===e){t.subProcesses.filter(function(e){e._id===s&&(a=e)})}});var c={id:s,seq:i,initiated:!1,dates:{created:"",valid:"",due:"",closed:""},complete:!1,indicators:[],step:{}};return new Promise(function(u,l){try{var d=a.initiate;initiate(d,o,n).then(function(o){c.initiated=o.data.initiated,c.dates=o.data.dates;var d=a.steps[0]._id,f=a.steps[0].transitions[0]._id,p=1;step(e,s,d,p,n,r).then(function(o){c.step=o.data,transition(e,t,s,i,d,f,n,r).then(function(e){c.step=e.data;var t=util.success(e.message,c);u(t)},function(e){l(e)})},function(e){l(e)})},function(e){l(e)})}catch(f){l(f)}})}function initiate(e,t,s){var i={initiated:!1,dates:{created:"",valid:"",due:"",closed:""}};return new Promise(function(n,r){var o=function(){switch(e._type){case"user":if(i.dates.created=s.createdDate,"userSelected"===e.dates.valid._type)if(void 0!==s.validDate)i.dates.valid=s.validDate;else{var t=util.error("WFInitiateError","No valid date passed in - {inputData.validDate}");r(t)}if("userSelected"===e.dates.due._type)if(void 0!==s.dueDate)i.dates.due=s.dueDate;else{var t=util.error("WFInitiateError","No due date passed in - {inputData.dueDate}");r(t)}i.initiated=!0;var o=util.success("Sub-Process initiate completed successfully.",i);n(o);break;default:var t=util.error("WFInitiateError","Initiate type: "+e._type+" not defined.");r(t)}};if(void 0===t.complete)o();else if(!t.complete)if(e.parallelInstances)o();else{var a=util.error("WFInitiateError","Sub-process: "+t.id+" still active and parallel instances are not allowed.");r(a)}})}function step(e,t,s,i,n,r){var o={id:"",seq:"",status:"",message:"",assignedTo:{userId:"",name:""},comment:""},a={},c={};return new Promise(function(u,l){try{if(r.config.processes.filter(function(i){i._id===e&&i.subProcesses.filter(function(e){e._id===t&&(a=e,e.steps.filter(function(e){e._id===s&&(c=e)}))})}),o.id=s,o.seq=i,o.status=c._setInstanceStatusTo,o.message=c._setStatusMsgTo,o.assignedTo.userId=n.userId,o.assignedTo.name=n.name,o.comment=void 0!==n.comment?n.comment:"",void 0!==c.actions[0])actions(c.actions,a,r).then(function(e){var t=util.success("Actions completed successfully.",o);u(t)},function(e){l(e)});else if(void 0!==c.task){var d=util.success("Task awaiting user action.",o);u(d)}}catch(f){l(f)}})}function actions(e,t,s){var i=[];return new Promise(function(n,r){util.syncLoop(e.length,function(n){var o=n.iteration();action(e[o],t,s).then(function(t){var s={id:e[o]._id,seq:o,data:t};i.push(s),n.next()},function(e){n["break"](),r(e)})},function(){var e=util.success("Actions completed successfully.",i);n(e)})})}function action(e,t,s){return new Promise(function(i,n){var r=[],o="global",a="";void 0!==e._id&&(o=e._id.split(".")[0]),void 0!==e._id&&(a=e._id.split(".")[1]);for(var c=0;c<e._args.length;c++){var u=e._args[c];switch(u){case"subProcess.indicators":r.push(t.indicators),r.push(s);break;default:r=[]}}if("form"===o)form[a](r).then(function(e){i(e.data)},function(e){n(e)});else{var l=util.error("WFActionError","Module: "+o+" not defined.");n(l)}})}function task(e){return"Implementation pending.."}function transition(e,t,s,i,n,r,o,a){return new Promise(function(c,u){try{for(var l=0,d="",f=0,p=[],v=a.config.processes.filter(function(t){return t._id===e?t:void 0}),m=v[0].subProcesses.filter(function(e){return e._id===s?e:void 0}),_=m[0].steps.filter(function(e){return e._id===n?e:void 0}),y=_[0].transitions.filter(function(e){return e._id===r?e:void 0}),h=0;h<m[0].steps.length;h++)m[0].steps[h]._id===n&&(l=parseInt(m[0].steps[h]._seq));m[0].steps.filter(function(e){f=l+1,parseInt(e._seq)===f&&(d=e._id)}),a.instance.processes.filter(function(n){n.id===e&&n.seq===t&&n.subProcesses.filter(function(e){e.id===s&&e.seq===i&&(p=e)})});var P=m[0].steps.length;switch(y[0]._type){case"auto":"nextStep"===y[0].goTo._type&&step(e,s,d,f,o,a).then(function(e){if(f===P){var t=util.success("All Step transitions have completed successfully.",{subProcessComplete:!0,step:e.data});c(t)}else{var t=util.success("Step transition completed successfully.",e.data);c(t)}var t=util.success("Step transition completed successfully.",e.data);c(t)},function(e){u(e)});break;case"user":if("nextStep"===y[0].goTo._type)step(e,s,d,f,o,a).then(function(e){if(f===P){var t=util.success("All Step transitions have completed successfully.",{subProcessComplete:!0,step:e.data});c(t)}else{var t=util.success("Step transition completed successfully.",e.data);c(t)}var t=util.success("Step transition completed successfully.",e.data);c(t)},function(e){u(e)});else if("stepId"===y[0].goTo._type){var g=y[0].goTo._stepId,b=1;m[0].steps.filter(function(e){e._id===g&&(b=parseInt(e._seq))}),step(e,s,g,b,o,a).then(function(e){if(b===P){var t=util.success("All Step transitions have completed successfully.",{subProcessComplete:!0,step:e.data});c(t)}else{var t=util.success("Step transition completed successfully.",e.data);c(t)}var t=util.success("Step transition completed successfully.",e.data);c(t)},function(e){u(e)})}break;default:var q=util.error("WFTransitionError","Transition type: "+y[0]._type+" not defined.");u(q)}}catch(I){u(I)}})}function postActions(e){return"Implementation pending.."}var util=require("./utility"),form=require("./form");module.exports={preRequisites:preRequisites,preActions:preActions,subProcess:subProcess,task:task,transition:transition};

},{"./form":2,"./utility":4}],4:[function(require,module,exports){
"use strict";function success(r,e){return{message:r,data:e}}function warn(r,e){return console.warn(e),{warning:r,data:e}}function error(r,e){var n=new Error("");return n.name=r,n.message=e,n}function syncLoop(r,e,n){var a=0,t=!1,o=!1,s={next:function(){return t&&o&&n?n():void(r>a?(a++,e(s)):(t=!0,n&&n()))},iteration:function(){return a-1},"break":function(r){t=!0,o=r}};return s.next(),s}function compare(r,e,n){switch(e){case"greaterThan":return r>n;case"lessThan":return n>r;case"greaterThanEqual":return r>=n;case"lessThanEqual":return n>=r;case"equalTo":return r===n;case"notEqualTo":return r!==n}}var form=require("./form");module.exports={success:success,warn:warn,error:error,syncLoop:syncLoop,compare:compare};

},{"./form":2}]},{},[1])(1)
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Vzci9sb2NhbC9saWIvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsIi9Vc2Vycy9icmVudGdvcmRvbjAxL2FwcHMvd29ya2Zsb3cvaW5kZXguanMiLCIvVXNlcnMvYnJlbnRnb3Jkb24wMS9hcHBzL3dvcmtmbG93L2xpYi9mb3JtLmpzIiwiL1VzZXJzL2JyZW50Z29yZG9uMDEvYXBwcy93b3JrZmxvdy9saWIvcHJvY2Vzcy5qcyIsIi9Vc2Vycy9icmVudGdvcmRvbjAxL2FwcHMvd29ya2Zsb3cvbGliL3V0aWxpdHkuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQSxZQXlDQSxTQUFTLFVBQVMsRUFBUyxFQUFLLEVBQVEsR0FDdkMsR0FBSSxHQUFRLElBRVosSUFBZ0IsS0FBWixHQUE4QixTQUFaLEVBQ2YsS0FBTSxNQUFLLE1BQU0sZ0JBQWlCLDRCQUMvQixJQUF3QixnQkFBZCxHQUNoQixLQUFNLElBQUksT0FBTSw4Q0FLcEIsSUFISSxFQUFNLFFBQVUsR0FBVyxHQUduQixLQUFSLEdBQXNCLFNBQVIsRUFDWCxLQUFNLE1BQUssTUFBTSxnQkFBaUIseUJBQy9CLElBQW9CLGdCQUFWLEdBQ2hCLEtBQU0sSUFBSSxPQUFNLDBDQUtqQixJQUhDLEVBQU0sSUFBTSxHQUFPLEdBR0wsS0FBWCxHQUE0QixTQUFYLEVBQ3BCLEtBQU0sTUFBSyxNQUFNLGdCQUFpQix3Q0FDTCxpQkFBYixHQUNiLEVBQU0sT0FBUyxLQUFLLE1BQU0sR0FFN0IsRUFBTSxPQUFTLEVBR2hCLEVBQU0sU0FBVyxFQUVuQixFQUFNLGNBcEVSLEdBQUksU0FBVSxRQUFRLGlCQUNsQixLQUFPLFFBQVEsZ0JBOEZuQixVQUFTLFVBQVUsT0FBUyxXQUMzQixHQUFJLEdBQVEsSUFDWixPQUFPLElBQUksU0FBUSxTQUFTLEVBQVMsR0FDcEMsSUFDQyxHQUF1QixTQUFuQixFQUFNLFNBQXdCLENBQ2pDLEdBQUksR0FBTyxLQUFLLEtBQUssMkJBQTRCLEVBQ2pELEdBQVEsT0FDRixDQUVOLEdBQUksSUFDQSxJQUFLLEdBQ0wsUUFBUyxHQUNULEtBQU0sbUJBQ04sYUFFSixHQUFNLElBQU0sRUFBTSxRQUFVLGFBQzVCLEVBQU0sUUFBVSxFQUFNLE9BQU8sUUFDN0IsRUFBTSxTQUFXLENBQ2pCLElBQUksR0FBVSxLQUFLLFFBQVEsb0RBQXFELEVBQ2hGLEdBQVEsSUFFUixNQUFPLEdBQ1IsRUFBTyxPQWtCVixTQUFTLFVBQVUsV0FBYSxTQUFTLEVBQVcsR0FDbkQsR0FBSSxHQUFRLElBQ1osT0FBTyxJQUFJLFNBQVEsU0FBUyxFQUFTLEdBQ3BDLElBQ0MsR0FBSSxLQUVKLElBQWtCLEtBQWQsR0FBa0MsU0FBZCxHQU92QixHQUxBLEVBQWdCLEVBQU0sT0FBTyxVQUFVLE9BQU8sU0FBUyxHQUN0RCxNQUFJLEdBQVcsTUFBUSxFQUNmLEVBRFIsU0FJNEIsU0FBekIsRUFBYyxHQUFHLElBQW1CLENBQ3ZDLEdBQUksR0FBUSxLQUFLLE1BQU0sZ0JBQWlCLHNEQUF3RCxFQUNoRyxHQUFPLFFBR1IsR0FBYyxLQUFLLEVBQU0sT0FBTyxVQUFVLElBQzFDLEVBQVksRUFBTSxPQUFPLFVBQVUsR0FBRyxHQUl2QyxJQUFJLEtBQ0osR0FBTSxTQUFTLFVBQVUsT0FBTyxTQUFTLEdBQ3BDLEVBQVksS0FBTyxHQUN0QixFQUFlLEtBQUssSUFHdEIsSUFBSSxHQUF1QyxJQUExQixFQUFlLE9BQWUsRUFBSSxFQUFlLE9BRzlELEdBQ0gsR0FBSSxHQUNKLElBQUssR0FDTCxnQkFHRCxHQUFhLEdBQUssRUFDbEIsRUFBYSxJQUFNLEVBQ25CLEVBQU0sU0FBUyxVQUFVLEtBQUssRUFFOUIsSUFBSSxHQUFlLEVBQWMsR0FBRyxhQUFhLEdBQUcsSUFDaEQsRUFBZ0IsQ0FDcEIsR0FBTSxTQUFTLFVBQVUsT0FBTyxTQUFTLEdBQ3BDLEVBQVksS0FBTyxHQUFhLEVBQVksTUFBUSxJQUN2RCxFQUFnQixFQUFZLGFBQWEsT0FBUyxLQUdwRCxRQUFRLFdBQVcsRUFBVyxFQUFZLEVBQWMsRUFBZSxFQUFNLEdBQU8sS0FBSyxTQUFTLEdBQ2pHLEVBQWEsYUFBYSxLQUFLLEVBQU8sTUFDdEMsRUFBTSxTQUFTLFVBQVUsS0FBSyxFQUM5QixJQUFJLEdBQVUsS0FBSyxRQUFRLFlBQWMsRUFBTSxPQUFPLFVBQVUsR0FBRyxJQUFNLDZCQUE4QixFQUN2RyxHQUFRLElBQ04sU0FBUyxHQUNYLEVBQU8sS0FFUCxNQUFNLEdBQ1AsRUFBTyxPQXVCVixTQUFTLFVBQVUsV0FBYSxTQUFTLEVBQVcsRUFBWSxFQUFjLEVBQWUsRUFBUSxFQUFjLEdBRWxILEdBQUksR0FBUSxJQUNaLE9BQU8sSUFBSSxTQUFRLFNBQVMsRUFBUyxHQUNwQyxJQUNDLFFBQVEsV0FBVyxFQUFXLEVBQVksRUFBYyxFQUFlLEVBQVEsRUFBYyxFQUFNLEdBQU8sS0FBSyxTQUFTLEdBRXZILEdBQUksR0FBUyxTQUFTLEdBQ3JCLEVBQU0sU0FBUyxVQUFVLE9BQU8sU0FBUyxHQUNwQyxFQUFZLEtBQU8sR0FBYSxFQUFZLE1BQVEsR0FDdkQsRUFBWSxhQUFhLE9BQU8sU0FBUyxHQUN4QyxHQUFJLEVBQWUsS0FBTyxHQUFnQixFQUFlLE1BQVEsRUFDaEUsR0FBYSxTQUFULEVBQWlCLENBQ3BCLEVBQWUsS0FBTyxFQUFPLElBQzdCLElBQUksR0FBVSxLQUFLLFFBQVEsRUFBTyxRQUFTLEVBQzNDLEdBQVEsT0FDRixJQUFhLGlCQUFULEVBQXlCLENBQ25DLEVBQWUsS0FBTyxFQUFPLEtBQUssS0FDbEMsRUFBZSxVQUFXLENBQzFCLElBQUksR0FBVSxLQUFLLFFBQVEsRUFBTyxRQUFTLEVBQzNDLEdBQVEsUUFRYixHQURHLEVBQU8sS0FBSyxtQkFDUixlQUVBLFNBRU4sU0FBUyxHQUNYLEVBQU8sS0FFUCxNQUFNLEdBQ1AsRUFBTyxPQWlCVixTQUFTLFVBQVUsUUFBVSxTQUFTLEVBQU0sR0FHM0MsTUFBTyxJQUFJLFNBQVEsU0FBUyxFQUFTLEdBQ3BDLElBQ0MsRUFBUSxXQUNQLE1BQU0sR0FDUCxFQUFPLE9BS1YsT0FBTyxRQUFVOzs7QUMzUmpCLFlBZUEsU0FBUyxRQUFPLEdBQ2YsR0FFSSxJQUZhLEVBQUssT0FDSixFQUFLLFVBRXZCLE9BQU8sSUFBSSxTQUFRLFNBQVMsRUFBUyxHQStCcEMsR0FBSSxHQUFVLEtBQUssUUFBUSx5Q0FBMEMsRUFDckUsR0FBUSxLQUlWLFFBQVMsTUFBSyxHQUNiLEdBQ0ksSUFDSCxVQUFVLEVBQ1YsUUFFRCxPQUFPLElBQUksU0FBUSxTQUFTLEVBQVMsR0FDcEMsR0FBSSxHQUFVLEtBQUssUUFBUSx5Q0FBMEMsRUFDckUsR0FBUSxLQUlWLFFBQVMsUUFBTyxHQUNmLEdBQ0ksSUFDSCxVQUFVLEVBQ1YsUUFFRCxPQUFPLElBQUksU0FBUSxTQUFTLEVBQVMsR0FDcEMsR0FBSSxHQUFVLEtBQUssUUFBUSwrQkFBZ0MsRUFDM0QsR0FBUSxLQUlWLFFBQVMsV0FBVSxHQUNsQixHQUNJLElBQ0gsVUFBVSxFQUNWLFFBRUQsT0FBTyxJQUFJLFNBQVEsU0FBUyxFQUFTLEdBQ3BDLEdBQUksR0FBVSxLQUFLLFFBQVEsZ0NBQWlDLEVBQzVELEdBQVEsS0FJVixRQUFTLE9BQU0sR0FDZCxHQUNJLElBQ0gsVUFBVSxFQUNWLFFBRUQsT0FBTyxJQUFJLFNBQVEsU0FBUyxFQUFTLEdBQ3BDLEdBQUksR0FBVSxLQUFLLFFBQVEsNEJBQTZCLEVBQ3hELEdBQVEsS0FqR1YsR0FBSSxNQUFPLFFBQVEsWUFxR25CLFFBQU8sU0FFTCxPQUFRLE9BQ1IsS0FBTSxLQUNOLE9BQVEsT0FDUixVQUFXLFVBQ1gsTUFBTzs7O0FDN0dULFlBeUJBLFNBQVMsZUFBYyxHQUN0QixNQUFPLElBQUksU0FBUSxTQUFTLEVBQVMsR0F1QnBDLEdBQUksR0FBVSxLQUFLLFFBQVEsNENBQzNCLEdBQVEsS0ErQlYsUUFBUyxjQUFhLEVBQWMsRUFBUyxHQUM1QyxNQUFPLElBQUksU0FBUSxTQUFTLEVBQVMsR0FDcEMsT0FBTyxFQUFhLE9BRW5CLFFBQ0MsR0FBSSxHQUFRLEtBQUssTUFBTSxzQkFBc0IsdUJBQXlCLEVBQWEsTUFBUSxnQkFDM0YsR0FBTyxNQWdCWCxRQUFTLFlBQVcsRUFBWSxHQUMvQixNQUFPLElBQUksU0FBUSxTQUFTLEVBQVMsR0FHcEMsR0FBSSxHQUFVLEtBQUssUUFBUSx5Q0FDM0IsR0FBUSxLQWlCVixRQUFTLFlBQVcsRUFBVyxFQUFZLEVBQWMsRUFBZSxFQUFNLEdBRzdFLEdBQUksTUFDQSxJQUNKLEdBQVksU0FBUyxVQUFVLE9BQU8sU0FBUyxHQUM5QyxHQUFJLEVBQVcsS0FBTyxHQUFhLEVBQVcsTUFBUSxFQUFZLENBQ2xELEVBQVcsYUFBYSxNQUN2QyxHQUFXLGFBQWEsT0FBTyxTQUFTLEdBQ25DLEVBQWMsS0FBTyxHQUFnQixFQUFjLE1BQVEsSUFDOUQsRUFBYSxRQU1qQixFQUFZLE9BQU8sVUFBVSxPQUFPLFNBQVMsR0FDNUMsR0FBSSxFQUFjLE1BQVEsRUFBVyxDQUVwQyxFQUFjLGFBQWEsT0FBTyxTQUFTLEdBQ3RDLEVBQWlCLE1BQVEsSUFDNUIsRUFBaUIsT0FTckIsSUFBSSxJQUNILEdBQUksRUFDSixJQUFLLEVBQ0wsV0FBVyxFQUNYLE9BQ0MsUUFBUyxHQUNULE1BQU8sR0FDUCxJQUFLLEdBQ0wsT0FBUSxJQUVULFVBQVUsRUFDVixjQUNBLFFBR0QsT0FBTyxJQUFJLFNBQVEsU0FBUyxFQUFTLEdBRXBDLElBRUMsR0FBSSxHQUFlLEVBQWUsUUFFbEMsVUFBUyxFQUFjLEVBQVksR0FBTSxLQUFLLFNBQVMsR0FFdEQsRUFBTSxVQUFZLEVBQU8sS0FBSyxVQUM5QixFQUFNLE1BQVEsRUFBTyxLQUFLLEtBRTFCLElBQUksR0FBUyxFQUFlLE1BQU0sR0FBRyxJQUNqQyxFQUFlLEVBQWUsTUFBTSxHQUFHLFlBQVksR0FBRyxJQUN0RCxFQUFVLENBQ2QsTUFBSyxFQUFXLEVBQWMsRUFBUSxFQUFTLEVBQU0sR0FBYSxLQUFLLFNBQVMsR0FDL0UsRUFBTSxLQUFPLEVBQU8sS0FFcEIsV0FBVyxFQUFXLEVBQVksRUFBYyxFQUFlLEVBQVEsRUFBYyxFQUFNLEdBQWEsS0FBSyxTQUFTLEdBRXJILEVBQU0sS0FBTyxFQUFPLElBQ2YsSUFBSSxHQUFVLEtBQUssUUFBUSxFQUFPLFFBQVMsRUFDM0MsR0FBUSxJQUNQLFNBQVMsR0FDVixFQUFPLE1BRVgsU0FBUyxHQUNYLEVBQU8sTUFFTixTQUFTLEdBQ1gsRUFBTyxLQUVQLE1BQU0sR0FDUCxFQUFPLE1BZ0JWLFFBQVMsVUFBUyxFQUFVLEVBQVksR0FDdkMsR0FDSSxJQUNILFdBQVcsRUFDWCxPQUNDLFFBQVMsR0FDVCxNQUFPLEdBQ1AsSUFBSyxHQUNMLE9BQVEsSUFHVixPQUFPLElBQUksU0FBUSxTQUFTLEVBQVMsR0FDcEMsR0FBSSxHQUFPLFdBQ1YsT0FBTyxFQUFTLE9BQ2YsSUFBSyxPQUdKLEdBREEsRUFBTyxNQUFNLFFBQVUsRUFBSyxZQUNPLGlCQUEvQixFQUFTLE1BQU0sTUFBTSxNQUN4QixHQUF1QixTQUFuQixFQUFLLFVBQ1IsRUFBTyxNQUFNLE1BQVEsRUFBSyxjQUNwQixDQUNOLEdBQUksR0FBUSxLQUFLLE1BQU0sa0JBQW1CLGtEQUMxQyxHQUFPLEdBR1QsR0FBaUMsaUJBQTdCLEVBQVMsTUFBTSxJQUFJLE1BQ3RCLEdBQXFCLFNBQWpCLEVBQUssUUFDUixFQUFPLE1BQU0sSUFBTSxFQUFLLFlBQ2xCLENBQ04sR0FBSSxHQUFRLEtBQUssTUFBTSxrQkFBbUIsOENBQzFDLEdBQU8sR0FHVCxFQUFPLFdBQVksQ0FDbkIsSUFBSSxHQUFVLEtBQUssUUFBUSwrQ0FBZ0QsRUFDM0UsR0FBUSxFQUNSLE1BQ0QsU0FDQyxHQUFJLEdBQVEsS0FBSyxNQUFNLGtCQUFtQixrQkFBb0IsRUFBUyxNQUFRLGdCQUMvRSxHQUFPLElBR1YsSUFBNEIsU0FBeEIsRUFBVyxTQUNkLFFBQ00sS0FBSyxFQUFXLFNBQ3RCLEdBQUksRUFBUyxrQkFDWixRQUNNLENBQ04sR0FBSSxHQUFRLEtBQUssTUFBTSxrQkFBbUIsZ0JBQWtCLEVBQVcsR0FBSyx3REFDNUUsR0FBTyxNQXFCWCxRQUFTLE1BQUssRUFBVyxFQUFjLEVBQVEsRUFBUyxFQUFXLEdBRWxFLEdBQUksSUFDSCxHQUFJLEdBQ0osSUFBSyxHQUNMLE9BQVEsR0FDUixRQUFTLEdBQ1QsWUFDQyxPQUFRLEdBQ1IsS0FBTSxJQUVQLFFBQVMsSUFFTixLQUNBLElBRUosT0FBTyxJQUFJLFNBQVEsU0FBUyxFQUFTLEdBQ3BDLElBeUJDLEdBdkJBLEVBQVksT0FBTyxVQUFVLE9BQU8sU0FBUyxHQUN4QyxFQUFXLE1BQVEsR0FDdEIsRUFBVyxhQUFhLE9BQU8sU0FBUyxHQUNuQyxFQUFjLE1BQVEsSUFDekIsRUFBYSxFQUNiLEVBQWMsTUFBTSxPQUFPLFNBQVMsR0FDL0IsRUFBUSxNQUFRLElBQ25CLEVBQU8sVUFRYixFQUFNLEdBQUssRUFDWCxFQUFNLElBQU0sRUFDWixFQUFNLE9BQVMsRUFBSyxxQkFDcEIsRUFBTSxRQUFVLEVBQUssZ0JBQ3JCLEVBQU0sV0FBVyxPQUFTLEVBQVUsT0FDcEMsRUFBTSxXQUFXLEtBQU8sRUFBVSxLQUNsQyxFQUFNLFFBQWdDLFNBQXRCLEVBQVUsUUFBd0IsRUFBVSxRQUFVLEdBRTlDLFNBQXBCLEVBQUssUUFBUSxHQUNoQixRQUFRLEVBQUssUUFBUyxFQUFZLEdBQWEsS0FBSyxTQUFTLEdBRTVELEdBQUksR0FBVSxLQUFLLFFBQVEsa0NBQW1DLEVBQzlELEdBQVEsSUFDTixTQUFTLEdBQ1gsRUFBTyxTQUdGLElBQWtCLFNBQWQsRUFBSyxLQUFvQixDQUNuQyxHQUFJLEdBQVUsS0FBSyxRQUFRLDZCQUE4QixFQUN6RCxHQUFRLElBRVIsTUFBTSxHQUNMLEVBQU8sTUFpQlosUUFBUyxTQUFRLEVBQVMsRUFBWSxHQUNyQyxHQUFJLEtBQ0osT0FBTyxJQUFJLFNBQVEsU0FBUyxFQUFTLEdBQ3BDLEtBQUssU0FBUyxFQUFRLE9BQVEsU0FBUyxHQUN0QyxHQUFJLEdBQVUsRUFBSyxXQUNuQixRQUFPLEVBQVEsR0FBVSxFQUFZLEdBQWEsS0FBSyxTQUFTLEdBQy9ELEdBQUksSUFBYyxHQUFJLEVBQVEsR0FBUyxJQUFLLElBQUssRUFBUyxLQUFNLEVBQ2hFLEdBQVcsS0FBSyxHQUNoQixFQUFLLFFBQ0gsU0FBUyxHQUNYLEVBQUEsV0FDQSxFQUFPLE1BRU4sV0FFRixHQUFJLEdBQVUsS0FBSyxRQUFRLGtDQUFtQyxFQUM5RCxHQUFRLE9BaUJYLFFBQVMsUUFBTyxFQUFRLEVBQVksR0FDbkMsTUFBTyxJQUFJLFNBQVEsU0FBUyxFQUFTLEdBQ3BDLEdBQUksTUFDQSxFQUFVLFNBQ1YsRUFBUyxFQUNNLFVBQWYsRUFBTyxNQUNWLEVBQVUsRUFBTyxJQUFJLE1BQU0sS0FBSyxJQUVkLFNBQWYsRUFBTyxNQUNWLEVBQVMsRUFBTyxJQUFJLE1BQU0sS0FBSyxHQUVoQyxLQUFLLEdBQUksR0FBSSxFQUFHLEVBQUksRUFBTyxNQUFNLE9BQVEsSUFBSyxDQUM3QyxHQUFJLEdBQU0sRUFBTyxNQUFNLEVBQ3ZCLFFBQU8sR0FDTixJQUFLLHdCQUVKLEVBQUssS0FBSyxFQUFXLFlBQ3JCLEVBQUssS0FBSyxFQUNWLE1BQ0QsU0FDQyxNQUdILEdBQWdCLFNBQVosRUFDSCxLQUFLLEdBQVEsR0FBTSxLQUFLLFNBQVMsR0FDaEMsRUFBUSxFQUFPLE9BQ2IsU0FBUyxHQUNYLEVBQU8sU0FFRixDQUNOLEdBQUksR0FBUSxLQUFLLE1BQU0sZ0JBQWlCLFdBQWEsRUFBVSxnQkFDL0QsR0FBTyxNQWdCVixRQUFTLE1BQUssR0FDYixNQUFPLDJCQW9CUixRQUFTLFlBQVcsRUFBVyxFQUFZLEVBQWMsRUFBZSxFQUFRLEVBQWMsRUFBTSxHQUNuRyxNQUFPLElBQUksU0FBUSxTQUFTLEVBQVMsR0FDcEMsSUF5QkMsSUFBSyxHQXhCRCxHQUFVLEVBQ1YsRUFBYSxHQUNiLEVBQWMsRUFDZCxLQUNBLEVBQWlCLEVBQVksT0FBTyxVQUFVLE9BQU8sU0FBUyxHQUNqRSxNQUFJLEdBQVcsTUFBUSxFQUNmLEVBRFIsU0FJRyxFQUFvQixFQUFlLEdBQUcsYUFBYSxPQUFPLFNBQVMsR0FDdEUsTUFBSSxHQUFjLE1BQVEsRUFDbEIsRUFEUixTQUlHLEVBQWMsRUFBa0IsR0FBRyxNQUFNLE9BQU8sU0FBUyxHQUM1RCxNQUFJLEdBQVEsTUFBUSxFQUNaLEVBRFIsU0FJRyxFQUFhLEVBQVksR0FBRyxZQUFZLE9BQU8sU0FBUyxHQUMzRCxNQUFJLEdBQWMsTUFBUSxFQUNsQixFQURSLFNBSVEsRUFBSSxFQUFHLEVBQUksRUFBa0IsR0FBRyxNQUFNLE9BQVEsSUFDbEQsRUFBa0IsR0FBRyxNQUFNLEdBQUcsTUFBUSxJQUN6QyxFQUFVLFNBQVMsRUFBa0IsR0FBRyxNQUFNLEdBQUcsTUFHbkQsR0FBa0IsR0FBRyxNQUFNLE9BQU8sU0FBUyxHQUMxQyxFQUFjLEVBQVUsRUFDcEIsU0FBUyxFQUFTLFFBQVUsSUFDL0IsRUFBYSxFQUFTLE9BR3hCLEVBQVksU0FBUyxVQUFVLE9BQU8sU0FBUyxHQUMxQyxFQUFXLEtBQU8sR0FBYSxFQUFXLE1BQVEsR0FDckQsRUFBVyxhQUFhLE9BQU8sU0FBUyxHQUNuQyxFQUFjLEtBQU8sR0FBZ0IsRUFBYyxNQUFRLElBQzlELEVBQWEsTUFLakIsSUFBSSxHQUFXLEVBQWtCLEdBQUcsTUFBTSxNQUMxQyxRQUFPLEVBQVcsR0FBRyxPQUNwQixJQUFLLE9BQzZCLGFBQTdCLEVBQVcsR0FBRyxLQUFLLE9BQ3RCLEtBQUssRUFBVyxFQUFjLEVBQVksRUFBYSxFQUFNLEdBQWEsS0FBSyxTQUFTLEdBQ3ZGLEdBQUksSUFBZ0IsRUFBVSxDQUM3QixHQUFJLEdBQVUsS0FBSyxRQUFRLHFEQUF1RCxvQkFBb0IsRUFBTSxLQUFNLEVBQU8sTUFDekgsR0FBUSxPQUNGLENBQ04sR0FBSSxHQUFVLEtBQUssUUFBUSwwQ0FBMkMsRUFBTyxLQUM3RSxHQUFRLEdBRVQsR0FBSSxHQUFVLEtBQUssUUFBUSwwQ0FBMkMsRUFBTyxLQUM3RSxHQUFRLElBQ04sU0FBUyxHQUNYLEVBQU8sSUFHVCxNQUNELEtBQUssT0FDSixHQUFpQyxhQUE3QixFQUFXLEdBQUcsS0FBSyxNQUN0QixLQUFLLEVBQVcsRUFBYyxFQUFZLEVBQWEsRUFBTSxHQUFhLEtBQUssU0FBUyxHQUN2RixHQUFJLElBQWdCLEVBQVUsQ0FDN0IsR0FBSSxHQUFVLEtBQUssUUFBUSxxREFBdUQsb0JBQW9CLEVBQU0sS0FBTSxFQUFPLE1BQ3pILEdBQVEsT0FDRixDQUNOLEdBQUksR0FBVSxLQUFLLFFBQVEsMENBQTJDLEVBQU8sS0FDN0UsR0FBUSxHQUVULEdBQUksR0FBVSxLQUFLLFFBQVEsMENBQTJDLEVBQU8sS0FDN0UsR0FBUSxJQUNOLFNBQVMsR0FDWCxFQUFPLFNBRUYsSUFBaUMsV0FBN0IsRUFBVyxHQUFHLEtBQUssTUFBb0IsQ0FDakQsR0FBSSxHQUFhLEVBQVcsR0FBRyxLQUFLLFFBQ2hDLEVBQWMsQ0FDbEIsR0FBa0IsR0FBRyxNQUFNLE9BQU8sU0FBUyxHQUN0QyxFQUFTLE1BQVEsSUFDcEIsRUFBYyxTQUFTLEVBQVMsU0FHbEMsS0FBSyxFQUFXLEVBQWMsRUFBWSxFQUFhLEVBQU0sR0FBYSxLQUFLLFNBQVMsR0FDdkYsR0FBSSxJQUFnQixFQUFVLENBQzdCLEdBQUksR0FBVSxLQUFLLFFBQVEscURBQXVELG9CQUFvQixFQUFNLEtBQU0sRUFBTyxNQUN6SCxHQUFRLE9BQ0YsQ0FDTixHQUFJLEdBQVUsS0FBSyxRQUFRLDBDQUEyQyxFQUFPLEtBQzdFLEdBQVEsR0FFVCxHQUFJLEdBQVUsS0FBSyxRQUFRLDBDQUEyQyxFQUFPLEtBQzdFLEdBQVEsSUFDTixTQUFTLEdBQ1gsRUFBTyxLQUdULEtBQ0QsU0FDQyxHQUFJLEdBQVEsS0FBSyxNQUFNLG9CQUFvQixvQkFBc0IsRUFBVyxHQUFHLE1BQVEsZ0JBQ3ZGLEdBQU8sSUFFUixNQUFNLEdBQ1AsRUFBTyxNQWVWLFFBQVMsYUFBWSxHQUNwQixNQUFPLDJCQXprQlIsR0FBSSxNQUFPLFFBQVEsYUFDZixLQUFPLFFBQVEsU0Eya0JuQixRQUFPLFNBRUwsY0FBZSxjQUNmLFdBQVksV0FDWixXQUFZLFdBQ1osS0FBTSxLQUNOLFdBQVk7OztBQ3BsQmQsWUErQkEsU0FBUyxTQUFRLEVBQVMsR0FDekIsT0FDQyxRQUFTLEVBQ1QsS0FBTSxHQWlCUixRQUFTLE1BQUssRUFBUyxHQUV0QixNQURBLFNBQVEsS0FBSyxJQUVaLFFBQVMsRUFDVCxLQUFNLEdBZ0JSLFFBQVMsT0FBTSxFQUFNLEdBQ3BCLEdBQUksR0FBTSxHQUFJLE9BQU0sR0FHcEIsT0FGQSxHQUFJLEtBQU8sRUFDWCxFQUFJLFFBQVUsRUFDUCxFQTBCUixRQUFTLFVBQVMsRUFBWSxFQUFTLEdBQ25DLEdBQUksR0FBUSxFQUNSLEdBQU8sRUFDUCxHQUFhLEVBQ2IsR0FDQSxLQUFLLFdBQ0QsTUFBRyxJQUNJLEdBQWMsRUFDTixTQUlKLEVBQVIsR0FDQyxJQUNBLEVBQVEsS0FHUixHQUFPLEVBQ0osR0FBTSxPQUdqQixVQUFVLFdBQ04sTUFBTyxHQUFRLEdBRW5CLFFBQU0sU0FBUyxHQUNYLEdBQU8sRUFDUCxFQUFhLEdBSXJCLE9BREEsR0FBSyxPQUNFLEVBR1gsUUFBUyxTQUFRLEVBQVMsRUFBVSxHQUNqQyxPQUFRLEdBQ1AsSUFBSyxjQUNOLE1BQU8sR0FBVSxDQUNsQixLQUFLLFdBQ0osTUFBaUIsR0FBVixDQUNSLEtBQUssbUJBQ0osTUFBTyxJQUFXLENBQ25CLEtBQUssZ0JBQ0osTUFBa0IsSUFBWCxDQUNSLEtBQUssVUFDSixNQUFPLEtBQVksQ0FDcEIsS0FBSyxhQUNKLE1BQU8sS0FBWSxHQWpKdEIsR0FBSSxNQUFPLFFBQVEsU0FxSm5CLFFBQU8sU0FFTCxRQUFTLFFBQ1QsS0FBTSxLQUNOLE1BQU8sTUFDUCxTQUFVLFNBQ1YsUUFBUyIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCIndXNlIHN0cmljdCc7XG5cbnZhciBQcm9jZXNzID0gcmVxdWlyZSgnLi9saWIvcHJvY2VzcycpO1xudmFyIHV0aWwgPSByZXF1aXJlKCcuL2xpYi91dGlsaXR5Jyk7XG5cbi8qZ2xvYmFscyAqL1xuXG4vKipcbiAqIEEgbmV3IFdvcmtmbG93IGNvbnN0cnVjdG9yIGluc3RhbmNlIGNvbnRhaW5zIHRoZSByZWZlcmVuY2UgdG8gdGhlIGFwcGxpY2F0aW9uXG4gKiBhbmQgYXNzb2NpYXRlZCBwcm9maWxlIHdoaWNoIGl0IHJlcXVpcmVzIGFzIHRoZSBmaXJzdCB0d28gcGFyYW1ldGVycy4gSXQgYWxzb1xuICogcmVxdWlyZXMgYSB3b3JrZmxvdyBjb25maWd1cmF0aW9uLCBhcyB0aGUgdGhpcmQgcGFyYW1ldGVyLCB3aGljaCBpcyB1c2VkIHRvXG4gKiBkZXNjaWJlIHRoZSB3b3JrZmxvdyBwcm9jZXNzZXMuIElmIGEgd29ya2Zsb3cgaW5zdGFuY2UgZXhpc3RzIHlvdSBjYW4gcGFzcyBpdFxuICogaW4gYXMgdGhlIGZvdXJ0aCBwYXJhbWV0ZXIgd2hpY2ggaXQgd2lsbCB0aGVuIHVzZSwgZWxzZSBjcmVhdGUgYSBuZXcgb25lLlxuICpcbiAqIEBjb25zdHJ1Y3RvclxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBwcm9maWxlIC0gVGhlIGN1cnJlbnQgcHJvZmlsZSBpZFxuICogQHBhcmFtIHtzdHJpbmd9IGFwcCAtIFRoZSBhc3NvY2lhdGVkIGFwcGxpY2F0aW9uIGlkXG4gKiBAcGFyYW0ge09iamVjdH0gY29uZmlnIC0gVGhlIGFwcGxpY2F0aW9uIHdvcmtmbG93IGNvbmZpZ3VyYXRpb24gLyBkZWZpbml0aW9uXG4gKiBAcGFyYW0ge09iamVjdH0gW2luc3RhbmNlXSAtIEFuIGV4aXN0aW5nIGFwcGxpY2F0aW9uIHByb2ZpbGUgd29ya2Zsb3cgaW5zdGFuY2UgYmFzZWRcbiAqIG9uIHRoZSBkZWZpbml0aW9uXG4gKlxuICogQGF1dGhvciBCcmVudCBHb3Jkb25cbiAqIEB2ZXJzaW9uIDAuMS4wXG4gKlxuICogQGV4YW1wbGVcbiAqIHZhciBjb25maWcgPSB7ICdfaWQnOiAnYWJjMTIzJyB9O1xuICogdmFyIGluc3RhbmNlID0geyAnX2lkJzogJ2luc3RhbmNlX2FiYzEyMycgfTtcbiAqIC8vIElmIHRoZXJlIGlzbid0IGFuIGV4aXN0aW5nIGluc3RhbmNlXG4gKiB2YXIgd29ya2Zsb3cgPSBuZXcgV29ya2Zsb3coJzEyMzQnLCAnNTY3OCcsIGNvbmZpZyk7XG4gKiAvLyBJZiB0aGVyZSBpcyBhbiBleGlzdGluZyBpbnN0YW5jZVxuICogdmFyIHdvcmtmbG93ID0gbmV3IFdvcmtmbG93KCcxMjM0JywgJzU2NzgnLCBjb25maWcsIGluc3RhbmNlKTtcbiAqXG4gKiBAcmV0dXJuIHtPYmplY3R9IG5ldyBXb3JrZmxvdyBvYmplY3RcbiAqXG4gKiBAdGhyb3dzIEVycm9yOiBBIHByb2ZpbGUgaWQgaXMgcmVxdWlyZWRcbiAqIEB0aHJvd3MgRXJyb3I6IEFuIGFwcCBpZCBpcyByZXF1aXJlZFxuICogQHRocm93cyBFcnJvcjogQSB3b3JrZmxvdyBjb25maWd1cmF0aW9uIGlzIHJlcXVpcmVkXG4gKlxuICovXG5cbmZ1bmN0aW9uIFdvcmtmbG93KHByb2ZpbGUsIGFwcCwgY29uZmlnLCBpbnN0YW5jZSl7XG5cdHZhciBfdGhpcyA9IHRoaXM7XG5cdC8vIFByb2ZpbGUgSUQgdmFsaWRhdGlvbiBjaGVja3Ncblx0aWYgKHByb2ZpbGUgPT09ICcnIHx8IHByb2ZpbGUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aHJvdyB1dGlsLmVycm9yKCdQYXJhbVJlcXVpcmVkJywgJ0EgcHJvZmlsZSBpZCBpcyByZXF1aXJlZC4nKTtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZihwcm9maWxlKSAhPT0gJ3N0cmluZycpIHtcbiAgICBcdHRocm93IG5ldyBFcnJvcignVGhlIHByb2ZpbGUgaWQgbXVzdCBiZSBhIGphdmFzY3JpcHQgc3RyaW5nLicpO1xuICAgIH0gZWxzZSB7XG4gICAgXHRfdGhpcy5wcm9maWxlID0gcHJvZmlsZSB8fCAnJztcbiAgICB9XG4gICAgLy8gQXBwIElEIHZhbGlkYXRpb24gY2hlY2tzXG5cdGlmIChhcHAgPT09ICcnIHx8IGFwcCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRocm93IHV0aWwuZXJyb3IoJ1BhcmFtUmVxdWlyZWQnLCAnQW4gYXBwIGlkIGlzIHJlcXVpcmVkLicpO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mKGFwcCkgIT09ICdzdHJpbmcnKSB7XG4gICAgXHR0aHJvdyBuZXcgRXJyb3IoJ1RoZSBhcHAgaWQgbXVzdCBiZSBhIGphdmFzY3JpcHQgc3RyaW5nLicpO1xuICAgIH0gZWxzZSB7XG4gICAgXHRfdGhpcy5hcHAgPSBhcHAgfHwgJyc7XG4gICAgfVxuICAgIC8vIFdvcmtmbG93IGNvbmZpZ3VyYXRpb24gdmFsaWRhdGlvbiBjaGVja3NcbiAgICBpZiAoY29uZmlnID09PSAnJyB8fCBjb25maWcgPT09IHVuZGVmaW5lZCkge1xuICAgIFx0dGhyb3cgdXRpbC5lcnJvcignUGFyYW1SZXF1aXJlZCcsICdBIHdvcmtmbG93IGNvbmZpZ3VyYXRpb24gaXMgcmVxdWlyZWQuJyk7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YoY29uZmlnKSAhPT0gJ29iamVjdCcpIHtcbiAgICAgICAgX3RoaXMuY29uZmlnID0gSlNPTi5wYXJzZShjb25maWcpO1xuICAgIH0gZWxzZSB7XG4gICAgXHRfdGhpcy5jb25maWcgPSBjb25maWc7XG4gICAgfVxuICAgIC8vIFdvcmtmbG93IGluc3RhbmNlIHZhbGlkYXRpb24gY2hlY2tzXG4gICAgX3RoaXMuaW5zdGFuY2UgPSBpbnN0YW5jZTtcblx0XHQvLyBXb3JrZmxvdyBpbmRpY2F0b3JzIHBsYWNlIGhvbGRlclxuXHRcdF90aGlzLmluZGljYXRvcnMgPSBbXTtcblxufVxuXG4vKipcbiAqIFRoaXMgbWV0aG9kIGNyZWF0ZXMgYSBuZXcgd29ya2Zsb3cgcHJvY2VzcyBpLmUuIGl0IGNyZWF0ZXMgYSB3b3JrZmxvdyBwcm9jZXNzZXMgaW5zdGFuY2VcbiAqIG9iamVjdCB3aXRoIHRoZSBtaW5pbXVtIHJlcXVpcmVkIGRhdGEuIFRoaXMgaW5zdGFuY2UgY2FuIGJlIHJlZmVyZW5jZWQgaW4gdGhlIGZvbGxvd2luZ1xuICogd2F5LCBzZWUgZXhhbXBsZSBiZWxvdy5cbiAqXG4gKiBAZXhhbXBsZVxuICogdmFyIGNvbmZpZyA9IHsgJ19pZCc6ICdhYmMxMjMnIH07XG4gKiB2YXIgd29ya2Zsb3cgPSBuZXcgV29ya2Zsb3coJzEyMzQnLCAnNTY3OCcsIGNvbmZpZyk7XG4gKiB3b3JrZmxvdy5jcmVhdGUoKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCl7XG4gKlx0Y29uc29sZS5sb2cocmVzdWx0Lm1lc3NhZ2UpO1xuICpcdC8vIFRoZSBmb2xsb3dpbmcgcHJvcGVydGllcyBjYW4gbm93IGJlIGFjY2Vzc2VkXG4gKiBcdHZhciBwcm9maWxlID0gd29ya2Zsb3cucHJvZmlsZTtcbiAqIFx0dmFyIGFwcCA9IHdvcmtmbG93LmFwcDtcbiAqIFx0dmFyIGNvbmZpZyA9IHdvcmtmbG93LmNvbmZpZztcbiAqXHQvLyBPbiBzdWNjZXNzIHlvdSBjYW4gYWNjZXNzIHRoZSBpbnN0YW5jZSB0aGUgZm9sbG93aW5nIHdheVxuICpcdHZhciBpbnN0YW5jZSA9IHdvcmtmbG93Lmluc3RhbmNlO1xuICogfSwgZnVuY3Rpb24oZXJyb3Ipe1xuICpcdGNvbnNvbGUubG9nKGVycm9yKTtcbiAqIH0pO1xuICpcbiAqIEByZXR1cm4ge09iamVjdH0gbmV3IFdvcmtmbG93IGluc3RhbmNlIHdpdGggdXBkYXRlZCBpbnN0YW5jZSBkYXRhLlxuICpcbiAqL1xuV29ya2Zsb3cucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uKCl7XG5cdHZhciBfdGhpcyA9IHRoaXM7XG5cdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcblx0XHR0cnkge1xuXHRcdFx0aWYgKF90aGlzLmluc3RhbmNlICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdFx0dmFyIHdhcm4gPSB1dGlsLndhcm4oJ0luc3RhbmNlIGFscmVhZHkgZXhpc3RzLicsIF90aGlzKVxuXHRcdFx0XHRyZXNvbHZlKHdhcm4pO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Ly8gQ3JlYXRlIHRoZSB3b3JrZmxvdyBwcm9jZXNzZXMgaW5zdGFuY2Ugb2JqZWN0XG5cdFx0XHRcdHZhciBtb2RlbCA9IHtcblx0XHRcdFx0ICAgIF9pZDogJycsXG5cdFx0XHRcdCAgICB2ZXJzaW9uOiAnJyxcblx0XHRcdFx0ICAgIHR5cGU6ICd3b3JrZmxvd0luc3RhbmNlJyxcblx0XHRcdFx0ICAgIHByb2Nlc3NlczogW11cblx0XHRcdFx0fTtcblx0XHRcdFx0bW9kZWwuX2lkID0gX3RoaXMucHJvZmlsZSArICc6cHJvY2Vzc2VzJztcblx0XHRcdFx0bW9kZWwudmVyc2lvbiA9IF90aGlzLmNvbmZpZy52ZXJzaW9uO1xuXHRcdFx0XHRfdGhpcy5pbnN0YW5jZSA9IG1vZGVsO1xuXHRcdFx0XHR2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnV29ya2Zsb3cgcHJvY2Vzc2VzIGluc3RhbmNlIGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5LicsIF90aGlzKTtcblx0XHRcdFx0cmVzb2x2ZShzdWNjZXNzKTtcblx0XHRcdH1cblx0XHR9IGNhdGNoIChlcnIpIHtcblx0XHRcdHJlamVjdChlcnIpO1xuXHRcdH1cblx0fSk7XG59O1xuXG4vKipcbiAqIFdvcmtmbG93IGluaXRpYWxpc2UsIHRoaXMgZnVuY3Rpb24gZXhlY3V0ZXMgYSBwcm9jZXNzIHdpdGhpbiBhIHdvcmtmbG93XG4gKiBjb25maWd1cmF0aW9uLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBwcm9jZXNzSWQgLSB0aGUgcHJvY2VzcyBpZCB0byBwcm9jZXNzXG4gKiBAcGFyYW0ge29iamVjdH0gW2RhdGFdIC0gdGhlIGlucHV0IGRhdGEgdG8gcHJvY2Vzc1xuICpcbiAqIEBleGFtcGxlXG4gKiBXb3JrZmxvdy5pbml0aWFsaXplKCdwcm9jZXNzSWQnLCB7IHZhbGlkRGF0ZTogJ2RhdGUnIH0pO1xuICpcbiAqIEByZXR1cm4gXCJcIlxuICpcbiAqL1xuV29ya2Zsb3cucHJvdG90eXBlLmluaXRpYWxpc2UgPSBmdW5jdGlvbihwcm9jZXNzSWQsIGRhdGEpe1xuXHR2YXIgX3RoaXMgPSB0aGlzO1xuXHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG5cdFx0dHJ5IHtcblx0XHRcdHZhciBjb25maWdQcm9jZXNzID0gW107XG5cdFx0XHQvLyBDaGVjayB0aGUgcGFzc2VkIGluIHBhcmFtZXRlcnNcblx0XHRcdGlmIChwcm9jZXNzSWQgIT09ICcnICYmIHByb2Nlc3NJZCAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRcdC8vIEdldCB0aGUgY3VycmVudCBwcm9jZXNzIGNvbmZpZ1xuXHRcdFx0XHRjb25maWdQcm9jZXNzID0gX3RoaXMuY29uZmlnLnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24ob2JqUHJvY2Vzcyl7XG5cdFx0XHRcdFx0aWYgKG9ialByb2Nlc3MuX2lkID09PSBwcm9jZXNzSWQpIHtcblx0XHRcdFx0XHRcdHJldHVybiBvYmpQcm9jZXNzO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHRcdGlmIChjb25maWdQcm9jZXNzWzBdLl9pZCA9PT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRcdFx0dmFyIGVycm9yID0gdXRpbC5lcnJvcignV0ZDb25maWdFcnJvcicsICdObyB2YWxpZCBwcm9jZXNzIGRlZmluaXRpb24gZm91bmQgd2l0aCBwcm9jZXNzIGlkOiAnICsgcHJvY2Vzc0lkKTtcblx0XHRcdFx0XHRyZWplY3QoZXJyb3IpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb25maWdQcm9jZXNzLnB1c2goX3RoaXMuY29uZmlnLnByb2Nlc3Nlc1swXSk7XG5cdFx0XHRcdHByb2Nlc3NJZCA9IF90aGlzLmNvbmZpZy5wcm9jZXNzZXNbMF0uX2lkO1xuXHRcdFx0fVxuXHRcdFx0Ly8gR2V0IHRoZSBjdXJyZW50IGxpc3Qgb2YgcHJvY2VzcyBpbnN0YW5jZXNcblx0XHRcdC8vIHZhciBwcm9jZXNzU2VxID0gMTtcblx0XHRcdHZhciBjdXJyZW50UHJvY2VzcyA9IFtdO1xuXHRcdFx0X3RoaXMuaW5zdGFuY2UucHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihwcm9jZXNzSXRlbSl7XG5cdFx0XHRcdGlmIChwcm9jZXNzSXRlbS5pZCA9PT0gcHJvY2Vzc0lkKSB7XG5cdFx0XHRcdFx0Y3VycmVudFByb2Nlc3MucHVzaChwcm9jZXNzSXRlbSk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdFx0dmFyIHByb2Nlc3NTZXEgPSBjdXJyZW50UHJvY2Vzcy5sZW5ndGggPT09IDAgPyAxIDogY3VycmVudFByb2Nlc3MubGVuZ3RoO1xuXHRcdFx0Ly8gdmFyIG5leHRTZXEgPSBwcm9jZXNzU2VxICsgMTtcblx0XHRcdC8vIFB1c2ggdGhlIHByb2Nlc3Mgb2JqZWN0IGludG8gdGhlIGFycmF5XG5cdFx0XHR2YXIgcHJvY2Vzc01vZGVsID0ge1xuXHRcdFx0XHRpZDogJycsXG5cdFx0XHRcdHNlcTogJycsXG5cdFx0XHRcdHN1YlByb2Nlc3NlczogW11cblx0XHRcdH1cblx0XHRcdC8vIDEuIFVwZGF0ZSB0aGUgcHJvY2VzcyBpZCBhbmQgc2VxXG5cdFx0XHRwcm9jZXNzTW9kZWwuaWQgPSBwcm9jZXNzSWQ7XG5cdFx0XHRwcm9jZXNzTW9kZWwuc2VxID0gcHJvY2Vzc1NlcTtcblx0XHRcdF90aGlzLmluc3RhbmNlLnByb2Nlc3Nlcy5wdXNoKHByb2Nlc3NNb2RlbCk7XG5cdFx0XHQvLyBQYXJhbWV0ZXJzXG5cdFx0XHR2YXIgc3ViUHJvY2Vzc0lkID0gY29uZmlnUHJvY2Vzc1swXS5zdWJQcm9jZXNzZXNbMF0uX2lkO1xuXHRcdFx0dmFyIHN1YlByb2Nlc3NTZXEgPSAxO1xuXHRcdFx0X3RoaXMuaW5zdGFuY2UucHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihwcm9jZXNzSXRlbSl7XG5cdFx0XHRcdGlmIChwcm9jZXNzSXRlbS5pZCA9PT0gcHJvY2Vzc0lkICYmIHByb2Nlc3NJdGVtLnNlcSA9PT0gcHJvY2Vzc1NlcSkgKFxuXHRcdFx0XHRcdHN1YlByb2Nlc3NTZXEgPSBwcm9jZXNzSXRlbS5zdWJQcm9jZXNzZXMubGVuZ3RoICsgMVxuXHRcdFx0XHQpXG5cdFx0XHR9KVxuXHRcdFx0UHJvY2Vzcy5zdWJQcm9jZXNzKHByb2Nlc3NJZCwgcHJvY2Vzc1NlcSwgc3ViUHJvY2Vzc0lkLCBzdWJQcm9jZXNzU2VxLCBkYXRhLCBfdGhpcykudGhlbihmdW5jdGlvbihyZXN1bHQpe1xuXHRcdFx0XHRwcm9jZXNzTW9kZWwuc3ViUHJvY2Vzc2VzLnB1c2gocmVzdWx0LmRhdGEpO1xuXHRcdFx0XHRfdGhpcy5pbnN0YW5jZS5wcm9jZXNzZXMucHVzaChwcm9jZXNzTW9kZWwpO1xuXHRcdFx0XHR2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnUHJvY2VzczogJyArIF90aGlzLmNvbmZpZy5wcm9jZXNzZXNbMF0uX2lkICsgJyBpbml0aWFsaXplZCBzdWNjZXNzZnVsbHkuJywgX3RoaXMpO1xuXHRcdFx0XHRyZXNvbHZlKHN1Y2Nlc3MpO1xuXHRcdFx0fSwgZnVuY3Rpb24oZXJyKXtcblx0XHRcdFx0cmVqZWN0KGVycik7XG5cdFx0XHR9KTtcblx0XHR9IGNhdGNoKGVycikge1xuXHRcdFx0cmVqZWN0KGVycik7XG5cdFx0fVxuXHR9KTtcbn07XG5cbi8qKlxuICogV29ya2Zsb3cgdHJhbnNpdGlvbiB0byB0aGUgbmV4dCBzdGVwLiBUaGlzIG1vdmVzIHRoZSB3b3JrZmxvdyBmcm9tIHRoZSBjdXJyZW50IHByb2Nlc3MsXG4gKiBzdWItcHJvY2VzcyBzdGVwIHRvIHRoZSBuZXh0IG9uZSBhcyBzcGVjaWZpZWQuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHByb2Nlc3NJZCAtIHRoZSBXb3JrZmxvdyBjb25maWcgLyBkZWZpbml0aW9uIHByb2Nlc3MgaWRcbiAqIEBwYXJhbSB7bnVtYmVyfSBwcm9jZXNzU2VxIC0gdGhlIFdvcmtmbG93IGluc3RhbmNlIHByb2Nlc3Mgc2VxXG4gKiBAcGFyYW0ge3N0cmluZ30gc3ViUHJvY2Vzc0lkIC0gdGhlIFdvcmtmbG93IGNvbmZpZyAvIGRlZmluaXRpb24gc3ViLXByb2Nlc3MgaWRcbiAqIEBwYXJhbSB7bnVtYmVyfSBzdWJQcm9jZXNzU2VxIC0gdGhlIFdvcmtmbG93IGluc3RhbmNlIHN1Yi1wcm9jZXNzIHNlcVxuICogQHBhcmFtIHtzdHJpbmd9IHN0ZXBJZCAtIHRoZSBXb3JrZmxvdyBjb25maWcgLyBkZWZpbml0aW9uIHN0ZXAgaWRcbiAqIEBwYXJhbSB7c3RyaW5nfSB0cmFuc2l0aW9uSWQgLSB0aGUgV29ya2Zsb3cgY29uZmlnIC8gZGVmaW5pdGlvbiB0cmFuc2l0aW9uIGlkXG4gKiBAcGFyYW0ge29iamVjdH0gZGF0YSAtIGFueSBhZGRpdGlvbmFsIGRhdGEgcGFzc2VkIGluIGFzIGtleSB2YWx1ZSBwYWlyc1xuICpcbiAqIEBleGFtcGxlXG4gKiBXb3JrZmxvdy50cmFuc2l0aW9uKCdwcm9jZXNzSWQnLCAxLCAnc3ViUHJvY2Vzc0lkJywgMSwgJ3N0ZXBJZCcsICd0cmFuc2l0aW9uSWQnLCB7IGtleTogJycsIHZhbHVlOiAnJyB9KTtcbiAqXG4gKiBAcmV0dXJuIFwiXCJcbiAqXG4gKi9cbldvcmtmbG93LnByb3RvdHlwZS50cmFuc2l0aW9uID0gZnVuY3Rpb24ocHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIHN0ZXBJZCwgdHJhbnNpdGlvbklkLCBkYXRhKXtcblx0Ly8gUmUtYXNzaWduIHRoaXNcblx0dmFyIF90aGlzID0gdGhpcztcblx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuXHRcdHRyeSB7XG5cdFx0XHRQcm9jZXNzLnRyYW5zaXRpb24ocHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIHN0ZXBJZCwgdHJhbnNpdGlvbklkLCBkYXRhLCBfdGhpcykudGhlbihmdW5jdGlvbihyZXN1bHQpe1xuXHRcdFx0XHQvLyBVcGRhdGUgdGhlIGN1cnJlbnQgc3ViLXByb2Nlc3Mgc3RlcCBkYXRhXG5cdFx0XHRcdHZhciB1cGRhdGUgPSBmdW5jdGlvbih0eXBlKXtcblx0XHRcdFx0XHRfdGhpcy5pbnN0YW5jZS5wcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKHByb2Nlc3NJdGVtKXtcblx0XHRcdFx0XHRcdGlmIChwcm9jZXNzSXRlbS5pZCA9PT0gcHJvY2Vzc0lkICYmIHByb2Nlc3NJdGVtLnNlcSA9PT0gcHJvY2Vzc1NlcSkge1xuXHRcdFx0XHRcdFx0XHRwcm9jZXNzSXRlbS5zdWJQcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKHN1YlByb2Nlc3NJdGVtKXtcblx0XHRcdFx0XHRcdFx0XHRpZiAoc3ViUHJvY2Vzc0l0ZW0uaWQgPT09IHN1YlByb2Nlc3NJZCAmJiBzdWJQcm9jZXNzSXRlbS5zZXEgPT09IHN1YlByb2Nlc3NTZXEpIHtcblx0XHRcdFx0XHRcdFx0XHRcdGlmICh0eXBlID09PSAnc3RlcCcpIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0c3ViUHJvY2Vzc0l0ZW0uc3RlcCA9IHJlc3VsdC5kYXRhO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcyhyZXN1bHQubWVzc2FnZSwgc3ViUHJvY2Vzc0l0ZW0pO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRyZXNvbHZlKHN1Y2Nlc3MpO1xuXHRcdFx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmICh0eXBlID09PSAnc3RlcENvbXBsZXRlJykge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRzdWJQcm9jZXNzSXRlbS5zdGVwID0gcmVzdWx0LmRhdGEuc3RlcDtcblx0XHRcdFx0XHRcdFx0XHRcdFx0c3ViUHJvY2Vzc0l0ZW0uY29tcGxldGUgPSB0cnVlXG5cdFx0XHRcdFx0XHRcdFx0XHRcdHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKHJlc3VsdC5tZXNzYWdlLCBzdWJQcm9jZXNzSXRlbSk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdHJlc29sdmUoc3VjY2Vzcyk7XG5cdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR9KVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pXG5cdFx0XHRcdH1cblx0XHRcdFx0aWYgKHJlc3VsdC5kYXRhLnN1YlByb2Nlc3NDb21wbGV0ZSkge1xuXHRcdFx0XHRcdHVwZGF0ZSgnc3RlcENvbXBsZXRlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dXBkYXRlKCdzdGVwJyk7XG5cdFx0XHRcdH1cblx0XHRcdH0sIGZ1bmN0aW9uKGVycil7XG5cdFx0XHRcdHJlamVjdChlcnIpO1xuXHRcdFx0fSk7XG5cdFx0fSBjYXRjaChlcnIpIHtcblx0XHRcdHJlamVjdChlcnIpO1xuXHRcdH1cblx0fSk7XG59O1xuXG4vKipcbiAqIFdvcmtmbG93IHRhc2ssIHRoaXMgbWV0aG9kIGV4ZWN1dGVzIGEgc3BlY2lmaWMgdGFzay5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gcHJvY2Vzc0lkIC0gdGhlIHByb2Nlc3MgaWQgdG8gcHJvY2Vzc1xuICogQHBhcmFtIHtvYmplY3R9IGlucHV0RGF0YSAtIHRoZSBpbnB1dCBkYXRhIHRvIHByb2Nlc3NcbiAqXG4gKiBAZXhhbXBsZVxuICogV29ya2Zsb3cuaW5pdGlhbGl6ZSgncHJvY2Vzc0lkJywgeyB2YWxpZERhdGU6ICdkYXRlJyB9KTtcbiAqXG4gKiBAcmV0dXJuIFwiXCJcbiAqXG4gKi9cbldvcmtmbG93LnByb3RvdHlwZS5ydW5UYXNrID0gZnVuY3Rpb24odHlwZSwgcGFyYW1zKXtcblx0Ly8gUmUtYXNzaWduIHRoZSBXb3JrZmxvdyBjb25zdHJ1Y3RvciBpbnN0YW5jZSBhcyBfdGhpc1xuXHR2YXIgX3RoaXMgPSB0aGlzO1xuXHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG5cdFx0dHJ5IHtcblx0XHRcdHJlc29sdmUoJ1N1Y2Nlc3MnKTtcblx0XHR9IGNhdGNoKGVycikge1xuXHRcdFx0cmVqZWN0KGVycik7XG5cdFx0fVxuXHR9KTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gV29ya2Zsb3c7XG4iLCIndXNlIHN0cmljdCc7XG5cbnZhciB1dGlsID0gcmVxdWlyZSgnLi91dGlsaXR5Jyk7XG5cbi8qKlxuICogRm9ybSBNb2R1bGVcbiAqXG4gKiBAbW9kdWxlIGxpYi9mb3JtXG4gKiBAYXV0aG9yIEJyZW50IEdvcmRvblxuICogQHZlcnNpb24gMi4wLjBcbiAqIEBkZXNjcmlwdGlvbiB0ZXN0IGRlc2NyaXB0aW9uXG4gKiBAY29weXJpZ2h0IEt3YW50dSBMdGQgUlNBIDIwMDktMjAxNS5cbiAqXG4gKi9cblxuZnVuY3Rpb24gY3JlYXRlKGFyZ3Mpe1xuXHR2YXIgaW5kaWNhdG9ycyA9IGFyZ3NbMF0gfHwgW107XG5cdHZhciBfV0ZJbnN0YW5jZSA9IGFyZ3NbMV0gfHwge307XG5cdHZhciByZXN1bHQgPSBbXTtcblx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuXHRcdC8vIHV0aWwuc3luY0xvb3AoaW5kaWNhdG9ycy5sZW5ndGgsIGZ1bmN0aW9uKGxvb3Ape1xuXHRcdC8vIFx0dmFyIGNvdW50ZXIgPSBsb29wLml0ZXJhdGlvbigpO1xuXHRcdC8vIFx0dmFyIGluZGljYXRvcklkID0gaW5kaWNhdG9yc1tjb3VudGVyXS5faWQ7XG5cdFx0Ly8gXHR2YXIgaW5kaWNhdG9yTmFtZSA9IGluZGljYXRvcnNbY291bnRlcl0ubmFtZS5pMThuLnZhbHVlO1xuXHRcdC8vIFx0Ly8gQ29tbWVudCBvdXQgZm9yIHRlc3Rpbmdcblx0XHQvLyBcdC8vIHZhciBpbmRpY2F0b3IgPSB7fTtcblx0XHQvLyBcdC8vIGxpYnJhcnkuY3JlYXRlSW5kaWNhdG9ySW5zdGFuY2UoaW5kaWNhdG9ySWQsIF9XRkluc3RhbmNlLnByb2ZpbGUpLmRvbmUoZnVuY3Rpb24oZGF0YSl7XG5cdFx0Ly8gXHQvLyBcdGluZGljYXRvciA9IGRhdGE7XG5cdFx0Ly8gXHQvLyBcdGluZGljYXRvcnMucHVzaChpbmRpY2F0b3IpO1xuXHRcdC8vIFx0Ly8gXHRsb29wLm5leHQoKTtcblx0XHQvLyBcdC8vIH0pLmZhaWwoZnVuY3Rpb24oZXJyKXtcblx0XHQvLyBcdC8vIFx0Y29uc29sZS5sb2coZXJyKTtcblx0XHQvLyBcdC8vIH0pO1xuXHRcdC8vIFx0Ly8gVE9ETzogUmVwbGFjZSB3aXRoIHRoZSBnYXRla2VlcGVyIGNhbGwgYW5kIHJldHVybiB0aGUgb2JqZWN0XG5cdFx0Ly8gXHR2YXIgdXVpZCA9IF9XRkluc3RhbmNlLnByb2ZpbGUgKyAnOicgKyBfV0ZJbnN0YW5jZS5hcHAgKyAnOicgKyBpbmRpY2F0b3JJZCArICc6MCc7XG5cdFx0Ly8gXHR2YXIgaW5kaWNhdG9yID0ge1xuXHRcdC8vIFx0XHRfaWQ6IHV1aWQsXG5cdFx0Ly8gXHRcdGNhdGVnb3J5OiB7XG5cdFx0Ly8gXHRcdFx0dGVybTogaW5kaWNhdG9ySWQsXG5cdFx0Ly8gXHRcdFx0bGFiZWw6IGluZGljYXRvck5hbWVcblx0XHQvLyBcdFx0fSxcblx0XHQvLyBcdFx0cHJvY2Vzc2VzOiBbXVxuXHRcdC8vIFx0fTtcblx0XHQvLyBcdHJlc3VsdC5wdXNoKGluZGljYXRvcik7XG5cdFx0Ly8gXHRsb29wLm5leHQoKTtcblx0XHQvLyB9LCBmdW5jdGlvbigpe1xuXHRcdC8vICAgICAvLyBjb25zb2xlLmxvZygnZG9uZScpO1xuXHRcdC8vICAgICB2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnRm9ybSBjcmVhdGVkIHN1Y2Nlc3NmdWxseS4nLCByZXN1bHQpO1xuXHRcdC8vIFx0XHRyZXNvbHZlKHN1Y2Nlc3MpO1xuXHRcdC8vIH0pO1xuXHRcdHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdGb3JtIGluZGljYXRvciBzZXQgc2F2ZWQgc3VjY2Vzc2Z1bGx5LicsIHJlc3VsdCk7XG5cdFx0cmVzb2x2ZShzdWNjZXNzKTtcblx0fSk7XG59O1xuXG5mdW5jdGlvbiBzYXZlKGluZGljYXRvcil7XG5cdHZhciBjb21wbGV0ZWQgPSBbXTtcblx0dmFyIHJlc3VsdCA9IHtcblx0XHRjb21wbGV0ZTogdHJ1ZSxcblx0XHRkYXRhOiBbXVxuXHR9O1xuXHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG5cdFx0dmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ0Zvcm0gaW5kaWNhdG9yIHNldCBzYXZlZCBzdWNjZXNzZnVsbHkuJywgcmVzdWx0KTtcblx0XHRyZXNvbHZlKHN1Y2Nlc3MpO1xuXHR9KTtcbn07XG5cbmZ1bmN0aW9uIHN1Ym1pdChmb3JtKXtcblx0dmFyIGNvbXBsZXRlZCA9IFtdO1xuXHR2YXIgcmVzdWx0ID0ge1xuXHRcdGNvbXBsZXRlOiB0cnVlLFxuXHRcdGRhdGE6IFtdXG5cdH07XG5cdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcblx0XHR2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnRm9ybSBzdWJtaXR0ZWQgc3VjY2Vzc2Z1bGx5LicsIHJlc3VsdCk7XG5cdFx0cmVzb2x2ZShzdWNjZXNzKTtcblx0fSk7XG59O1xuXG5mdW5jdGlvbiBhdXRob3Jpc2UoZm9ybSl7XG5cdHZhciBjb21wbGV0ZWQgPSBbXTtcblx0dmFyIHJlc3VsdCA9IHtcblx0XHRjb21wbGV0ZTogdHJ1ZSxcblx0XHRkYXRhOiBbXVxuXHR9O1xuXHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG5cdFx0dmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ0Zvcm0gYXV0aG9yaXNlZCBzdWNjZXNzZnVsbHkuJywgcmVzdWx0KTtcblx0XHRyZXNvbHZlKHN1Y2Nlc3MpO1xuXHR9KTtcbn07XG5cbmZ1bmN0aW9uIGNsb3NlKGZvcm0pe1xuXHR2YXIgY29tcGxldGVkID0gW107XG5cdHZhciByZXN1bHQgPSB7XG5cdFx0Y29tcGxldGU6IHRydWUsXG5cdFx0ZGF0YTogW11cblx0fTtcblx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuXHRcdHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdGb3JtIGNsb3NlZCBzdWNjZXNzZnVsbHkuJywgcmVzdWx0KTtcblx0XHRyZXNvbHZlKHN1Y2Nlc3MpO1xuXHR9KTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuXG4gXHRjcmVhdGU6IGNyZWF0ZSxcbiBcdHNhdmU6IHNhdmUsXG4gXHRzdWJtaXQ6IHN1Ym1pdCxcbiBcdGF1dGhvcmlzZTogYXV0aG9yaXNlLFxuIFx0Y2xvc2U6IGNsb3NlXG5cbn1cbiIsIid1c2Ugc3RyaWN0JztcblxudmFyIHV0aWwgPSByZXF1aXJlKCcuL3V0aWxpdHknKTtcbnZhciBmb3JtID0gcmVxdWlyZSgnLi9mb3JtJyk7XG5cbi8qKlxuICogUHJvY2VzcyBNb2R1bGVcbiAqXG4gKiBAbW9kdWxlIGxpYi9wcm9jZXNzXG4gKiBAYXV0aG9yIEJyZW50IEdvcmRvblxuICogQHZlcnNpb24gMC4xLjBcbiAqIEBkZXNjcmlwdGlvbiB0ZXN0IGRlc2NyaXB0aW9uXG4gKlxuICovXG5cbi8qKlxuICogUHJvY2VzcyBwcmUtcmVxdWlzaXRlc1xuICpcbiAqIEBwYXJhbSB7b2JqZWN0fSBwcmVyZXF1aXNpdGVzIC0gdGhlIHByZS1yZXF1aXNpdGVzIGNvbmZpZyBkYXRhXG4gKlxuICogQGV4YW1wbGUgJydcbiAqXG4gKiBAcmV0dXJuICcnXG4gKlxuICovXG5mdW5jdGlvbiBwcmVSZXF1aXNpdGVzKHByZXJlcXVpc2l0ZXMpIHtcblx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuXHRcdC8vIFVuY29tbWVudCBiZWxvdyBzZWN0aW9uIHdoZW4gcmVhZHkgdG8gaW1wbGVtZW50XG5cdFx0Ly8gdXRpbC5zeW5jTG9vcChwcmVyZXF1aXNpdGVzLmxlbmd0aCwgZnVuY3Rpb24obG9vcCl7XG5cdFx0Ly8gXHR2YXIgY291bnRlciA9IGxvb3AuaXRlcmF0aW9uKCk7XG5cdFx0Ly8gXHRwcmVSZXF1aXNpdGUocHJlcmVxdWlzaXRlc1tjb3VudGVyXSwgY291bnRlcikudGhlbihmdW5jdGlvbihkYXRhKXtcblx0XHQvLyBcdFx0Ly8gQ2hlY2sgaWYgYWxsIHByZS1yZXF1aXNpdGVzIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkuXG5cdFx0Ly8gXHRcdGNvbXBsZXRlZC5wdXNoKGRhdGEuY29tcGxldGUpO1xuXHRcdC8vIFx0XHRyZXN1bHQuZGF0YS5wdXNoKGRhdGEpO1xuXHRcdC8vIFx0XHRpZiAoY29tcGxldGVkLmV2ZXJ5KEJvb2xlYW4pKSB7XG5cdFx0Ly8gXHRcdFx0cmVzdWx0LmNvbXBsZXRlZCA9IHRydWU7XG5cdFx0Ly8gXHRcdFx0bG9vcC5uZXh0KCk7XG5cdFx0Ly8gXHRcdFx0dmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ1ByZS1yZXF1aXNpdGVzIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkuJywgcmVzdWx0KTtcblx0XHQvLyBcdFx0XHRkZWZlcnJlZC5yZXNvbHZlKHN1Y2Nlc3MpO1xuXHRcdC8vIFx0XHR9IGVsc2Uge1xuXHRcdC8vIFx0XHRcdGxvb3AuYnJlYWsoKTtcblx0XHQvLyBcdFx0XHR2YXIgZXJyb3IgPSB1dGlsLmVycm9yKCdXRjAwNycpO1xuXHRcdC8vIFx0XHRcdGRlZmVycmVkLnJlamVjdChlcnJvcik7XG5cdFx0Ly8gXHRcdH1cblx0XHQvLyBcdH0sIGZ1bmN0aW9uKGVycil7XG5cdFx0Ly8gXHRcdGxvb3AuYnJlYWsoKTtcblx0XHQvLyBcdFx0ZGVmZXJyZWQucmVqZWN0KGVycik7XG5cdFx0Ly8gXHR9KTtcblx0XHQvLyB9KTtcblx0XHR2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnUHJlLXJlcXVpc2l0ZXMgY29tcGxldGVkIHN1Y2Nlc3NmdWxseS4nLCB7fSk7XG5cdFx0cmVzb2x2ZShzdWNjZXNzKTtcblx0fSk7XG59O1xuXG4vKipcbiAqIFByb2Nlc3MgcHJlLXJlcXVpc2l0ZSwgZXhlY3V0ZSB0aGUgcHJlLXJlcXVpc2l0ZSBjb25kaXRpb24uXG4gKlxuICogQHBhcmFtIHtvYmplY3R9IHByZXJlcXVpc2l0ZSAtIHRoZSBwcmUtcmVxdWlzaXRlIGNvbmZpZyBkYXRhXG4gKiBAcGFyYW0ge251bWJlcn0gY291bnRlciAtIHRoZSBwcmUtcmVxdWlzaXRlIGNvdW50IC8gbnVtYmVyXG4gKiBAcGFyYW0ge29iamVjdH0gX1dGSW5zdGFuY2UgLSB0aGUgd29ya2Zsb3cgY29uc3RydWN0b3IgaW5zdGFuY2VcbiAqXG4gKiBAZXhhbXBsZVxuICogdmFyIGNvbmZpZyA9IHtcbiAqXHQgICAgXCJfc2VxXCI6IFwiXCIsXG4gKlx0ICAgIFwiX3R5cGVcIjogXCJcIixcbiAqXHRcdFwiX3N1YmplY3RcIjogXCJcIixcbiAqXHQgICAgXCJfb3BlcmF0b3JcIjogXCJcIixcbiAqXHQgICAgXCJfdmFsdWVcIjogXCJcIixcbiAqXHQgICAgXCJfcmVmZXJlbmNlXCI6IFwiXCIsXG4gKlx0ICAgIFwibWVzc2FnZVwiOiB7XG4gKlx0ICAgIFx0XCJpMThuXCI6IHtcbiAqXHQgICAgXHRcdFwiX2xhbmdcIjogXCJlblwiLFxuICpcdCAgICBcdFx0XCJ2YWx1ZVwiOiBcIlwiXG4gKlx0ICAgIFx0fVxuICpcdCAgICB9XG4gKlx0fTtcbiAqIFByb2Nlc3MucHJlUmVxdWlzaXRlKGNvbmZpZywgY291bnRlciwgaW5zdGFuY2UsIGRvYyk7XG4gKlxuICogQHJldHVybiAnJ1xuICpcbiAqL1xuZnVuY3Rpb24gcHJlUmVxdWlzaXRlKHByZXJlcXVpc2l0ZSwgY291bnRlciwgX1dGSW5zdGFuY2Upe1xuXHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG5cdFx0c3dpdGNoKHByZXJlcXVpc2l0ZS5fdHlwZSkge1xuXHRcdFx0Ly8gVE9ETzogQWRkIHRoZSBjYWxsIHRvIHRoZSByZWxldmFudCBtZXRob2RzIGJhc2VkIG9uIHRoZSBfdHlwZSBhdHRyaWJ1dGUuIFNob3VsZCBjYWxsIHRoZSBnZW5lcmljIGFjdGlvbigpIG1ldGhvZC5cblx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdHZhciBlcnJvciA9IHV0aWwuZXJyb3IoJ1dGUHJlUmVxdWlzaXRlRXJyb3InLCdQcmUtcmVxdWlzaXRlIHR5cGU6ICcgKyBwcmVyZXF1aXNpdGUuX3R5cGUgKyAnIG5vdCBkZWZpbmVkLicpO1xuXHRcdFx0XHRyZWplY3QoZXJyb3IpO1xuXHRcdH1cblx0fSk7XG59O1xuXG4vKipcbiAqIFByb2Nlc3MgcHJlLWFjdGlvbnNzXG4gKlxuICogQHBhcmFtIHtvYmplY3R9IHByZUFjdGlvbnMgLSB0aGUgcHJlLWFjdGlvbnMgY29uZmlnIGRhdGFcbiAqIEBwYXJhbSB7b2JqZWN0fSBfV0ZJbnN0YW5jZSAtIHRoZSBjdXJyZW50IHdvcmtmbG93IGNvbnN0cnVjdG9yIGluc3RhbmNlXG4gKlxuICogQGV4YW1wbGUgJydcbiAqXG4gKiBAcmV0dXJuICcnXG4gKlxuICovXG5mdW5jdGlvbiBwcmVBY3Rpb25zKHByZUFjdGlvbnMsIF9XRkluc3RhbmNlKXtcblx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuXHRcdC8vIEFkZCBmdW5jdGlvbiBsb2dpYyBoZXJlLi4uXG5cblx0XHR2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnUHJlLWFjdGlvbnMgY29tcGxldGVkIHN1Y2Nlc3NmdWxseS4nLCB7fSk7XG5cdFx0cmVzb2x2ZShzdWNjZXNzKTtcblx0fSk7XG59O1xuXG4vKipcbiAqIFByb2Nlc3Mgc3ViLXByb2Nlc3NcbiAqXG4gKiBAcGFyYW0ge29iamVjdH0gcHJvY2VzcyAtIHRoZSBjdXJyZW50IHByb2Nlc3MgaWQgYW5kIHNlcVxuICogQHBhcmFtIHtvYmplY3R9IHN1YlByb2Nlc3MgLSB0aGUgc3ViLXByb2Nlc3MgaWQgYW5kIHNlcVxuICogQHBhcmFtIHtvYmplY3R9IGRhdGEgLSB0aGUgdXNlciBpbnB1dCBkYXRhXG4gKiBAcGFyYW0ge29iamVjdH0gX1dGSW5zdGFuY2UgLSB0aGUgY3VycmVudCB3b3JrZmxvdyBjb25zdHJ1Y3RvciBpbnN0YW5jZVxuICpcbiAqIEBleGFtcGxlICcnXG4gKlxuICogQHJldHVybiAnJ1xuICpcbiAqL1xuZnVuY3Rpb24gc3ViUHJvY2Vzcyhwcm9jZXNzSWQsIHByb2Nlc3NTZXEsIHN1YlByb2Nlc3NJZCwgc3ViUHJvY2Vzc1NlcSwgZGF0YSwgX1dGSW5zdGFuY2Upe1xuXHQvLyBHZXQgdGhlIGN1cnJlbnQgcHJvY2VzcyBzdWJQcm9jZXNzIGluc3RhbmNlXG5cdC8vIHZhciBzdWJQcm9jZXNzU2VxID0gMTtcblx0dmFyIHN1YlByb2Nlc3MgPSBbXTtcblx0dmFyIHN1YlByb2Nlc3NDb25mID0gW107XG5cdF9XRkluc3RhbmNlLmluc3RhbmNlLnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24ob2JqUHJvY2Vzcyl7XG5cdFx0aWYgKG9ialByb2Nlc3MuaWQgPT09IHByb2Nlc3NJZCAmJiBvYmpQcm9jZXNzLnNlcSA9PT0gcHJvY2Vzc1NlcSkge1xuXHRcdFx0dmFyIHNwTGVuZ3RoID0gb2JqUHJvY2Vzcy5zdWJQcm9jZXNzZXMubGVuZ3RoO1xuXHRcdFx0b2JqUHJvY2Vzcy5zdWJQcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKG9ialN1YlByb2Nlc3Mpe1xuXHRcdFx0XHRpZiAob2JqU3ViUHJvY2Vzcy5pZCA9PT0gc3ViUHJvY2Vzc0lkICYmIG9ialN1YlByb2Nlc3Muc2VxID09PSBzdWJQcm9jZXNzU2VxKSB7XG5cdFx0XHRcdFx0c3ViUHJvY2VzcyA9IG9ialN1YlByb2Nlc3M7XG5cdFx0XHRcdH1cblx0XHRcdH0pXG5cdFx0fVxuXHR9KVxuXHQvLyBHZXQgdGhlIGN1cnJlbnQgc3ViUHJvY2VzcyBjb25maWd1cmF0aW9uXG5cdF9XRkluc3RhbmNlLmNvbmZpZy5wcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKHByb2Nlc3NDb25maWcpe1xuXHRcdGlmIChwcm9jZXNzQ29uZmlnLl9pZCA9PT0gcHJvY2Vzc0lkKSB7XG5cdFx0XHR2YXIgcmVzdWx0ID0gW107XG5cdFx0XHRwcm9jZXNzQ29uZmlnLnN1YlByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24oc3ViUHJvY2Vzc0NvbmZpZyl7XG5cdFx0XHRcdGlmIChzdWJQcm9jZXNzQ29uZmlnLl9pZCA9PT0gc3ViUHJvY2Vzc0lkKSB7XG5cdFx0XHRcdFx0c3ViUHJvY2Vzc0NvbmYgPSBzdWJQcm9jZXNzQ29uZmlnO1xuXHRcdFx0XHR9XG5cdFx0XHR9KVxuXHRcdH1cblx0fSlcblx0Ly8gaWYgKHN1YlByb2Nlc3MubGVuZ3RoICE9PSAwKSB7XG5cdC8vIFx0c3ViUHJvY2Vzc1NlcSA9IHN1YlByb2Nlc3MubGVuZ3RoICsgMTtcblx0Ly8gfVxuXHQvLyBUaGUgZGVmYXVsdCBzdWJQcm9jZXNzIG1vZGVsXG5cdHZhciBtb2RlbCA9IHtcblx0XHRpZDogc3ViUHJvY2Vzc0lkLFxuXHRcdHNlcTogc3ViUHJvY2Vzc1NlcSxcblx0XHRpbml0aWF0ZWQ6IGZhbHNlLFxuXHRcdGRhdGVzOiB7XG5cdFx0XHRjcmVhdGVkOiAnJyxcblx0XHRcdHZhbGlkOiAnJyxcblx0XHRcdGR1ZTogJycsXG5cdFx0XHRjbG9zZWQ6ICcnXG5cdFx0fSxcblx0XHRjb21wbGV0ZTogZmFsc2UsXG5cdFx0aW5kaWNhdG9yczogW10sXG5cdFx0c3RlcDoge31cblx0fTtcblx0Ly8gUmV0dXJuIGEgcHJvbWlzZVxuXHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG5cdFx0Ly8gQ2F0Y2ggYWxsIHVuY2F1Z2h0IGVycm9yc1xuXHRcdHRyeSB7XG5cdFx0XHQvLyAxLiBJbml0aWF0ZSB0aGUgc3ViUHJvY2Vzc1xuXHRcdFx0dmFyIGluaXRpYXRlQ29uZiA9IHN1YlByb2Nlc3NDb25mLmluaXRpYXRlO1xuXHRcdFx0Ly8gY29uc29sZS5sb2coc3ViUHJvY2Vzcyk7XG5cdFx0XHRpbml0aWF0ZShpbml0aWF0ZUNvbmYsIHN1YlByb2Nlc3MsIGRhdGEpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KXtcblx0XHRcdFx0Ly9VcGRhdGUgdGhlIHN1YlByb2Nlc3MgbW9kZWxcblx0XHRcdFx0bW9kZWwuaW5pdGlhdGVkID0gcmVzdWx0LmRhdGEuaW5pdGlhdGVkO1xuXHRcdFx0XHRtb2RlbC5kYXRlcyA9IHJlc3VsdC5kYXRhLmRhdGVzO1xuXHRcdFx0XHQvLyBFeGVjdXRlIHRoZSBmaXJzdCBzdGVwXG5cdFx0XHRcdHZhciBzdGVwSWQgPSBzdWJQcm9jZXNzQ29uZi5zdGVwc1swXS5faWQ7XG5cdFx0XHRcdHZhciB0cmFuc2l0aW9uSWQgPSBzdWJQcm9jZXNzQ29uZi5zdGVwc1swXS50cmFuc2l0aW9uc1swXS5faWQ7XG5cdFx0XHRcdHZhciBzdGVwU2VxID0gMTtcblx0XHRcdFx0c3RlcChwcm9jZXNzSWQsIHN1YlByb2Nlc3NJZCwgc3RlcElkLCBzdGVwU2VxLCBkYXRhLCBfV0ZJbnN0YW5jZSkudGhlbihmdW5jdGlvbihyZXN1bHQpe1xuXHRcdFx0XHRcdG1vZGVsLnN0ZXAgPSByZXN1bHQuZGF0YTtcblx0XHRcdFx0XHQvLyBFeGVjdXRlIHRoZSB0cmFuc2l0aW9ucywgaWYgYXV0b1xuXHRcdFx0XHRcdHRyYW5zaXRpb24ocHJvY2Vzc0lkLCBwcm9jZXNzU2VxLCBzdWJQcm9jZXNzSWQsIHN1YlByb2Nlc3NTZXEsIHN0ZXBJZCwgdHJhbnNpdGlvbklkLCBkYXRhLCBfV0ZJbnN0YW5jZSkudGhlbihmdW5jdGlvbihyZXN1bHQpe1xuXHRcdFx0XHRcdFx0Ly8gVXBkYXRlIHRoZSBzdWJQcm9jZXNzIHN0ZXAgZGF0YVxuXHRcdFx0XHRcdFx0bW9kZWwuc3RlcCA9IHJlc3VsdC5kYXRhO1xuXHQgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MocmVzdWx0Lm1lc3NhZ2UsIG1vZGVsKTtcblx0ICAgICAgICAgIHJlc29sdmUoc3VjY2Vzcyk7XG5cdCAgICAgICAgfSwgZnVuY3Rpb24oZXJyKXtcblx0ICAgICAgICAgIHJlamVjdChlcnIpO1xuXHQgICAgICAgIH0pO1xuXHRcdFx0XHR9LCBmdW5jdGlvbihlcnIpe1xuXHRcdFx0XHRcdHJlamVjdChlcnIpO1xuXHRcdFx0XHR9KVxuXHRcdFx0fSwgZnVuY3Rpb24oZXJyKXtcblx0XHRcdFx0cmVqZWN0KGVycik7XG5cdFx0XHR9KVxuXHRcdH0gY2F0Y2goZXJyKXtcblx0XHRcdHJlamVjdChlcnIpO1xuXHRcdH1cblx0fSk7XG59O1xuXG4vKipcbiAqIFByb2Nlc3MgaW5pdGlhdGVcbiAqXG4gKiBAcGFyYW0ge29iamVjdH0gaW5pdGlhdGUgLSB0aGUgaW5pdGlhdGUgY29uZmlnIGRhdGFcbiAqIEBwYXJhbSB7b2JqZWN0fSBkYXRhIC0gdGhlIHVzZXIgaW5wdXQgZGF0YVxuICpcbiAqIEBleGFtcGxlICcnXG4gKlxuICogQHJldHVybiAnJ1xuICpcbiAqL1xuZnVuY3Rpb24gaW5pdGlhdGUoaW5pdGlhdGUsIHN1YlByb2Nlc3MsIGRhdGEpe1xuXHR2YXIgY29tcGxldGVkID0gW107XG5cdHZhciByZXN1bHQgPSB7XG5cdFx0aW5pdGlhdGVkOiBmYWxzZSxcblx0XHRkYXRlczoge1xuXHRcdFx0Y3JlYXRlZDogJycsXG5cdFx0XHR2YWxpZDogJycsXG5cdFx0XHRkdWU6ICcnLFxuXHRcdFx0Y2xvc2VkOiAnJ1xuXHRcdH1cblx0fTtcblx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuXHRcdHZhciBpbml0ID0gZnVuY3Rpb24oKXtcblx0XHRcdHN3aXRjaChpbml0aWF0ZS5fdHlwZSkge1xuXHRcdFx0XHRjYXNlICd1c2VyJzpcblx0XHRcdFx0XHQvLyBJZiB0aGUgc3ViUHJvY2VzcyBpbml0aWF0aW9uIGlzIHVzZXIgZGVmaW5lZCB0aGVuXG5cdFx0XHRcdFx0cmVzdWx0LmRhdGVzLmNyZWF0ZWQgPSBkYXRhLmNyZWF0ZWREYXRlO1xuXHRcdFx0XHRcdGlmIChpbml0aWF0ZS5kYXRlcy52YWxpZC5fdHlwZSA9PT0gJ3VzZXJTZWxlY3RlZCcpIHtcblx0XHRcdFx0XHRcdGlmIChkYXRhLnZhbGlkRGF0ZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRcdFx0XHRcdHJlc3VsdC5kYXRlcy52YWxpZCA9IGRhdGEudmFsaWREYXRlO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0dmFyIGVycm9yID0gdXRpbC5lcnJvcignV0ZJbml0aWF0ZUVycm9yJywgJ05vIHZhbGlkIGRhdGUgcGFzc2VkIGluIC0ge2lucHV0RGF0YS52YWxpZERhdGV9Jyk7XG5cdFx0XHRcdFx0XHRcdHJlamVjdChlcnJvcik7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmIChpbml0aWF0ZS5kYXRlcy5kdWUuX3R5cGUgPT09ICd1c2VyU2VsZWN0ZWQnKSB7XG5cdFx0XHRcdFx0XHRpZiAoZGF0YS5kdWVEYXRlICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdFx0XHRcdFx0cmVzdWx0LmRhdGVzLmR1ZSA9IGRhdGEuZHVlRGF0ZTtcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdHZhciBlcnJvciA9IHV0aWwuZXJyb3IoJ1dGSW5pdGlhdGVFcnJvcicsICdObyBkdWUgZGF0ZSBwYXNzZWQgaW4gLSB7aW5wdXREYXRhLmR1ZURhdGV9Jyk7XG5cdFx0XHRcdFx0XHRcdHJlamVjdChlcnJvcik7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJlc3VsdC5pbml0aWF0ZWQgPSB0cnVlO1xuXHRcdFx0XHRcdHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdTdWItUHJvY2VzcyBpbml0aWF0ZSBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5LicsIHJlc3VsdCk7XG5cdFx0XHRcdFx0cmVzb2x2ZShzdWNjZXNzKTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0XHR2YXIgZXJyb3IgPSB1dGlsLmVycm9yKCdXRkluaXRpYXRlRXJyb3InLCAnSW5pdGlhdGUgdHlwZTogJyArIGluaXRpYXRlLl90eXBlICsgJyBub3QgZGVmaW5lZC4nKTtcblx0XHRcdFx0XHRyZWplY3QoZXJyb3IpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZiAoc3ViUHJvY2Vzcy5jb21wbGV0ZSA9PT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRpbml0KCk7XG5cdFx0fSBlbHNlIGlmICghc3ViUHJvY2Vzcy5jb21wbGV0ZSkge1xuXHRcdFx0aWYgKGluaXRpYXRlLnBhcmFsbGVsSW5zdGFuY2VzKSB7XG5cdFx0XHRcdGluaXQoKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHZhciBlcnJvciA9IHV0aWwuZXJyb3IoJ1dGSW5pdGlhdGVFcnJvcicsICdTdWItcHJvY2VzczogJyArIHN1YlByb2Nlc3MuaWQgKyAnIHN0aWxsIGFjdGl2ZSBhbmQgcGFyYWxsZWwgaW5zdGFuY2VzIGFyZSBub3QgYWxsb3dlZC4nKTtcblx0XHRcdFx0cmVqZWN0KGVycm9yKTtcblx0XHRcdH1cblx0XHR9XG5cdH0pO1xufTtcblxuLyoqXG4gKiBQcm9jZXNzIHN0ZXBcbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gcHJvY2Vzc0lkIC0gdGhlIGN1cnJlbnQgcHJvY2VzcyBpZFxuICogQHBhcmFtIHtzdHJpbmd9IHN1YlByb2Nlc3NJZCAtIHRoZSBjdXJyZW50IHN1Yi1wcm9jZXNzIGlkXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RlcElkIC0gdGhlIGN1cnJlbnQgc3ViLXByb2Nlc3Mgc3RlcCBpZFxuICogQHBhcmFtIHtudW1iZXJ9IHN0ZXBTZXEgLSB0aGUgY3VycmVudCBzdWItcHJvY2VzcyBzdGVwIGluc3RhbmNlIGNvdW50ZXIgLyBzZXF1ZW5jZVxuICogQHBhcmFtIHtvYmplY3R9IGlucHV0RGF0YSAtIHRoZSB1c2VyIGlucHV0IGRhdGFcbiAqIEBwYXJhbSB7b2JqZWN0fSBfV0ZJbnN0YW5jZSAtIHRoZSBjdXJyZW50IF9XRkluc3RhbmNlIGNvbnN0cnVjdG9yIGluc3RhbmNlXG4gKlxuICogQGV4YW1wbGUgJydcbiAqXG4gKiBAcmV0dXJuICcnXG4gKlxuICovXG5mdW5jdGlvbiBzdGVwKHByb2Nlc3NJZCwgc3ViUHJvY2Vzc0lkLCBzdGVwSWQsIHN0ZXBTZXEsIGlucHV0RGF0YSwgX1dGSW5zdGFuY2Upe1xuXHQvLyBEZWZhdWx0IHN0ZXAgbW9kZWxcblx0dmFyIG1vZGVsID0ge1xuXHRcdGlkOiAnJyxcblx0XHRzZXE6ICcnLFxuXHRcdHN0YXR1czogJycsXG5cdFx0bWVzc2FnZTogJycsXG5cdFx0YXNzaWduZWRUbzoge1xuXHRcdFx0dXNlcklkOiAnJyxcblx0XHRcdG5hbWU6ICcnXG5cdFx0fSxcblx0XHRjb21tZW50OiAnJ1xuXHR9O1xuXHR2YXIgc3ViUHJvY2VzcyA9IHt9O1xuXHR2YXIgc3RlcCA9IHt9O1xuXHR2YXIgdHJhbnNpdGlvbklkID0gJyc7XG5cdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcblx0XHR0cnkge1xuXHRcdFx0Ly8gR2V0IHRoZSBjdXJyZW50IHN0ZXBcblx0XHRcdF9XRkluc3RhbmNlLmNvbmZpZy5wcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKG9ialByb2Nlc3Mpe1xuXHRcdFx0XHRpZiAob2JqUHJvY2Vzcy5faWQgPT09IHByb2Nlc3NJZCkge1xuXHRcdFx0XHRcdG9ialByb2Nlc3Muc3ViUHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihvYmpTdWJQcm9jZXNzKXtcblx0XHRcdFx0XHRcdGlmIChvYmpTdWJQcm9jZXNzLl9pZCA9PT0gc3ViUHJvY2Vzc0lkKSB7XG5cdFx0XHRcdFx0XHRcdHN1YlByb2Nlc3MgPSBvYmpTdWJQcm9jZXNzO1xuXHRcdFx0XHRcdFx0XHRvYmpTdWJQcm9jZXNzLnN0ZXBzLmZpbHRlcihmdW5jdGlvbihvYmpTdGVwKXtcblx0XHRcdFx0XHRcdFx0XHRpZiAob2JqU3RlcC5faWQgPT09IHN0ZXBJZCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0c3RlcCA9IG9ialN0ZXA7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR9KVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pXG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdFx0Ly8gVXBkYXRlIHRoZSBzdWItcHJvY2VzcyBzdGVwIGRhdGFcblx0XHRcdG1vZGVsLmlkID0gc3RlcElkO1xuXHRcdFx0bW9kZWwuc2VxID0gc3RlcFNlcTtcblx0XHRcdG1vZGVsLnN0YXR1cyA9IHN0ZXAuX3NldEluc3RhbmNlU3RhdHVzVG87XG5cdFx0XHRtb2RlbC5tZXNzYWdlID0gc3RlcC5fc2V0U3RhdHVzTXNnVG87XG5cdFx0XHRtb2RlbC5hc3NpZ25lZFRvLnVzZXJJZCA9IGlucHV0RGF0YS51c2VySWQ7XG5cdFx0XHRtb2RlbC5hc3NpZ25lZFRvLm5hbWUgPSBpbnB1dERhdGEubmFtZTtcblx0XHRcdG1vZGVsLmNvbW1lbnQgPSBpbnB1dERhdGEuY29tbWVudCAhPT0gdW5kZWZpbmVkID8gaW5wdXREYXRhLmNvbW1lbnQgOiAnJztcblx0XHRcdC8vIElmIGFjdGlvbnMgYXJlIHNwcmVjaWZpZWQsIGV4ZWN1dGUgdGhlbVxuXHRcdFx0aWYgKHN0ZXAuYWN0aW9uc1swXSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRcdGFjdGlvbnMoc3RlcC5hY3Rpb25zLCBzdWJQcm9jZXNzLCBfV0ZJbnN0YW5jZSkudGhlbihmdW5jdGlvbihyZXN1bHQpe1xuXHRcdFx0XHRcdC8vIEV4ZWN1dGUgdGhlIHRyYW5zaXRpb25zLCBpZiBhdXRvXG5cdFx0XHRcdFx0dmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ0FjdGlvbnMgY29tcGxldGVkIHN1Y2Nlc3NmdWxseS4nLCBtb2RlbCk7XG5cdFx0XHRcdFx0cmVzb2x2ZShzdWNjZXNzKTtcblx0XHRcdFx0fSwgZnVuY3Rpb24oZXJyKXtcblx0XHRcdFx0XHRyZWplY3QoZXJyKTtcblx0XHRcdFx0fSlcblx0XHRcdC8vIEVsc2UgdGFza3MgYXJlIHNwcmVjaWZpZWQsIGV4ZWN1dGUgdGhlbVxuXHRcdFx0fSBlbHNlIGlmIChzdGVwLnRhc2sgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0XHR2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnVGFzayBhd2FpdGluZyB1c2VyIGFjdGlvbi4nLCBtb2RlbCk7XG5cdFx0XHRcdHJlc29sdmUoc3VjY2Vzcyk7XG5cdFx0XHR9XG5cdFx0fSBjYXRjaChlcnIpIHtcbiAgICBcdHJlamVjdChlcnIpO1xuICAgIH1cblx0fSk7XG59O1xuXG4vKipcbiAqIFByb2Nlc3MgYWN0aW9uc1xuICpcbiAqIEBwYXJhbSB7b2JqZWN0fSBhY3Rpb25zIC0gdGhlIGFjdGlvbnMgY29uZmlnIGRhdGFcbiAqIEBwYXJhbSB7b2JqZWN0fSBzdWJQcm9jZXNzIC0gdGhlIGN1cnJlbnQgc3ViLXByb2Nlc3MgZm9ybSBjb25maWcgZGF0YVxuICogQHBhcmFtIHtvYmplY3R9IF9XRkluc3RhbmNlIC0gdGhlIGN1cnJlbnQgd29ya2Zsb3cgY29uc3RydWN0b3IgaW5zdGFuY2VcbiAqXG4gKiBAZXhhbXBsZSAnJ1xuICpcbiAqIEByZXR1cm4gJydcbiAqXG4gKi9cbmZ1bmN0aW9uIGFjdGlvbnMoYWN0aW9ucywgc3ViUHJvY2VzcywgX1dGSW5zdGFuY2Upe1xuXHR2YXIgYXJyQWN0aW9ucyA9IFtdO1xuXHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG5cdFx0dXRpbC5zeW5jTG9vcChhY3Rpb25zLmxlbmd0aCwgZnVuY3Rpb24obG9vcCl7XG5cdFx0XHR2YXIgY291bnRlciA9IGxvb3AuaXRlcmF0aW9uKCk7XG5cdFx0XHRhY3Rpb24oYWN0aW9uc1tjb3VudGVyXSwgc3ViUHJvY2VzcywgX1dGSW5zdGFuY2UpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KXtcblx0XHRcdFx0dmFyIHJldEFjdGlvbiA9IHsgaWQ6IGFjdGlvbnNbY291bnRlcl0uX2lkLCBzZXE6IGNvdW50ZXIsIGRhdGE6IHJlc3VsdCB9O1xuXHRcdFx0XHRhcnJBY3Rpb25zLnB1c2gocmV0QWN0aW9uKTtcblx0XHRcdFx0bG9vcC5uZXh0KCk7XG5cdFx0XHR9LCBmdW5jdGlvbihlcnIpe1xuXHRcdFx0XHRsb29wLmJyZWFrKCk7XG5cdFx0XHRcdHJlamVjdChlcnIpO1xuXHRcdFx0fSk7XG5cdFx0fSwgZnVuY3Rpb24oKXtcblx0XHRcdC8vIE9uIGNvbXBsZXRpb24gb2YgdGhlIGxvb3Bcblx0XHRcdHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdBY3Rpb25zIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkuJywgYXJyQWN0aW9ucyk7XG5cdFx0XHRyZXNvbHZlKHN1Y2Nlc3MpO1xuXHRcdH0pO1xuXHR9KTtcbn07XG5cbi8qKlxuICogUHJvY2VzcyBhY3Rpb25cbiAqXG4gKiBAcGFyYW0ge29iamVjdH0gYWN0aW9uIC0gdGhlIGFjdGlvbiBjb25maWcgZGF0YVxuICogQHBhcmFtIHtvYmplY3R9IHN1YlByb2Nlc3MgLSB0aGUgY3VycmVudCBzdWItcHJvY2VzcyBmb3JtIGNvbmZpZyBkYXRhXG4gKiBAcGFyYW0ge29iamVjdH0gX1dGSW5zdGFuY2UgLSB0aGUgY3VycmVudCB3b3JrZmxvdyBjb25zdHJ1Y3RvciBpbnN0YW5jZVxuICpcbiAqIEBleGFtcGxlICcnXG4gKlxuICogQHJldHVybiAnJ1xuICpcbiAqL1xuZnVuY3Rpb24gYWN0aW9uKGFjdGlvbiwgc3ViUHJvY2VzcywgX1dGSW5zdGFuY2Upe1xuXHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG5cdFx0dmFyIGFyZ3MgPSBbXTtcblx0XHR2YXIgY29udGV4dCA9ICdnbG9iYWwnO1xuXHRcdHZhciBtZXRob2QgPSAnJztcblx0XHRpZiAoYWN0aW9uLl9pZCAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRjb250ZXh0ID0gYWN0aW9uLl9pZC5zcGxpdChcIi5cIilbMF07XG5cdFx0fVxuXHRcdGlmIChhY3Rpb24uX2lkICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdG1ldGhvZCA9IGFjdGlvbi5faWQuc3BsaXQoXCIuXCIpWzFdO1xuXHRcdH1cblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IGFjdGlvbi5fYXJncy5sZW5ndGg7IGkrKykge1xuXHRcdFx0dmFyIGFyZyA9IGFjdGlvbi5fYXJnc1tpXTtcblx0XHRcdHN3aXRjaChhcmcpIHtcblx0XHRcdFx0Y2FzZSAnc3ViUHJvY2Vzcy5pbmRpY2F0b3JzJzpcblx0XHRcdFx0XHQvLyBBZGQgdGhlIHJlcXVpcmVkIHBhcmFtZXRlcnMgdG8gdGhlIGFyZ3MgYXJyYXlcblx0XHRcdFx0XHRhcmdzLnB1c2goc3ViUHJvY2Vzcy5pbmRpY2F0b3JzKTtcblx0XHRcdFx0XHRhcmdzLnB1c2goX1dGSW5zdGFuY2UpO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHRcdGFyZ3MgPSBbXTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYgKGNvbnRleHQgPT09ICdmb3JtJykge1xuXHRcdFx0Zm9ybVttZXRob2RdKGFyZ3MpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KXtcblx0XHRcdFx0cmVzb2x2ZShyZXN1bHQuZGF0YSk7XG5cdFx0XHR9LCBmdW5jdGlvbihlcnIpe1xuXHRcdFx0XHRyZWplY3QoZXJyKTtcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR2YXIgZXJyb3IgPSB1dGlsLmVycm9yKCdXRkFjdGlvbkVycm9yJywgJ01vZHVsZTogJyArIGNvbnRleHQgKyAnIG5vdCBkZWZpbmVkLicpO1xuXHRcdFx0cmVqZWN0KGVycm9yKTtcblx0XHR9XG5cdH0pO1xufTtcblxuLyoqXG4gKiBQcm9jZXNzIHRhc2tcbiAqXG4gKiBAcGFyYW0ge29iamVjdH0gdGFzayAtIHRoZSB0YXNrIGNvbmZpZyBkYXRhXG4gKiBAcGFyYW0ge29iamVjdH0gaW5wdXREYXRhIC0gdGhlIHVzZXIgaW5wdXQgZGF0YVxuICpcbiAqIEBleGFtcGxlICcnXG4gKlxuICogQHJldHVybiAnJ1xuICpcbiAqL1xuZnVuY3Rpb24gdGFzayh0YXNrKXtcblx0cmV0dXJuICdJbXBsZW1lbnRhdGlvbiBwZW5kaW5nLi4nO1xufTtcblxuLyoqXG4gKiBQcm9jZXNzIHRyYW5zaXRpb25cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gcHJvY2Vzc0lkIC0gdGhlIFdvcmtmbG93IGNvbmZpZyAvIGRlZmluaXRpb24gcHJvY2VzcyBpZFxuICogQHBhcmFtIHtudW1iZXJ9IHByb2Nlc3NTZXEgLSB0aGUgV29ya2Zsb3cgaW5zdGFuY2UgcHJvY2VzcyBzZXFcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdWJQcm9jZXNzSWQgLSB0aGUgV29ya2Zsb3cgY29uZmlnIC8gZGVmaW5pdGlvbiBzdWItcHJvY2VzcyBpZFxuICogQHBhcmFtIHtudW1iZXJ9IHN1YlByb2Nlc3NTZXEgLSB0aGUgV29ya2Zsb3cgaW5zdGFuY2Ugc3ViLXByb2Nlc3Mgc2VxXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RlcElkIC0gdGhlIFdvcmtmbG93IGNvbmZpZyAvIGRlZmluaXRpb24gc3RlcCBpZFxuICogQHBhcmFtIHtzdHJpbmd9IHRyYW5zaXRpb25JZCAtIHRoZSBXb3JrZmxvdyBjb25maWcgLyBkZWZpbml0aW9uIHRyYW5zaXRpb24gaWRcbiAqIEBwYXJhbSB7b2JqZWN0fSBkYXRhIC0gYW55IGFkZGl0aW9uYWwgZGF0YSBwYXNzZWQgaW4gYXMga2V5IHZhbHVlIHBhaXJzXG4gKiBAcGFyYW0ge29iamVjdH0gX1dGSW5zdGFuY2UgLSB0aGUgY3VycmVudCB3b3JrZmxvdyBjb25zdHJ1Y3RvciBpbnN0YW5jZVxuICpcbiAqIEBleGFtcGxlICcnXG4gKlxuICogQHJldHVybiAnJ1xuICpcbiAqL1xuZnVuY3Rpb24gdHJhbnNpdGlvbihwcm9jZXNzSWQsIHByb2Nlc3NTZXEsIHN1YlByb2Nlc3NJZCwgc3ViUHJvY2Vzc1NlcSwgc3RlcElkLCB0cmFuc2l0aW9uSWQsIGRhdGEsIF9XRkluc3RhbmNlKXtcblx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuXHRcdHRyeSB7XG5cdFx0XHR2YXIgc3RlcFNlcSA9IDA7XG5cdFx0XHR2YXIgbmV4dFN0ZXBJZCA9ICcnO1xuXHRcdFx0dmFyIG5leHRTdGVwU2VxID0gMDtcblx0XHRcdHZhciBzdWJQcm9jZXNzID0gW107XG5cdFx0XHR2YXIgY3VycmVudFByb2Nlc3MgPSBfV0ZJbnN0YW5jZS5jb25maWcucHJvY2Vzc2VzLmZpbHRlcihmdW5jdGlvbihvYmpQcm9jZXNzKXtcblx0XHRcdFx0aWYgKG9ialByb2Nlc3MuX2lkID09PSBwcm9jZXNzSWQpIHtcblx0XHRcdFx0XHRyZXR1cm4gb2JqUHJvY2Vzcztcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0XHR2YXIgY3VycmVudFN1YlByb2Nlc3MgPSBjdXJyZW50UHJvY2Vzc1swXS5zdWJQcm9jZXNzZXMuZmlsdGVyKGZ1bmN0aW9uKG9ialN1YlByb2Nlc3Mpe1xuXHRcdFx0XHRpZiAob2JqU3ViUHJvY2Vzcy5faWQgPT09IHN1YlByb2Nlc3NJZCkge1xuXHRcdFx0XHRcdHJldHVybiBvYmpTdWJQcm9jZXNzO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHRcdHZhciBjdXJyZW50U3RlcCA9IGN1cnJlbnRTdWJQcm9jZXNzWzBdLnN0ZXBzLmZpbHRlcihmdW5jdGlvbihvYmpTdGVwKXtcblx0XHRcdFx0aWYgKG9ialN0ZXAuX2lkID09PSBzdGVwSWQpIHtcblx0XHRcdFx0XHRyZXR1cm4gb2JqU3RlcDtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0XHR2YXIgdHJhbnNpdGlvbiA9IGN1cnJlbnRTdGVwWzBdLnRyYW5zaXRpb25zLmZpbHRlcihmdW5jdGlvbihvYmpUcmFuc2l0aW9uKXtcblx0XHRcdFx0aWYgKG9ialRyYW5zaXRpb24uX2lkID09PSB0cmFuc2l0aW9uSWQpIHtcblx0XHRcdFx0XHRyZXR1cm4gb2JqVHJhbnNpdGlvbjtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IGN1cnJlbnRTdWJQcm9jZXNzWzBdLnN0ZXBzLmxlbmd0aDsgaSsrKXtcblx0XHRcdFx0aWYgKGN1cnJlbnRTdWJQcm9jZXNzWzBdLnN0ZXBzW2ldLl9pZCA9PT0gc3RlcElkKSB7XG5cdFx0XHRcdFx0c3RlcFNlcSA9IHBhcnNlSW50KGN1cnJlbnRTdWJQcm9jZXNzWzBdLnN0ZXBzW2ldLl9zZXEpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHRjdXJyZW50U3ViUHJvY2Vzc1swXS5zdGVwcy5maWx0ZXIoZnVuY3Rpb24oc3RlcEl0ZW0pe1xuXHRcdFx0XHRuZXh0U3RlcFNlcSA9IHN0ZXBTZXEgKyAxO1xuXHRcdFx0XHRpZiAocGFyc2VJbnQoc3RlcEl0ZW0uX3NlcSkgPT09IG5leHRTdGVwU2VxKSB7XG5cdFx0XHRcdFx0bmV4dFN0ZXBJZCA9IHN0ZXBJdGVtLl9pZDtcblx0XHRcdFx0fVxuXHRcdFx0fSlcblx0XHRcdF9XRkluc3RhbmNlLmluc3RhbmNlLnByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24ob2JqUHJvY2Vzcyl7XG5cdFx0XHRcdGlmIChvYmpQcm9jZXNzLmlkID09PSBwcm9jZXNzSWQgJiYgb2JqUHJvY2Vzcy5zZXEgPT09IHByb2Nlc3NTZXEpIHtcblx0XHRcdFx0XHRvYmpQcm9jZXNzLnN1YlByb2Nlc3Nlcy5maWx0ZXIoZnVuY3Rpb24ob2JqU3ViUHJvY2Vzcyl7XG5cdFx0XHRcdFx0XHRpZiAob2JqU3ViUHJvY2Vzcy5pZCA9PT0gc3ViUHJvY2Vzc0lkICYmIG9ialN1YlByb2Nlc3Muc2VxID09PSBzdWJQcm9jZXNzU2VxKSB7XG5cdFx0XHRcdFx0XHRcdHN1YlByb2Nlc3MgPSBvYmpTdWJQcm9jZXNzO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pXG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdFx0dmFyIG1heFN0ZXBzID0gY3VycmVudFN1YlByb2Nlc3NbMF0uc3RlcHMubGVuZ3RoO1xuXHRcdFx0c3dpdGNoKHRyYW5zaXRpb25bMF0uX3R5cGUpIHtcblx0XHRcdFx0Y2FzZSAnYXV0byc6XG5cdFx0XHRcdFx0aWYgKHRyYW5zaXRpb25bMF0uZ29Uby5fdHlwZSA9PT0gJ25leHRTdGVwJykge1xuXHRcdFx0XHRcdFx0c3RlcChwcm9jZXNzSWQsIHN1YlByb2Nlc3NJZCwgbmV4dFN0ZXBJZCwgbmV4dFN0ZXBTZXEsIGRhdGEsIF9XRkluc3RhbmNlKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCl7XG5cdFx0XHRcdFx0XHRcdGlmIChuZXh0U3RlcFNlcSA9PT0gbWF4U3RlcHMpIHtcblx0XHRcdFx0XHRcdFx0XHR2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnQWxsIFN0ZXAgdHJhbnNpdGlvbnMgaGF2ZSBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5LicsIHsgc3ViUHJvY2Vzc0NvbXBsZXRlOiB0cnVlLCBzdGVwOiByZXN1bHQuZGF0YSB9KTtcblx0XHRcdFx0XHRcdFx0XHRyZXNvbHZlKHN1Y2Nlc3MpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdTdGVwIHRyYW5zaXRpb24gY29tcGxldGVkIHN1Y2Nlc3NmdWxseS4nLCByZXN1bHQuZGF0YSk7XG5cdFx0XHRcdFx0XHRcdFx0cmVzb2x2ZShzdWNjZXNzKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnU3RlcCB0cmFuc2l0aW9uIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkuJywgcmVzdWx0LmRhdGEpO1xuXHRcdFx0XHRcdFx0XHRyZXNvbHZlKHN1Y2Nlc3MpO1xuXHRcdFx0XHRcdFx0fSwgZnVuY3Rpb24oZXJyKXtcblx0XHRcdFx0XHRcdFx0cmVqZWN0KGVycik7XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdGNhc2UgJ3VzZXInOlxuXHRcdFx0XHRcdGlmICh0cmFuc2l0aW9uWzBdLmdvVG8uX3R5cGUgPT09ICduZXh0U3RlcCcpIHtcblx0XHRcdFx0XHRcdHN0ZXAocHJvY2Vzc0lkLCBzdWJQcm9jZXNzSWQsIG5leHRTdGVwSWQsIG5leHRTdGVwU2VxLCBkYXRhLCBfV0ZJbnN0YW5jZSkudGhlbihmdW5jdGlvbihyZXN1bHQpe1xuXHRcdFx0XHRcdFx0XHRpZiAobmV4dFN0ZXBTZXEgPT09IG1heFN0ZXBzKSB7XG5cdFx0XHRcdFx0XHRcdFx0dmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ0FsbCBTdGVwIHRyYW5zaXRpb25zIGhhdmUgY29tcGxldGVkIHN1Y2Nlc3NmdWxseS4nLCB7IHN1YlByb2Nlc3NDb21wbGV0ZTogdHJ1ZSwgc3RlcDogcmVzdWx0LmRhdGEgfSk7XG5cdFx0XHRcdFx0XHRcdFx0cmVzb2x2ZShzdWNjZXNzKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHR2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnU3RlcCB0cmFuc2l0aW9uIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkuJywgcmVzdWx0LmRhdGEpO1xuXHRcdFx0XHRcdFx0XHRcdHJlc29sdmUoc3VjY2Vzcyk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0dmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ1N0ZXAgdHJhbnNpdGlvbiBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5LicsIHJlc3VsdC5kYXRhKTtcblx0XHRcdFx0XHRcdFx0cmVzb2x2ZShzdWNjZXNzKTtcblx0XHRcdFx0XHRcdH0sIGZ1bmN0aW9uKGVycil7XG5cdFx0XHRcdFx0XHRcdHJlamVjdChlcnIpO1xuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICh0cmFuc2l0aW9uWzBdLmdvVG8uX3R5cGUgPT09ICdzdGVwSWQnKSB7XG5cdFx0XHRcdFx0XHR2YXIgZ29Ub1N0ZXBJZCA9IHRyYW5zaXRpb25bMF0uZ29Uby5fc3RlcElkO1xuXHRcdFx0XHRcdFx0dmFyIGdvVG9TdGVwU2VxID0gMTtcblx0XHRcdFx0XHRcdGN1cnJlbnRTdWJQcm9jZXNzWzBdLnN0ZXBzLmZpbHRlcihmdW5jdGlvbihzdGVwSXRlbSl7XG5cdFx0XHRcdFx0XHRcdGlmIChzdGVwSXRlbS5faWQgPT09IGdvVG9TdGVwSWQpIHtcblx0XHRcdFx0XHRcdFx0XHRnb1RvU3RlcFNlcSA9IHBhcnNlSW50KHN0ZXBJdGVtLl9zZXEpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9KVxuXHRcdFx0XHRcdFx0c3RlcChwcm9jZXNzSWQsIHN1YlByb2Nlc3NJZCwgZ29Ub1N0ZXBJZCwgZ29Ub1N0ZXBTZXEsIGRhdGEsIF9XRkluc3RhbmNlKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCl7XG5cdFx0XHRcdFx0XHRcdGlmIChnb1RvU3RlcFNlcSA9PT0gbWF4U3RlcHMpIHtcblx0XHRcdFx0XHRcdFx0XHR2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnQWxsIFN0ZXAgdHJhbnNpdGlvbnMgaGF2ZSBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5LicsIHsgc3ViUHJvY2Vzc0NvbXBsZXRlOiB0cnVlLCBzdGVwOiByZXN1bHQuZGF0YSB9KTtcblx0XHRcdFx0XHRcdFx0XHRyZXNvbHZlKHN1Y2Nlc3MpO1xuXHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdHZhciBzdWNjZXNzID0gdXRpbC5zdWNjZXNzKCdTdGVwIHRyYW5zaXRpb24gY29tcGxldGVkIHN1Y2Nlc3NmdWxseS4nLCByZXN1bHQuZGF0YSk7XG5cdFx0XHRcdFx0XHRcdFx0cmVzb2x2ZShzdWNjZXNzKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR2YXIgc3VjY2VzcyA9IHV0aWwuc3VjY2VzcygnU3RlcCB0cmFuc2l0aW9uIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkuJywgcmVzdWx0LmRhdGEpO1xuXHRcdFx0XHRcdFx0XHRyZXNvbHZlKHN1Y2Nlc3MpO1xuXHRcdFx0XHRcdFx0fSwgZnVuY3Rpb24oZXJyKXtcblx0XHRcdFx0XHRcdFx0cmVqZWN0KGVycik7XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdFx0dmFyIGVycm9yID0gdXRpbC5lcnJvcignV0ZUcmFuc2l0aW9uRXJyb3InLCdUcmFuc2l0aW9uIHR5cGU6ICcgKyB0cmFuc2l0aW9uWzBdLl90eXBlICsgJyBub3QgZGVmaW5lZC4nKTtcblx0XHRcdFx0XHRyZWplY3QoZXJyb3IpO1xuXHRcdFx0fVxuXHRcdH0gY2F0Y2goZXJyKXtcblx0XHRcdHJlamVjdChlcnIpO1xuXHRcdH1cblx0fSk7XG59O1xuXG4vKipcbiAqIFByb2Nlc3MgcG9zdEFjdGlvbnNcbiAqXG4gKiBAcGFyYW0ge29iamVjdH0gcG9zdEFjdGlvbnMgLSB0aGUgcG9zdEFjdGlvbnMgY29uZmlnIGRhdGFcbiAqXG4gKiBAZXhhbXBsZSAnJ1xuICpcbiAqIEByZXR1cm4gJydcbiAqXG4gKi9cbmZ1bmN0aW9uIHBvc3RBY3Rpb25zKHBvc3RBY3Rpb25zKXtcblx0cmV0dXJuICdJbXBsZW1lbnRhdGlvbiBwZW5kaW5nLi4nO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSB7XG5cbiBcdHByZVJlcXVpc2l0ZXM6IHByZVJlcXVpc2l0ZXMsXG4gXHRwcmVBY3Rpb25zOiBwcmVBY3Rpb25zLFxuIFx0c3ViUHJvY2Vzczogc3ViUHJvY2VzcyxcbiBcdHRhc2s6IHRhc2ssXG4gXHR0cmFuc2l0aW9uOiB0cmFuc2l0aW9uXG5cbn1cbiIsIid1c2Ugc3RyaWN0JztcblxudmFyIGZvcm0gPSByZXF1aXJlKCcuL2Zvcm0nKTtcblxuLyoqXG4gKiBVdGlsaXR5IE1vZHVsZVxuICpcbiAqIEBtb2R1bGUgbGliL3V0aWxcbiAqXG4gKiBAYXV0aG9yIEJyZW50IEdvcmRvblxuICogQHZlcnNpb24gMC4xLjBcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIFdvcmtmbG93IHV0aWxpdHkgbW9kdWxlIHVzZWQgdG8gZm9ybWF0IHRoZSByZXR1cm4gYW5kIGVycm9yIG9iamVjdHMsIGFuZFxuICogY29udGFpbnMgc29tZSBvdGhlciB1dGlsaXR5IGZ1bmN0aW9ucyBzdWNoIGFzIGEgc3luYyBsb29wIGFuZCBjb21wYXJlLlxuICpcbiAqL1xuXG4vKipcbiAqIFN1Y2Nlc3MgYmxvY2sgcmV0dXJuIG9iamVjdCwgY29udGFpbnMgYSBtZXNzYWdlIGFuZCBvcHRpb25hbCBkYXRhIG9iamVjdC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gbWVzc2FnZSAtIHRoZSBzdWNjZXNzIG1lc3NhZ2VcbiAqIEBwYXJhbSB7c3RyaW5nfE9iamVjdH0gW2RhdGFdIC0gdGhlIHN1Y2Nlc3MgcmV0dXJuZWQgZGF0YVxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyBSZXR1cm4gc3VjY2VzcyB3aXRob3V0IGEgZGF0YSBibG9ja1xuICogdmFyIHN1Y2Nlc3MgPSB1dGlsLnN1Y2Nlc3MoJ1N1Y2Nlc3MgbWVzc2FnZSBnb2VzIGhlcmUuLi4nKTtcbiAqXG4gKiBAcmV0dXJuIHtPYmplY3R9IC0gd2l0aCBtZXNzYWdlIGFuZCBkYXRhIHByb3BlcnRpZXNcbiAqXG4gKi9cbmZ1bmN0aW9uIHN1Y2Nlc3MobWVzc2FnZSwgZGF0YSl7XG5cdHJldHVybiB7XG5cdFx0bWVzc2FnZTogbWVzc2FnZSxcblx0XHRkYXRhOiBkYXRhXG5cdH07XG59O1xuXG4vKipcbiAqIFdhcm5pbmcgYmxvY2sgcmV0dXJuIG9iamVjdCwgY29udGFpbnMgYSBtZXNzYWdlIGFuZCBvcHRpb25hbCBkYXRhIG9iamVjdC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gbWVzc2FnZSAtIHRoZSB3YXJuaW5nIG1lc3NhZ2VcbiAqIEBwYXJhbSB7c3RyaW5nfE9iamVjdH0gW2RhdGFdIC0gdGhlIHJldHVybmVkIGRhdGFcbiAqXG4gKiBAZXhhbXBsZVxuICogLy8gUmV0dXJuIHN1Y2Nlc3Mgd2l0aG91dCBhIGRhdGEgYmxvY2tcbiAqIHZhciBzdWNjZXNzID0gdXRpbC53YXJuKCdXYXJuaW5nIG1lc3NhZ2UgZ29lcyBoZXJlLi4uJyk7XG4gKlxuICogQHJldHVybiB7T2JqZWN0fSB3aXRoIG1lc3NhZ2UgYW5kIGRhdGEgcHJvcGVydGllcywgYW5kIGxvZ3MgdGhlIHdhcm5pbmcgdG8gdGhlIGNvbnNvbGUuXG4gKlxuICovXG5mdW5jdGlvbiB3YXJuKG1lc3NhZ2UsIGRhdGEpe1xuXHRjb25zb2xlLndhcm4oZGF0YSk7XG5cdHJldHVybiB7XG5cdFx0d2FybmluZzogbWVzc2FnZSxcblx0XHRkYXRhOiBkYXRhXG5cdH07XG59O1xuXG4vKipcbiAqIEVycm9yIGJsb2NrIEpTIGVycm9yIG9iamVjdCwgY29udGFpbnMgYSBjb2RlIGFuZCBtZXNzYWdlIGZvciB0aGUgZXJyb3IuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGNvZGUgLSB0aGUgZXJyb3IgY29kZVxuICogQHBhcmFtIHtzdHJpbmd9IG1lc3NhZ2UgLSB0aGUgZXJyb3IgbWVzc2FnZVxuICpcbiAqIEBleGFtcGxlXG4gKiB2YXIgc3VjY2VzcyA9IHV0aWwuZXJyb3IoJ0Vycm9yMDAxJywnRXJyb3IgbWVzc2FnZSBnb2VzIGhlcmUuLi4nKTtcbiAqXG4gKiBAcmV0dXJuIHtPYmplY3R9IHdpdGggYSBjb2RlIGFuZCBtZXNzYWdlIHByb3BlcnRpZXMuXG4gKlxuICovXG5mdW5jdGlvbiBlcnJvcihjb2RlLCBtZXNzYWdlKXtcblx0dmFyIGVyciA9IG5ldyBFcnJvcignJyk7XG5cdGVyci5uYW1lID0gY29kZTtcblx0ZXJyLm1lc3NhZ2UgPSBtZXNzYWdlO1xuXHRyZXR1cm4gZXJyO1xufTtcblxuLyoqXG4gKiBBIGxvb3Agd2hpY2ggY2FuIGxvb3AgWCBhbW91bnQgb2YgdGltZXMsIHdoaWNoIGNhcnJpZXMgb3V0XG4gKiBhc3luY2hyb25vdXMgY29kZSwgYnV0IHdhaXRzIGZvciB0aGF0IGNvZGUgdG8gY29tcGxldGUgYmVmb3JlIGxvb3BpbmcuXG4gKlxuICogQHBhcmFtIHtudW1iZXJ9IGl0ZXJhdGlvbnMgLSB0aGUgbnVtYmVyIG9mIGl0ZXJhdGlvbnMgdG8gY2Fycnkgb3V0XG4gKiBAcGFyYW0ge2Z1bmN0aW9ufSBwcm9jZXNzIC0gdGhlIGNvZGUvZnVuY3Rpb24gd2UncmUgcnVubmluZyBmb3IgZXZlcnlcbiAqIGl0ZXJhdGlvblxuICogQHBhcmFtIHtmdW5jdGlvbn0gZXhpdCAtIGFuIG9wdGlvbmFsIGNhbGxiYWNrIHRvIGNhcnJ5IG91dCBvbmNlIHRoZSBsb29wXG4gKiBoYXMgY29tcGxldGVkXG4gKlxuICogQGV4YW1wbGVcbiAqIHV0aWwuc3luY0xvb3AoNSwgZnVuY3Rpb24obG9vcCl7XG4gKiBcdHZhciBjb3VudGVyID0gbG9vcC5pdGVyYXRpb24oKTtcbiAqIFx0Ly8gQWRkIGFzeW5jIGNhbGxzIGhlcmUuLlxuICpcbiAqIH0sIGZ1bmN0aW9uKCl7XG4gKiBcdC8vIE9uIGNvbXBsZXRlIHBlcmZvcm0gYWN0aW9ucyBoZXJlLi4uXG4gKlxuICogfSk7XG4gKlxuICogQHJldHVybiB7T2JqZWN0fSB0aGUgbG9vcCBjb250cm9sIG9iamVjdC5cbiAqXG4gKi9cbmZ1bmN0aW9uIHN5bmNMb29wKGl0ZXJhdGlvbnMsIHByb2Nlc3MsIGV4aXQpe1xuICAgIHZhciBpbmRleCA9IDAsXG4gICAgICAgIGRvbmUgPSBmYWxzZSxcbiAgICAgICAgc2hvdWxkRXhpdCA9IGZhbHNlO1xuICAgIHZhciBsb29wID0ge1xuICAgICAgICBuZXh0OmZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBpZihkb25lKXtcbiAgICAgICAgICAgICAgICBpZihzaG91bGRFeGl0ICYmIGV4aXQpe1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXhpdCgpOyAvLyBFeGl0IGlmIHdlJ3JlIGRvbmVcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBJZiB3ZSdyZSBub3QgZmluaXNoZWRcbiAgICAgICAgICAgIGlmKGluZGV4IDwgaXRlcmF0aW9ucyl7XG4gICAgICAgICAgICAgICAgaW5kZXgrKzsgLy8gSW5jcmVtZW50IG91ciBpbmRleFxuICAgICAgICAgICAgICAgIHByb2Nlc3MobG9vcCk7IC8vIFJ1biBvdXIgcHJvY2VzcywgcGFzcyBpbiB0aGUgbG9vcFxuICAgICAgICAgICAgLy8gT3RoZXJ3aXNlIHdlJ3JlIGRvbmVcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZG9uZSA9IHRydWU7IC8vIE1ha2Ugc3VyZSB3ZSBzYXkgd2UncmUgZG9uZVxuICAgICAgICAgICAgICAgIGlmKGV4aXQpIGV4aXQoKTsgLy8gQ2FsbCB0aGUgY2FsbGJhY2sgb24gZXhpdFxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBpdGVyYXRpb246ZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJldHVybiBpbmRleCAtIDE7IC8vIFJldHVybiB0aGUgbG9vcCBudW1iZXIgd2UncmUgb25cbiAgICAgICAgfSxcbiAgICAgICAgYnJlYWs6ZnVuY3Rpb24oZW5kKXtcbiAgICAgICAgICAgIGRvbmUgPSB0cnVlOyAvLyBFbmQgdGhlIGxvb3BcbiAgICAgICAgICAgIHNob3VsZEV4aXQgPSBlbmQ7IC8vIFBhc3NpbmcgZW5kIGFzIHRydWUgbWVhbnMgd2Ugc3RpbGwgY2FsbCB0aGUgZXhpdCBjYWxsYmFja1xuICAgICAgICB9XG4gICAgfTtcbiAgICBsb29wLm5leHQoKTtcbiAgICByZXR1cm4gbG9vcDtcbn07XG5cbmZ1bmN0aW9uIGNvbXBhcmUoc3ViamVjdCwgb3BlcmF0b3IsIHZhbHVlKSB7XG4gIFx0c3dpdGNoIChvcGVyYXRvcikge1xuICBcdFx0Y2FzZSAnZ3JlYXRlclRoYW4nOlxuXHRcdFx0cmV0dXJuIHN1YmplY3QgPiB2YWx1ZTtcblx0XHRjYXNlICdsZXNzVGhhbic6XG5cdFx0XHRyZXR1cm4gc3ViamVjdCA8IHZhbHVlO1xuXHRcdGNhc2UgJ2dyZWF0ZXJUaGFuRXF1YWwnOlxuXHRcdFx0cmV0dXJuIHN1YmplY3QgPj0gdmFsdWU7XG5cdFx0Y2FzZSAnbGVzc1RoYW5FcXVhbCc6XG5cdFx0XHRyZXR1cm4gc3ViamVjdCA8PSB2YWx1ZTtcblx0XHRjYXNlICdlcXVhbFRvJzpcblx0XHRcdHJldHVybiBzdWJqZWN0ID09PSB2YWx1ZTtcblx0XHRjYXNlICdub3RFcXVhbFRvJzpcblx0XHRcdHJldHVybiBzdWJqZWN0ICE9PSB2YWx1ZTtcbiAgXHR9XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IHtcblxuIFx0c3VjY2Vzczogc3VjY2VzcyxcbiBcdHdhcm46IHdhcm4sXG4gXHRlcnJvcjogZXJyb3IsXG4gXHRzeW5jTG9vcDogc3luY0xvb3AsXG4gXHRjb21wYXJlOiBjb21wYXJlXG5cbiB9XG4iXX0=
